/**
 * IMPORTANT NOTE:
 *
 * This file is licensed only for the use of Apple developers in providing MusicKit Web Services,
 * and is subject to the Apple Media Services Terms and Conditions and the Apple Developer Program
 * License Agreement. You may not copy, modify, re-host, or create derivative works of this file or the
 * accompanying Documentation, or any part thereof, including any updates, without Apple's written consent.
 *
 * ACKNOWLEDGEMENTS:
 * https://js-cdn.music.apple.com/musickit/v1/acknowledgements.txt
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).MusicKit={})}(this,(function(e){"use strict";var t=void 0!==typeof self?self:this,r="undefined"!=typeof FastBoot?FastBoot.require("buffer").Buffer:"undefined"!=typeof process&&null!==process.versions&&null!==process.versions.node?Buffer:window.Buffer;function memoize(e){return function(...t){let r="",n=t.length;for(e._memoized=e._memoized||{};n--;){const e=t[n];r+=e===Object(e)?JSON.stringify(e):e}return r in e._memoized?e._memoized[r]:e._memoized[r]=e(...t)}}function isObject$1(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function generateUUID(){let e=strRandomizer()+strRandomizer();for(;e.length<16;)e+=strRandomizer();return e.slice(0,16)}function strRandomizer(){return Math.random().toString(16).substring(2)}const n=memoize(e=>/^[a|i|l|p]{1}\.[a-zA-Z0-9]+$/.test(e)),i=memoize(e=>/^(a\.)?[a-zA-Z0-9]+$/.test(e));function isNodeEnvironment$1(e){const isDefined=e=>null!=e;return 0===arguments.length&&"undefined"!=typeof process&&(e=process),isDefined(e)&&isDefined(e.versions)&&isDefined(e.versions.node)||"undefined"!=typeof FastBoot}const a=memoize(isNodeEnvironment$1()?e=>r.from(e,"base64").toString("binary"):e=>window.atob(e));memoize(isNodeEnvironment$1()?e=>r.from(e).toString("base64"):e=>window.btoa(e));const debounce=(e,t=250,r={isImmediate:!1})=>{let n;return function(...i){const a=this,o=r.isImmediate&&void 0===n;void 0!==n&&clearTimeout(n),n=setTimeout((function(){n=void 0,r.isImmediate||e.apply(a,i)}),t),o&&e.apply(a,i)}},arrayEquals=(e,t)=>!!e&&!!t&&[].every.call(e,(e,r)=>e===t[r]),o=memoize(e=>{const t=new Uint16Array(e),r=t.length;let n="";for(let i=0;i<r;i++)n+=String.fromCharCode(t[i]);return n}),s=memoize(e=>{const t=a(e);return c(t)});function ensureArray(e=[]){return Array.isArray(e)?e:[e]}const c=memoize(e=>{const t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}),l=memoize(e=>{const t=e.length,r=new ArrayBuffer(2*t),n=new Uint16Array(r);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}),u=memoize(e=>{let t,r,n,i,a,o,s,c=0;const l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let u="";for(;c<e.length;)t=e[c++],r=c<e.length?e[c++]:Number.NaN,n=c<e.length?e[c++]:Number.NaN,i=t>>2,a=(3&t)<<4|r>>4,o=(15&r)<<2|n>>6,s=63&n,isNaN(r)?o=s=64:isNaN(n)&&(s=64),u+=l.charAt(i)+l.charAt(a)+l.charAt(o)+l.charAt(s);return u});function hasOwn(e,t){return Object.prototype.hasOwnProperty.call(Object(e),t)}function transform$9(e,t,r=!1){return r&&(e=Object.keys(e).reduce((t,r)=>(t[e[r]]=r,t),{})),Object.keys(e).reduce((r,n)=>{const i=e[n],a="function"==typeof i?i():function(e,t){return t.split(".").reduce((e,t)=>{if(void 0!==e)return e[t]},e)}(t,i);return a&&function(e,t,r){t.split(".").reduce((t,n,i,a)=>{const o=i===a.length-1,s=hasOwn(t,n),c=t[n]instanceof Object,l=null===t[n];if(!o&&s&&(!c||l))throw new TypeError(`Value at ${a.slice(0,i+1).join(".")} in keypath is not an Object.`);return o?(t[n]=r,e):s?t[n]:t[n]={}},e)}(r,n,a),r},{})}function transformKeys(e,t){return Object.keys(e).reduce((r,n)=>(r[t(n)]=e[n],r),{})}class GenericStorage{get data(){return this._data}set data(e){this._data=e}get length(){return this.keys.length}get keys(){return Object.keys(this.data)}getItem(e){return this.data[e]||null}setItem(e,t){this.data[e]=t}removeItem(e){delete this.data[e]}clear(){this.keys.forEach(e=>this.removeItem(e))}key(e){return this.keys[e]||null}constructor(e={}){this.data=e}}function getCookie(e="",t=document.cookie){const r=t.match(new RegExp(`(?:^|;\\s*)${e}=([^;]*)`));if(r)return r[1]}function setCookie(e,t,r="",n=14,i,a){const o=new Date;i=null!=i?i:window;const s=(a=null!=a?a:/\./.test(i.location.hostname)?i.location.hostname:"").length>0?`domain=${a}; `:"";o.setTime(o.getTime()+24*n*60*60*1e3);let c="";"https:"===i.location.protocol&&(c="; secure"),i.document.cookie=`${e}=${t}; expires=${o.toUTCString()}; ${s}path=${r}${c}`}function removeCookie(e,t,r){setCookie(e,"","/",0,t,r)}function hasSessionStorage(){let e=!1;try{e="undefined"!=typeof sessionStorage}catch(t){}return e}function getSessionStorage(){let e;return hasSessionStorage()&&(e=sessionStorage),e}function hasLocalStorage(){let e=!1;try{e="undefined"!=typeof localStorage}catch(t){}return e}function getLocalStorage(){let e;return hasLocalStorage()&&(e=localStorage),e}class Notifications{get shouldStorageDispatch(){return"undefined"!=typeof window&&hasSessionStorage()&&this.dispatchNamespace}addEventListener(e,t){Array.isArray(this._eventRegistry[e])&&this._eventRegistry[e].push(t)}dispatchEvent(e,t){Array.isArray(this._eventRegistry[e])&&this._eventRegistry[e].forEach(e=>e(t))}dispatchDistributedEvent(e,t){if(this.dispatchEvent(e,t),this.shouldStorageDispatch){var r;const n=`${this.dispatchNamespace}:${e}`;null===(r=getSessionStorage())||void 0===r||r.setItem(n,JSON.stringify(t))}}removeEventListener(e,t){if(Array.isArray(this._eventRegistry[e])){const r=this._eventRegistry[e].indexOf(t);this._eventRegistry[e].splice(r,1)}}_handleGlobalStorageEvent(e){var t;if(this.dispatchNamespace&&(null===(t=e.key)||void 0===t?void 0:t.startsWith(this.dispatchNamespace+":"))){const t=e.key.substring(this.dispatchNamespace.length+1);this.dispatchEvent(t,JSON.parse(e.newValue))}}constructor(e=[],t){this._eventRegistry={},e.forEach(e=>{this._eventRegistry[e]=[]}),t&&t.namespace&&(this.dispatchNamespace="com.apple."+t.namespace),this.shouldStorageDispatch&&(this._handleGlobalStorageEvent=this._handleGlobalStorageEvent.bind(this),window.addEventListener("storage",this._handleGlobalStorageEvent))}}let isMergeableObject=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){let t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===d}(e)}(e)};let d="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function cloneUnlessOtherwiseSpecified(e,t){return!1!==t.clone&&t.isMergeableObject(e)?deepmerge((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function defaultArrayMerge(e,t,r){return e.concat(t).map((function(e){return cloneUnlessOtherwiseSpecified(e,r)}))}function getKeys(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return e.propertyIsEnumerable(t)})):[]}(e))}function mergeObject(e,t,r){let n={};return r.isMergeableObject(e)&&getKeys(e).forEach((function(t){n[t]=cloneUnlessOtherwiseSpecified(e[t],r)})),getKeys(t).forEach((function(i){r.isMergeableObject(t[i])&&e[i]?n[i]=function(e,t){if(!t.customMerge)return deepmerge;let r=t.customMerge(e);return"function"==typeof r?r:deepmerge}(i,r)(e[i],t[i],r):n[i]=cloneUnlessOtherwiseSpecified(t[i],r)})),n}function deepmerge(e,t,r){(r=r||{}).arrayMerge=r.arrayMerge||defaultArrayMerge,r.isMergeableObject=r.isMergeableObject||isMergeableObject;let n=Array.isArray(t);return n===Array.isArray(e)?n?r.arrayMerge(e,t,r):mergeObject(e,t,r):cloneUnlessOtherwiseSpecified(t,r)}function _defineProperty$K(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$K(e,t,r[t])}))}return e}function _objectSpreadProps$r(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function _objectWithoutProperties$2(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var p;deepmerge.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,r){return deepmerge(e,r,t)}),{})},function(e){e.dataRecordDidDelete="dataRecordDidDelete",e.dataRecordWillDelete="dataRecordWillDelete",e.dataRecordDidMaterialize="dataRecordDidMaterialize",e.dataRecordDidPopulate="dataRecordDidPopulate",e.dataRecordWillPopulate="dataRecordWillPopulate"}(p||(p={}));const isDataRecord=e=>!(!e||"function"!=typeof e.hasAttributes||"function"!=typeof e.hasRelationships||"function"!=typeof e.hasViews||"function"!=typeof e.serialize);class DataRecord{hasProperties(e){return!e||(e.attributes||e.relationships||e.views?!(e.attributes&&!this.hasAttributes(e.attributes))&&(!(e.relationships&&!this.hasRelationships(e.relationships))&&!(e.views&&!this.hasViews(e.views))):this.hasAttributes()||this.hasRelationships()||this.hasViews())}hasAttributes(e){return this._hasProperties(this._mjs.attributes,e)}hasRelationships(e){return this._hasProperties(this._mjs.relationships,e)}hasViews(e){return this._hasProperties(this._mjs.views,e)}meta(e){return e?this._meta[e]:this._meta}serialize(e=!0,t={},r={}){const n={id:this.id,type:this.type};return t[`${this.type}-${this.id}`]&&!r.allowFullDuplicateSerializations?n:(t[`${this.type}-${this.id}`]=!0,this.hasAttributes()&&(n.attributes=this._mjs.attributes.reduce((e,t)=>(e[t]=this[t],e),{})),this._mjs.relationships.length>0&&(n.relationships=this._serializeRelatedData(this._mjs.relationships,t,r)),this._mjs.views.length>0&&(n.views=this._serializeRelatedData(this._mjs.views,t,r)),e?{data:n}:n)}setProperty(e,t,r="attributes",n={}){function isMergeableObject(e){return!(!e||"object"!=typeof e||e instanceof DataRecord)}hasOwn(this,e)||(this._mjs[r]||(this._mjs[r]=[]),this._mjs[r].push(e));const setDescriptor=e=>({value:e,writable:!0,configurable:!0,enumerable:!0});this[e]&&t&&"object"==typeof this[e]&&"object"==typeof t?"attributes"===r?Object.defineProperty(this,e,setDescriptor(deepmerge(this[e],t,{arrayMerge:function(e,t,r){return t},isMergeableObject:isMergeableObject}))):"relationships"===r&&Array.isArray(this[e])&&n.extendRelationships?Object.defineProperty(this,e,setDescriptor(deepmerge(this[e],t,{isMergeableObject:isMergeableObject}))):Object.defineProperty(this,e,setDescriptor(t)):Object.defineProperty(this,e,setDescriptor(t))}removeRelative(e,t){this[e]&&(Array.isArray(this[e])?this[e]=this[e].filter(e=>e.id!==t):delete this[e])}setParent(e){const t=this._mjs.parents,r=t&&t.length>0;this._mjs.parents=r?t.concat(e):e}_hasProperties(e,t){return!!e&&(t?ensureArray(t).every(t=>e.includes(t)):e.length>0)}_serializeRelatedData(e,t={},r={}){return e.reduce((e,n)=>{if(r.excludeRelationships&&r.excludeRelationships.has(n))return e;if(r.includeRelationships&&!r.includeRelationships.has(n))return e;const i=this[n];return Array.isArray(i)?e[n]={data:i.map(e=>"function"==typeof e.serialize?e.serialize(!1,t,r):e)}:e[n]=i&&"function"==typeof i.serialize?i.serialize(!1,t,r):i,e},{})}constructor(e,t,r={}){this.type=e,this.id=t,this._mjs={attributes:[],relationships:[],views:[]},this._meta={},this._mjs=_objectSpread$K({},this._mjs,r)}}class DataStore extends Notifications{get mapping(){return this._mapping}set mapping(e){this._mapping=e}clear(){this._records={},this._expiryRecords=new Set}peek(e,t,r){if(this._checkForExpiredRecords(),!this._records[e])return t?null:[];if(!t)return Object.values(this._records[e]);if(Array.isArray(t))return t.map(t=>{const n=this._records[e][t];if(n&&n.hasProperties(r))return n});const n=this._records[e][t];return n&&n.hasProperties(r)?n:null}populateDataRecords(e,t={},r={}){if(!e.data)return[];if(!Array.isArray(e.data))return this.populateDataRecord(e.data,t,r);const n=[];return e.data.forEach((e,i)=>{const a=_objectSpreadProps$r(_objectSpread$K({},r),{parents:r.parents?[_objectSpreadProps$r(_objectSpread$K({},r.parents[0]),{position:i})]:[]});r.parents&&(r.parents[0].position=i);const o=this.populateDataRecord(e,t,a);n.push(o)}),n}populateDataRecord(e,t={},r){const n=r.filter||this.filter,i=r.mapping||this.mapping;if(n&&!n(e))return;if(i){let t="function"==typeof i?i(e):transform$9(i,e);Object.assign(e,t)}this._shouldDisableRecordReuse&&(t={});const a=this._materializeRecord(t,_objectSpread$K({id:e.id,type:e.type},r));return e.meta&&(a._meta=e.meta),e.attributes&&e.attributes.cachingPolicy&&e.attributes.cachingPolicy.maxAge&&(a._mjs.expiration=Date.now()+1e3*e.attributes.cachingPolicy.maxAge,this._removeOnExpiration&&this._expiryRecords.add(a)),this._populateDataAttributes(e,a),"object"==typeof e.relationships&&Object.keys(e.relationships).forEach(n=>{let o=e.relationships[n];o&&"data"in o&&(o=this.populateDataRecords(o,t,{mapping:i,parents:[{relationshipName:n,parentType:a.type,parentId:a.id}]}),a.setProperty(n,o,"relationships",r))}),"object"==typeof e.views&&Object.keys(e.views).forEach(r=>{const n=e.views[r];if(n.attributes||n.data){const e=new DataRecord("view",r);if(this._populateDataAttributes(n,e),n.data){const r=this.populateDataRecords(n,t,i);e.setProperty("data",r,"relationships")}a.setProperty(r,e,"views")}}),a}query(e,t){this._checkForExpiredRecords();let includeRecord=e=>!1;return"string"==typeof e&&t?includeRecord=r=>(null==r?void 0:r[e])===t:"function"==typeof e?includeRecord=t=>{try{return e(t)}catch(r){return!1}}:"object"==typeof e&&(includeRecord=t=>{const r=Object.keys(e);let n=0;return r.forEach(r=>{(null==t?void 0:t[r])===e[r]&&n++}),r.length===n}),Object.values(this._records).reduce((e,t)=>(Object.values(t).forEach(t=>{includeRecord(t)&&e.push(t)}),e),[])}remove(e,t){setTimeout(this._checkForExpiredRecords.bind(this),0);if(!hasOwn(this._records,e))return;const r=this.peek(e,t);r&&(this.dispatchEvent(p.dataRecordWillDelete,[e,t]),r._mjs.parents&&r._mjs.parents.length>0&&r._mjs.parents.forEach(({relationshipName:e,parentType:t,parentId:n})=>{this.peek(t,n).removeRelative(e,r.id)}),delete this._records[e][t],this.dispatchEvent(p.dataRecordDidDelete,[e,t]))}save(e,t={}){return setTimeout(this._checkForExpiredRecords.bind(this),0),this.populateDataRecords(e,this._records,t)}_populateDataAttributes(e,t){"object"==typeof e.attributes&&(this.dispatchEvent(p.dataRecordWillPopulate,[t.type,t.id]),Object.keys(e.attributes).forEach(r=>{t.setProperty(r,e.attributes[r],"attributes")}),this.dispatchEvent(p.dataRecordDidPopulate,[t.type,t.id]))}_materializeRecord(e,t){const{type:r,id:n}=t,i=_objectWithoutProperties$2(t,["type","id"]);return e[r]=e[r]||{},e[r][n]?e[r][n].setParent(i.parents||[]):e[r][n]=new DataRecord(r,n,i),this.dispatchEvent(p.dataRecordDidMaterialize,[r,n]),e[r][n]}_checkForExpiredRecords(){const e=[];this._expiryRecords.forEach(t=>{Date.now()>t._mjs.expiration&&(e.push([t.type,t.id]),this._expiryRecords.delete(t))}),e.forEach(e=>{this.remove(...e)})}constructor(e={}){super([p.dataRecordDidDelete,p.dataRecordWillDelete,p.dataRecordDidMaterialize,p.dataRecordWillPopulate,p.dataRecordDidPopulate]),this._removeOnExpiration=!1,this._shouldDisableRecordReuse=!0,this._records={},this._expiryRecords=new Set,this._removeOnExpiration=!!e.removeOnExpiration,this._mapping=e.mapping,this._shouldDisableRecordReuse=!!e.shouldDisableRecordReuse,this.filter=e.filter}}class DeveloperToken{get isExpired(){return this.expiration<Date.now()}_decode(e){return JSON.parse(a(e))}constructor(e){if(this.token=e,!e||!/^[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}\.[a-z0-9\-\_]{16,}/i.test(e))throw new Error("Invalid token.");const[t,r]=e.split("."),{exp:n,iss:i}=this._decode(r);if(this.expiration=1e3*n,this.isExpired)throw new Error("Initialized with an expired token.");this.teamId=i;const{kid:a}=this._decode(t);this.keyId=a}}const h={400:"REQUEST_ERROR",401:"UNAUTHORIZED_ERROR",403:"ACCESS_DENIED",404:"NOT_FOUND",405:"NOT_FOUND",413:"REQUEST_ERROR",414:"REQUEST_ERROR",429:"QUOTA_EXCEEDED",500:"SERVER_ERROR",501:"NOT_FOUND",503:"SERVICE_UNAVAILABLE"},y={"-1004":"DEVICE_LIMIT","-1017":"GEO_BLOCK",1010:h[404],2002:"AUTHORIZATION_ERROR",2034:"TOKEN_EXPIRED",3059:"DEVICE_LIMIT",3063:"SUBSCRIPTION_ERROR",3076:"CONTENT_UNAVAILABLE",3082:"CONTENT_RESTRICTED",3084:"STREAM_UPSELL",5002:h[500],180202:"PLAYREADY_CBC_ENCRYPTION_ERROR",190121:"WIDEVINE_CDM_EXPIRED"},f=new Set(["CONTENT_EQUIVALENT","CONTENT_UNAVAILABLE","CONTENT_UNSUPPORTED","SERVER_ERROR","SUBSCRIPTION_ERROR","UNSUPPORTED_ERROR","USER_INTERACTION_REQUIRED"]);class MKError extends Error{static playActivityError(e){return new this("PLAY_ACTIVITY",e)}static parseError(e){return new this("PARSE_ERROR",e)}static responseError(e){const{status:t,statusText:r}=e,n=new this(h[t]||"NETWORK_ERROR",r||""+t);return n.data=e,n}static serverError(e,t="UNKNOWN_ERROR"){let{status:r,dialog:n,failureType:i,customerMessage:a,errorMessage:o,message:s}=e;n&&(s=n.message||n.customerMessage||n.errorMessage,n.message=s);const c=y[i]||y[r]||t,l=new this(c,s||a||o);return"STREAM_UPSELL"===c&&n&&n.okButtonAction&&n.okButtonAction.url&&(n.okButtonAction.url=n.okButtonAction.url.replace(/\&(?:challenge|key-system|uri|user-initiated)=[^\&]+/gim,"")),l.dialog=n,l}static internalError(e){return new this(MKError.INTERNAL_ERROR,e)}constructor(e,t){super(),this.errorCode="UNKNOWN_ERROR",e&&f.has(e)?(this.name=this.errorCode=e,this.message=this.description=t||e):t||"string"!=typeof e?(this.name=this.errorCode=e||"UNKNOWN_ERROR",t&&(this.message=this.description=t)):(this.name=this.errorCode="UNKNOWN_ERROR",this.message=this.description=e),Error.captureStackTrace&&Error.captureStackTrace(this,MKError)}}MKError.ACCESS_DENIED=h[403],MKError.AGE_VERIFICATION="AGE_VERIFICATION",MKError.AUTHORIZATION_ERROR=y[2002],MKError.CONFIGURATION_ERROR="CONFIGURATION_ERROR",MKError.CONTENT_EQUIVALENT="CONTENT_EQUIVALENT",MKError.CONTENT_RESTRICTED=y[3082],MKError.CONTENT_UNAVAILABLE=y[3076],MKError.CONTENT_UNSUPPORTED="CONTENT_UNSUPPORTED",MKError.DEVICE_LIMIT=y[3059],MKError.GEO_BLOCK=y[-1017],MKError.INVALID_ARGUMENTS="INVALID_ARGUMENTS",MKError.PLAYREADY_CBC_ENCRYPTION_ERROR="PLAYREADY_CBC_ENCRYPTION_ERROR",MKError.MEDIA_CERTIFICATE="MEDIA_CERTIFICATE",MKError.MEDIA_DESCRIPTOR="MEDIA_DESCRIPTOR",MKError.MEDIA_LICENSE="MEDIA_LICENSE",MKError.MEDIA_KEY="MEDIA_KEY",MKError.MEDIA_PLAYBACK="MEDIA_PLAYBACK",MKError.MEDIA_SESSION="MEDIA_SESSION",MKError.NETWORK_ERROR="NETWORK_ERROR",MKError.NOT_FOUND=y[1010],MKError.PARSE_ERROR="PARSE_ERROR",MKError.PLAY_ACTIVITY="PLAY_ACTIVITY",MKError.QUOTA_EXCEEDED=h[429],MKError.REQUEST_ERROR=h[400],MKError.SERVER_ERROR=y[5002],MKError.SERVICE_UNAVAILABLE=h[503],MKError.STREAM_UPSELL=y[3084],MKError.SUBSCRIPTION_ERROR=y[3063],MKError.TOKEN_EXPIRED=y[2034],MKError.UNAUTHORIZED_ERROR=h[401],MKError.UNKNOWN_ERROR="UNKNOWN_ERROR",MKError.UNSUPPORTED_ERROR="UNSUPPORTED_ERROR",MKError.USER_INTERACTION_REQUIRED="USER_INTERACTION_REQUIRED",MKError.INTERNAL_ERROR="INTERNAL_ERROR",MKError.OUTPUT_RESTRICTED="OUTPUT_RESTRICTED",MKError.WIDEVINE_CDM_EXPIRED="WIDEVINE_CDM_EXPIRED";function invoke(e){return void 0===e||(e=>"function"!=typeof e)(e)?e:e()}const DEFAULT_CACHE_KEY_FUNCTION=(e,t)=>`${t}${e}`;class NetworkCache{getItem(e){const t=this.cacheKeyForPath(e),r=this.storage.getItem(t);if(null!==r){const{x:e,d:n}=JSON.parse(r);if(e>Date.now())return n;this.storage.removeItem(t)}}setItem(e,t,r=this.ttl){const n=this.cacheKeyForPath(e);this.storage.setItem(n,JSON.stringify({x:Date.now()+r,d:t}))}removeItem(e){const t=this.cacheKeyForPath(e);this.storage.removeItem(t)}removeItemsMatching(e,t=!0){const r=this.cacheKeyForPath(e);this.removeItemsMatchingCacheKey(r,t)}clear(){this.removeItemsMatchingCacheKey(this.prefix,!1)}removeItemsMatchingCacheKey(e,t){const r=new RegExp(`^${e}${t?"$":""}`);(this.storage instanceof GenericStorage?this.storage.keys:Object.keys(this.storage)).forEach(e=>{e&&r.test(e)&&this.storage.removeItem(e)})}cacheKeyForPath(e){return this.cacheKeyFunction(e,this.prefix)}constructor(e={}){this.storage=e.storage||new GenericStorage,this.prefix=e.prefix||"",this.ttl=e.ttl||3e5,this.cacheKeyFunction=e.cacheKeyFunction||DEFAULT_CACHE_KEY_FUNCTION}}function _defineProperty$J(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$J(e,t,r[t])}))}return e}function _objectSpreadProps$q(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const addPathToURL=(e,t)=>void 0===e||""===e?t||"":void 0===t?e:(e.endsWith("/")&&(e=e.slice(0,-1)),t.startsWith("/")&&(t=t.slice(1)),`${e}/${t}`),addQueryParamsToURL=(e,t)=>{const r=urlEncodeParameters(t);return""===r?e:e.endsWith("&")||e.endsWith("?")?`${e}${r}`:e.includes("?")?`${e}&${r}`:`${e}?${r}`},m="undefined"!=typeof Headers,headersToDict=e=>{let t={};var r;return r=e,m&&r instanceof Headers?e.forEach((e,r)=>t[r]=e):Array.isArray(e)?e.forEach(([e,r])=>t[e]=r):t=e,t},mergeFetchHeaders=(e={},t={})=>_objectSpread$J({},headersToDict(e),headersToDict(t)),mergeFetchOptions=(e,t)=>{if(e||t)return(null==e?void 0:e.headers)&&(null==t?void 0:t.headers)?_objectSpreadProps$q(_objectSpread$J({},e,t),{headers:mergeFetchHeaders(e.headers,t.headers)}):_objectSpread$J({},e,t)};function parseQueryParams(e){if(!e||e.startsWith("http")&&!e.includes("?"))return{};try{var t;return parseParams(null!==(t=e.split("?")[1])&&void 0!==t?t:e,"&",decodeURIComponent)}catch(r){return{}}}function parseParams(e,t="&",r=(e=>e)){return"string"!=typeof e?{}:e.split(t).map(e=>e.trim().split("=",2)).reduce((e,t)=>{const[n,i]=t;return""===n&&void 0===i||(e[r(n)]=r(i),void 0===i&&(e[r(n)]=void 0)),e},{})}function getMaxAgeFromHeaders(e){const t=function(e,t){if(void 0!==t)return m&&t instanceof Headers?t.get(e):t[e]}("cache-control",e);if(t){return(e=>{const t=Number(e);if(Number.isFinite(t))return t})(parseParams(t,",")["max-age"])}}function rewriteLastUrlPath(e,t){const r=e.split("/");return r.pop(),r.push(t),r.join("/")}const recursiveEncodeParameters=(e,t)=>Object.keys(e).reduce((r,n)=>{const i=e[n],a=t?`${t}[${encodeURIComponent(n)}]`:encodeURIComponent(n);return`${r}${r?"&":""}${isObject$1(i)?recursiveEncodeParameters(i,a):`${a}=${encodeURIComponent(""+i)}`}`},"");function urlEncodeParameters(e){return e?recursiveEncodeParameters(e):""}function asyncGeneratorStep$1h(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _defineProperty$I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$I(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$I(e,t,r[t])}))}return e}var g;!function(e){e.JSON="application/json",e.FORM="application/x-www-form-urlencoded"}(g||(g={}));class TokenSession extends class{clearCacheForRequest(e,t){"object"==typeof e&&(t=e,e=void 0);const r=this.constructURL(e,t);this.networkCache.removeItemsMatching(r)}request(e,t,r){var n,i=this;return(n=function*(){r||"object"!=typeof e||(r=t||{},t=e,e=void 0);let n={};"object"==typeof(r=_objectSpread$I({method:i.method,headers:i.headers,reload:!1},i._fetchOptions,r)).queryParameters?(n=r.queryParameters,delete r.queryParameters):"GET"!==r.method&&"DELETE"!==r.method||(n=t);const a=i.constructURL(e,n),{method:o,reload:s=!1,useRawResponse:c}=r;if(r.headers=i.buildHeaders(r),delete r.reload,delete r.useRawResponse,"GET"===o&&!s){const e=i.getCacheItem(a);if(e)return Promise.resolve(e)}t&&Object.keys(t).length&&("POST"===o||"PUT"===o)&&(r.body=r.body||t,r.contentType===g.FORM?(r.body=urlEncodeParameters(r.body),r.headers.set("Content-Type",g.FORM)):(r.body=JSON.stringify(r.body),r.headers.set("Content-Type",g.JSON)));const l=yield i._fetchFunction(a,r);if(!l.ok)return Promise.reject(l);let u;try{u=yield l.json()}catch(h){u={}}if(u.errors)return Promise.reject(u.errors);const d=c?u:u.results||u.data||u;if("GET"===o){var p;const e=null!==(p=getMaxAgeFromHeaders(l.headers))&&void 0!==p?p:i.ttl;i.setCacheItem(a,d,e)}return d},function(){var e=this,t=arguments;return new Promise((function(r,i){var a=n.apply(e,t);function _next(e){asyncGeneratorStep$1h(a,r,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1h(a,r,i,_next,_throw,"throw",e)}_next(void 0)}))})()}buildHeaders({headers:e,reload:t=!1}={}){void 0===e&&(e=this.headers);const r=(e=>new e.constructor(e))(e);return t&&r.set("Cache-Control","no-cache"),r}constructURL(e,t){return((e,t,r)=>addQueryParamsToURL(addPathToURL(e,t),r))(this.url,e,t)}getCacheItem(e){const t=this.networkCache.storage,r=`${this.prefix}${this.prefix}cache-mut`,n=t.getItem(r)||null,i=this.headers.get("Music-User-Token")||this.headers.get("Media-User-Token")||null;return i!==n&&(this.networkCache.clear(),null===i?t.removeItem(r):t.setItem(r,i)),this.networkCache.getItem(e)}setCacheItem(e,t,r=this.ttl){this.networkCache.setItem(e,t,r)}clearNetworkCache(){this.networkCache.clear()}_key(e,t){const r=function(e){try{const[t,r]=e.split("?",2);if(void 0===r)return t;const n=r.split("&").map(e=>e.split("=",2)),i=[...Array(n.length).keys()];i.sort((e,t)=>{const r=n[e],i=n[t];return r<i?-1:r>i?1:e-t});const a=i.map(e=>n[e]);return`${t}?${a.map(([e,t])=>void 0!==t?`${e}=${t}`:e).join("&")}`}catch(t){return e}}(e).toLowerCase().replace(this.url,"");return`${this.prefix}${r.replace(/[^-_0-9a-z]{1,}/g,".")}`}constructor(e,t){if(this.prefix="",this.method="GET",this.url=e,(t=t||{}).storage&&t.underlyingStorage)throw new Error("only pass storage OR underlyingStorage in sessionOptions to URLSession");const r=t.underlyingStorage||{};if(this.storage=t.storage||new GenericStorage(r),this.networkCache=new NetworkCache({storage:this.storage,prefix:this.prefix,cacheKeyFunction:this._key.bind(this)}),this.ttl=t.ttl||3e5,this._fetchOptions=_objectSpread$I({},t.fetchOptions),"function"!=typeof t.fetch&&"function"!=typeof fetch)throw new Error("window.fetch is not defined");var n;this._fetchFunction=null!==(n=t.fetch)&&void 0!==n?n:fetch.bind(window),this.headers=this._fetchOptions.headers||new Headers,delete this._fetchOptions.headers}}{get developerToken(){return this._developerToken.token}constructor(e,t,r){super(e,r),this._developerToken=new DeveloperToken(t),this.headers.set("Authorization","Bearer "+this.developerToken),r=r||{},this.userToken=r.userToken,this.userToken&&this.headers.set("Media-User-Token",this.userToken)}}Date.now();isNodeEnvironment$1();const v=/\/(?:([a-z]{2})\/)?(album|artist|episode|movie|music-video|playlist|podcast|post|season|show|song|station)\/(?:[^/]*\/)?(?:id)?(\d+|[a-z]{2}\.[a-z0-9-]+|umc.cmc.[a-zA-Z0-9]+)(?:.*(?:[?|&]i=(\d+)).*)?.*$/i;function formatArtworkURL(e,t,r){return t=t||e.height||100,r=r||e.width||100,window.devicePixelRatio>=1.5&&(r*=2,t*=2),e.url.replace("{h}",""+t).replace("{w}",""+r).replace("{f}","jpeg")}function formattedMediaURL(e){const t=function(e){const t=e.match(v)||[],[,r,n,i,a]=t;return{storefrontId:r,kind:n,contentId:i,itemId:a}}(e);let{storefrontId:r,kind:n,contentId:i,itemId:a}=t;if([r,n,i].some(e=>void 0===e))throw new TypeError("Invalid Media URL: "+e);return"music-video"===n&&(n="musicVideo"),-1!==["album","playlist"].indexOf(n)&&a?(n="song",i=a):"podcast"===n&&a&&(n="episode",i=a),{storefrontId:r,kind:n,contentId:i,isUTS:!!i&&i.startsWith("umc.")}}const b=/^http(?:s)?\:\/\/(?:itunes|(embed\.)?(music|podcasts|tv))\.apple\.com/i,_=["allow-forms","allow-popups","allow-same-origin","allow-scripts","allow-storage-access-by-user-activation","allow-top-navigation-by-user-activation"],S=["autoplay *","encrypted-media *","fullscreen *","clipboard-write"];var T,P;e.PlaybackType=void 0,(T=e.PlaybackType||(e.PlaybackType={}))[T.none=0]="none",T[T.preview=1]="preview",T[T.unencryptedFull=2]="unencryptedFull",T[T.encryptedFull=3]="encryptedFull",function(e){e[e.none=0]="none",e[e.loading=1]="loading",e[e.ready=2]="ready",e[e.playing=3]="playing",e[e.ended=4]="ended",e[e.unavailable=5]="unavailable",e[e.restricted=6]="restricted",e[e.error=7]="error",e[e.unsupported=8]="unsupported"}(P||(P={}));const E={AFG:"143610",AGO:"143564",AIA:"143538",ALB:"143575",AND:"143611",ARE:"143481",ARG:"143505",ARM:"143524",ATG:"143540",AUS:"143460",AUT:"143445",AZE:"143568",BEL:"143446",BEN:"143576",BFA:"143578",BGD:"143490",BGR:"143526",BHR:"143559",BHS:"143539",BIH:"143612",BLR:"143565",BLZ:"143555",BMU:"143542",BOL:"143556",BRA:"143503",BRB:"143541",BRN:"143560",BTN:"143577",BWA:"143525",CAF:"143623",CAN:"143455",CHE:"143459",CHL:"143483",CHN:"143465",CIV:"143527",CMR:"143574",COD:"143613",COG:"143582",COL:"143501",CPV:"143580",CRI:"143495",CYM:"143544",CYP:"143557",CZE:"143489",DEU:"143443",DMA:"143545",DNK:"143458",DOM:"143508",DZA:"143563",ECU:"143509",EGY:"143516",ESP:"143454",EST:"143518",ETH:"143569",FIN:"143447",FJI:"143583",FRA:"143442",FSM:"143591",GAB:"143614",GBR:"143444",GEO:"143615",GHA:"143573",GIN:"143616",GMB:"143584",GNB:"143585",GRC:"143448",GRD:"143546",GTM:"143504",GUY:"143553",HKG:"143463",HND:"143510",HRV:"143494",HUN:"143482",IDN:"143476",IND:"143467",IRL:"143449",IRQ:"143617",ISL:"143558",ISR:"143491",ITA:"143450",JAM:"143511",JOR:"143528",JPN:"143462",KAZ:"143517",KEN:"143529",KGZ:"143586",KHM:"143579",KNA:"143548",KOR:"143466",KWT:"143493",LAO:"143587",LBN:"143497",LBR:"143588",LBY:"143567",LCA:"143549",LIE:"143522",LKA:"143486",LTU:"143520",LUX:"143451",LVA:"143519",MAC:"143515",MAR:"143620",MCO:"143618",MDA:"143523",MDG:"143531",MDV:"143488",MEX:"143468",MKD:"143530",MLI:"143532",MLT:"143521",MMR:"143570",MNE:"143619",MNG:"143592",MOZ:"143593",MRT:"143590",MSR:"143547",MUS:"143533",MWI:"143589",MYS:"143473",NAM:"143594",NER:"143534",NGA:"143561",NIC:"143512",NLD:"143452",NOR:"143457",NPL:"143484",NRU:"143606",NZL:"143461",OMN:"143562",PAK:"143477",PAN:"143485",PER:"143507",PHL:"143474",PLW:"143595",PNG:"143597",POL:"143478",PRT:"143453",PRY:"143513",PSE:"143596",QAT:"143498",ROU:"143487",RUS:"143469",RWA:"143621",SAU:"143479",SEN:"143535",SGP:"143464",SLB:"143601",SLE:"143600",SLV:"143506",SRB:"143500",STP:"143598",SUR:"143554",SVK:"143496",SVN:"143499",SWE:"143456",SWZ:"143602",SYC:"143599",TCA:"143552",TCD:"143581",THA:"143475",TJK:"143603",TKM:"143604",TON:"143608",TTO:"143551",TUN:"143536",TUR:"143480",TWN:"143470",TZA:"143572",UGA:"143537",UKR:"143492",URY:"143514",USA:"143441",UZB:"143566",VCT:"143550",VEN:"143502",VGB:"143543",VNM:"143471",VUT:"143609",WSM:"143607",XKX:"143624",YEM:"143571",ZAF:"143472",ZMB:"143622",ZWE:"143605"};function asyncGeneratorStep$1g(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$1g(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$1g(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1g(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const k={AW:"ABW",AF:"AFG",AO:"AGO",AI:"AIA",AX:"ALA",AL:"ALB",AD:"AND",AE:"ARE",AR:"ARG",AM:"ARM",AS:"ASM",AQ:"ATA",TF:"ATF",AG:"ATG",AU:"AUS",AT:"AUT",AZ:"AZE",BI:"BDI",BE:"BEL",BJ:"BEN",BQ:"BES",BF:"BFA",BD:"BGD",BG:"BGR",BH:"BHR",BS:"BHS",BA:"BIH",BL:"BLM",BY:"BLR",BZ:"BLZ",BM:"BMU",BO:"BOL",BR:"BRA",BB:"BRB",BN:"BRN",BT:"BTN",BV:"BVT",BW:"BWA",CF:"CAF",CA:"CAN",CC:"CCK",CH:"CHE",CL:"CHL",CN:"CHN",CI:"CIV",CM:"CMR",CD:"COD",CG:"COG",CK:"COK",CO:"COL",KM:"COM",CV:"CPV",CR:"CRI",CU:"CUB",CW:"CUW",CX:"CXR",KY:"CYM",CY:"CYP",CZ:"CZE",DE:"DEU",DJ:"DJI",DM:"DMA",DK:"DNK",DO:"DOM",DZ:"DZA",EC:"ECU",EG:"EGY",ER:"ERI",EH:"ESH",ES:"ESP",EE:"EST",ET:"ETH",FI:"FIN",FJ:"FJI",FK:"FLK",FR:"FRA",FO:"FRO",FM:"FSM",GA:"GAB",GB:"GBR",GE:"GEO",GG:"GGY",GH:"GHA",GI:"GIB",GN:"GIN",GP:"GLP",GM:"GMB",GW:"GNB",GQ:"GNQ",GR:"GRC",GD:"GRD",GL:"GRL",GT:"GTM",GF:"GUF",GU:"GUM",GY:"GUY",HK:"HKG",HM:"HMD",HN:"HND",HR:"HRV",HT:"HTI",HU:"HUN",ID:"IDN",IM:"IMN",IN:"IND",IO:"IOT",IE:"IRL",IR:"IRN",IQ:"IRQ",IS:"ISL",IL:"ISR",IT:"ITA",JM:"JAM",JE:"JEY",JO:"JOR",JP:"JPN",KZ:"KAZ",KE:"KEN",KG:"KGZ",KH:"KHM",KI:"KIR",KN:"KNA",KR:"KOR",KW:"KWT",LA:"LAO",LB:"LBN",LR:"LBR",LY:"LBY",LC:"LCA",LI:"LIE",LK:"LKA",LS:"LSO",LT:"LTU",LU:"LUX",LV:"LVA",MO:"MAC",MF:"MAF",MA:"MAR",MC:"MCO",MD:"MDA",MG:"MDG",MV:"MDV",MX:"MEX",MH:"MHL",MK:"MKD",ML:"MLI",MT:"MLT",MM:"MMR",ME:"MNE",MN:"MNG",MP:"MNP",MZ:"MOZ",MR:"MRT",MS:"MSR",MQ:"MTQ",MU:"MUS",MW:"MWI",MY:"MYS",YT:"MYT",NA:"NAM",NC:"NCL",NE:"NER",NF:"NFK",NG:"NGA",NI:"NIC",NU:"NIU",NL:"NLD",NO:"NOR",NP:"NPL",NR:"NRU",NZ:"NZL",OM:"OMN",PK:"PAK",PA:"PAN",PN:"PCN",PE:"PER",PH:"PHL",PW:"PLW",PG:"PNG",PL:"POL",PR:"PRI",KP:"PRK",PT:"PRT",PY:"PRY",PS:"PSE",PF:"PYF",QA:"QAT",RE:"REU",RO:"ROU",RU:"RUS",RW:"RWA",SA:"SAU",SD:"SDN",SN:"SEN",SG:"SGP",GS:"SGS",SH:"SHN",SJ:"SJM",SB:"SLB",SL:"SLE",SV:"SLV",SM:"SMR",SO:"SOM",PM:"SPM",RS:"SRB",SS:"SSD",ST:"STP",SR:"SUR",SK:"SVK",SI:"SVN",SE:"SWE",SZ:"SWZ",SX:"SXM",SC:"SYC",SY:"SYR",TC:"TCA",TD:"TCD",TG:"TGO",TH:"THA",TJ:"TJK",TK:"TKL",TM:"TKM",TL:"TLS",TO:"TON",TT:"TTO",TN:"TUN",TR:"TUR",TV:"TUV",TW:"TWN",TZ:"TZA",UG:"UGA",UA:"UKR",UM:"UMI",UY:"URY",US:"USA",UZ:"UZB",VA:"VAT",VC:"VCT",VE:"VEN",VG:"VGB",VI:"VIR",VN:"VNM",VU:"VUT",WF:"WLF",WS:"WSM",XK:"XKX",YE:"YEM",ZA:"ZAF",ZM:"ZMB",ZW:"ZWE"};const w={af:48,sq:1,ar:34,eu:1,bg:49,be:1,ca:42,zh:19,"zh-tw":18,"zh-cn":19,"zh-hk":45,"zh-sg":19,hr:41,cs:22,da:11,nl:10,"nl-be":65,en:1,"en-us":1,"en-eg":26,"en-au":27,"en-gb":2,"en-ca":6,"en-nz":27,"en-ie":26,"en-za":26,"en-jm":26,"en-bz":26,"en-tt":26,"en-001":26,et:30,fo:1,fa:59,fi:12,fr:3,"fr-ca":5,gd:2,de:4,"de-ch":57,el:23,he:36,hi:50,hu:21,is:31,id:37,it:7,ja:9,ko:13,lv:33,lt:32,mk:1,mt:1,no:14,nb:14,nn:14,pl:20,"pt-br":15,pt:24,rm:1,ro:39,ru:16,sr:1,sk:40,sl:52,es:8,"es-mx":28,"es-419":44,sv:17,th:35,ts:1,tn:1,tr:25,uk:29,ur:55,ve:1,vi:43,xh:1,yi:1,zu:56,ms:38,iw:36,lo:46,tl:47,kk:51,ta:53,te:54,bn:58,ga:60,ht:61,la:62,pa:63,sa:64};let I="Music-User-Token";function getLanguages(){if("undefined"==typeof navigator)return[];if(navigator.languages)return navigator.languages;const e=navigator.language||navigator.userLanguage;return e?[e]:[]}I="Media-User-Token";const O={};function findOrCreate(e,t){const r=e.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase());if(hasOwn(O,r)){const n=O[r];if(t!==n.constructor)throw new Error(`DevFlag ${e} was already registered with a different type (${n.constructor.name})`);return n}const n=new t(e);return Object.defineProperty(O,r,{configurable:!0,enumerable:!0,get:function(){return n},set(e){n.set(e)}}),n}class LocalStorageDevFlag{get value(){return this.get()}get configured(){return void 0!==this.value}read(){var e,t;const r=null!==(t=null===(e=getLocalStorage())||void 0===e?void 0:e.getItem(this.key))&&void 0!==t?t:null;return null!==r?r:void 0}write(e){var t;null===(t=getLocalStorage())||void 0===t||t.setItem(this.key,e)}clear(){var e;null===(e=getLocalStorage())||void 0===e||e.removeItem(this.key)}constructor(e){if("string"!=typeof e||""===e.trim())throw new Error("DevFlag requires a non-empty string key");this.key=e}}class StringDevFlag extends LocalStorageDevFlag{static register(e){return findOrCreate(e,this)}static get(e){return this.register(e).get()}static set(e,t){this.register(e).set(t)}get(){return this.read()}set(e){"string"!=typeof e&&console.warn("Value for StringDevFlag should be a string"),this.write(e)}}class BooleanDevFlag extends LocalStorageDevFlag{static register(e){return findOrCreate(e,this)}static get(e){return this.register(e).get()}static set(e,t){this.register(e).set(t)}get(){const e=this.read();if(void 0!==e)return"1"===e||"true"===e.toLowerCase()}set(e){"boolean"==typeof e?this.write(!0===e?"1":"0"):console.warn("Value for BooleanDevFlag should be a boolean")}get enabled(){return!0===this.get()}enable(){this.set(!0)}disable(){this.set(!1)}toggle(){this.set(!this.get())}}class JsonDevFlag extends LocalStorageDevFlag{static register(e){return findOrCreate(e,this)}static get(e){return this.register(e).get()}static set(e,t){this.register(e).set(t)}get(){const e=this.read();if(void 0!==e)try{return JSON.parse(e)}catch(Tt){return}}set(e){this.write(JSON.stringify(e))}prop(e){if(void 0!==this.value)return this.value[e]}}const A=JsonDevFlag.register("mk-hlsjs-automation-config"),R=new RegExp("^https://([a-z0-9]+-)?"+("js-cdn.music.apple.com"+"/musickit/v3/".replace(/v3/,"(v2|v3)")).replace(/[\.\/]/g,"\\$&"),"i"),C=/^https:\/\/(.*\/includes\/js-cdn)\//i,D=/^([a-z]+:)?\/\//;function findScript(e){return isNodeEnvironment$1()||!e?null:document.querySelector(`script[src*="${e}"]`)}function getScriptSrcElements(){if("undefined"==typeof document||!document.querySelectorAll)return[];return Array.from(document.querySelectorAll("script[src]"))}function determineCdnBasePrefix(){for(const e of getScriptSrcElements()){const t=R.exec(e.src);if(t)return t[1]||""}return""}function determineCdnPathPrefix(){for(const e of getScriptSrcElements()){const t=C.exec(e.src);if(t)return t[1]||""}return""}function determineCdnBaseHost(){if(isNodeEnvironment$1())return"";return`//${determineCdnBasePrefix()}js-cdn.music.apple.com`}function determineCdnPathHost(){const e=determineCdnPathPrefix();return e?"//"+e:e}const M=StringDevFlag.register("mk-hlsjs-log-level"),x=StringDevFlag.register("mk-hlsjs-version");function getHlsJsCdnConfig(){const e={hls:"",rtc:""};if(isNodeEnvironment$1())return e;const t=determineCdnPathHost()||determineCdnBaseHost(),r=x.get()||"2.330.1",n=function(){const e=M.value;switch(e){case"info":case"error":case"warn":return"hls.production.verbose.min.js";case"trace":case"debug":return console.warn(`HLS log level ${e} is not supported, loading production build.`),"hls.js";default:return"hls.js"}}();return e.hls=`https:${t}/hls.js/${r}/hls.js/${n}`,e.rtc=`https:${t}/hls.js/${r}/rtc.js/rtc.min.js`,function(e){const t=A.get();if(!(null==t?void 0:t.url))return;const{url:r}=t;isAppleHostname(r)&&"carry-"===determineCdnBasePrefix()&&(e.hls=r)}(e),e}function isAppleHostname(e){try{return new URL(e).hostname.endsWith(".apple.com")}catch(t){}return!1}function cdnBaseURL(e,t=window){var r;if(isNodeEnvironment$1())return"";const n=null===(r=getLocalStorage())||void 0===r?void 0:r.getItem("mkCDNBaseURLOverride");if(n)return n;const i=findScript(e);return i?i.getAttribute("src").replace(new RegExp(e+"$"),""):(determineCdnPathHost()||determineCdnBaseHost())+"/musickit/v3/"}const L=new Map;function loadScript(e,t){const r=L.get(e);if(r)return r;const n=new Promise((r,n)=>{isNodeEnvironment$1()&&n("Dynamic script loading is unsupported in Node environments.");if(findScript(e))return r();const i=document.createElement("script");let a;if(t&&Object.keys(t).forEach(e=>{i.setAttribute(e,t[e])}),i.onload=()=>{r()},i.onerror=e=>{n(e)},D.test(e))a=e;else{a=`${cdnBaseURL(e)}${e}`}i.src=a,document.head.appendChild(i)});return L.set(e,n),n}const N={CRITICAL:50,ERROR:40,WARNING:30,NOTICE:20,INFO:10,DEBUG:2,TRACE:1,NONE:0};const $={OFF:"NONE",0:"NONE","+":"INFO","++":"DEBUG",V:"DEBUG",D:"DEBUG",VERBOSE:"DEBUG",VV:"TRACE",SILLY:"TRACE","*":"TRACE"};function getLoggingLevel(e,t={}){if("number"==typeof e)return function(e){return"number"==typeof e&&Object.values(N).includes(e)}(e)?e:void 0;let r=e.toUpperCase();return t.allowShorthands&&void 0!==$[r]&&(r=$[r]),function(e){return"string"==typeof e&&void 0!==N[e.toUpperCase()]}(r)?N[r]:void 0}function getLoggingLevelName(e){for(const[t,r]of Object.entries(N))if(e===r)return t}function walk(e,t){const r=[e];for(;r.length>0;){const e=r.shift();void 0!==e&&(r.push(...e.children),t(e))}}function _defineProperty$H(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$H(e,t,r[t])}))}return e}function _objectSpreadProps$p(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const j=N.ERROR,DEFAULT_POLICY=(e,t)=>e!==N.NONE&&t>=e;class Logger$1{get parent(){return this._parent}get children(){return Array.from(this._children.values())}get namespace(){return void 0===this._parent?this.name:this._parent.namespace+"/"+this.name}get enabled(){return this.level!==N.NONE}get level(){var e,t,r;return null!==(r=null!==(t=this._level)&&void 0!==t?t:null===(e=this.parent)||void 0===e?void 0:e.level)&&void 0!==r?r:j}get levelName(){var e;return null!==(e=getLoggingLevelName(this.level))&&void 0!==e?e:"UNKNOWN"}get levelPolicy(){var e,t,r;return null!==(r=null!==(t=this._levelPolicy)&&void 0!==t?t:null===(e=this.parent)||void 0===e?void 0:e.levelPolicy)&&void 0!==r?r:DEFAULT_POLICY}get handlers(){var e,t,r;return null!==(r=null!==(t=this._handlers)&&void 0!==t?t:null===(e=this.parent)||void 0===e?void 0:e.handlers)&&void 0!==r?r:{}}isEnabledFor(e){return this.levelPolicy(this.level,e)}setLevel(e){const t=getLoggingLevel(e);void 0!==t&&(this._level=t)}clearLevel(){this._level=void 0}setLevelPolicy(e){this._levelPolicy=e}clearLevelPolicy(){this._levelPolicy=void 0}addHandler(e,t){this._handlers||(this._handlers={}),this._handlers[e]=t}hasHandler(e){var t;return void 0!==(null===(t=this._handlers)||void 0===t?void 0:t[e])}removeHandler(e){void 0!==this._handlers&&(delete this._handlers[e],0===Object.keys(this._handlers).length&&this.clearHandlers())}clearHandlers(){this._handlers=void 0}createChild(e,t){const r=this._children.get(e);return void 0!==r?r:new Logger$1(e,_objectSpreadProps$p(_objectSpread$H({},t),{parent:this}))}linkChild(e){if(void 0!==e.parent&&e.parent!==this)throw new Error(`Logger '${e.name}' is already a child of a different parent ('${e.parent.name}')`);const t=this._children.get(e.name);if(void 0!==t&&t!==e)throw new Error(`A child with name '${e.name}' is already registered`);return void 0===t&&(this._children.set(e.name,e),e.linkParent(this)),e}unlinkChild(e){const t=this._children.get(e.name);return t===e&&(this._children.delete(e.name),t.unlinkParent()),e}getByName(e){return this._children.get(e)}getByNamespace(e){return function(e,t,r="/"){if(""===(t=t.trim())||"*"===t)return e;const n=t.split(r);n[0].trim()===e.name&&n.shift();if(0===n.length)return e;let i=e;for(;void 0!==i&&n.length>0;){const e=n.shift();i=i.getByName(e.trim())}return i}(this,e)}linkParent(e){return this.parent!==e&&(this.unlinkParent(),this._parent=e,e.linkChild(this)),this}unlinkParent(){return void 0!==this._parent&&(this._parent.unlinkChild(this),this._parent=void 0),this}log(e,t,...r){const n=getLoggingLevel(e);void 0!==n&&this.logRecord({time:Date.now(),namespace:this.namespace,level:n,message:t,args:r})}logRecord(e){if(!this.levelPolicy(this.level,e.level))return;const t=_objectSpread$H({namespace:this.namespace},e);for(const r of Object.values(this.handlers))r.process(t)}error(e,...t){this.log(N.ERROR,e,...t)}warning(e,...t){this.log(N.WARNING,e,...t)}warn(e,...t){this.warning(e,...t)}info(e,...t){this.log(N.INFO,e,...t)}debug(e,...t){this.log(N.DEBUG,e,...t)}trace(e,...t){this.log(N.TRACE,e,...t)}constructor(e,t){this._children=new Map,this.name=e,this._levelPolicy=null==t?void 0:t.levelPolicy,this._handlers=null==t?void 0:t.handlers,void 0!==(null==t?void 0:t.parent)&&this.linkParent(t.parent),void 0!==(null==t?void 0:t.level)&&this.setLevel(t.level)}}class CallbackHandler{process(e){this.enabled&&void 0!==this.callback&&this.callback(e)}constructor(e,t={}){var r;this.callback=e,this.enabled=null===(r=t.enabled)||void 0===r||r}}const U=/%{([^}]+)}/gi;var G;const F={timestamp:e=>String(e.time),time:e=>String(e.time),datetime:e=>new Date(e.time).toISOString(),date:e=>new Date(e.time).toISOString(),level:e=>String(e.level),levelname:e=>null!==(G=getLoggingLevelName(e.level))&&void 0!==G?G:"UNKNOWN",message:e=>e.message,name:e=>e.namespace.split("/").pop(),namespace:e=>e.namespace};const B=new Map([[N.CRITICAL,"error"],[N.ERROR,"error"],[N.WARNING,"warn"],[N.NOTICE,"warn"],[N.INFO,"log"],[N.DEBUG,"debug"]]),V=(H="%{datetime} %{levelname} - [%{namespace}] %{message}",function(e){return H.replace(U,(function(t,r){return r=r.toLowerCase(),void 0!==F[r]?F[r](e):t}))});var H;const W=new Logger$1("storekit"),q=["apps.apple.com","books.apple.com","fitness.apple.com","mediaauth.apple.com","multidev.apple.com","music.apple.com","one.apple.com","podcasts.apple.com","tv.apple.com"];class AuthBridgeApp extends class{init(e,t){var r;this._receiveWindow=e,this._sendWindow=t,this.handleMessage=this.handleMessage.bind(this),null===(r=this._receiveWindow)||void 0===r||r.addEventListener("message",this.handleMessage)}sendMessage(e,t){const r={action:"mediakit:"+e,data:t};this._sendWindow&&this._sendWindow.postMessage(JSON.stringify(r),this._targetOrigin)}handleMessage(e){if(!this._isOriginAllowed(e.origin))return;let t;try{t=JSON.parse(e.data)}catch(n){}if(!t||!this._isNamespacedData(t))return;"*"===this._targetOrigin&&(this._targetOrigin=e.origin),W.debug("auth-bridge: handleMessage",t);const r=t.action.replace("mediakit:","");this[r]?this[r](t.data):W.debug("auth-bridge: unsupported method",r)}_isOriginAllowed(e){if(!e)return!1;const[t,r]=e.split("://");let n="";return r&&(n=r.split(":")[0],n&&(n=n.toLocaleLowerCase())),"https"===t&&!!n&&q.some(e=>n===e||n.endsWith("."+e))}_isNamespacedData(e){return e.action&&-1!==e.action.indexOf("mediakit:")}constructor(){this._targetOrigin="*"}}{requestAuthUpdate(){this.whenFrameInited.then(()=>this.sendMessage("requestAuthUpdate"))}setCookieItem(e,t){this.whenFrameInited.then(()=>this.sendMessage("setCookieItem",{name:e,value:t}))}clearAuth(){this.whenFrameInited.then(()=>this.sendMessage("clearAuth"))}frameInit(){var e;null===(e=this._frameInitResolve)||void 0===e||e.call(this),this.requestAuthUpdate()}updateAuth(e){if((null==e?void 0:e.enabled)&&(null==e?void 0:e.cookies)){const t=e.cookies;Object.keys(t).forEach(e=>{var r;const n=null!==(r=t[e])&&void 0!==r?r:"";n?setCookie(e,n,"/",7):removeCookie(e)})}this._authUpdateResolve&&(this._authUpdateResolve(),this._authUpdateResolve=void 0)}authClearedFromOtherFrame(){W.warn("Override auth-bridge/app's authClearedFromOtherFrame to trigger app-specific sign out behavior")}_getIframeSrc(){let e="",t=determineCdnPathPrefix();if(t)t+="/musickit/v3/",e="?inc="+encodeURIComponent(t);else{const t=determineCdnBasePrefix();t&&(e="?env="+t.substring(0,t.length-1))}return"https://mediaauth.apple.com/auth-bridge/"+e}constructor(){super(),this.whenFrameInited=new Promise(e=>this._frameInitResolve=e),this.whenAuthCompleted=new Promise(e=>this._authUpdateResolve=e),this.frame=document.createElement("iframe"),this.frame.src=this._getIframeSrc(),this.frame.style.display="none",document.body.appendChild(this.frame),this.init(window,this.frame.contentWindow)}}const z=new Set(["apps","books","music","podcasts","tv"]),Y=/\.apple\.com$/;function getCommerceHostname(e,t){!t&&"undefined"!=typeof location&&location.hostname&&(t=location);let r=e+".itunes.apple.com";if(!t)return r;const n=function(e){if(!e||!Y.test(e))return;const t=e.split(".");let r=t[t.length-3];const n=r;if(r&&r.includes("-")){const e=r.split("-");r=e[e.length-1]}return z.has(r)?n:void 0}(t.hostname);return n&&(r=`${e}.${n}.apple.com`),r}var Q,J,X;function buildQueryParams(e={app:Q.APP,p:Q.P}){return void 0===e.app&&(e.app=Q.APP),void 0===e.p&&(e.p=Q.P),Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`).join("&")}!function(e){e.APP="music",e.P="subscribe"}(Q||(Q={})),function(e){e.DEFAULT_CID="pldfltcid",e.TV_CID="pltvcid",e.RESTRICTIONS_ENABLED="itre",e.STOREFRONT_COUNTRY_CODE="itua",e.USER_TOKEN="media-user-token"}(J||(J={})),e.SKRealm=void 0,(X=e.SKRealm||(e.SKRealm={}))[X.MUSIC=0]="MUSIC",X[X.PODCAST=1]="PODCAST",X[X.TV=2]="TV";const Z={[e.SKRealm.TV]:"com.apple.onboarding.tvapp",[e.SKRealm.MUSIC]:"com.apple.onboarding.applemusic"},ee={[e.SKRealm.TV]:"pltvcid",[e.SKRealm.MUSIC]:"pldfltcid"},te={"com.apple.onboarding.tvapp":5,"com.apple.onboarding.applemusic":3};function asyncGeneratorStep$1f(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}var re;!function(e){e[e.ParseError=-32700]="ParseError",e[e.InvalidRequest=-32600]="InvalidRequest",e[e.MethodNotFound=-32601]="MethodNotFound",e[e.InvalidParams=-32602]="InvalidParams",e[e.InternalError=-32603]="InternalError"}(re||(re={}));class Dispatch{get source(){return this._source}set source(e){if(!e&&this._source)return this._source.removeEventListener("message",this.handle),void(this._source=void 0);e.addEventListener("message",this.handle),this._source=e}apply(e,t){if(!this.destination)throw new Error("No destination");const r=this._sequence++,n=new Promise((e,t)=>{this._registry[r]={resolve:e,reject:t}});return this.send(this.destination,{jsonrpc:"2.0",id:r,method:e,params:t}),n}call(e,...t){return this.apply(e,t)}handleRequest(e){var t,r=this;return(t=function*(){const t={jsonrpc:"2.0",id:e.id},n=r.methods[e.method];if(!n)return Object.assign(t,{error:{code:re.MethodNotFound,message:"Method not found"}});try{const r=yield n.apply(void 0,ensureArray(e.params));return Object.assign(t,{result:r})}catch(Tt){return Object.assign(t,{error:{code:Tt.code||re.InternalError,message:Tt.message}})}},function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function _next(e){asyncGeneratorStep$1f(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1f(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}handleResponse(e){const t=this._registry[e.id];delete this._registry[e.id],t&&(e.error?t.reject(Object.assign(Error(),e.error)):t.resolve(e.result))}send(e,t){e.postMessage(t,e.window===e?this.origin:void 0)}constructor(e={}){this._registry={},this._sequence=0,this.handle=e=>{e.data&&"2.0"===e.data.jsonrpc&&("*"!==this.origin&&this.origin!==e.origin||(e.data.method&&this.destination?this.handleRequest(e.data).then(e=>{this.send(this.destination,e)}):(hasOwn(e.data,"result")||e.data.error)&&this.handleResponse(e.data)))},this.destination=e.destination,this.methods=e.methods||{},this.origin=e.origin||"*",e.source&&(this.source=e.source)}}function asyncGeneratorStep$1e(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$1e(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$1e(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1e(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$G(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$G(e,t,r[t])}))}return e}function _objectSpreadProps$o(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var ne;function validateToken(e){if("string"!=typeof e)return!1;const t=e.match(/[a-zA-Z0-9=\/+]{32,}==$/);var r;return null!==(r=t&&t.length>0)&&void 0!==r&&r}!function(e){e[e.UNAVAILABLE=-1]="UNAVAILABLE",e[e.NOT_DETERMINED=0]="NOT_DETERMINED",e[e.DENIED=1]="DENIED",e[e.RESTRICTED=2]="RESTRICTED",e[e.AUTHORIZED=3]="AUTHORIZED"}(ne||(ne={}));const ie=`https://${getCommerceHostname("buy")}/commerce/account/authenticateMusicKitRequest`,ae="https://authorize.music.apple.com",oe=/^https?:\/\/(.+\.)*(apple\.com|apps\.mzstatic\.com)(\/[\w\d]+)*$/;var se,ce;!function(e){e[e.AUTHORIZE=0]="AUTHORIZE",e[e.SUBSCRIBE=1]="SUBSCRIBE"}(se||(se={}));class ServiceSetupView{get isServiceView(){return/(authorize\.(.+\.)*apple\.com)/i.test(window.location.hostname)||window&&window.name===this.target||!1}focus(){this._window&&window.focus&&this._window.focus()}load(e={action:se.AUTHORIZE}){var t=this;return _asyncToGenerator$1e((function*(){return e.action===se.SUBSCRIBE?t._subscribeAction(e.parameters):t._authorizeAction(e.parameters)}))()}present(e="",t){const{height:r,left:n,top:i,width:a}=this._calculateClientDimensions(),o={height:650,menubar:"no",resizable:"no",scrollbars:"no",status:"no",toolbar:"no",width:650},s=_objectSpread$G(_objectSpreadProps$o(_objectSpread$G({},o),{left:a/2-o.width/2+n,top:r/2-o.height/2+i}),t),c=Object.keys(s).map(e=>`${e}=${s[e]}`).join(",");return/trident|msie/i.test(navigator.userAgent)?(this._window=window.open(window.location.href,this.target,c)||void 0,this._window.location.href=e):this._window=window.open(e,this.target,c)||void 0,/\bedge\b/i.test(navigator.userAgent)&&(this._window.opener=self),this.focus(),this._window}_startPollingForWindowClosed(e){this._window&&void 0===this._windowClosedInterval&&(this._windowClosedInterval=setInterval(()=>{var t;(null===(t=this._window)||void 0===t?void 0:t.closed)&&(this._stopPollingForWindowClosed(),e())},500))}_stopPollingForWindowClosed(){void 0!==this._windowClosedInterval&&(clearInterval(this._windowClosedInterval),this._windowClosedInterval=void 0)}_authorizeAction(e={}){var t=this;return _asyncToGenerator$1e((function*(){var r;let n,i;const a=(null===(r=window.location)||void 0===r?void 0:r.href)||"";return"GET"===t.authenticateMethod?i=`${ae}/woa?${buildQueryParams(_objectSpreadProps$o(_objectSpread$G({},t.deeplinkParameters),{a:btoa(t._thirdPartyInfo()),referrer:a}))}`:(n=t._buildFormElement(ie),document.body.appendChild(n)),new Promise((r,a)=>{const o=t.present(i);t._startPollingForWindowClosed(()=>{a(ne.NOT_DETERMINED)}),t.dispatch=new Dispatch({methods:{authorize(e,t,n){validateToken(e)?r({restricted:t&&"1"===t,userToken:e,cid:n}):a(ne.NOT_DETERMINED)},close(){},decline(){a(ne.DENIED)},switchUserId(){a(ne.NOT_DETERMINED)},thirdPartyInfo:()=>t._thirdPartyInfo(t.developerToken,_objectSpread$G({},t.deeplinkParameters,e)),unavailable(){a(ne.UNAVAILABLE)}},origin:ae,source:window,destination:o}),n&&n.submit()})}))()}_buildFormElement(e,t=this.target,r=this.developerToken){const n=document.createElement("form");n.setAttribute("method","post"),n.setAttribute("action",e),n.setAttribute("target",t),n.style.display="none";const i=document.createElement("input");i.setAttribute("name","jwtToken"),i.setAttribute("value",r),n.appendChild(i);const a=document.createElement("input");a.setAttribute("name","isWebPlayer"),a.setAttribute("value","true"),n.appendChild(a);const o=document.createElement("input");return o.setAttribute("name","LogoURL"),o.setAttribute("value",""),n.appendChild(o),n}_calculateClientDimensions(e=window){return{height:e.innerHeight?e.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,left:e.screenLeft?e.screenLeft:screen.availLeft||screen.left,top:e.screenTop?e.screenTop:screen.availTop||screen.top,width:e.innerWidth?e.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width}}_subscribeAction(e={}){var t=this;return _asyncToGenerator$1e((function*(){return Object.assign(e,t.deeplinkParameters),new Promise((r,n)=>{const i="https://authorize.music.apple.com/upsell?"+buildQueryParams(e);t.present(i),window.addEventListener("message",({data:e,origin:t,source:i})=>{const{closeWindow:a,launchClient:o}="string"==typeof e?JSON.parse(e):e;t&&!oe.test(t)||(o?0===o.supported?n("Unable to subscribe on this platform."):r(o):n("Subscribe action error."))})})}))()}_thirdPartyInfo(e=this.developerToken,t){let r=this.iconURL;const n=window.location.host||document.referrer,i=[...[].slice.call(document.querySelectorAll('link[rel="apple-music-app-icon"]')),...[].slice.call(document.querySelectorAll('link[rel="apple-touch-icon-precomposed"]')),...[].slice.call(document.querySelectorAll('link[rel="apple-touch-icon"]'))];if(i&&i[0]&&i[0].href){const e=i.find(e=>!!e.sizes&&"120x120"===e.sizes.value);var a;r=null!==(a=null==e?void 0:e.href)&&void 0!==a?a:i[0].href}return JSON.stringify({thirdPartyIconURL:r,thirdPartyName:n,thirdPartyParameters:t,thirdPartyToken:e})}constructor(e,t={}){if(this.developerToken=e,this.authenticateMethod="GET",this.target="apple-music-service-view",this.deeplinkParameters=t&&t.deeplinkParameters||{},this.iconURL=t&&t.iconURL,this.authenticateMethod=t&&t.authenticateMethod||"GET",this.isServiceView&&window.opener!==window){var r;const e=null===(r=getSessionStorage())||void 0===r?void 0:r.getItem("ac"),t=null!=e?new URL(e).origin:void 0;var n;if(t)this.dispatch=new Dispatch({destination:null!==(n=window.opener)&&void 0!==n?n:void 0,origin:t,source:window})}}}function asyncGeneratorStep$1d(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$1d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$1d(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1d(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _fetchStorefronts(){return(_fetchStorefronts=_asyncToGenerator$1d((function*(e,t="https://api.music.apple.com/v1"){const r=new Headers({Authorization:"Bearer "+e}),n=yield fetch(t+"/storefronts",{headers:r}),i=yield n.json();return i.errors?Promise.reject(i.errors):i.data}))).apply(this,arguments)}!function(e){e.ID="us",e.LANGUAGE_TAG="en-gb"}(ce||(ce={}));class Storefront{static inferFromLanguages(e,t=getLanguages()){return _asyncToGenerator$1d((function*(){const r=yield function(e){return _fetchStorefronts.apply(this,arguments)}(e),n=r.map(e=>e.id),i=t[0]||"en-US",[a,o]=i.toLowerCase().split(/-|_/),s=n.includes(o)?o:"us";return r.find(e=>e.id===s)}))()}constructor(e,t,r){this.id=e,this.attributes=t,this.type="storefronts",this.href=r||`/v1/${this.type}/${e}`}}function asyncGeneratorStep$1c(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$1c(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$1c(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1c(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$F(e,t,r[t])}))}return e}var le,ue={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},de={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){e.authorizationStatusDidChange="authorizationStatusDidChange",e.authorizationStatusWillChange="authorizationStatusWillChange",e.eligibleForSubscribeView="eligibleForSubscribeView",e.needsGDPRDidChange="needsGDPRDidChange",e.storefrontCountryCodeDidChange="storefrontCountryCodeDidChange",e.storefrontIdentifierDidChange="storefrontIdentifierDidChange",e.userTokenDidChange="userTokenDidChange"}(le||(le={})),J.DEFAULT_CID;let pe=!1;pe=!0;const he="https://"+getCommerceHostname("buy"),ye=`https://${getCommerceHostname("play")}/WebObjects/MZPlay.woa/wa`;class StoreKit extends Notifications{updateUserTokenFromStorage(){const e=this._getStorageItem(J.USER_TOKEN);this.userToken=e||void 0}get authorizationStatus(){return this._authorizationStatus}set authorizationStatus(e){this._authorizationStatus!==e&&(this._getIsActiveSubscription.updateCache(void 0),this.dispatchEvent(le.authorizationStatusWillChange,{authorizationStatus:this._authorizationStatus,newAuthorizationStatus:e}),this._authorizationStatus=e,this.dispatchEvent(le.authorizationStatusDidChange,{authorizationStatus:e}))}get cid(){if(!this._cids[this.cidNamespace]){const e=this._getStorageItem(this.cidNamespace);this._cids[this.cidNamespace]=e||void 0}return this._cids[this.cidNamespace]}set cid(e){e?this._setStorageItem(this.cidNamespace,e):this._removeStorageItem(this.cidNamespace),this._cids[this.cidNamespace]=e}eligibleForSubscribeView(){var e=this;return _asyncToGenerator$1c((function*(){const t=yield e.hasMusicSubscription();return(!e.hasAuthorized||e.hasAuthorized&&!t)&&!e._dispatchedSubscribeView}))()}get hasAuthorized(){return this.authorizationStatus>ne.DENIED}get logoutURL(){if(!this._disableLogoutURL)return this.iTunesBuyBase+"/account/web/logout"}get parentalControls(){return this._parentalControls}set parentalControls(t){this._parentalControls=t,t&&(this.realm===e.SKRealm.MUSIC?this.restrictedEnabled=t.musicParentalControlsEnabled:this.realm===e.SKRealm.TV&&t.videoContentRestrictions&&(this.authorizationStatus=ne.RESTRICTED))}get _pldfltcid(){return this._cids[J.DEFAULT_CID]}set _pldfltcid(e){this._cids[J.DEFAULT_CID]=e}get privacyAcknowledgements(){return this._privacyAcknowledgements}set privacyAcknowledgements(e){if(this._privacyAcknowledgements=e,!e)return this._gdprVersion=-1,void(this._needsGDPR=void 0);this.bundleId&&(this._gdprVersion=e[this.bundleId]||0,this._needsGDPR=this._gdprVersion<(te[this.bundleId]||0),this._needsGDPR&&this.dispatchEvent(le.needsGDPRDidChange,{GDPRVersion:this._gdprVersion,needsGDPR:this._needsGDPR}))}get restrictedEnabled(){if(this.userToken&&"boolean"!=typeof this._restrictedEnabled){const e=this._getStorageItem(J.RESTRICTIONS_ENABLED);if(e)this._restrictedEnabled="0"!==e;else if(this._storefrontCountryCode){const e=["br","ch","gt","hu","id","in","it","kr","la","lt","my","ru","sg","tr"];this._restrictedEnabled=-1!==e.indexOf(this._storefrontCountryCode)||void 0}}return this._restrictedEnabled}set restrictedEnabled(e){this._restrictedEnabledOverridden||(this.userToken&&void 0!==e&&this._setStorageItem(J.RESTRICTIONS_ENABLED,e?"1":"0"),this._restrictedEnabled=e,e&&(this.authorizationStatus=ne.RESTRICTED))}overrideRestrictEnabled(e){this._restrictedEnabledOverridden=!1,this.restrictedEnabled=e,this._restrictedEnabledOverridden=!0}get storefrontCountryCode(){if(!this._storefrontCountryCode){const e=this._getStorageItem(J.STOREFRONT_COUNTRY_CODE);this._storefrontCountryCode=(null==e?void 0:e.toLowerCase())||ce.ID}return this._storefrontCountryCode}set storefrontCountryCode(e){e&&this.userToken?this._setStorageItem(J.STOREFRONT_COUNTRY_CODE,e):this._removeStorageItem(J.STOREFRONT_COUNTRY_CODE),e!==this._storefrontCountryCode&&(this._storefrontCountryCode=e,this.dispatchEvent(le.storefrontCountryCodeDidChange,{storefrontCountryCode:e}))}get storefrontIdentifier(){return this._storefrontIdentifier}set storefrontIdentifier(e){this._storefrontIdentifier=e,this.dispatchEvent(le.storefrontIdentifierDidChange,{storefrontIdentifier:e})}runTokenValidations(e,t=!0){e&&validateToken(e)?(t&&this._setStorageItem(J.USER_TOKEN,e),this.authorizationStatus=this.restrictedEnabled?ne.RESTRICTED:ne.AUTHORIZED):(this._removeStorageItem(J.USER_TOKEN),this.authorizationStatus=ne.NOT_DETERMINED)}wrapDynamicUserTokenForChanges(e,t=invoke(e)){if("function"!=typeof e)return e;let r=t;return()=>{const t=invoke(e);return r!==t&&(r=t,this.runTokenValidations(t,!1),this.dispatchEvent(le.userTokenDidChange,{userToken:t})),t||""}}get dynamicUserToken(){return this._dynamicUserToken}set dynamicUserToken(e){const t=invoke(e);this._dynamicUserToken=this.wrapDynamicUserTokenForChanges(e,t),this.runTokenValidations(t,"function"!=typeof e),this.dispatchEvent(le.userTokenDidChange,{userToken:t})}get userToken(){return invoke(this.dynamicUserToken)}set userToken(e){this.dynamicUserToken=e}get userTokenIsValid(){return validateToken(this.userToken)}deeplinkURL(e={}){return"https://finance-app.itunes.apple.com/deeplink?"+buildQueryParams(e=_objectSpread$F({},this.deeplinkParameters||{},e))}itunesDeeplinkURL(e={p:"browse"}){return"https://itunes.apple.com/deeplink?"+buildQueryParams(e=_objectSpread$F({},this.deeplinkParameters||{},e))}pldfltcid(){var e=this;return _asyncToGenerator$1c((function*(){if(!e._cids[J.DEFAULT_CID])try{yield e.infoRefresh()}catch(t){return}return e._cids[J.DEFAULT_CID]}))()}renewUserToken(){var e=this;return _asyncToGenerator$1c((function*(){if(!e.userToken)return e.requestUserToken();const t=new Headers({Authorization:"Bearer "+e.developerToken,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+e.userToken}),r=yield fetch(e.playBase+"/renewMusicToken",{method:"POST",headers:t});if(401===r.status)return yield e.revokeUserToken(),Promise.reject(new Error("Renew token"));const n=yield r.json();return n["music-token"]&&(e.userToken=n["music-token"]),e.userToken}))()}requestStorefrontCountryCode(){var e=this;return _asyncToGenerator$1c((function*(){if(e.authorizationStatus<=ne.DENIED)return Promise.reject("Not authorized: "+e.authorizationStatus);const t=new Headers({Authorization:"Bearer "+e.developerToken,[I]:e.userToken||""}),r=yield fetch(e.apiBase+"/me/storefront",{headers:t});if(r&&!r.ok)return e._reset(),Promise.reject("Storefront Country Code error.");const n=yield r.json();if(n.errors)return Promise.reject(n.errors);const[i]=n.data;return i&&i.id?(e.storefrontCountryCode=i.id,e.storefrontCountryCode):Promise.reject("Storefront Country Code error.")}))()}requestStorefrontIdentifier(){var e=this;return _asyncToGenerator$1c((function*(){if(!e.storefrontIdentifier){const t=yield Storefront.inferFromLanguages(e.developerToken);e.storefrontIdentifier=t.id}return e.storefrontIdentifier}))()}requestUserToken(){var e=this;return _asyncToGenerator$1c((function*(){if(e._serviceSetupView.isServiceView)return e.userToken||"";try{const t=yield e._serviceSetupView.load({action:se.AUTHORIZE});e.cid=t.cid,e.userToken=t.userToken,e.restrictedEnabled=t.restricted}catch(t){return e._reset(),e.authorizationStatus=t,Promise.reject(t)}return e.userToken}))()}revokeUserToken(){var e=this;return _asyncToGenerator$1c((function*(){var t;try{yield e._webPlayerLogout()}catch(r){}null===(t=e.authBridgeApp)||void 0===t||t.clearAuth(),e.dispatchEvent(le.authorizationStatusWillChange,{authorizationStatus:e.authorizationStatus,newAuthorizationStatus:ne.NOT_DETERMINED}),e._reset(),e.dispatchEvent(le.authorizationStatusDidChange,{authorizationStatus:e.authorizationStatus}),e.dispatchEvent(le.userTokenDidChange,{userToken:e.userToken})}))()}setCids(e){this._cids=_objectSpread$F({},this._cids,e),Object.keys(this._cids).forEach(e=>{this._setStorageItem(e,this._cids[e])})}shouldDisplayPrivacyLink(e){var t=this;return _asyncToGenerator$1c((function*(){return void 0!==t._needsGDPR||(yield t.me()),t._needsGDPR}))()}hasMusicSubscription(){var e=this;return _asyncToGenerator$1c((function*(){return!!e.hasAuthorized&&e._getIsActiveSubscription()}))()}_getIsActiveSubscription(){var e=this;return _asyncToGenerator$1c((function*(){var t;return!!(null===(t=(yield e.me()).subscription)||void 0===t?void 0:t.active)}))()}resetSubscribeViewEligibility(){this._dispatchedSubscribeView=!1}presentSubscribeViewForEligibleUsers(e={},t=!0){var r=this;return _asyncToGenerator$1c((function*(){const n=yield r.eligibleForSubscribeView();if(!r._serviceSetupView.isServiceView&&n){if(!t)return r.dispatchEvent(le.eligibleForSubscribeView,e),void(r._dispatchedSubscribeView=!0);try{const e=yield r._serviceSetupView.load({action:se.SUBSCRIBE});return r._dispatchedSubscribeView=!0,e}catch(i){return r.revokeUserToken()}}}))()}infoRefresh(){var e=this;return _asyncToGenerator$1c((function*(){if(e.authorizationStatus<=ne.DENIED)return Promise.reject("Not authorized: "+e.authorizationStatus);const t=new Headers({Authorization:"Bearer "+e.developerToken,[I]:e.userToken||""});try{const r=yield fetch(e.iTunesBuyBase+"/account/web/infoRefresh",{credentials:"include",headers:t}),n=yield r.json();e.setCids(n)}catch(r){}}))()}me(){if(this.authorizationStatus<=ne.DENIED)return Promise.reject("Not authorized: "+this.authorizationStatus);if(!this._me){var t=this;this._me=new Promise((r=_asyncToGenerator$1c((function*(r,n){const i=new Headers({Authorization:"Bearer "+t.developerToken,[I]:t.userToken||""}),a=addQueryParamsToURL(t.apiBase+"/me/account",_objectSpread$F({meta:"subscription"},t.meParameters)),o=yield fetch(a,{headers:i});if(o&&!o.ok)return t.realm!==e.SKRealm.TV&&t._reset(),n("Account error.");let s=yield o.json();if(s.errors)return n(s.errors);const{data:c,meta:l}=s;if(!l||!l.subscription)return n("Account error.");t.storefrontCountryCode=l.subscription.storefront;const u={meta:l,subscription:l.subscription};c&&c.length&&(u.attributes=c[0].attributes);try{let e=yield fetch(t.iTunesBuyBase+"/account/web/info",{credentials:"include",headers:i});if(s=yield e.json(),t.parentalControls=s.parentalControlsData,t.privacyAcknowledgements=s.privacyAcknowledgement,function(e){if("object"!=typeof e)throw new TypeError("Source is not an Object");for(const t in e)if(hasOwn(e,t))return!1;return!0}(t.privacyAcknowledgements||{})){try{yield t.infoRefresh()}catch(d){r(u)}e=yield fetch(t.iTunesBuyBase+"/account/web/info",{credentials:"include",headers:i}),s=yield e.json(),t.parentalControls=s.parentalControlsData,t.privacyAcknowledgements=s.privacyAcknowledgement}u.info=s}catch(p){console.warn("Failed to fetch privacyAcknowledgements",p)}return r(u)})),function(e,t){return r.apply(this,arguments)})).then(e=>{var t;return this._getIsActiveSubscription.updateCache((null===(t=e.subscription)||void 0===t?void 0:t.active)||!1),this._me=null,e}).catch(e=>(this._me=null,Promise.reject(e)))}var r;return this._me}musicSubscriptionOffers(e,t=getLanguages()){var r=this;return _asyncToGenerator$1c((function*(){let n;if(r.hasAuthorized){n=(yield r.me()).info.storeFrontISO3A}else{if(!e){const n=yield Storefront.inferFromLanguages(r.developerToken,t);e=null==n?void 0:n.id}n=e&&k[e.toUpperCase()]||"USA"}const i=function(e="en-US"){const t=w[e.toLowerCase()];if(t)return t;if(e.includes("-")){const t=e.split("-")[0],r=w[t.toLowerCase()];if(r)return r}return w["en-us"]}(t[0]),a=E[n];if(!i||!a)return[];const o=new Headers({"X-Apple-Store-Front":`${a}-${i},8`});r.userToken&&(o.set("Authorization","Bearer "+r.developerToken),o.set("Music-User-Token",r.userToken));const s=yield fetch(r.iTunesBuyBase+"/commerce/web/subscription/offers/music",{headers:o});if(!s.ok)return Promise.reject(s.status);return(yield s.json()).offers}))()}_getStorageItem(e){var t;if(e)return"cookie"===this.persist?getCookie(e):"localstorage"===this.persist?null===(t=this.storage)||void 0===t?void 0:t.getItem(`${this.storagePrefix}.${e}`):void 0}_processLocationHash(e){const t=/^\#([a-zA-Z0-9+\/]{200,}={0,2})$/;if(t.test(e)){const n=e.replace(t,"$1");try{const{itre:e,musicUserToken:t,cid:r}=JSON.parse(atob(n));this.restrictedEnabled=e&&"1"===e,this.userToken=t,this.cid=r}catch(r){}history.replaceState(null,document.title," ")}}_removeStorageItem(e){if("cookie"===this.persist)this._removeCookieFromDomains(e);else if("localstorage"===this.persist){var t;return null===(t=this.storage)||void 0===t?void 0:t.removeItem(`${this.storagePrefix}.${e}`)}}_removeCookieFromDomains(e,t=window){removeCookie(e);const{hostname:r}=t.location,n=r.split(".");if(n.length&&(n.shift(),n.length>2))for(let i=n.length;i>2;i--){const r=n.join(".");n.shift(),removeCookie(e,t,r)}}_reset(e=ne.NOT_DETERMINED){this._authorizationStatus=e,this._cids={},this._dispatchedSubscribeView=!1,this._restrictedEnabled=void 0,this._storefrontCountryCode=void 0,this._getIsActiveSubscription.updateCache(void 0),Object.keys(ee).forEach(e=>{this._removeStorageItem(ee[e])}),this._removeStorageItem(J.RESTRICTIONS_ENABLED),this._removeStorageItem(J.USER_TOKEN),this._removeStorageItem(J.STOREFRONT_COUNTRY_CODE),this._dynamicUserToken=void 0,this._me=null,this.privacyAcknowledgements=void 0}_setStorageItem(e,t){var r,n;return"cookie"===this.persist?(null===(r=this.authBridgeApp)||void 0===r||r.setCookieItem(e,t),setCookie(e,t,"/",180)):"localstorage"===this.persist?null===(n=this.storage)||void 0===n?void 0:n.setItem(`${this.storagePrefix}.${e}`,t):void 0}_webPlayerLogout(){var e=this;return _asyncToGenerator$1c((function*(){const t=e.logoutURL;if(!t)return;const r=new Headers({Authorization:"Bearer "+e.developerToken,Accept:"application/json","Content-Type":"application/json",["X-Apple-"+I]:""+e.userToken});r.delete("X-Apple-"+I),r.append(I,e.userToken||"");const n=yield fetch(t,{method:"POST",headers:r,credentials:"include"});return n&&!n.ok?Promise.reject(n.status):n.json()}))()}constructor(t,r){super([le.authorizationStatusDidChange,le.authorizationStatusWillChange,le.eligibleForSubscribeView,le.needsGDPRDidChange,le.storefrontCountryCodeDidChange,le.userTokenDidChange,le.storefrontIdentifierDidChange]),this.developerToken=t,this.apiBase="https://api.music.apple.com/v1",this.iTunesBuyBase=he,this.meParameters={},this.persist="localstorage",this.playBase=ye,this.prefix="music",this.realm=e.SKRealm.MUSIC,this.storage=getLocalStorage(),this._authorizationStatus=ne.NOT_DETERMINED,this._disableLogoutURL=!1,this._dispatchedSubscribeView=!1,this._me=null,this._cids={},this._gdprVersion=-1,this._needsGDPR=void 0,this._restrictedEnabledOverridden=!1,this._dynamicUserToken=getCookie(J.USER_TOKEN),W.info("StoreKit initialized"),r&&(r.apiBase&&(this.apiBase=r.apiBase),r.deeplink&&(this.deeplinkParameters=r.deeplink),r.meParameters&&(this.meParameters=r.meParameters),r.persist&&(this.persist=r.persist),r.prefix&&(this.prefix=r.prefix),void 0!==r.realm&&(this.realm=r.realm),void 0!==r.disableLogoutURL&&(this._disableLogoutURL=r.disableLogoutURL),this.bundleId=Z[this.realm]),this.cidNamespace=ee[this.realm],this._developerToken=new DeveloperToken(t),this._serviceSetupView=new ServiceSetupView(t,{authenticateMethod:r&&r.authenticateMethod,iconURL:r&&r.iconURL,deeplinkParameters:this.deeplinkParameters}),this.storagePrefix=`${this.prefix}.${this._developerToken.teamId}`.toLocaleLowerCase(),this.updateUserTokenFromStorage(),this.developerToken&&this.userTokenIsValid&&(this._restrictedEnabled=this.restrictedEnabled,this.shouldDisplayPrivacyLink(this.bundleId).catch(()=>{})),this._storefrontCountryCode=this.storefrontCountryCode,this.whenAuthCompleted=Promise.resolve(),isNodeEnvironment$1()||(this._processLocationHash(window.location.hash),"cookie"!==this.persist||(null==r?void 0:r.disableAuthBridge)||(this.authBridgeApp=new AuthBridgeApp,this.authBridgeApp.authClearedFromOtherFrame=this.revokeUserToken.bind(this),this.whenAuthCompleted=this.authBridgeApp.whenAuthCompleted.then(()=>{this.updateUserTokenFromStorage()})))}}var fe,me;ue([((e=300)=>(t,r,n)=>{if(void 0===n||"function"!=typeof n.value)throw new TypeError(`Only methods can be decorated with @CachedResult, but ${r} is not a method.`);return{configurable:!0,get(){const t=n.value,i=1e3*e;let a,o=-1;function cachedResultMethod(){return _cachedResultMethod.apply(this,arguments)}function _cachedResultMethod(){return(_cachedResultMethod=_asyncToGenerator$1g((function*(...e){const r=Date.now();return(void 0===a||-1===o||o>0&&r>o+i)&&(o=r,a=yield t.apply(this,e)),a}))).apply(this,arguments)}return cachedResultMethod.updateCache=function(e){o=Date.now(),a=e},cachedResultMethod.getCachedValue=()=>a,Object.defineProperty(this,r,{value:cachedResultMethod,configurable:!0,writable:!0}),cachedResultMethod}}})(900),de("design:type",Function),de("design:paramtypes",[])],StoreKit.prototype,"_getIsActiveSubscription",null),e.PlaybackStates=void 0,(fe=e.PlaybackStates||(e.PlaybackStates={}))[fe.none=0]="none",fe[fe.loading=1]="loading",fe[fe.playing=2]="playing",fe[fe.paused=3]="paused",fe[fe.stopped=4]="stopped",fe[fe.ended=5]="ended",fe[fe.seeking=6]="seeking",fe[fe.waiting=8]="waiting",fe[fe.stalled=9]="stalled",fe[fe.completed=10]="completed",e.PresentationMode=void 0,(me=e.PresentationMode||(e.PresentationMode={}))[me.pictureinpicture=0]="pictureinpicture",me[me.inline=1]="inline";var ge="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var ve=createCommonjsModule((function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)})),be=createCommonjsModule((function(e){var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)}));be.version;var _isObject=function(e){return"object"==typeof e?null!==e:"function"==typeof e},_anObject=function(e){if(!_isObject(e))throw TypeError(e+" is not an object!");return e},_fails=function(e){try{return!!e()}catch(t){return!0}},_e=!_fails((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),Se=ve.document,Te=_isObject(Se)&&_isObject(Se.createElement),Pe=!_e&&!_fails((function(){return 7!=Object.defineProperty((e="div",Te?Se.createElement(e):{}),"a",{get:function(){return 7}}).a;var e})),Ee=Object.defineProperty,ke={f:_e?Object.defineProperty:function(e,t,r){if(_anObject(e),t=function(e,t){if(!_isObject(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!_isObject(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!_isObject(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!_isObject(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")}(t,!0),_anObject(r),Pe)try{return Ee(e,t,r)}catch(n){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},we=_e?function(e,t,r){return ke.f(e,t,function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}(1,r))}:function(e,t,r){return e[t]=r,e},Ie={}.hasOwnProperty,_has=function(e,t){return Ie.call(e,t)},Oe=0,Ae=Math.random(),_uid=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++Oe+Ae).toString(36))},Re=createCommonjsModule((function(e){var t=ve["__core-js_shared__"]||(ve["__core-js_shared__"]={});(e.exports=function(e,r){return t[e]||(t[e]=void 0!==r?r:{})})("versions",[]).push({version:be.version,mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})})),Ce=Re("native-function-to-string",Function.toString),De=createCommonjsModule((function(e){var t=_uid("src"),r=(""+Ce).split("toString");be.inspectSource=function(e){return Ce.call(e)},(e.exports=function(e,n,i,a){var o="function"==typeof i;o&&(_has(i,"name")||we(i,"name",n)),e[n]!==i&&(o&&(_has(i,t)||we(i,t,e[n]?""+e[n]:r.join(String(n)))),e===ve?e[n]=i:a?e[n]?e[n]=i:we(e,n,i):(delete e[n],we(e,n,i)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[t]||Ce.call(this)}))})),_ctx=function(e,t,r){if(function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!")}(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}},$export=function(e,t,r){var n,i,a,o,s=e&$export.F,c=e&$export.G,l=e&$export.S,u=e&$export.P,d=e&$export.B,p=c?ve:l?ve[t]||(ve[t]={}):(ve[t]||{}).prototype,h=c?be:be[t]||(be[t]={}),y=h.prototype||(h.prototype={});for(n in c&&(r=t),r)a=((i=!s&&p&&void 0!==p[n])?p:r)[n],o=d&&i?_ctx(a,ve):u&&"function"==typeof a?_ctx(Function.call,a):a,p&&De(p,n,a,e&$export.U),h[n]!=a&&we(h,n,o),u&&y[n]!=a&&(y[n]=a)};ve.core=be,$export.F=1,$export.G=2,$export.S=4,$export.P=8,$export.B=16,$export.W=32,$export.U=64,$export.R=128;var Me,xe,Le=$export,Ne={}.toString,$e=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==function(e){return Ne.call(e).slice(8,-1)}(e)?e.split(""):Object(e)},_defined=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},_toIobject=function(e){return $e(_defined(e))},je=Math.ceil,Ue=Math.floor,_toInteger=function(e){return isNaN(e=+e)?0:(e>0?Ue:je)(e)},Ge=Math.min,Fe=Math.max,Be=Math.min,Ke=Re("keys"),Ve=(Me=!1,function(e,t,r){var n,i,a=_toIobject(e),o=(n=a.length)>0?Ge(_toInteger(n),9007199254740991):0,s=function(e,t){return(e=_toInteger(e))<0?Fe(e+t,0):Be(e,t)}(r,o);if(Me&&t!=t){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((Me||s in a)&&a[s]===t)return Me||s||0;return!Me&&-1}),He=Ke[xe="IE_PROTO"]||(Ke[xe]=_uid(xe)),We="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),qe=Object.keys||function(e){return function(e,t){var r,n=_toIobject(e),i=0,a=[];for(r in n)r!=He&&_has(n,r)&&a.push(r);for(;t.length>i;)_has(n,r=t[i++])&&(~Ve(a,r)||a.push(r));return a}(e,We)},ze={f:Object.getOwnPropertySymbols},Ye={f:{}.propertyIsEnumerable},_toObject=function(e){return Object(_defined(e))},Qe=Object.assign,Je=!Qe||_fails((function(){var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=Qe({},e)[r]||Object.keys(Qe({},t)).join("")!=n}))?function(e,t){for(var r=_toObject(e),n=arguments.length,i=1,a=ze.f,o=Ye.f;n>i;)for(var s,c=$e(arguments[i++]),l=a?qe(c).concat(a(c)):qe(c),u=l.length,d=0;u>d;)s=l[d++],_e&&!o.call(c,s)||(r[s]=c[s]);return r}:Qe;Le(Le.S+Le.F,"Object",{assign:Je}),be.Object.assign;var Xe="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==Xe&&Xe,Ze="URLSearchParams"in Xe,et="Symbol"in Xe&&"iterator"in Symbol,tt="FileReader"in Xe&&"Blob"in Xe&&function(){try{return new Blob,!0}catch(e){return!1}}(),rt="FormData"in Xe,nt="ArrayBuffer"in Xe;if(nt)var it=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],at=ArrayBuffer.isView||function(e){return e&&it.indexOf(Object.prototype.toString.call(e))>-1};function normalizeName(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function normalizeValue(e){return"string"!=typeof e&&(e=String(e)),e}function iteratorFor(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return et&&(t[Symbol.iterator]=function(){return t}),t}function Headers$1(e){this.map={},e instanceof Headers$1?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function consumed(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function fileReaderReady(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function readBlobAsArrayBuffer(e){var t=new FileReader,r=fileReaderReady(t);return t.readAsArrayBuffer(e),r}function bufferClone(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:tt&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:rt&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:Ze&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():nt&&tt&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=bufferClone(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):nt&&(ArrayBuffer.prototype.isPrototypeOf(e)||at(e))?this._bodyArrayBuffer=bufferClone(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Ze&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},tt&&(this.blob=function(){var e=consumed(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=consumed(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var e,t,r,n=consumed(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=fileReaderReady(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},rt&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers$1.prototype.append=function(e,t){e=normalizeName(e),t=normalizeValue(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},Headers$1.prototype.delete=function(e){delete this.map[normalizeName(e)]},Headers$1.prototype.get=function(e){return e=normalizeName(e),this.has(e)?this.map[e]:null},Headers$1.prototype.has=function(e){return this.map.hasOwnProperty(normalizeName(e))},Headers$1.prototype.set=function(e,t){this.map[normalizeName(e)]=normalizeValue(t)},Headers$1.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},Headers$1.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),iteratorFor(e)},Headers$1.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),iteratorFor(e)},Headers$1.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),iteratorFor(e)},et&&(Headers$1.prototype[Symbol.iterator]=Headers$1.prototype.entries);var ot=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Request(e,t){if(!(this instanceof Request))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,i=(t=t||{}).body;if(e instanceof Request){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new Headers$1(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new Headers$1(t.headers)),this.method=(r=t.method||this.method||"GET",n=r.toUpperCase(),ot.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var a=/([?&])_=[^&]*/;if(a.test(this.url))this.url=this.url.replace(a,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function decode(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function Response(e,t){if(!(this instanceof Response))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new Headers$1(t.headers),this.url=t.url||"",this._initBody(e)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers$1(this.headers),url:this.url})},Response.error=function(){var e=new Response(null,{status:0,statusText:""});return e.type="error",e};var st=[301,302,303,307,308];Response.redirect=function(e,t){if(-1===st.indexOf(t))throw new RangeError("Invalid status code");return new Response(null,{status:t,headers:{location:e}})};var ct=Xe.DOMException;try{new ct}catch(su){(ct=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),ct.prototype.constructor=ct}function fetch$1(e,t){return new Promise((function(r,n){var i=new Request(e,t);if(i.signal&&i.signal.aborted)return n(new ct("Aborted","AbortError"));var a=new XMLHttpRequest;function abortXhr(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new Headers$1,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;setTimeout((function(){r(new Response(i,n))}),0)},a.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},a.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},a.onabort=function(){setTimeout((function(){n(new ct("Aborted","AbortError"))}),0)},a.open(i.method,function(e){try{return""===e&&Xe.location.href?Xe.location.href:e}catch(t){return e}}(i.url),!0),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),"responseType"in a&&(tt?a.responseType="blob":nt&&i.headers.get("Content-Type")&&-1!==i.headers.get("Content-Type").indexOf("application/octet-stream")&&(a.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof Headers$1?i.headers.forEach((function(e,t){a.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){a.setRequestHeader(e,normalizeValue(t.headers[e]))})),i.signal&&(i.signal.addEventListener("abort",abortXhr),a.onreadystatechange=function(){4===a.readyState&&i.signal.removeEventListener("abort",abortXhr)}),a.send(void 0===i._bodyInit?null:i._bodyInit)}))}function isLive(e){var t;return!!(null==e||null===(t=e.attributes)||void 0===t?void 0:t.isLive)}function isStream(e){var t,r;return"stream"===(null==e||null===(t=e.attributes)||void 0===t||null===(r=t.playParams)||void 0===r?void 0:r.format)}function isLiveRadioStation(e){return isLive(e)&&isStream(e)}function isLiveRadioKind(e,t){var r;return isLiveRadioStation(e)&&(null===(r=e.attributes)||void 0===r?void 0:r.mediaKind)===t}function isBroadcastRadio(e){return isLive(e)&&isStream(e)&&void 0!==e.attributes.stationProviderName&&"Shoutcast"===e.attributes.streamingRadioSubType}function getFilterFromFlags(e){const t=e.includes("radio-live"),r=e.includes("radio-aod"),n=e.includes("radio-broadcast");return e=>(!t||t&&!isLiveRadioStation(e))&&(!r||r&&!function(e){return!isLive(e)&&isStream(e)&&"Episode"===e.attributes.streamingRadioSubType}(e))&&(!n||n&&!isBroadcastRadio(e))}fetch$1.polyfill=!0,Xe.fetch||(Xe.fetch=fetch$1,Xe.Headers=Headers$1,Xe.Request=Request,Xe.Response=Response);const lt={album:"albums",albums:"albums",artist:"artists",artists:"artists",song:"songs",songs:"songs"};function normalizeContentType(e){let t=lt[e];return t||(t=e.replace(/_|[A-Z]/g,(e,t)=>"_"===e?"-":(e=e.toLowerCase(),0===t?e:"-"+e)),e.endsWith("y")?t=t.substring(0,t.length-1)+"ies":t.endsWith("s")||(t+="s"),lt[e]=t,t)}const ut=["contributors","modalities","musicVideo","podcast-episodes","radioStation","song","uploaded-audios","uploadedAudio","uploaded-videos","uploadedVideo","workouts","workout-programs"],dt={"uploaded-videos":!0,uploadedVideo:!0,"uploaded-audios":!0,uploadedAudio:!0,"podcast-episodes":!0},pt=["Vod","LiveService","EbsEvent","Event"],ht={mediaItemStateDidChange:"mediaItemStateDidChange",mediaItemStateWillChange:"mediaItemStateWillChange"},yt=new Logger$1("media-item"),{none:ft,loading:mt,ready:gt,playing:vt,ended:bt,unavailable:_t,restricted:St,error:Tt,unsupported:Pt}=P,Et={[ft]:{allowed:[mt],unknown:[bt,_t,St,Tt,Pt]},[mt]:{allowed:[gt,St,Tt,Pt],unknown:[]},[gt]:{allowed:[vt],unknown:[Tt]},[vt]:{allowed:[bt,Tt],unknown:[_t,St,Pt]},[bt]:{allowed:[],unknown:[]},[_t]:{allowed:[],unknown:[]},[St]:{allowed:[],unknown:[]},[Tt]:{allowed:[],unknown:[]},[Pt]:{allowed:[],unknown:[]}},toName=e=>P[e],createMediaItemStateGuard=(e=ft)=>{const t={current:e,set(e){const{current:r}=t;if(!((e,t)=>Et[e].allowed.includes(t))(r,e)){const t=((e,t)=>Et[e].unknown.includes(t))(r,e);yt.debug(`MediaItem.state was changed from ${toName(r)} to ${toName(e)}`,t?"but it is unknown whether it should be allowed or not.":"and it should not be happening")}t.current=e}};return t};function isStringNotEmpty(e){return!function(e){return void 0===e||""===e.trim()}(e)}function transform$8(e){return transform$9({"attributes.albumName":"metadata.playlistName","attributes.artistName":"metadata.artistName","attributes.artwork"(){const t=null==e?void 0:e.artworkURL;if(t)return function(e){const t=e.split("/").pop(),[r,n]=!!t&&t.match(/\d+/g)||["100","100"];return{width:parseInt(r,10),height:parseInt(n,10),url:e.replace(`${r}x${n}`,"{w}x{h}")}}(t)},"attributes.composerName":"metadata.composerName","attributes.contentRating"(){var t;if(1===(null==e||null===(t=e.metadata)||void 0===t?void 0:t.explicit))return"explicit"},"attributes.discNumber"(){var t;return(null==e||null===(t=e.metadata)||void 0===t?void 0:t.discNumber)||1},"attributes.durationInMillis":"metadata.duration","attributes.genreNames"(){var t;return[null==e||null===(t=e.metadata)||void 0===t?void 0:t.genre]},"attributes.isrc"(){var t;const r=null==e||null===(t=e.metadata)||void 0===t?void 0:t.xid;if(r)return r.replace(/^([^:]+):isrc:/,"$1")},"attributes.name":"metadata.itemName","attributes.playParams.id":"metadata.itemId","attributes.playParams.kind":"metadata.kind","attributes.previews":()=>[{url:null==e?void 0:e.previewURL}],"attributes.releaseDate":"metadata.releaseDate","attributes.trackNumber":"metadata.trackNumber",assetURL:"URL",cloudId:"metadata.cloud-id",id(){var t;return""+(null==e||null===(t=e.metadata)||void 0===t?void 0:t.itemId)},flavor:"flavor",type:"metadata.kind"},e)}function _defineProperty$E(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const{mediaItemStateDidChange:kt,mediaItemStateWillChange:wt}=ht,It={isEntitledToPlay:!0};class MediaItem extends Notifications{get ageGatePolicy(){var e;return null===(e=this.defaultPlayable)||void 0===e?void 0:e.ageGatePolicy}get albumInfo(){const{albumName:e,artistName:t}=this,r=[];return t&&r.push(t),e&&r.push(e),r.join(" - ")}get albumName(){return this.attributes.albumName}get artistName(){return this.attributes.genreNames&&this.attributes.genreNames.indexOf("Classical")>-1&&this.attributes.composerName?this.attributes.composerName:this.attributes.artistName}get artwork(){var e,t;return null!==(t=this.attributes.artwork)&&void 0!==t?t:null===(e=this.attributes.images)||void 0===e?void 0:e.coverArt16X9}get artworkURL(){if(this.artwork&&this.artwork.url)return this.artwork.url}get assets(){return this._assets}get canPlay(){return this.isPlayable&&this.isReady}get container(){return this._container}set container(e){this._container=e}get contentRating(){return this.attributes.contentRating}get context(){return this._context}set context(e){this._context=e}get defaultPlayable(){var e;return null===(e=this.playables)||void 0===e?void 0:e[0]}get discNumber(){return this.attributes.discNumber}get hasContainerArtwork(){return this.container&&this.container.attributes&&this.container.attributes.artwork&&this.container.attributes.artwork.url}get hasPlaylistContainer(){return this.container&&"playlists"===this.container.type&&this.container.attributes}get isEntitledToPlay(){const{attributes:e,defaultPlayable:t}=this;var r;return null!==(r=e.isEntitledToPlay||(null==t?void 0:t.isEntitledToPlay))&&void 0!==r&&r}get supportsLinearScrubbing(){var e,t,r;return this.isLinearStream&&!0===(null===(e=this.defaultPlayable)||void 0===e||null===(t=e.assets)||void 0===t||null===(r=t.streamCapability)||void 0===r?void 0:r.supportsLinearScrubbing)}get isAssetScrubbingDisabled(){return!!this.isLinearStream&&!this.supportsLinearScrubbing}get isLinearStream(){return function(e){var t,r;return"LiveService"===(null==e?void 0:e.type)||"Event"===(null==e||null===(t=e.defaultPlayable)||void 0===t?void 0:t.type)||"EbsEvent"===(null==e||null===(r=e.defaultPlayable)||void 0===r?void 0:r.type)}(this)}get isLiveRadioStation(){return isLiveRadioStation(this)}get isLiveAudioStation(){return isLiveRadioKind(this,"audio")}get isLiveVideoStation(){return isLiveRadioKind(this,"video")}get isSong(){return"song"===this.type}get info(){return`${this.title} - ${this.albumInfo}`}get isCloudItem(){return this.playParams&&this.playParams.isLibrary||n(this.id)}get isCloudUpload(){return-1===this._songId}get isExplicitItem(){return"explicit"===this.contentRating}get isLoading(){return this.state===P.loading}get isPlayableMediaType(){return this.isUTS||-1!==ut.indexOf(this.type)}get isPlayable(){var e;return!!this.isPlayableMediaType&&(!(!this.isLiveRadioStation&&!this.hasOffersHlsUrl)||(this.needsPlayParams?!!this.playParams:this.isUTS?this.isEntitledToPlay:!!this.attributes.assetUrl||!!(null===(e=this.attributes.previews)||void 0===e?void 0:e.length)))}get isPlaying(){return this.state===P.playing}get isPreparedToPlay(){if("song"===this.type)return!!this._assets&&!!this.keyURLs&&!!this._songId;if(this.isUTS){const e=isStringNotEmpty(this.assetURL),t=!!(this.keyURLs&&isStringNotEmpty(this.keyURLs["hls-key-cert-url"])&&isStringNotEmpty(this.keyURLs["hls-key-server-url"])&&isStringNotEmpty(this.keyURLs["widevine-cert-url"]));return e&&t}return!!isStringNotEmpty(this.assetURL)||this.playRawAssetURL&&!!isStringNotEmpty(this.attributes.assetUrl)}get isrc(){return this.attributes.isrc}get isReady(){return this.state===P.ready}get isRestricted(){return this.state===P.restricted}get isUTS(){var e;return!(!(null===(e=this.defaultPlayable)||void 0===e?void 0:e.type)||!pt.includes(this.defaultPlayable.type))}get isUnavailable(){return this.state===P.unavailable}get needsPlayParams(){return["musicVideo","song"].includes(this.type)}get normalizedType(){return normalizeContentType(this.type)}get offers(){return this.attributes.offers}get offersHlsUrl(){const{offers:e}=this,t=null==e?void 0:e.find(e=>{var t;return!!(null===(t=e.hlsUrl)||void 0===t?void 0:t.length)});return null==t?void 0:t.hlsUrl}get hasOffersHlsUrl(){return isStringNotEmpty(this.offersHlsUrl)}set playbackData(e){if(void 0===e)return;this.previewURL&&(e.previewURL=this.previewURL);const t=transform$8(e);this.artwork&&t.artwork&&delete t.artwork,t.id!==this.id&&delete t.id,this.playParams&&t.attributes.playParams&&(t.attributes.playParams=this.playParams),t.attributes=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$E(e,t,r[t])}))}return e}({},this.attributes,t.attributes),Object.assign(this,t),yt.debug("media-item: item merged with playbackData",this),this.state=P.ready}get playbackDuration(){return this.attributes.durationInMillis||this.attributes.durationInMilliseconds}get playEvent(){var e;return null===(e=this.defaultPlayable)||void 0===e?void 0:e.playEvent}get playlistArtworkURL(){var e,t,r;return this.hasPlaylistContainer&&this.hasContainerArtwork?null===(e=this.container)||void 0===e||null===(t=e.attributes)||void 0===t||null===(r=t.artwork)||void 0===r?void 0:r.url:this.artworkURL}get playlistName(){var e,t;return this.hasPlaylistContainer?null===(e=this.container)||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.name:this.albumName}get playParams(){return this.attributes.playParams}get playRawAssetURL(){return this.offers?this.offers.some(e=>"STDQ"===e.type):!(!this.isCloudUpload&&!dt[this.type])}get previewURL(){var e,t,r,n,i,a,o,s,c,l,u,d,p,h,y;return(null===(e=this.attributes)||void 0===e||null===(t=e.previews)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.url)||(null===(n=this.attributes)||void 0===n||null===(i=n.previews)||void 0===i||null===(a=i[0])||void 0===a?void 0:a.hlsUrl)||(null===(o=this.attributes)||void 0===o||null===(s=o.trailers)||void 0===s||null===(c=s[0])||void 0===c||null===(l=c.assets)||void 0===l?void 0:l.hlsUrl)||(null===(u=this.attributes)||void 0===u||null===(d=u.movieClips)||void 0===d||null===(p=d[0])||void 0===p?void 0:p.hlsUrl)||(null===(h=this.attributes)||void 0===h||null===(y=h.video)||void 0===y?void 0:y.hlsUrl)}get rating(){return this.attributes.rating}get releaseDate(){if(this._releaseDate)return this._releaseDate;if(this.attributes&&(this.attributes.releaseDate||this.attributes.releaseDateTime)){const e=this.attributes.releaseDate||this.attributes.releaseDateTime;return this._releaseDate=/^\d{4}-\d{1,2}-\d{1,2}/.test(e)?new Date(e):void 0,this._releaseDate}}set releaseDate(e){this._releaseDate="string"==typeof e?/^\d{4}-\d{1,2}-\d{1,2}/.test(e)?new Date(e):void 0:"number"==typeof e?new Date(e):e}get songId(){return this._songId&&-1!==this._songId?this._songId:this.id}get state(){return this._state.current}set state(e){const t={oldState:this._state.current,state:e};this._stateWillChange&&this._stateWillChange(this),this.dispatchEvent(wt,t),this._state.set(e),this._stateDidChange&&this._stateDidChange(this),this.dispatchEvent(kt,t)}get title(){return this.attributes.name||this.attributes.title}get trackNumber(){return this.attributes.trackNumber}beginMonitoringStateDidChange(e){this._stateDidChange=e}beginMonitoringStateWillChange(e){this._stateWillChange=e}endMonitoringStateDidChange(){this._stateDidChange=void 0}endMonitoringStateWillChange(){this._stateWillChange=void 0}isEqual(e){return this.id===e.id&&this.type===e.type&&this.attributes===e.attributes}resetState(){this.endMonitoringStateWillChange(),this.endMonitoringStateDidChange(),this.state=P.none}restrict(){this.isExplicitItem&&(this.state=P.restricted,this._removePlayableData())}notSupported(){this.state=P.unsupported,this._removePlayableData()}updateFromLoadError(e){switch(e.errorCode){case MKError.CONTENT_RESTRICTED:this.state=P.restricted;break;case MKError.CONTENT_UNAVAILABLE:this.state=P.unavailable;break;default:this.state=P.error}}updateFromSongList(e){"musicVideo"===this.type?this.updateWithLoadedAssets(void 0,e["hls-playlist-url"]):this.updateWithLoadedAssets(e.assets),this._songId=e.songId,this.updateWithLoadedKeys({"hls-key-cert-url":e["hls-key-cert-url"],"hls-key-server-url":e["hls-key-server-url"],"widevine-cert-url":e["widevine-cert-url"]})}updateWithLoadedKeys(e,t){this.keyURLs=e,t&&(this.keyServerQueryParameters=t)}updateWithLoadedAssets(e,t){e&&(this._assets=e),t&&(this.assetURL=t)}_removePlayableData(){var e,t,r;null===(e=this.attributes)||void 0===e||delete e.playParams,null===(t=this.attributes)||void 0===t||delete t.previews,null===(r=this.attributes)||void 0===r||delete r.trailers}constructor(t={}){super([kt,wt]),this.hlsMetadata={},this.attributes={},this.playbackType=e.PlaybackType.none,this._assets=[],this._state=createMediaItemStateGuard(),yt.debug("media-item: creating Media Item with options:",t);t.id&&t.attributes?(Object.keys(t).forEach(e=>{hasOwn(It,e)||(this[e]=t[e])}),this.type=this.playParams&&this.playParams.kind?this.playParams.kind:this.type||"song"):(this.id=t.id||generateUUID(),this.type=t.type||"song",this.attributes={playParams:{id:this.id,kind:this.type}}),this.contentType=t.contentType,this._context=t.context||{},t.container?this._container=t.container:t.containerId&&t.containerType&&(this._container={id:t.containerId,type:t.containerType})}}const Ot=new Logger$1("player"),K=()=>{},asAsync=e=>{e.then(K,K)},At=isNodeEnvironment$1();class Browser{static supportsEs6(){if("undefined"==typeof Symbol)return!1;try{new Function('"use strict";class Foo {}')(),new Function('"use strict";var bar = (x) => x+1')()}catch(e){return!1}return!0}constructor(e){var t;e||(e="undefined"!=typeof window&&(null===window||void 0===window||null===(t=window.navigator)||void 0===t?void 0:t.userAgent)?window.navigator.userAgent:"");const r=e.toLowerCase();this.isEdge=/\sedge\//.test(r),this.isChrome=!this.isEdge&&/chrome/.test(r),this.isSafari=!this.isEdge&&!this.isChrome&&/safari/.test(r),this.isFirefox=!this.isEdge&&!this.isChrome&&!this.isSafari&&/firefox/.test(r),this.isIE=!this.isEdge&&!this.isChrome&&!this.isSafari&&!this.isFirefox&&/trident|msie/.test(r),this.isMobile=/mobile/.test(r),this.isAndroid=/android/.test(r),this.isiOS=this.isMobile&&/iphone|ipad|ipod/.test(r),this.isMacOs=!this.isMobile&&/macintosh/.test(r),this.isWebView=/(webview|(iphone|ipod|ipad)(?!.*safari\/)|android.*(wv|\.0\.0\.0)|\bfb[\w_]+\/(?:messenger)?|\binstagram|\btwitter)/.test(r),this.isEdge?this.engineVersion=r.match(/(?:edge).(\d+)/):(this.version=r.match(/(?:chrome|version|firefox|msie|rv).(\d+)\.(\d+)/),this.engineVersion=r.match(/(?:applewebkit|gecko|trident).(\d+)/)),this.version&&(this.majorVersion=parseInt(this.version[1],10),this.minorVersion=parseInt(this.version[2],10)),this.engineVersion&&(this.engineMajorVersion=parseInt(this.engineVersion[1],10))}}const Rt=new Browser;var Ct;!function(e){e.NONE="none",e.FAIRPLAY="com.apple.fps",e.PLAYREADY="com.microsoft.playready",e.WIDEVINE="com.widevine.alpha"}(Ct||(Ct={}));const Dt={app:{},features:{},urls:{}},Mt="mk-player-tsid",xt='audio/mp4;codecs="mp4a.40.2"',Lt=document.createElement("video"),Nt=[],$t=[];function deferPlayback(){fillAvailableElements("audio",$t),fillAvailableElements("video",Nt),Ot.debug(`dom-helpers: defer playback called.  There are ${Nt.length} available video elements and ${$t.length} available audio elements.`)}function fillAvailableElements(e,t){let r=100-t.length;for(;r>0;){const n=document.createElement(e);n.load(),t.push(n),r--}}var jt,Ut,Gt;function asyncGeneratorStep$1b(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$1b(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$1b(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1b(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function findMediaKeySystemAccess(e,t){return _findMediaKeySystemAccess.apply(this,arguments)}function _findMediaKeySystemAccess(){return(_findMediaKeySystemAccess=_asyncToGenerator$1b((function*(e,t){for(let n=0;n<e.length;n++)try{const r=e[n];return[r,yield navigator.requestMediaKeySystemAccess(r,t)]}catch(r){}return[]}))).apply(this,arguments)}!function(e){e.playbackLicenseError="playbackLicenseError",e.playbackSessionError="playbackSessionError",e.manifestParsed="manifestParsed",e.audioCodecIdentified="audioCodecIdentified",e.audioTracksSwitched="audioTracksSwitched",e.audioTracksUpdated="audioTracksUpdated",e.textTracksSwitched="textTracksSwitched",e.textTracksUpdated="textTracksUpdated",e.inlineStylesParsed="inlineStylesParsed",e.levelUpdated="levelUpdated"}(jt||(jt={})),function(e){e.MP4="audio/mp4",e.AVC1="video/mp4"}(Ut||(Ut={})),function(e){e.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",e.PLAYREADY="com.microsoft.playready",e.FAIRPLAY="com.apple.streamingkeydelivery"}(Gt||(Gt={}));let Ft;const{NONE:Bt,FAIRPLAY:Kt,WIDEVINE:Vt,PLAYREADY:Ht}=Ct;function supportsDrm(){if(!Ft)throw new Error("findKeySystemPreference has not been invoked");return Ft!==Bt}function potentialKeySystemsForAccess(){return function(){const e=getSessionStorage();return!!e&&"true"===e.getItem("mk-playready-cbcs-unsupported")}()?[Vt]:Dt.features["prefer-playready"]?[Ht,Vt]:[Vt,Ht]}function findKeySystemPreference(){return _findKeySystemPreference.apply(this,arguments)}function _findKeySystemPreference(){return(_findKeySystemPreference=_asyncToGenerator$1b((function*(){var e,t;if(!At){if(null===(e=window.WebKitMediaKeys)||void 0===e?void 0:e.isTypeSupported(Kt+".1_0",Ut.AVC1))Ft=Kt;else if(null===(t=window.MSMediaKeys)||void 0===t?void 0:t.isTypeSupported(Ht,Ut.AVC1))Ft=Ht;else{const e=Lt;if(hasMediaKeySupport()&&e.canPlayType('video/mp4;codecs="avc1.42E01E"')&&e.canPlayType(xt)){const e=[{initDataTypes:["keyids","cenc"],distinctiveIdentifier:"optional",persistentState:"required",videoCapabilities:[{contentType:'video/mp4;codecs="avc1.42E01E"',robustness:"SW_SECURE_CRYPTO"}],audioCapabilities:[{contentType:xt}]}],t=potentialKeySystemsForAccess(),[r]=yield findMediaKeySystemAccess(t,e);Ft=r}}return Ft=null!=Ft?Ft:Bt,Ft}Ft=Bt}))).apply(this,arguments)}function hasMediaKeySupport(){return!!(navigator&&navigator.requestMediaKeySystemAccess&&window.MediaKeys&&window.MediaKeySystemAccess)}const AsyncDebounce=(e=100,t)=>(r,n,i)=>{const a=i.value,o=asyncDebounce(a,e,t);i.value=o},asyncDebounce=(e,t=250,r={isImmediate:!1})=>{let n,i;function fulfill(e){return null==e?void 0:e.resolve(r.cancelledValue)}const clearLastPromise=()=>{n&&(n.resolved||(fulfill(n),n.timeoutId&&clearTimeout(n.timeoutId)),n=void 0)},invokeFn=(t,r,i,a)=>{e.apply(t,a).then(e=>{r(e),n&&(n.resolved=!0)}).catch(i)};return r.isImmediate?function(...e){const r=Date.now(),a=this;return i&&r>=i&&clearLastPromise(),i=Date.now()+t,n?fulfill(Promise):new Promise((t,r)=>{n={resolve:t,reject:r},invokeFn(a,t,r,e)})}:function(...e){const r=this;return n&&clearLastPromise(),new Promise((function(i,a){const o=setTimeout(invokeFn.bind(void 0,r,i,a,e),t);n={resolve:i,reject:a,timeoutId:o}}))}};function deprecationWarning(e,t={}){var r;const n=null!==(r=t.message)&&void 0!==r?r:e+" has been deprecated",i=[];t.since&&i.push("since: "+t.since),t.until&&i.push("until: "+t.until),console.warn("Deprecation Warning: "+n+(i.length>0?` (${i.join(", ")})`:""))}class PubSub{publish(e,t){const r=this.getSubscribersForType(e);void 0!==r&&r.forEach(r=>{r(e,t)})}subscribe(e,t){this.getSubscribersForType(e,!0).push(t)}subscribeOnce(e,t){const onceCallback=(e,r)=>{this.unsubscribe(e,onceCallback),t(e,r)};this.subscribe(e,onceCallback)}unsubscribe(e,t){const r=this.getSubscribersForType(e);if(void 0!==r)for(const n in r)if(r[n]===t){delete r[n];break}}clear(e){void 0===e?this.events={}:delete this.events[e]}getSubscribersForType(e,t=!1){return!this.events.hasOwnProperty(e)&&t&&(this.events[e]=[]),this.events[e]}constructor(){this.events={}}}function asyncGeneratorStep$1a(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$1a(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$1a(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1a(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const Wt={},SerialAsync=e=>{let t=Promise.resolve();return(r,n,i)=>{const a=i.value;return i.value=_asyncToGenerator$1a((function*(...r){return e&&(t=(e=>{let t=Wt[e];return t||(t=Promise.resolve(),Wt[e]=t),t})(e)),t=t.catch(()=>{}).then(()=>a.apply(this,r)),e&&(Wt[e]=t),t})),i}};var qt,zt,Yt;e.PlaybackBitrate=void 0,(qt=e.PlaybackBitrate||(e.PlaybackBitrate={}))[qt.STANDARD=64]="STANDARD",qt[qt.HIGH=256]="HIGH",function(e){e.apiStorefrontChanged="apiStorefrontChanged",e.hlsLevelUpdated="hlsLevelUpdated",e.mediaContentComplete="mediaContentComplete",e.playbackPause="playbackPause",e.playbackPlay="playbackPlay",e.playbackScrub="playbackScrub",e.playbackSeek="playbackSeek",e.playbackSkip="playbackSkip",e.playbackStop="playbackStop",e.lyricsPlay="lyricsPlay",e.lyricsStop="lyricsStop",e.playerActivate="playerActivate",e.playerExit="playerExit",e.queueModified="queueModified",e.userActivityIntent="userActivityIntent",e.applicationActivityIntent="applicationActivityIntent"}(zt||(zt={})),function(e){e[e.ACCURATE=0]="ACCURATE",e[e.ROUND=1]="ROUND"}(Yt||(Yt={}));class TimingAccuracy{time(e=0){return this.mode===Yt.ROUND?Math.round(e):e}constructor(e=!1){this.mode=e?Yt.ACCURATE:Yt.ROUND}}const Qt={audioTrackAdded:"audioTrackAdded",audioTrackChanged:"audioTrackChanged",audioTrackRemoved:"audioTrackRemoved",bufferedProgressDidChange:"bufferedProgressDidChange",drmUnsupported:"drmUnsupported",forcedTextTrackChanged:"forcedTextTrackChanged",mediaCanPlay:"mediaCanPlay",mediaElementCreated:"mediaElementCreated",mediaPlaybackError:"mediaPlaybackError",nowPlayingItemDidChange:"nowPlayingItemDidChange",nowPlayingItemWillChange:"nowPlayingItemWillChange",metadataDidChange:"metadataDidChange",playbackBitrateDidChange:"playbackBitrateDidChange",playbackDurationDidChange:"playbackDurationDidChange",playbackProgressDidChange:"playbackProgressDidChange",playbackRateDidChange:"playbackRateDidChange",playbackStateDidChange:"playbackStateDidChange",playbackStateWillChange:"playbackStateWillChange",playbackTargetAvailableDidChange:"playbackTargetAvailableDidChange",playbackTargetIsWirelessDidChange:"playbackTargetIsWirelessDidChange",playbackTimeDidChange:"playbackTimeDidChange",playbackVolumeDidChange:"playbackVolumeDidChange",playerTypeDidChange:"playerTypeDidChange",presentationModeDidChange:"presentationModeDidChange",primaryPlayerDidChange:"primaryPlayerDidChange",textTrackAdded:"textTrackAdded",textTrackChanged:"textTrackChanged",textTrackRemoved:"textTrackRemoved",timedMetadataDidChange:"timedMetadataDidChange"};class BitrateCalculator{get bitrate(){return this._bitrate}set bitrate(e){this._bitrate!==e&&(this._bitrate=e,this._dispatcher.publish(Qt.playbackBitrateDidChange,{bitrate:e}))}_calculateAverageDownlink(){return 0===this._downlinkSamples.length?0:this._downlinkSamples.reduce((e,t)=>e+t,0)/this._downlinkSamples.length||0}_recalculateBitrate(t){Ot.debug("_recalculateBitrate",t),this._downlinkSamples.push(t);this._calculateAverageDownlink()>e.PlaybackBitrate.STANDARD?(Ot.debug("setting bitrate to",e.PlaybackBitrate.HIGH),this.bitrate=e.PlaybackBitrate.HIGH):(Ot.debug("setting bitrate to",e.PlaybackBitrate.STANDARD),this.bitrate=e.PlaybackBitrate.STANDARD)}constructor(t,r=e.PlaybackBitrate.STANDARD){var n,i;this._downlinkSamples=[],this._bitrate=r,this._dispatcher=t,void 0!==(null===window||void 0===window||null===(n=window.navigator)||void 0===n||null===(i=n.connection)||void 0===i?void 0:i.downlink)&&this._recalculateBitrate(100*(window.navigator.connection.downlink||0))}}var Jt,Xt,Zt,er,tr,rr,nr;!function(e){e.MUSICKIT="music_kit-integration",e.OTHER="other",e.MINI="mini",e.SONG="song",e.ALBUM="album",e.ALBUM_CLASSICAL="album-classical",e.ARTIST="artist",e.COMPILATION="compilation",e.COMPILATION_CLASSICAL="compilation-classical",e.PLAYLIST="playlist",e.PLAYLIST_CLASSICAL="playlist-classical",e.RADIO="radio",e.SEARCH="search",e.STATION="station"}(Jt||(Jt={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.RADIO=1]="RADIO",e[e.PLAYLIST=2]="PLAYLIST",e[e.ALBUM=3]="ALBUM",e[e.ARTIST=4]="ARTIST"}(Xt||(Xt={})),function(e){e[e.NOT_APPLICABLE=0]="NOT_APPLICABLE",e[e.OTHER=1]="OTHER",e[e.TRACK_SKIPPED_FORWARDS=2]="TRACK_SKIPPED_FORWARDS",e[e.PLAYBACK_MANUALLY_PAUSED=3]="PLAYBACK_MANUALLY_PAUSED",e[e.PLAYBACK_SUSPENDED=4]="PLAYBACK_SUSPENDED",e[e.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM=5]="MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM",e[e.PLAYBACK_PAUSED_DUE_TO_INACTIVITY=6]="PLAYBACK_PAUSED_DUE_TO_INACTIVITY",e[e.NATURAL_END_OF_TRACK=7]="NATURAL_END_OF_TRACK",e[e.PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT=8]="PLAYBACK_STOPPED_DUE_TO_SESSION_TIMEOUT",e[e.TRACK_BANNED=9]="TRACK_BANNED",e[e.FAILED_TO_LOAD=10]="FAILED_TO_LOAD",e[e.PAUSED_ON_TIMEOUT=11]="PAUSED_ON_TIMEOUT",e[e.SCRUB_BEGIN=12]="SCRUB_BEGIN",e[e.SCRUB_END=13]="SCRUB_END",e[e.TRACK_SKIPPED_BACKWARDS=14]="TRACK_SKIPPED_BACKWARDS",e[e.NOT_SUPPORTED_BY_CLIENT=15]="NOT_SUPPORTED_BY_CLIENT",e[e.QUICK_PLAY=16]="QUICK_PLAY",e[e.EXITED_APPLICATION=17]="EXITED_APPLICATION"}(Zt||(Zt={})),e.SeekReasonType=void 0,(er=e.SeekReasonType||(e.SeekReasonType={}))[er.Manual=0]="Manual",er[er.Interval=1]="Interval",er[er.SkipIntro=2]="SkipIntro",function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.NO_RIGHTS=1]="NO_RIGHTS",e[e.PURCHASED=2]="PURCHASED",e[e.UPLOADED=3]="UPLOADED",e[e.MATCHED=4]="MATCHED",e[e.ADDED=5]="ADDED",e[e.SUBSCRIBED=6]="SUBSCRIBED",e[e.NOT_SUPPORTED=7]="NOT_SUPPORTED"}(tr||(tr={})),function(e){e[e.NO_SELECTION_PLAY=0]="NO_SELECTION_PLAY",e[e.RESUME_LAST_PLAYED_SONG=1]="RESUME_LAST_PLAYED_SONG",e[e.RESUME_CURRENT_DEVICE_POSITION=2]="RESUME_CURRENT_DEVICE_POSITION"}(rr||(rr={})),function(e){e[e.NOT_APPLICABLE=0]="NOT_APPLICABLE",e[e.SIMILARITIES=1]="SIMILARITIES",e[e.ESSENTIALS=2]="ESSENTIALS",e[e.USER_LIBRARY=3]="USER_LIBRARY",e[e.ALGO_HEATSEEKER=4]="ALGO_HEATSEEKER",e[e.SEED_TRACK=5]="SEED_TRACK",e[e.GN_1M_TEMPORARY=6]="GN_1M_TEMPORARY",e[e.VECTOR=8]="VECTOR",e[e.ARTIST_SIMILARITIES=9]="ARTIST_SIMILARITIES",e[e.STORY_ALBUM_LISTENERS_ALSO_BOUGHT=10]="STORY_ALBUM_LISTENERS_ALSO_BOUGHT",e[e.STORY_ALBUM_SALES_LEADER=11]="STORY_ALBUM_SALES_LEADER",e[e.STORY_BILLBOARD=12]="STORY_BILLBOARD",e[e.STORY_COMPLETE_MY_ALBUM=13]="STORY_COMPLETE_MY_ALBUM",e[e.STORY_CRITICAL_PICK=14]="STORY_CRITICAL_PICK",e[e.STORY_ITUNES_ESSENTIAL=15]="STORY_ITUNES_ESSENTIAL",e[e.STORY_HEATSEEKER=16]="STORY_HEATSEEKER",e[e.STORY_IDENTITY=17]="STORY_IDENTITY",e[e.STORY_POWER_SONG=18]="STORY_POWER_SONG",e[e.STORY_SONG_SALES_LEADER=20]="STORY_SONG_SALES_LEADER",e[e.GENRE_SIMILARITIES=21]="GENRE_SIMILARITIES",e[e.STORY_IMIX=22]="STORY_IMIX",e[e.STORY_OTHER_MIX=23]="STORY_OTHER_MIX",e[e.EDITORIAL=24]="EDITORIAL",e[e.TOP_SONGS=25]="TOP_SONGS",e[e.SUBFORMAT_SONGS=26]="SUBFORMAT_SONGS",e[e.CRITICAL_PICKS=27]="CRITICAL_PICKS",e[e.US_ARTIST_SIMS=28]="US_ARTIST_SIMS",e[e.HEAVY_ROTATION=29]="HEAVY_ROTATION",e[e.STORY_FORMAT_STATION_HEAVY_ROTATION=30]="STORY_FORMAT_STATION_HEAVY_ROTATION",e[e.ARTIST_BASED_CORE_SIMILAR_ARTISTS=31]="ARTIST_BASED_CORE_SIMILAR_ARTISTS",e[e.ARTIST_BASED_FAMILIAR_SIMILAR_ARTISTS=32]="ARTIST_BASED_FAMILIAR_SIMILAR_ARTISTS",e[e.ARTIST_BASED_DISCOVERIES=33]="ARTIST_BASED_DISCOVERIES",e[e.ARTIST_BASED_HOT_SONGS=34]="ARTIST_BASED_HOT_SONGS",e[e.ARTIST_BASED_SEED_ARTIST=35]="ARTIST_BASED_SEED_ARTIST",e[e.ARTIST_BASED_COMPOSER=36]="ARTIST_BASED_COMPOSER",e[e.EDITORIAL_STATION_INTRO=37]="EDITORIAL_STATION_INTRO",e[e.EDITORIAL_RELATIVE_REPEAT=38]="EDITORIAL_RELATIVE_REPEAT",e[e.EDITORIAL_ABSOLUTE_REPEAT=39]="EDITORIAL_ABSOLUTE_REPEAT",e[e.EDITORIAL_SCHEDULED=40]="EDITORIAL_SCHEDULED",e[e.EDITORIAL_SUGGESTED_ARTIST=41]="EDITORIAL_SUGGESTED_ARTIST",e[e.FOR_YOU_FAMILIAR=42]="FOR_YOU_FAMILIAR",e[e.FOR_YOU_RECOMMENDED=43]="FOR_YOU_RECOMMENDED",e[e.FOR_YOU_FAVORITE_ARTIST=44]="FOR_YOU_FAVORITE_ARTIST",e[e.FOR_YOU_RECOMMENDED_ARTIST=45]="FOR_YOU_RECOMMENDED_ARTIST",e[e.EDITORIAL_POSITIONAL=46]="EDITORIAL_POSITIONAL",e[e.SIMILAR_SONGS=47]="SIMILAR_SONGS",e[e.SONG_ATTRIBUTE_FAVORITE_ARTIST=48]="SONG_ATTRIBUTE_FAVORITE_ARTIST",e[e.SONG_ATTRIBUTE_FAVORITE_ARTIST_DERIVED=49]="SONG_ATTRIBUTE_FAVORITE_ARTIST_DERIVED",e[e.SONG_ATTRIBUTE_FAVORITE_ARTIST_EDITORIAL=50]="SONG_ATTRIBUTE_FAVORITE_ARTIST_EDITORIAL",e[e.SONG_ATTRIBUTE_RECOMMENDED=51]="SONG_ATTRIBUTE_RECOMMENDED",e[e.SONG_ATTRIBUTE_RECOMMENDED_DERIVED=52]="SONG_ATTRIBUTE_RECOMMENDED_DERIVED",e[e.SONG_ATTRIBUTE_RECOMMENDED_EDITORIAL=53]="SONG_ATTRIBUTE_RECOMMENDED_EDITORIAL",e[e.SONG_ATTRIBUTE_NON_PERSONALIZED=54]="SONG_ATTRIBUTE_NON_PERSONALIZED",e[e.SONG_ATTRIBUTE_NON_PERSONALIZED_DERIVED=55]="SONG_ATTRIBUTE_NON_PERSONALIZED_DERIVED",e[e.SONG_ATTRIBUTE_NON_PERSONALIZED_EDITORIAL=56]="SONG_ATTRIBUTE_NON_PERSONALIZED_EDITORIAL",e[e.PERSONAL_STATION=57]="PERSONAL_STATION",e[e.PERSONAL_STATION_FAVORITE_ARTIST=58]="PERSONAL_STATION_FAVORITE_ARTIST",e[e.PERSONAL_STATION_RECOMMENDED=59]="PERSONAL_STATION_RECOMMENDED",e[e.NEW_MUSIC_STATION=60]="NEW_MUSIC_STATION",e[e.NEW_MUSIC_STATION_FAVORITE_ARTIST=61]="NEW_MUSIC_STATION_FAVORITE_ARTIST",e[e.NEW_MUSIC_STATION_RECOMMENDED=62]="NEW_MUSIC_STATION_RECOMMENDED"}(nr||(nr={}));var ir,ar,or,sr,cr,lr,ur,dr,pr,hr,yr,fr,mr,gr;!function(e){e[e.UNKNOWN_FORMAT=0]="UNKNOWN_FORMAT",e[e.STEREO=1]="STEREO",e[e.SPATIAL=2]="SPATIAL",e[e.PREFERENCE_FORMAT_UNSUPPORTED=3]="PREFERENCE_FORMAT_UNSUPPORTED"}(ir||(ir={})),function(e){e[e.UNKNOWN_QUALITY=0]="UNKNOWN_QUALITY",e[e.HIGH_EFFICIENCY=1]="HIGH_EFFICIENCY",e[e.HIGH_QUALITY=2]="HIGH_QUALITY",e[e.LOSSLESS=3]="LOSSLESS",e[e.HIGH_RESOLUTION_LOSSLESS=4]="HIGH_RESOLUTION_LOSSLESS",e[e.PREFERENCE_QUALITY_UNSUPPORTED=5]="PREFERENCE_QUALITY_UNSUPPORTED"}(ar||(ar={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.STATIC=1]="STATIC",e[e.LINE_BY_LINE=2]="LINE_BY_LINE",e[e.WORD_BY_WORD=3]="WORD_BY_WORD"}(or||(or={})),function(e){e[e.REPEAT_UNKNOWN=0]="REPEAT_UNKNOWN",e[e.REPEAT_OFF=1]="REPEAT_OFF",e[e.REPEAT_ONE=2]="REPEAT_ONE",e[e.REPEAT_ALL=3]="REPEAT_ALL"}(sr||(sr={})),function(e){e[e.SHUFFLE_UNKNOWN=0]="SHUFFLE_UNKNOWN",e[e.SHUFFLE_OFF=1]="SHUFFLE_OFF",e[e.SHUFFLE_ON=2]="SHUFFLE_ON"}(cr||(cr={})),function(e){e[e.AUTO_UNKNOWN=0]="AUTO_UNKNOWN",e[e.AUTO_OFF=1]="AUTO_OFF",e[e.AUTO_ON=2]="AUTO_ON",e[e.AUTO_ON_CONTENT_UNSUPPORTED=3]="AUTO_ON_CONTENT_UNSUPPORTED"}(lr||(lr={})),function(e){e[e.NOT_SPECIFIED=0]="NOT_SPECIFIED",e[e.CONTAINER_CHANGED=1]="CONTAINER_CHANGED"}(ur||(ur={})),function(e){e[e.PLAY_END=0]="PLAY_END",e[e.PLAY_START=1]="PLAY_START",e[e.LYRIC_DISPLAY=2]="LYRIC_DISPLAY"}(dr||(dr={})),function(e){e[e.INVALID=0]="INVALID",e[e.ITUNES_STORE_CONTENT=1]="ITUNES_STORE_CONTENT",e[e.NON_SONG_CLIP=2]="NON_SONG_CLIP",e[e.AD=3]="AD",e[e.STREAM=4]="STREAM",e[e.AUDIO_AD=5]="AUDIO_AD",e[e.VIDEO_AD=6]="VIDEO_AD",e[e.TIMED_METADATA_PING=7]="TIMED_METADATA_PING",e[e.ARTIST_UPLOADED_CONTENT=8]="ARTIST_UPLOADED_CONTENT",e[e.AGGREGATE_NON_CATALOG_PLAY_TIME=9]="AGGREGATE_NON_CATALOG_PLAY_TIME",e[e.ORIGINAL_CONTENT_MOVIES=10]="ORIGINAL_CONTENT_MOVIES",e[e.ORIGINAL_CONTENT_SHOWS=11]="ORIGINAL_CONTENT_SHOWS"}(pr||(pr={})),function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO"}(hr||(hr={})),function(e){e[e.AUTO=0]="AUTO",e[e.MANUAL=1]="MANUAL"}(yr||(yr={})),function(e){e[e.ORIGINATING_DEVICE=0]="ORIGINATING_DEVICE",e[e.PAIRED_WATCH=1]="PAIRED_WATCH",e[e.SONOS=2]="SONOS",e[e.CAR_PLAY=3]="CAR_PLAY",e[e.WEB_AUC=4]="WEB_AUC",e[e.TWITTER_AUC=5]="TWITTER_AUC",e[e.MUSIC_SDK=6]="MUSIC_SDK",e[e.ATV_REMOTE=7]="ATV_REMOTE",e[e.WEBPLAYER=8]="WEBPLAYER",e[e.WHOLE_HOUSE_AUDIO=9]="WHOLE_HOUSE_AUDIO",e[e.MUSICKIT=10]="MUSICKIT",e[e.VW=11]="VW",e[e.UNKNOWN_SOURCE_TYPE=12]="UNKNOWN_SOURCE_TYPE",e[e.AMAZON=13]="AMAZON",e[e.PORSCHE=14]="PORSCHE",e[e.CHROMECAST=15]="CHROMECAST",e[e.WEB_APP=16]="WEB_APP",e[e.MERCEDES_BENZ=17]="MERCEDES_BENZ",e[e.THIRD_PARTY_TV=18]="THIRD_PARTY_TV",e[e.SAMSUNG=18]="SAMSUNG",e[e.SEAT=19]="SEAT",e[e.CUPRA=20]="CUPRA"}(fr||(fr={})),function(e){e[e.EPISODE=1]="EPISODE",e[e.SHOUTCAST=2]="SHOUTCAST"}(mr||(mr={})),new Map([["play",dr.PLAY_START],["playbackstarted",dr.PLAY_START],["stop",dr.PLAY_END],["playbackstopped",dr.PLAY_END]]),new Map([["exit",Zt.EXITED_APPLICATION],["next",Zt.TRACK_SKIPPED_FORWARDS],["pause",Zt.PLAYBACK_MANUALLY_PAUSED],["playbackfinished",Zt.NATURAL_END_OF_TRACK],["playbackstopped",Zt.PLAYBACK_MANUALLY_PAUSED],["previous",Zt.TRACK_SKIPPED_BACKWARDS],["scrub_begin",Zt.SCRUB_BEGIN],["scrub_end",Zt.SCRUB_END],["stop",Zt.NATURAL_END_OF_TRACK]]),new Logger$1("paf"),function(e){e[e.ALEXA=13]="ALEXA"}(gr||(gr={}));const Bind=()=>(e,t,r)=>{if(void 0===r||"function"!=typeof r.value)throw new TypeError(`Only methods can be decorated with @Bind, but ${t} is not a method.`);return{configurable:!0,get(){const e=r.value.bind(this);return Object.defineProperty(this,t,{value:e,configurable:!0,writable:!0}),e}}},vr=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],br=["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"],_r=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],noop=()=>Promise.resolve(),Sr=(e=>{if(void 0===e)return noop;const t=vr.find(t=>"function"==typeof e.prototype[t]);return"string"!=typeof t?noop:(e=self.document)=>{var r;return null==e||null===(r=e[t])||void 0===r?void 0:r.call(e)}})(HTMLDocument),Tr=(e=>{if(void 0===e)return()=>!1;const t=br.find(t=>t in e.prototype);return"string"!=typeof t?()=>!1:(e=self.document)=>!!e[t]})(HTMLDocument),Pr=(e=>{if(void 0===e)return noop;const t=_r.find(t=>"function"==typeof e.prototype[t]);return"string"!=typeof t?noop:e=>null==e?void 0:e[t]()})(HTMLElement);function asyncGeneratorStep$19(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$19(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$19(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$19(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}class Fullscreen{exit(){var e=this;return _asyncToGenerator$19((function*(){if(e.isInFullscreen())return e.stopDispatchingEvents(()=>e.exitFullscreen())}))()}request(e){var t=this;return _asyncToGenerator$19((function*(){if(void 0!==e)return t.stopDispatchingEvents(()=>t.requestFullscreenForElement(e))}))()}stopDispatchingEvents(e){var t=this;return _asyncToGenerator$19((function*(){return t.player.windowHandlers.stopListeningToVisibilityChanges(e)}))()}exitFullscreen(){return Sr()}isInFullscreen(){return Tr()}requestFullscreenForElement(e){return Pr(e)}constructor(e){this.player=e}}function asyncGeneratorStep$18(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}class UnsupportedSeeker{start(){Ot.warn("seeker.start is not supported in this playback method")}end(){Ot.warn("seeker.end is not supported in this playback method")}seekToTime(e){return Ot.warn("seekToTime is not supported in this playback method"),Promise.resolve()}constructor(){this.ended=!1}}class PlayerSeeker{get ended(){return this._ended}get isEngagedInPlayback(){return this._player.isEngagedInPlayback}get stillPlayingSameItem(){return this._currentItem===this._player.nowPlayingItem}end(){Ot.debug("seeker: end"),-1!==this._startTime?this._ended?Ot.warn("seeker: Cannot end the same seeker twice."):(this.dispatchStartEvent(),this.dispatchEndEvent()):Ot.warn("seeker: Cannot end a seeker before starting it.")}seekToTime(e){var t,r=this;return(t=function*(){if(Ot.debug("seeker: seekToTime",e),!r.ended)return r.stillPlayingSameItem||(r._currentItem=r._player.nowPlayingItem,r._startTime=0),r._lastSeekedTime=e,r._player.seekToTime(e);Ot.warn("seeker: Cannot seek once the seeker has ended")},function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function _next(e){asyncGeneratorStep$18(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$18(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}start(){Ot.debug("seeker: start"),-1===this._startTime?(this._currentItem=this._player.nowPlayingItem,this._startTime=this._player.currentPlaybackTime,this._lastSeekedTime=this._startTime):Ot.warn("seeker: Cannot start same seeker twice")}dispatch(e,t){this.isEngagedInPlayback?(Ot.debug("seeker: dispatch",e),this._player.dispatch(e,t)):Ot.debug("seeker: do not dispatch because isEngagedInPlayback",this.isEngagedInPlayback)}dispatchStartEvent(){this.stillPlayingSameItem||(this._startTime=0,this._lastSeekedTime=0),this.dispatch(zt.playbackScrub,{item:this._currentItem,position:this._startTime})}dispatchEndEvent(){this._ended=!0,this.dispatch(zt.playbackScrub,{item:this._currentItem,position:this._lastSeekedTime,endReasonType:Zt.SCRUB_END})}constructor(e){this._ended=!1,this._lastSeekedTime=-1,this._startTime=-1,Ot.debug("seeker: new"),this._player=e}}function asyncGeneratorStep$17(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}var Er={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},kr={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const{visibilityChangeEvent:wr,visibilityState:Ir,unloadEventName:Or}=(()=>{let e="visibilitychange",t="visibilityState";void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozVisibilityState"):void 0!==document.msHidden?(e="msvisibilitychange",t="msVisibilityState"):document.webkitHidden&&(e="webkitvisibilitychange",t="webkitVisibilityState");return{visibilityChangeEvent:e,visibilityState:t,unloadEventName:"onpagehide"in window?"pagehide":"unload"}})();class WindowHandlers{activate(e=self,t=self.document){t.addEventListener(wr,this.visibilityChanged),e.addEventListener("storage",this.storage,!1),e.addEventListener(Or,this.windowUnloaded)}deactivate(){document.removeEventListener(wr,this.visibilityChanged),window.removeEventListener("storage",this.storage),window.addEventListener(Or,this.windowUnloaded)}stopListeningToVisibilityChanges(e){var t,r=this;return(t=function*(){r.dispatchVisibilityChanges=!1;const t=yield e();return r.dispatchVisibilityChanges=!0,t},function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function _next(e){asyncGeneratorStep$17(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$17(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}dispatch(e,t={}){this.player.dispatch(e,t)}storage({key:e,newValue:t}){e===Mt&&this.player.tsidChanged(t)}visibilityChanged(e){const t=e.target[Ir];Ot.info("dc visibilityState",t,e,Tr()),this.browser.isiOS&&this.dispatchVisibilityChanges&&("hidden"===t?this.dispatch(zt.playerExit,{item:this.player.nowPlayingItem,position:this.player.currentPlaybackTime}):"visible"===t&&this.dispatch(zt.playerActivate))}windowUnloaded(){this.player.isPlaying&&this.dispatch(zt.playerExit,{item:this.player.nowPlayingItem,position:this.player.currentPlaybackTime})}constructor(e,t=Rt){this.dispatchVisibilityChanges=!0,this.player=e,this.browser=t}}function asyncGeneratorStep$16(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$16(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$16(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$16(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$D(e,t,r[t])}))}return e}Er([Bind(),kr("design:type",Function),kr("design:paramtypes",[void 0])],WindowHandlers.prototype,"storage",null),Er([Bind(),kr("design:type",Function),kr("design:paramtypes",["undefined"==typeof Event?Object:Event])],WindowHandlers.prototype,"visibilityChanged",null),Er([Bind(),kr("design:type",Function),kr("design:paramtypes",[])],WindowHandlers.prototype,"windowUnloaded",null);var Ar={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Rr={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const{bufferedProgressDidChange:Cr,mediaCanPlay:Dr,mediaElementCreated:Mr,mediaPlaybackError:xr,nowPlayingItemDidChange:Lr,nowPlayingItemWillChange:Nr,metadataDidChange:$r,primaryPlayerDidChange:jr,playbackDurationDidChange:Ur,playbackProgressDidChange:Gr,playbackStateDidChange:Fr,playbackRateDidChange:Br,playbackStateWillChange:Kr,playbackTargetAvailableDidChange:Vr,playbackTargetIsWirelessDidChange:Hr,playbackTimeDidChange:Wr,playbackVolumeDidChange:qr}=Qt,zr=["canplay","durationchange","ended","error","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","timeupdate","volumechange","waiting"],Yr=["NotAllowedError","NotSupportedError"],{ended:Qr,loading:Jr,paused:Xr,playing:Zr,seeking:en,stopped:tn,waiting:rn}=e.PlaybackStates;class BasePlayer{get bitrate(){return this._bitrateCalculator.bitrate}get currentBufferedProgress(){return this._currentBufferedProgress}get _currentDuration(){return this._targetElement.duration}get _currentTime(){const e=this._targetElement.currentTime,t=this._buffer;var r;return e-(null!==(r=null==t?void 0:t.currentTimestampOffset)&&void 0!==r?r:0)}get currentPlaybackDuration(){const t=this.nowPlayingItem;if(!t)return 0;const r=t.playbackType===e.PlaybackType.encryptedFull||t.playbackType===e.PlaybackType.unencryptedFull,n=t.playbackDuration;return r&&n?this.calculateTime(n/1e3):this.calculateTime(this._currentDuration)}get currentPlaybackTime(){return this.calculateTime(this._currentTime)}calculateTime(e){return this._timing.time(e)}get currentPlaybackTimeRemaining(){return this.currentPlaybackDuration-this.currentPlaybackTime}get currentPlaybackProgress(){return this._currentPlaybackProgress||0}get hasMediaElement(){return this._targetElement instanceof HTMLElement&&null!==this._targetElement.parentNode}get isEngagedInPlayback(){return!this._stopped&&!this.isPaused()}get isPlaying(){return this.playbackState===Zr}get isPrimaryPlayer(){return this._isPrimaryPlayer}set isPrimaryPlayer(e){var t;e!==this._isPrimaryPlayer&&(this._isPrimaryPlayer=e,this._isPrimaryPlayer?null===(t=getLocalStorage())||void 0===t||t.setItem(Mt,this._serial):(this._dispatcher.publish(jr,{target:this}),this.pause({userInitiated:!1})))}get isReady(){return 0!==this._targetElement.readyState}get nowPlayingItem(){return this._nowPlayingItem}set nowPlayingItem(e){const t=this._dispatcher;if(void 0===e)return t.publish(Nr,{item:e}),this._nowPlayingItem=e,void t.publish(Lr,{item:e});const r=this._nowPlayingItem,n=this._buffer;(null==r?void 0:r.isEqual(e))||(t.publish(Nr,{item:e}),this.isPlaying&&(null==n?void 0:n.currentItem)!==e&&this._pauseMedia(),r&&(Ot.debug("setting state to ended on ",r.title),r.state=P.ended,r.endMonitoringStateDidChange(),r.endMonitoringStateWillChange()),this._nowPlayingItem=e,Ot.debug("setting state to playing on ",e.title),e.state=P.playing,e&&e.info&&this._setTargetElementTitle(e.info),t.publish(Lr,{item:e}),t.publish(Ur,{currentTarget:this._targetElement,duration:this.currentPlaybackDuration,target:this._targetElement,type:"durationchange"}))}get playbackRate(){return this._targetElement.playbackRate}set playbackRate(e){this._targetElement.playbackRate=e}get playbackState(){return this._playbackState}setPlaybackState(e,t){const r=this._playbackState;if(e===r)return;const n={oldState:r,state:e,nowPlayingItem:t};Ot.debug("BasePlayer.playbackState is changing",n),this._dispatcher.publish(Kr,n),this._playbackState=e,this._dispatcher.publish(Fr,n)}get playbackTargetAvailable(){return void 0!==window.WebKitPlaybackTargetAvailabilityEvent&&this._playbackTargetAvailable}set playbackTargetAvailable(e){e!==this._playbackTargetAvailable&&(this._playbackTargetAvailable=e,this._dispatcher.publish(Vr,{available:e}))}get playbackTargetIsWireless(){return void 0!==window.WebKitPlaybackTargetAvailabilityEvent&&this._playbackTargetIsWireless}set playbackTargetIsWireless(e){e!==this._playbackTargetIsWireless&&(this._playbackTargetIsWireless=e,this._dispatcher.publish(Hr,{playing:e}))}get volume(){return this._targetElement.volume}set volume(e){this._targetElement.volume=e}get isDestroyed(){return this._isDestroyed}clearNextManifest(){var e;null===(e=this._buffer)||void 0===e||e.clearNextManifest()}initialize(){var e=this;return _asyncToGenerator$16((function*(){Ot.debug("BasePlayer.initialize"),e.isPlayerSupported()?(yield e.initializeMediaElement(),yield e.initializeExtension(),e.initializeEventHandlers(),e._dispatcher.publish(Mr,e._targetElement)):Ot.warn("{this.constructor.name} not supported")}))()}initializeEventHandlers(){if(this.windowHandlers.activate(),!this.hasMediaElement)return;const e=this._targetElement;window.WebKitPlaybackTargetAvailabilityEvent&&(e.addEventListener("webkitplaybacktargetavailabilitychanged",e=>{this.playbackTargetAvailable="available"===e.availability}),e.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",e=>{this.playbackTargetIsWireless=e.target===this._targetElement&&!this.playbackTargetIsWireless})),zr.forEach(t=>e.addEventListener(t,this)),this._dispatcher.publish(zt.playerActivate)}removeEventHandlers(){zr.forEach(e=>this._targetElement.removeEventListener(e,this)),this.windowHandlers.deactivate()}isPaused(){return this._paused}exitFullscreen(){return this.fullscreen.exit()}requestFullscreen(e){return this.fullscreen.request(e)}newSeeker(){var e;return null===(e=this._seeker)||void 0===e||e.end(),this._seeker=new PlayerSeeker(this),this._seeker}stop(e){var t=this;return _asyncToGenerator$16((function*(){Ot.debug("BasePlayer.stop",e),yield t._waitForPendingPlay(),t.isPlaying&&(Ot.debug("BasePlayer.play dispatching playbackStop"),t.dispatch(zt.playbackStop,_objectSpread$D({item:t.nowPlayingItem,position:t.currentPlaybackTime,startPosition:t.initialBufferPosition,playingDate:t.currentPlayingDate,startPlayingDate:t.initialPlayingDate},e))),yield t.stopMediaAndCleanup()}))()}stopMediaAndCleanup(e=tn){var t=this;return _asyncToGenerator$16((function*(){Ot.debug("stopMediaAndCleanup"),yield t._stopMediaElement(),t._stopped=!0,t._paused=!1;const r=t.nowPlayingItem;t.nowPlayingItem=void 0,t.initialBufferPosition=void 0,t.initialPlayingDate=void 0,t.setPlaybackState(e,r)}))()}onPlaybackError(e,t){this.resetDeferredPlay(),this.stop({endReasonType:Zt.FAILED_TO_LOAD,userInitiated:!1})}calculatePlaybackProgress(){const e=Math.round(100*(this.currentPlaybackTime/this.currentPlaybackDuration||0))/100;this._currentPlaybackProgress!==e&&(this._currentPlaybackProgress=e,this._dispatcher.publish(Gr,{progress:this._currentPlaybackProgress}))}calculateBufferedProgress(e){const t=Math.round(e/this.currentPlaybackDuration*100);this._currentBufferedProgress!==t&&(this._currentBufferedProgress=t,this._dispatcher.publish(Cr,{progress:t}))}destroy(){var e,t;if(Ot.debug("BasePlayer.destroy"),this._isDestroyed=!0,this._dispatcher.unsubscribe(xr,this.onPlaybackError),!this.hasMediaElement)return;const r=this._targetElement;null===(e=this.extension)||void 0===e||e.destroy(r),this.removeEventHandlers(),this.cleanupElement(),null===(t=r.parentNode)||void 0===t||t.removeChild(r)}handleEvent(e){var t=this;return _asyncToGenerator$16((function*(){"timeupdate"!==e.type&&Ot.debug("BasePlayer.handleEvent: ",e.type,e,t.isPaused(),t._stopped);const{nowPlayingItem:r}=t;switch(e.type){case"canplay":t._dispatcher.publish(Dr,e),t._playbackState!==rn||t._targetElement.paused||t.setPlaybackState(Zr,r);break;case"durationchange":t._targetElement.duration!==1/0&&(e.duration=t.currentPlaybackDuration,t._dispatcher.publish(Ur,e),t.calculatePlaybackProgress());break;case"ended":{var n;if(Ot.debug('media element "ended" event'),null===(n=t.nowPlayingItem)||void 0===n?void 0:n.isLinearStream)return void Ot.warn("ignoring ended event for linear stream",e);if(t.isElementCleaned()){Ot.debug('media element already cleaned, ignoring "ended" event');break}const r=t.nowPlayingItem,i=t.currentPlaybackTime,a=t.currentPlayingDate;yield t.stopMediaAndCleanup(Qr),t.dispatch(zt.playbackStop,{item:r,position:i,playingDate:a,endReasonType:Zt.NATURAL_END_OF_TRACK});break}case"error":Ot.error("Playback Error",e,t._targetElement.error),t._dispatcher.publish(xr,new MKError(MKError.MEDIA_PLAYBACK,"Playback Error"));break;case"loadedmetadata":t._dispatcher.publish($r,e);break;case"loadstart":t.setPlaybackState(Jr,r);break;case"pause":t.setPlaybackState(t._stopped?tn:Xr,r);break;case"play":case"playing":t._paused=!1,t._stopped=!1,t.isPrimaryPlayer=!0,t.setPlaybackState(Zr,r);break;case"progress":{const e=t._targetElement.buffered;t.handleBufferStart(),1===e.length&&0===e.start(0)&&t.calculateBufferedProgress(e.end(0));break}case"ratechange":t._dispatcher.publish(Br,e);break;case"seeked":t._stopped?t.setPlaybackState(tn,r):t._paused?t.setPlaybackState(Xr,r):t.playbackState!==Qr&&t.setPlaybackState(Zr,r);break;case"seeking":t.playbackState===Xr?t._paused=!0:t.playbackState===tn&&(t._stopped=!0),t.playbackState!==Qr&&t.setPlaybackState(en,r);break;case"timeupdate":{t._dispatcher.publish(Wr,{currentPlaybackDuration:t.currentPlaybackDuration,currentPlaybackTime:t.currentPlaybackTime,currentPlaybackTimeRemaining:t.currentPlaybackTimeRemaining}),t.calculatePlaybackProgress();const e=t._buffer;e&&(e.currentTime=t.currentPlaybackTime);break}case"volumechange":t._dispatcher.publish(qr,e);break;case"waiting":t.setPlaybackState(rn,r)}}))()}handleBufferStart(){const{_targetElement:e}=this;void 0!==this.initialBufferPosition||e.paused||0===e.buffered.length||(this.initialBufferPosition=e.buffered.start(0),this.initialPlayingDate=this.currentPlayingDate,Ot.debug("BasePlayer.handleBufferStart: setting initial buffer position ",this.initialBufferPosition))}pause(e={}){var t=this;return _asyncToGenerator$16((function*(){yield t._waitForPendingPlay(),t.isPlaying&&(yield t._pauseMedia(),t._paused=!0,t.dispatch(zt.playbackPause,_objectSpread$D({item:t.nowPlayingItem,position:t.currentPlaybackTime,playingDate:t.currentPlayingDate},e)))}))()}play(e=!0){var t=this;return _asyncToGenerator$16((function*(){if(Ot.debug("BasePlayer.play()"),t.nowPlayingItem)try{yield t._playMedia(),Ot.debug("BasePlayer.play dispatching playbackPlay"),t.dispatch(zt.playbackPlay,{userInitiated:e,item:t.nowPlayingItem,position:t.currentPlaybackTime,playingDate:t.currentPlayingDate})}catch(r){if(r&&Yr.includes(r.name)&&Ot.error("BasePlayer.play() rejected due to",r),"NotAllowedError"===(null==r?void 0:r.name))throw new MKError(MKError.USER_INTERACTION_REQUIRED,"Playback of media content requires user interaction first and cannot be automatically started on page load.")}}))()}preload(){return this._loadMedia()}showPlaybackTargetPicker(){this.playbackTargetAvailable&&this._targetElement.webkitShowPlaybackTargetPicker()}dispatch(e,t){void 0===t.item&&(t.item=this.nowPlayingItem),hasOwn(t,"isPlaying")||(t.isPlaying=this.isPlaying),this._dispatcher.publish(e,t)}tsidChanged(e){void 0!==e&&""!==e&&(this.isPrimaryPlayer=e===this._serial)}_waitForPendingPlay(){var e=this;return _asyncToGenerator$16((function*(){e._deferredPlay&&(yield e._deferredPlay.promise,e._deferredPlay=void 0)}))()}_loadMedia(){var e=this;return _asyncToGenerator$16((function*(){Ot.debug("BasePlayer._loadMedia",e._targetElement),e._targetElement.load()}))()}_pauseMedia(){var e=this;return _asyncToGenerator$16((function*(){e._targetElement.pause()}))()}_playAssetURL(e,t){var r=this;return _asyncToGenerator$16((function*(){Ot.debug("BasePlayer._playAssetURL",e),r._targetElement.src=e;const n=r._loadMedia();if(t)return Ot.debug("BasePlayer.loadOnly"),void(yield n);yield r._playMedia()}))()}playItemFromUnencryptedSource(e,t,r){var n=this;return _asyncToGenerator$16((function*(){return(null==r?void 0:r.startTime)&&(e+="#t="+r.startTime),t||n.startPlaybackSequence(),yield n._playAssetURL(e,t),n.finishPlaybackSequence()}))()}_playMedia(){var e=this;return _asyncToGenerator$16((function*(){Ot.debug("BasePlayer._playMedia",e._targetElement,e.extension);try{yield e._targetElement.play(),e._playbackDidStart=!0}catch(Tt){throw Ot.error("BasePlayer._playMedia: targetElement.play() rejected",Tt),Tt}}))()}_setTargetElementTitle(e){this.hasMediaElement&&(this._targetElement.title=e)}resetDeferredPlay(){this._deferredPlay=void 0}_stopMediaElement(){var e=this;return _asyncToGenerator$16((function*(){e.hasMediaElement&&(e._targetElement.pause(),e.cleanupElement())}))()}cleanupElement(){const e=this._targetElement;e&&!this.isElementCleaned()&&(e.currentTime=0,e.removeAttribute("src"),e.removeAttribute("title"))}isElementCleaned(){const e=this._targetElement;return!e||0===e.currentTime&&""===e.src&&""===e.title}finishPlaybackSequence(){var e;Ot.debug("BasePlayer.finishPlaybackSequence",this._deferredPlay);const t=null===(e=this._deferredPlay)||void 0===e?void 0:e.resolve(void 0);return this._deferredPlay=void 0,t}startPlaybackSequence(){return Ot.debug("BasePlayer.startPlaybackSequence",this._deferredPlay),this._deferredPlay&&(Ot.warn("Previous playback sequence not cleared"),this.finishPlaybackSequence()),this._deferredPlay=function(){let e,t;return{promise:new Promise((function(r,n){e=r,t=n})),resolve(t){null==e||e(t)},reject(e){null==t||t(e)}}}(),this._deferredPlay.promise}constructor(t){var r;this.privateEnabled=!1,this.siriInitiated=!1,this._currentBufferedProgress=0,this._paused=!1,this._playbackState=e.PlaybackStates.none,this._stopped=!1,this._playbackDidStart=!1,this._currentPlaybackProgress=0,this._isPrimaryPlayer=!0,this._playbackTargetAvailable=!1,this._playbackTargetIsWireless=!1,this._serial=Date.now().toString(),this._isDestroyed=!1,this._dispatcher=t.services.dispatcher,this._timing=t.services.timing,this._context=t.context||{},this.privateEnabled=t.privateEnabled||!1,this.siriInitiated=t.siriInitiated||!1,this._bitrateCalculator=t.services.bitrateCalculator,this.windowHandlers=new WindowHandlers(this),this.fullscreen=new Fullscreen(this),null===(r=getLocalStorage())||void 0===r||r.setItem(Mt,this._serial),this._dispatcher.subscribe(xr,this.onPlaybackError)}}function generateAssetUrl(e,t){if("Preview"===e.type&&isStringNotEmpty(e.previewURL))return e.previewURL;let r=e.assetURL;if(!r)throw new Error("Cannot generate asset URL");return t&&(t.startOver&&(r=addQueryParamsToURL(r,{startOver:!0})),t.bingeWatching&&(r=addQueryParamsToURL(r,{bingeWatching:!0}))),e.supportsLinearScrubbing&&(r=addQueryParamsToURL(r,{linearScrubbingSupported:!0})),r.match(/xapsub=accepts-css/)||(r=addQueryParamsToURL(r,{xapsub:"accepts-css"})),r}function restoreSelectedTrack(e,t){Ot.debug("MEDIA_TRACKS restoreSelectedTrack");const r=e.getPersistedTrack(),n=e.fields,i=t.currentTrack;if(!r)return void Ot.debug("MEDIA_TRACKS no persisted track");if(i&&trackEquals(i,r,n))return void Ot.debug("MEDIA_TRACKS persisted track is equal to current track, not setting");const a=t.tracks;if(a&&a.length)for(let o=0;o<a.length;o++){const e=a[o];if(Ot.debug(`MEDIA_TRACKS testing track ${e.label} against persisted track ${JSON.stringify(r)}`),trackEquals(e,r,n)){Ot.debug("MEDIA_TRACKS found matching track "+e.label),t.currentTrack=e;break}}}function trackEquals(e,t,r){let n=!0;for(let i=0;i<r.length;i++){const a=r[i];if(e[a]!==t[a]){n=!1;break}}return n}Ar([Bind(),Rr("design:type",Function),Rr("design:paramtypes",[String,void 0===MKError?Object:MKError])],BasePlayer.prototype,"onPlaybackError",null);class TrackPersistence{getPersistedTrack(){var e;if(!hasLocalStorage())return!1;const t=(null===(e=getLocalStorage())||void 0===e?void 0:e.getItem(this.storageKey))||"";try{return JSON.parse(t)}catch(r){return Ot.warn("MEDIA_TRACK could not parse persisted value "+t),!1}}setPersistedTrack(e){var t,r;if(!hasLocalStorage())return;if(Ot.debug(`MEDIA_TRACK setPersistedTrack ${e.language},${e.label},${e.kind} with keys ${this.fields}`),!e)return void(null===(r=getLocalStorage())||void 0===r||r.setItem(this.storageKey,""));const n=JSON.stringify(this.extractFieldValuesFromTrack(e));Ot.debug("MEDIA_TRACK Extracted values "+n),null===(t=getLocalStorage())||void 0===t||t.setItem(this.storageKey,n)}extractFieldValuesFromTrack(e){const t={};return this.fields.forEach(r=>{const n=e[r];null==n&&Ot.warn(`MEDIA_TRACK No value for field ${r} on track ${JSON.stringify(e)}`),t[r]=n}),t}constructor(e,t){this.storageKey=e,this.fields=t}}var nn;function isHomeRadioTrack(e){return void 0!==e.characteristics&&e.characteristics.includes("com.apple.amp.appletv.home-team-radio")}function isAwayRadioTrack(e){return void 0!==e.characteristics&&e.characteristics.includes("com.apple.amp.appletv.away-team-radio")}!function(e){e.Home="com.apple.amp.appletv.home-team-radio",e.Away="com.apple.amp.appletv.away-team-radio"}(nn||(nn={}));class TrackManagerStub{get currentTrack(){return{}}set currentTrack(e){}get tracks(){return[]}destroy(){}restoreSelectedTrack(){}}const{audioTrackAdded:an,audioTrackChanged:on,audioTrackRemoved:sn}=Qt,{audioTracksSwitched:cn,audioTracksUpdated:ln}=jt;class AudioTrackManager{get currentTrack(){return this.tracks.find(e=>e.enabled)}set currentTrack(e){e&&(Ot.debug("MEDIA_TRACK Setting audio track "+e.label),this.extensionTracks?(Ot.debug(`MEDIA_TRACK Setting track on extension ${e.id}-${e.label}`),this.extensionTracks.audioTrack=e):(Ot.debug("MEDIA_TRACK disabling all audio tracks"),Array.from(this.mediaElement.audioTracks).forEach(t=>{t!==e&&(t.enabled=!1)}),Ot.debug("MEDIA_TRACK enabling",e),e.enabled=!0),isHomeRadioTrack(e)||isAwayRadioTrack(e)||this.trackPersistence.setPersistedTrack(e))}get tracks(){return this.extensionTracks?this._extensionTracks||this.extensionTracks.audioTracks||[]:Array.from(this.mediaElement.audioTracks)}destroy(){if(this.extensionTracks){const e=this.extensionTracks;e.removeEventListener(ln,this.onExtensionAudioTracksUpdated),e.removeEventListener(cn,this.onExtensionAudioTrackSwitched)}else{if(!this.mediaElement.audioTracks)return;this.mediaElement.audioTracks.removeEventListener("addtrack",this.onAudioTrackAdded),this.mediaElement.audioTracks.removeEventListener("change",this.onAudioTrackChanged),this.mediaElement.audioTracks.removeEventListener("removetrack",this.onAudioTrackRemoved)}}restoreSelectedTrack(){return restoreSelectedTrack(this.trackPersistence,this)}onExtensionAudioTracksUpdated(e){Ot.debug("MEDIA_TRACK Extension audio tracks updated "+JSON.stringify(e)),this._extensionTracks=e,this.restoreSelectedTrack(),this.dispatcher.publish(an,e)}onExtensionAudioTrackSwitched(e){if(Ot.debug("MEDIA_TRACK Extension audio track switched "+JSON.stringify(e)),this._extensionTracks){const preserveSelectedTrack=t=>{t.enabled=e.selectedId===t.id};this._extensionTracks.forEach(preserveSelectedTrack)}this.dispatcher.publish(on,e)}onAudioTrackAdded(e){!function(e,t,r){const n=t.getPersistedTrack();n&&trackEquals(e,n,t.fields)&&(Ot.debug("MEDIA_TRACK onTrackAdded with track that matches persisted track "+e.label),r.currentTrack=e)}(e.track,this.trackPersistence,this),this.dispatcher.publish(an,e)}onAudioTrackChanged(e){this.dispatcher.publish(on,e)}onAudioTrackRemoved(e){this.dispatcher.publish(sn,e)}constructor(e,t,r){if(this.mediaElement=e,this.dispatcher=t,this.extensionTracks=r,this._extensionTracks=[],this.trackPersistence=new TrackPersistence("mk-audio-track",["label","language","kind"]),this.extensionTracks){Ot.debug("MEDIA_TRACK Initializing audio track manager for hls track events"),this.onExtensionAudioTracksUpdated=this.onExtensionAudioTracksUpdated.bind(this),this.onExtensionAudioTrackSwitched=this.onExtensionAudioTrackSwitched.bind(this);const e=this.extensionTracks;e.addEventListener(ln,this.onExtensionAudioTracksUpdated),e.addEventListener(cn,this.onExtensionAudioTrackSwitched)}else{if(!e.audioTracks)return;Ot.debug("MEDIA_TRACK Initializing audio track manager for native track events"),this.onAudioTrackAdded=this.onAudioTrackAdded.bind(this),this.onAudioTrackChanged=this.onAudioTrackChanged.bind(this),this.onAudioTrackRemoved=this.onAudioTrackRemoved.bind(this),e.audioTracks.addEventListener("addtrack",this.onAudioTrackAdded),e.audioTracks.addEventListener("change",this.onAudioTrackChanged),e.audioTracks.addEventListener("removetrack",this.onAudioTrackRemoved)}}}const un=BooleanDevFlag.register("mk-load-manifest-once"),shouldLoadManifestOnce=()=>!!un.configured&&un.enabled;var dn=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isValidScrollSetting=t.isValidPositionAlignSetting=t.isValidLineAlignSetting=t.isValidLineAndPositionSetting=t.isValidDirectionSetting=t.isValidAlignSetting=t.isValidPercentValue=void 0,t.isValidPercentValue=function(e){return"number"==typeof e&&e>=0&&e<=100},t.isValidAlignSetting=function(e){return"string"==typeof e&&["start","center","end","left","right","middle"].includes(e)},t.isValidDirectionSetting=function(e){return"string"==typeof e&&["","rl","lr"].includes(e)},t.isValidLineAndPositionSetting=function(e){return"number"==typeof e||"auto"===e},t.isValidLineAlignSetting=function(e){return"string"==typeof e&&["start","center","end"].includes(e)},t.isValidPositionAlignSetting=function(e){return"string"==typeof e&&["line-left","center","line-right","auto","left","start","middle","end","right"].includes(e)},t.isValidScrollSetting=function(e){return["","up"].includes(e)}}));unwrapExports(dn),dn.isValidScrollSetting,dn.isValidPositionAlignSetting,dn.isValidLineAlignSetting,dn.isValidLineAndPositionSetting,dn.isValidDirectionSetting,dn.isValidAlignSetting,dn.isValidPercentValue;var pn=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},n={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},i={v:"title",lang:"lang"},a={rt:"ruby"},o={"text-combine-upright":"-webkit-text-combine:horizontal; text-orientation: mixed;"};class ParserUtility{static parseTimeStamp(e){function computeSeconds(e){const[t,r,n,i]=e.map(e=>e?parseInt(""+e):0);return 3600*t+60*r+n+i/1e3}const t=/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/.exec(e);return t?t[3]?computeSeconds([t[1],t[2],t[3].substring(1),t[4]]):parseInt(t[1])>59?computeSeconds([t[1],t[2],null,t[4]]):computeSeconds([null,t[1],t[2],t[4]]):null}static parseContent(e,t,s){let c=t.text;function nextToken(){if(!c)return null;const e=/^([^<]*)(<[^>]+>?)?/.exec(c);return t=e[1]?e[1]:e[2],c=c.substr(t.length),t;var t}function unescape1(e){return r[e]}function shouldAdd(e,t){return!a[t.dataset.localName]||a[t.dataset.localName]===e.dataset.localName}function createElement(t,r,a){const c=n[t];if(!c)return null;const l=e.document.createElement(c);l.dataset.localName=c;const u=i[t];if(u&&a&&(l[u]=a.trim()),r)if(s[r]){const e=function(e){let t="";for(const r in e)t+=o[r]?o[r]:r+":"+e[r]+";";return t}(s[r]);l.setAttribute("style",e)}else console.info(`WebVTT: parseContent: Style referenced, but no style defined for '${r}'!`);return l}const l=e.document.createElement("div"),u=[];let d,p,h=l;for(;null!==(d=nextToken());)if("<"!==d[0])h.appendChild(e.document.createTextNode(d.replace(/&(amp|lt|gt|lrm|rlm|nbsp);/g,unescape1)));else{if("/"===d[1]){u.length&&u[u.length-1]===d.substr(2).replace(">","")&&(u.pop(),h=h.parentNode);continue}const t=ParserUtility.parseTimeStamp(d.substr(1,d.length-2));let r;if(t){r=e.document.createProcessingInstruction("timestamp",t.toString()),h.appendChild(r);continue}if(p=/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/.exec(d),!p)continue;if(r=createElement(p[1],p[2],p[3]),!r)continue;if(!shouldAdd(h,r))continue;p[2],u.push(p[1]),h.appendChild(r),h=r}return l}}t.default=ParserUtility}));unwrapExports(pn);var hn=createCommonjsModule((function(e,t){var r=ge&&ge.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.VTTCue=void 0;let n=class{get id(){return this._id}set id(e){this._id=""+e}get pauseOnExit(){return this._pauseOnExit}set pauseOnExit(e){this._pauseOnExit=!!e}get startTime(){return this._startTime}set startTime(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number: "+e);this._startTime=e,this.hasBeenReset=!0}get endTime(){return this._endTime}set endTime(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number: "+e);this._endTime=e,this.hasBeenReset=!0}get text(){return this._text}set text(e){this._text=""+e,this.hasBeenReset=!0}get region(){return this._region}set region(e){this._region=e,this.hasBeenReset=!0}get vertical(){return this._vertical}set vertical(e){if(!dn.isValidDirectionSetting(e))throw new SyntaxError("An invalid or illegal string was specified for vertical: "+e);this._vertical=e,this.hasBeenReset=!0}get snapToLines(){return this._snapToLines}set snapToLines(e){this._snapToLines=!!e,this.hasBeenReset=!0}get line(){return this._line}set line(e){if(!dn.isValidLineAndPositionSetting(e))throw new SyntaxError("An invalid number or illegal string was specified for line: "+e);this._line=e,this.hasBeenReset=!0}get lineAlign(){return this._lineAlign}set lineAlign(e){if(!dn.isValidLineAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for lineAlign: "+e);this._lineAlign=e,this.hasBeenReset=!0}get position(){return this._position}set position(e){if(!dn.isValidLineAndPositionSetting(e))throw new Error("Position must be between 0 and 100 or auto: "+e);this._position=e,this.hasBeenReset=!0}get positionAlign(){return this._positionAlign}set positionAlign(e){if(!dn.isValidPositionAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for positionAlign: "+e);this._positionAlign=e,this.hasBeenReset=!0}get size(){return this._size}set size(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100: "+e);this._size=e,this.hasBeenReset=!0}get align(){return this._align}set align(e){if(!dn.isValidAlignSetting(e))throw new SyntaxError("An invalid or illegal string was specified for align: "+e);this._align=e,this.hasBeenReset=!0}getCueAsHTML(){return pn.default.parseContent(window,this,{})}static create(e){if(!e.hasOwnProperty("startTime")||!e.hasOwnProperty("endTime")||!e.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");const t=new this(e.startTime,e.endTime,e.text);return Object.keys(e).forEach(r=>{t.hasOwnProperty(r)&&(t[r]=e[r])}),t}static fromJSON(e){return this.create(JSON.parse(e))}toJSON(){const e={};return Object.keys(this).forEach(t=>{this.hasOwnProperty(t)&&"getCueAsHTML"!==t&&"hasBeenReset"!==t&&"displayState"!==t&&(e[t]=this[t])}),e}constructor(e,t,r){this._id="",this._pauseOnExit=!1,this._region=null,this._vertical="",this._snapToLines=!0,this._line="auto",this._lineAlign="start",this._position="auto",this._positionAlign="auto",this._size=100,this._align="center",this.hasBeenReset=!1,this._startTime=e,this._endTime=t,this._text=r}};n=r([function(e){let t=e;"undefined"!=typeof window&&null!=window.VTTCue&&(t=window.VTTCue,t.create=e.create,t.fromJSON=e.fromJSON,t.prototype.toJSON=e.prototype.toJSON);return t}],n),t.VTTCue=n}));unwrapExports(hn),hn.VTTCue;var yn=createCommonjsModule((function(e,t){var r=ge&&ge.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o};Object.defineProperty(t,"__esModule",{value:!0}),t.VTTRegion=void 0;let n=class{get id(){return this._id}set id(e){if("string"!=typeof e)throw new Error("ID must be a string.");this._id=e}get lines(){return this._lines}set lines(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");this._lines=e}get regionAnchorX(){return this._regionAnchorX}set regionAnchorX(e){if(!dn.isValidPercentValue(e))throw new TypeError("RegionAnchorX must be between 0 and 100.");this._regionAnchorX=e}get regionAnchorY(){return this._regionAnchorY}set regionAnchorY(e){if(!dn.isValidPercentValue(e))throw new TypeError("RegionAnchorY must be between 0 and 100.");this._regionAnchorY=e}get scroll(){return this._scroll}set scroll(e){if("string"==typeof e){const t=e.toLowerCase();if(dn.isValidScrollSetting(t))return void(this._scroll=t)}throw new SyntaxError("An invalid or illegal string was specified.")}get viewportAnchorX(){return this._viewportAnchorX}set viewportAnchorX(e){if(!dn.isValidPercentValue(e))throw new TypeError("ViewportAnchorX must be between 0 and 100.");this._viewportAnchorX=e}get viewportAnchorY(){return this._viewportAnchorY}set viewportAnchorY(e){if(!dn.isValidPercentValue(e))throw new TypeError("ViewportAnchorY must be between 0 and 100.");this._viewportAnchorY=e}get width(){return this._width}set width(e){if(!dn.isValidPercentValue(e))throw new TypeError("Width must be between 0 and 100.");this._lines=e}toJSON(){const e={};return Object.keys(this).forEach(t=>{this.hasOwnProperty(t)&&(e[t]=this[t])}),e}static create(e){const t=new this;return Object.keys(e).forEach(r=>{t.hasOwnProperty(r)&&(t[r]=e[r])}),t}static fromJSON(e){return this.create(JSON.parse(e))}constructor(){this._id="",this._lines=3,this._regionAnchorX=0,this._regionAnchorY=100,this._scroll="",this._viewportAnchorX=0,this._viewportAnchorY=100,this._width=100}};n=r([function(e){let t=e;"undefined"!=typeof window&&null!=window.VTTRegion&&(t=window.VTTRegion,t.create=e.create,t.fromJSON=e.fromJSON,t.prototype.toJSON=e.prototype.toJSON);return t}],n),t.VTTRegion=n}));unwrapExports(yn),yn.VTTRegion;var fn=createCommonjsModule((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}));unwrapExports(fn);var mn=createCommonjsModule((function(e,t){var r=ge&&ge.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=ge&&ge.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.VTTRegion=t.VTTCue=t.WebVTTParser=t.ParsingError=void 0,Object.defineProperty(t,"VTTCue",{enumerable:!0,get:function(){return hn.VTTCue}}),Object.defineProperty(t,"VTTRegion",{enumerable:!0,get:function(){return yn.VTTRegion}});class ParsingError extends Error{constructor(e,t){super(),this.name="ParsingError",this.code="number"==typeof e?e:e.code,t?this.message=t:e instanceof ParsingError&&(this.message=e.message)}}t.ParsingError=ParsingError,ParsingError.Errors={BadSignature:new ParsingError(0,"Malformed WebVTT signature."),BadTimeStamp:new ParsingError(1,"Malformed time stamp.")};class Settings{set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,r){return"object"==typeof t&&"string"==typeof r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(t.match(/^([\d]{1,3})(\.[\d]*)?%$/))try{const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}catch(su){return!1}return!1}constructor(){this.values={}}}class WebVTTParser{static StringDecoder(){return{decode:e=>{if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}}reportOrThrowError(e){if(!(e instanceof ParsingError&&"function"==typeof this.onparsingerror))throw e;this.onparsingerror(e)}parseOptions(e,t,r,n){const i=n?e.split(n):[e];for(const a of i){if("string"!=typeof a)continue;const e=a.split(r);if(2!==e.length)continue;t(e[0],e[1])}}parseCue(e,t,r){const n=e,consumeTimeStamp=()=>{const t=pn.default.parseTimeStamp(e);if(null===t)throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t},skipWhitespace=()=>{e=e.replace(/^\s+/,"")};if(skipWhitespace(),t.startTime=consumeTimeStamp(),skipWhitespace(),"--\x3e"!==e.substr(0,3))throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.substr(3),skipWhitespace(),t.endTime=consumeTimeStamp(),skipWhitespace(),((e,t)=>{const n=new Settings;this.parseOptions(e,(e,t)=>{let i,a;switch(e){case"region":for(let i=r.length-1;i>=0;i--)if(r[i].id===t){n.set(e,r[i].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),a=i[0],n.integer(e,a),n.percent(e,a)&&n.set("snapToLines",!1),n.alt(e,a,["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start","middle","center","end"]);break;case"position":if(i=t.split(","),n.percent(e,i[0]),2===i.length){let e=["line-left","line-right","center","auto","left","start","middle","end","right"];n.alt("positionAlign",i[1],e)}break;case"size":n.percent(e,t);break;case"align":let o=["start","center","end","left","right","middle"];n.alt(e,t,o)}},/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical",""),t.line=n.get("line",void 0===t.line?"auto":t.line);const i=n.get("lineAlign","start");t.lineAlign="center"===i||"middle"===i?this.middleOrCenter:i,t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100);const a=n.get("align","center");t.align="center"===a||"middle"===a?this.middleOrCenter:a,t.position=n.get("position","auto");let o=n.get("positionAlign",{start:"start",left:"start",center:"center",middle:"middle",right:"end",end:"end"},t.align);t.positionAlign="center"===o||"middle"===o?this.middleOrCenter:{start:"start","line-left":"start",left:"start",center:"center",middle:"middle","line-right":"end",right:"end",end:"end"}[o]})(e,t)}parseRegion(e){const t=new Settings;if(this.parseOptions(e,(e,r)=>{switch(e){case"id":t.set(e,r);break;case"width":t.percent(e,r);break;case"lines":t.integer(e,r);break;case"regionanchor":case"viewportanchor":{const n=r.split(",");if(2!==n.length)break;const i=new Settings;if(i.percent("x",n[0]),i.percent("y",n[1]),!i.has("x")||!i.has("y"))break;t.set(e+"X",i.get("x")),t.set(e+"Y",i.get("y"));break}case"scroll":t.alt(e,r,["up"])}},/=/,/\s/),t.has("id")){const e=new yn.VTTRegion;e.width=t.get("width",100),e.lines=t.get("lines",3),e.regionAnchorX=t.get("regionanchorX",0),e.regionAnchorY=t.get("regionanchorY",100),e.viewportAnchorX=t.get("viewportanchorX",0),e.viewportAnchorY=t.get("viewportanchorY",100),e.scroll=t.get("scroll",""),this.onregion&&this.onregion(e),this.regionList.push({id:t.get("id"),region:e})}}parseStyle(e){const parseStyles=e=>{const t={},r=e.split(";");for(let n=0;n<r.length;n++)if(r[n].includes(":")){const e=r[n].split(":",2),i=e[0].trim(),a=e[1].trim();""!==i&&""!==a&&(t[i]=a)}return t},t=e.split("}");t.pop();for(const r of t){let e=null,t=null;const n=r.split("{");n[0]&&(e=n[0].trim()),n[1]&&(t=parseStyles(n[1])),e&&t&&(this._styles[e]=t)}this.onStylesParsedCallback&&this.onStylesParsedCallback(this._styles)}parseHeader(e){this.parseOptions(e,(function(e,t){switch(e){case"Region":this.parseRegion(t)}}),/:/)}parse(e){e&&(this.buffer+=this.decoder.decode(e,{stream:!0}));const collectNextLine=()=>{const e=this.buffer;let t=0;const calculateBreakPosition=(e,t)=>{const r={start:-1,length:-1};if("\r"===e[t])r.start=t,r.length=1;else if("\n"===e[t])r.start=t,r.length=1;else if("<"===e[t]&&t+1<e.length&&"b"===e[t+1]&&t+2<e.length&&"r"===e[t+2]){let n=t+2;for(;n<e.length&&">"!==e[n++];);r.start=t,r.length=n-t}return r};let r={start:e.length,length:0};for(;t<e.length;){const n=calculateBreakPosition(e,t);if(n.length>0){r=n;break}++t}const n=e.substr(0,r.start);return this.buffer=e.substr(r.start+r.length),n};try{let e;if("INITIAL"===this.state){if(!/\r\n|\n/.test(this.buffer))return this;this.alreadyCollectedLine="",e=collectNextLine();const t=/^(ï»¿)?WEBVTT([ \t].*)?$/.exec(e);if(!t||!t[0])throw new ParsingError(ParsingError.Errors.BadSignature);this.state="HEADER"}for(;this.buffer;){if(!/\r\n|\n/.test(this.buffer))return this;switch(this.alreadyCollectedLine?(e=this.alreadyCollectedLine,this.alreadyCollectedLine=""):e=collectNextLine(),this.state){case"HEADER":e.includes(":")?this.parseHeader(e):e||(this.state="ID");continue;case"NOTE":e||(this.state="ID");continue;case"STYLE":e?this.styleCollector+=e:(this.parseStyle(this.styleCollector),this.state="ID",this.styleCollector="");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){this.state="NOTE";break}if(/^STYLE($|[ \t])/.test(e)){this.state="STYLE";break}if(!e)continue;if(this.cue=new hn.VTTCue(0,0,""),this.state="CUE",!e.includes("--\x3e")){this.cue.id=e;continue}case"CUE":try{this.parseCue(e,this.cue,this.regionList)}catch(t){this.reportOrThrowError(t),this.cue=null,this.state="BADCUE";continue}this.state="CUETEXT";continue;case"CUETEXT":{const t=e.includes("--\x3e");if(!e||t){this.alreadyCollectedLine=e,this.oncue&&this.oncue(this.cue),this.cue=null,this.state="ID";continue}this.cue.text&&(this.cue.text+="\n"),this.cue.text+=e;continue}case"BADCUE":e||(this.state="ID");continue}}}catch(r){this.reportOrThrowError(r),"CUETEXT"===this.state&&this.cue&&this.oncue&&this.oncue(this.cue),this.cue=null,this.state="INITIAL"===this.state?"BADWEBVTT":"BADCUE"}return this}flush(){try{if(this.buffer+=this.decoder.decode(),(this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state)throw new ParsingError(ParsingError.Errors.BadSignature)}catch(e){this.reportOrThrowError(e)}return this.onflush&&this.onflush(),this}styles(){return this._styles}constructor(e,t,r){this.window=e,this.state="INITIAL",this.styleCollector="",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[],this.alreadyCollectedLine="",this.onStylesParsedCallback=r,this._styles={},this.middleOrCenter="center";const n=new hn.VTTCue(0,0,"middleOrCenter");try{n.align="center","center"!==n.align&&(this.middleOrCenter="middle")}catch(i){this.middleOrCenter="middle"}}}t.default=WebVTTParser,t.WebVTTParser=WebVTTParser,n(fn,t)}));unwrapExports(mn),mn.VTTRegion,mn.VTTCue,mn.WebVTTParser,mn.ParsingError;var gn=createCommonjsModule((function(e,t){var r=ge&&ge.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=ge&&ge.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.VTTCue=t.WebVTTRenderer=t.BoxPosition=t.CueStyleBox=t.StyleBox=void 0,Object.defineProperty(t,"VTTCue",{enumerable:!0,get:function(){return hn.VTTCue}});const i=[/^(::cue\()(\..*)(\))/,/^(::cue\()(#.*)(\))/,/^(::cue\()(c|i|b|u|ruby|rt|v|lang)(\))/],a=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];class StyleBox{applyStyles(e,t){t=t||this.div;for(const r in e)e.hasOwnProperty(r)&&(t.style[r]=e[r])}formatStyle(e,t){return 0===e?"0":e+t}}t.StyleBox=StyleBox;class CueStyleBox extends StyleBox{determineBidi(e){let t,r=[],n="";if(!e||!e.childNodes)return"ltr";function pushNodes(e,t){for(let r=t.childNodes.length-1;r>=0;r--)e.push(t.childNodes[r])}function nextTextNode(e){if(!e||!e.length)return null;let t=e.pop(),r=t.textContent||t.innerText;if(r){const t=/^.*(\n|\r)/.exec(r);return t?(e.length=0,t[0]):r}return"ruby"===t.tagName?nextTextNode(e):t.childNodes?(pushNodes(e,t),nextTextNode(e)):void 0}function isContainedInCharacterList(e,t){for(const r of t)if(e>=r[0]&&e<=r[1])return!0;return!1}for(pushNodes(r,e);n=nextTextNode(r);)for(let e=0;e<n.length;e++)if(t=n.charCodeAt(e),isContainedInCharacterList(t,a))return"rtl";return"ltr"}parseOpacity(e){if(!e||"string"!=typeof e)return null;const t=(e=e.replace(/ /g,"").replace("rgba(","").replace(")","")).split(",");return t&&t.length>=4?t[3]:null}directionSettingToWritingMode(e){return""===e?"horizontal-tb":"lr"===e?"vertical-lr":"vertical-rl"}move(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}constructor(e,t,r,n,i){super(),this.cue=t;let a={start:"left","line-left":"left",left:"left",center:"center",middle:"center","line-right":"right",right:"right",end:"right"}[t.positionAlign]||t.align;"middle"===a&&(a="center");let o={textAlign:a,whiteSpace:"pre-line",position:"absolute"};o.direction=this.determineBidi(this.cueDiv),o.writingMode=this.directionSettingToWritingMode(t.vertical),o.unicodeBidi="plaintext",this.div=e.document.createElement("div"),this.applyStyles(o),o={backgroundColor:n.backgroundColor,display:"inline-block"},this.parseOpacity(o.backgroundColor)&&(o.padding="5px",o.borderRadius="5px"),this.backgroundDiv=e.document.createElement("div"),this.applyStyles(o,this.backgroundDiv),o={color:r.color,backgroundColor:r.backgroundColor,textShadow:r.textShadow,fontSize:r.fontSize,fontFamily:r.fontFamily,position:"relative",left:"0",right:"0",top:"0",bottom:"0",display:"inline-block",textOrientation:"upright"},o.writingMode=this.directionSettingToWritingMode(t.vertical),o.unicodeBidi="plaintext",this.cueDiv=pn.default.parseContent(e,t,i),this.applyStyles(o,this.cueDiv),this.backgroundDiv.appendChild(this.cueDiv),this.div.appendChild(this.backgroundDiv);let s=0;if("number"==typeof t.position){let e=t.positionAlign||t.align;if(e)switch(e){case"start":case"left":s=t.position;break;case"center":case"middle":s=t.position-t.size/2;break;case"end":case"right":s=t.position-t.size}}""===t.vertical?this.applyStyles({left:this.formatStyle(s,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(s,"%"),height:this.formatStyle(t.size,"%")})}}t.CueStyleBox=CueStyleBox;class BoxPosition{calculateNewLines(e){let t=1;for(let r=0;r<e.length;r++)"\n"===e[r]&&t++;return t}move(e,t){switch(t=void 0!==t?t:this.singleLineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}}overlaps(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top}overlapsAny(e){for(const t of e)if(this.overlaps(t))return!0;return!1}within(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right}moveIfOutOfBounds(e,t){switch(t){case"+x":this.left<e.left&&(this.left=e.left,this.right=this.left+this.width);break;case"-x":this.right>e.right&&(this.right=e.right,this.left=this.right-this.width);break;case"+y":this.top<e.top&&(this.top=e.top,this.bottom=this.top+this.height);break;case"-y":this.bottom>e.bottom&&(this.bottom=e.bottom,this.top=this.bottom-this.height)}}toCSSCompatValues(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}}static getSimpleBoxPosition(e){let t=null;e instanceof StyleBox&&e.div?t=e.div:e instanceof HTMLElement&&(t=e);let r=t.offsetHeight||0,n=t.offsetWidth||0,i=t.offsetTop||0,a=i+r,o=t.getBoundingClientRect();const{left:s,right:c}=o;return o.top&&(i=o.top),o.height&&(r=o.height),o.width&&(n=o.width),o.bottom&&(a=o.bottom),{left:s,right:c,top:i,height:r,bottom:a,width:n}}static getBoxPosition(e,t){if(e&&e.length>0){let r=0,n=e[0][t];for(let i=0;i<e.length;i++)t in["top","right"]?e[i][t]>n&&(r=i,n=e[i][t]):t in["bottom","left"]&&e[i][t]<n&&(r=i,n=e[i][t]);return e[r]}return null}static moveToMinimumDistancePlacement(e,t,r){"height"===e.property?"+y"===t?(e.top=r.topMostBoxPosition.bottom+0,e.bottom=e.top+e.height):"-y"===t&&(e.bottom=r.bottomMostBoxPosition.top-0,e.top=e.bottom-e.height):"width"===e.property&&("+x"===t?(e.left=r.rightMostBoxPosition.right+0,e.right=e.left+e.width):"-x"===t&&(e.right=r.leftMostBoxPosition.left-0,e.left=e.right-e.width))}static moveBoxToLinePosition(e,t,r){const n=e.cue;let i,a=new BoxPosition(e),o=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;let t=0;const r=e.track,n=r.textTrackList;for(let i=0;i<n.length&&n[i]!==r;i++)"showing"===n[i].mode&&t++;return-1*++t}(n),s=[];if(n.snapToLines){let e=0;switch(n.vertical){case"":s=["+y","-y"],i="height";break;case"rl":s=["+x","-x"],i="width";break;case"lr":s=["-x","+x"],i="width"}const r=a.lineHeight,c=t[i]+r,l=s[0];if(o<0){let i=0;switch(n.vertical){case"":i=t.height-r-.05*t.height;break;case"rl":case"lr":i=-t.width+r+.05*t.width}e=i,s=s.reverse()}else{switch(n.vertical){case"":e=r*Math.round(o);break;case"rl":e=t.width-r*Math.round(o);break;case"lr":e=r*Math.round(o)}Math.abs(e)>c&&(e=e<0?-1:1,e*=Math.ceil(c/r)*r)}a.move(l,e)}else{const r=""===n.vertical?t.height:t.width,i=a.lineHeight/r*100;switch(n.lineAlign){case"center":case"middle":o-=i/2;break;case"end":o-=i}switch(n.vertical){case"":e.applyStyles({top:e.formatStyle(o,"%")});break;case"rl":e.applyStyles({right:e.formatStyle(o,"%")});break;case"lr":e.applyStyles({left:e.formatStyle(o,"%")})}s=["+y","-y","+x","-x"],"+y"===n.axis?s=["+y","-y","+x","-x"]:"-y"===n.axis&&(s=["-y","+y","+x","-x"]),a=new BoxPosition(e)}const c=function(e,n){let i;for(let a=0;a<n.length;a++){e.moveIfOutOfBounds(t,n[a]);let o=0,s=!1;for(;e.overlapsAny(r)&&!(o>9);)s?e.move(n[a]):(r&&r.length>0&&(i||(i={topMostBoxPosition:BoxPosition.getBoxPosition(r,"top"),bottomMostBoxPosition:BoxPosition.getBoxPosition(r,"bottom"),leftMostBoxPosition:BoxPosition.getBoxPosition(r,"left"),rightMostBoxPosition:BoxPosition.getBoxPosition(r,"right")}),BoxPosition.moveToMinimumDistancePlacement(e,n[a],i)),s=!0),o++}return e}(a,s);e.move(c.toCSSCompatValues(t))}constructor(e){var t;let r,n,i,a,o,s;if(e instanceof CueStyleBox&&e.cue?(t=e.cue)&&""!==t.vertical?this.property="width":this.property="height":e instanceof BoxPosition&&(this.property=e.property||"height"),e instanceof CueStyleBox&&e.div){i=e.div.offsetHeight,a=e.div.offsetWidth,o=e.div.offsetTop;const t=e.div.firstChild;if(s=t?t.getBoundingClientRect():e.div.getBoundingClientRect(),r=s&&s[this.property]||null,t&&t.firstChild){const e=t.firstChild;if(e&&"string"==typeof e.textContent){n=r/this.calculateNewLines(e.textContent)}}}else e instanceof BoxPosition&&(s=e);this.left=s.left,this.right=s.right,this.top=s.top||o,this.height=s.height||i,this.bottom=s.bottom||o+(s.height||i),this.width=s.width||a,this.lineHeight=null!==r?r:s.lineHeight,this.singleLineHeight=null!==n?n:s.singleLineHeight,this.singleLineHeight||(this.singleLineHeight=41)}}t.BoxPosition=BoxPosition;class WebVTTRenderer{initSubtitleCSS(){const e=[new hn.VTTCue(0,0,"String to init CSS - Won't be visible to user")];this.paddedOverlay.style.opacity="0",this.processCues(e),this.processCues([]),this.paddedOverlay.style.opacity="1"}convertCueToDOMTree(e){return e?pn.default.parseContent(this.window,e,this.globalStyleCollection):null}setStyles(e){function applyStyles(e,t,r){for(const n in t)t.hasOwnProperty(n)&&(!0===r&&void 0!==e[n]||!1===r)&&(e[n]=t[n])}for(const t in e){let r=!1,n=null;"::cue"===t?(n=this.foregroundStyleOptions,r=!0):"::-webkit-media-text-track-display"===t&&(n=this.backgroundStyleOptions,r=!0);const a=e[t];if(!0===r)applyStyles(n,a,r);else for(let e=0;e<i.length;e++){const n=i[e].exec(t);if(n&&4===n.length){const e=n[2],t={};applyStyles(t,a,r),this.globalStyleCollection[e]=t}}}this.initSubtitleCSS(),this.loggingEnabled&&(console.log("WebVTTRenderer setStyles foregroundStyleOptions: "+JSON.stringify(this.foregroundStyleOptions)),console.log("WebVTTRenderer setStyles backgroundStyleOptions: "+JSON.stringify(this.backgroundStyleOptions)),console.log("WebVTTRenderer setStyles globalStyleCollection: "+JSON.stringify(this.globalStyleCollection)))}processCues(e){if(!e)return;for(;this.paddedOverlay.firstChild;)this.paddedOverlay.removeChild(this.paddedOverlay.firstChild);if(!function(e){for(let t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(e)){for(let t=0;t<e.length;t++)this.paddedOverlay.appendChild(e[t].displayState);return}const t=[],r=BoxPosition.getSimpleBoxPosition(this.paddedOverlay);e.length>1&&(e=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let i=e[n];if("number"!=typeof i.line)return e;r+=i.line,t.push(i)}return r/=e.length,r>50?(t.forEach((function(e){e.axis="-y"})),t.sort((e,t)=>t.line-e.line)):(t.forEach((function(e){e.axis="+y"})),t.sort((e,t)=>e.line-t.line)),t}(e));for(let n=0;n<e.length;n++){let i=e[n],a=new CueStyleBox(this.window,i,this.foregroundStyleOptions,this.backgroundStyleOptions,this.globalStyleCollection);this.paddedOverlay.appendChild(a.div),BoxPosition.moveBoxToLinePosition(a,r,t),i.displayState=a.div,t.push(BoxPosition.getSimpleBoxPosition(a))}}setSize(e,t){e&&(this.overlay.style.width=e+"px"),t&&(this.overlay.style.height=t+"px")}getOverlay(){return this.overlay}constructor(e,t,r=!0){if(!e)return null;this.window=e,this.overlay=t,this.loggingEnabled=r,this.foregroundStyleOptions={fontFamily:"Helvetica",fontSize:"36px",color:"rgba(255, 255, 255, 1)",textShadow:"",backgroundColor:"rgba(0, 0, 0, 0)"},this.backgroundStyleOptions={backgroundColor:"rgba(0, 0, 0, 0.5)"},this.globalStyleCollection={};const n=e.document.createElement("div");n.style.position="absolute",n.style.left="0",n.style.right="0",n.style.top="0",n.style.bottom="0",n.style.margin="1.5%",this.paddedOverlay=n,t.appendChild(this.paddedOverlay),this.initSubtitleCSS()}}t.default=WebVTTRenderer,t.WebVTTRenderer=WebVTTRenderer,n(fn,t)}));unwrapExports(gn),gn.VTTCue,gn.WebVTTRenderer,gn.BoxPosition,gn.CueStyleBox,gn.StyleBox;var vn=createCommonjsModule((function(e,t){var r=ge&&ge.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=ge&&ge.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),n(mn,t),n(gn,t)}));unwrapExports(vn);var bn=vn.WebVTTRenderer;const{audioTrackAdded:_n,audioTrackChanged:Sn,forcedTextTrackChanged:Tn,textTrackAdded:Pn,textTrackChanged:En,textTrackRemoved:kn}=Qt,{textTracksSwitched:wn,textTracksUpdated:In,inlineStylesParsed:On}=jt;class TextTrackManager{get currentTrack(){return this.tracks.find(e=>"showing"===e.mode)}set currentTrack(e){if(!e)return;let t;this.trackPersistence.setPersistedTrack(e),this.extensionTracks?(Ot.debug("MEDIA_TRACK Setting track on extension "+e.label),"Off"===e.label?(this.clearCurrentlyPlayingTrack(),t=this.extensionTracks.selectForcedTrack(),void 0===t&&this.onExtensionTextTrackSwitched({track:e})):this.extensionTracks.textTrack=e):(Ot.debug("MEDIA_TRACK Setting track on element "+e.label),this._tracks.forEach(t=>{t!==e&&"showing"===t.mode&&(t.mode="disabled")}),e&&(Ot.debug("MEDIA_TRACK setting track mode to showing for "+e.label),this.isTrackOff(e)?(this._tracks[0].mode="showing",t=this.selectNativeForcedTrack(this.mediaElement.audioTracks)):e.mode="showing")),this.dispatcher.publish(Qt.forcedTextTrackChanged,t)}get tracks(){return this._tracks}destroy(){if(this.clearCurrentlyPlayingTrack(),this.extensionTracks){const e=this.extensionTracks;e.removeEventListener(In,this.onExtensionTextTracksAdded),e.removeEventListener(wn,this.onExtensionTextTrackSwitched),e.removeEventListener(On,this.onExtensionInlineStylesParsed)}else this.mediaElement.textTracks.removeEventListener("addtrack",this.onTextTrackAdded),this.mediaElement.textTracks.removeEventListener("change",this.onTextTrackChanged),this.mediaElement.textTracks.removeEventListener("removetrack",this.onTextTrackRemoved),this.mediaElement.removeEventListener("playing",this.onPlayStart);this.dispatcher.unsubscribe(Sn,this.onAudioTrackAddedOrChanged),this.dispatcher.unsubscribe(_n,this.onAudioTrackAddedOrChanged)}restoreSelectedTrack(){return restoreSelectedTrack(this.trackPersistence,this)}onExtensionInlineStylesParsed(e){Ot.debug("MEDIA_TRACK Extension inline styles parsed",e),this.renderer.setStyles(e.styles)}onExtensionTextTracksAdded(e){Ot.debug("MEDIA_TRACK Extension text tracks updated "+JSON.stringify(e)),this._tracks.push(...e),this.restoreSelectedTrack(),this.dispatcher.publish(Pn,e)}onExtensionTextTrackSwitched(e){Ot.debug("MEDIA_TRACKS Extension text track switched "+e),this.handleVTT(e);const t=e.track;if(this._tracks){const preserveSelectedTrack=r=>{e.track?t.forced&&"Off"===r.label||"Off"===t.label&&"Off"===r.label?r.mode="showing":r.mode=e.track.persistentID===r.id?"showing":"disabled":r.mode="Off"===r.label?"showing":"disabled"};this._tracks.forEach(preserveSelectedTrack)}this.dispatcher.publish(En,e)}handleVTT(e){const t=e&&e.track&&e.track.id;if(void 0!==t&&t>=0){const e=this.filterSelectableTextTracks(this.mediaElement.textTracks)[t];this.onNativeTrackChange(e)}else this.clearCurrentlyPlayingTrack()}onAudioTrackAddedOrChanged(e,t){if(Ot.debug("MEDIA_TRACKS text track manager detects audio track change"),this.shouldForceSubtitle())if(this.extensionTracks){Ot.debug("MEDIA_TRACKS selecting forced text track via extension");const e=this.extensionTracks.selectForcedTrack();e?this.dispatcher.publish(Tn,e):this.clearCurrentlyPlayingTrack()}else Ot.debug("MEDIA_TRACKS selecting forced text track natively"),this.currentTrack=this._tracks[0]}onTextTrackAdded(e){this._tracks.push(e.track),this.dispatcher.publish(Pn,e)}onPlayStart(){this.restoreSelectedTrack()}onTextTrackRemoved(e){this.dispatcher.publish(kn,e)}onTextTrackChanged(e){const t=this.findNativeSelectedTextTrack();let r=this.trackPersistence.getPersistedTrack();if(r||(r=this._tracks[0]),t&&!trackEquals(t,r,this.trackPersistence.fields))if(this.isTrackOff(r)&&"forced"!==t.kind)this.currentTrack=r;else{const e=this.findNativeTrack(r);e&&(this.currentTrack=e)}else this.dispatcher.publish(En,e)}findNativeSelectedTextTrack(){for(let e=0;e<this.mediaElement.textTracks.length;e++){const t=this.mediaElement.textTracks[e];if("showing"===t.mode)return t}}findNativeTrack(e){for(let t=0;t<this.mediaElement.textTracks.length;t++){const r=this.mediaElement.textTracks[t];if(trackEquals(r,e,this.trackPersistence.fields))return r}}selectNativeForcedTrack(e){for(let t=0;t<e.length;t++){const r=e[t];if(r.enabled){const e=this.findNativeForcedTrack(r);return e&&"showing"!==e.mode&&(e.mode="showing"),e}}}findNativeForcedTrack(e){const t=this.mediaElement.textTracks;for(let r=0;r<t.length;r++){const n=t[r];if("forced"===n.kind&&n.language===e.language)return n}}onNativeTrackChange(e){this.clearCurrentlyPlayingTrack(),this._currentlyPlayingTrack=e,e.addEventListener("cuechange",this.onCueChange)}clearCurrentlyPlayingTrack(){var e;void 0!==this._currentlyPlayingTrack&&("string"==typeof(e=this._currentlyPlayingTrack).id&&"removeEventListener"in e)&&(this._currentlyPlayingTrack.removeEventListener("cuechange",this.onCueChange),this.renderer.processCues({}),delete this._currentlyPlayingTrack)}onCueChange(e){const t=e&&e.target&&e.target.activeCues;t&&this.renderer.processCues(t)}filterSelectableTextTracks(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];("captions"===n.kind||"subtitles"===n.kind||"metadata"===n.kind&&n.customTextTrackCueRenderer)&&t.push(n)}return t}shouldForceSubtitle(){Ot.debug("MEDIA_TRACKS Determining whether to select forced text track");const e=this.trackPersistence.getPersistedTrack();return!e||this.isTrackOff(e)}isTrackOff(e){return"Off"===e.label||"Auto"===e.label}constructor(e,t,r){this.mediaElement=e,this.dispatcher=t,this.extensionTracks=r,this._tracks=[],this.trackPersistence=new TrackPersistence("mk-text-track",["label","language","kind"]);const n=this.trackPersistence.getPersistedTrack();if(this._tracks.push({id:-2,label:"Off",language:"",kind:"subtitles",mode:!n||this.isTrackOff(n)?"showing":"disabled"}),this.extensionTracks){Ot.debug("MEDIA_TRACK Initializing text track manager for HLS.js track events");const t=e.parentElement;this.renderer=new bn(window,t,!1),this.renderer.setStyles({"::cue":{fontSize:"calc(1vw + 1em)"}}),this.onExtensionTextTracksAdded=this.onExtensionTextTracksAdded.bind(this),this.onExtensionTextTrackSwitched=this.onExtensionTextTrackSwitched.bind(this),this.onExtensionInlineStylesParsed=this.onExtensionInlineStylesParsed.bind(this),this.onCueChange=this.onCueChange.bind(this);const r=this.extensionTracks;r.addEventListener(In,this.onExtensionTextTracksAdded),r.addEventListener(wn,this.onExtensionTextTrackSwitched),r.addEventListener(On,this.onExtensionInlineStylesParsed)}else Ot.debug("MEDIA_TRACK Initializing text track manager for native track events"),this.onTextTrackAdded=this.onTextTrackAdded.bind(this),this.onTextTrackChanged=this.onTextTrackChanged.bind(this),this.onTextTrackRemoved=this.onTextTrackRemoved.bind(this),this.onPlayStart=this.onPlayStart.bind(this),e.textTracks.addEventListener("addtrack",this.onTextTrackAdded),e.textTracks.addEventListener("change",this.onTextTrackChanged),e.textTracks.addEventListener("removetrack",this.onTextTrackRemoved),e.addEventListener("playing",this.onPlayStart);this.onAudioTrackAddedOrChanged=debounce(this.onAudioTrackAddedOrChanged.bind(this)),t.subscribe(Sn,this.onAudioTrackAddedOrChanged),t.subscribe(_n,this.onAudioTrackAddedOrChanged)}}function asyncGeneratorStep$15(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$15(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$15(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$15(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var An={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Rn={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const Cn={"picture-in-picture":e.PresentationMode.pictureinpicture,inline:e.PresentationMode.inline},Dn={};Dn[e.PresentationMode.pictureinpicture]="picture-in-picture",Dn[e.PresentationMode.inline]="inline";const{presentationModeDidChange:Mn}=Qt,{playbackLicenseError:xn}=jt,{stopped:Ln}=e.PlaybackStates;class VideoPlayer extends BasePlayer{get audioTracks(){return this._audioTrackManager.tracks}get containerElement(){return this._context.videoContainerElement?this._context.videoContainerElement:document.getElementById("apple-music-video-container")}get currentAudioTrack(){return this._audioTrackManager.currentTrack}set currentAudioTrack(e){this._audioTrackManager.currentTrack=e}get currentTextTrack(){return this._textTrackManager.currentTrack}set currentTextTrack(e){this._textTrackManager.currentTrack=e}get _targetElement(){return this.video||function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$C(e,t,r[t])}))}return e}({},document.createElement("video"))}get textTracks(){return this._textTrackManager.tracks}initializeExtension(){var e=this;return _asyncToGenerator$15((function*(){e.restrictPlatforms&&Rt.isAndroid?Ot.warn("videoPlayer.initializeExtension Not supported on the current platform"):e.video||Ot.warn("videoPlayer.initializeExtension No video element, not initializing extension")}))()}onPlaybackLicenseError(e){this.resetDeferredPlay(),this._dispatcher.publish(xn,e)}setupTrackManagers(e){var t,r,n,i;null===(t=this._textTrackManager)||void 0===t||null===(r=t.destroy)||void 0===r||r.call(t),this._textTrackManager=new TextTrackManager(this._targetElement,this._dispatcher,e),null===(n=this._audioTrackManager)||void 0===n||null===(i=n.destroy)||void 0===i||i.call(n),this._audioTrackManager=new AudioTrackManager(this._targetElement,this._dispatcher,e)}destroy(){this.finishPlaybackSequence(),this._textTrackManager.destroy(),this._audioTrackManager.destroy(),super.destroy()}initializeEventHandlers(){var e=this,_superprop_get_initializeEventHandlers=()=>super.initializeEventHandlers;return _asyncToGenerator$15((function*(){_superprop_get_initializeEventHandlers().call(e),e.hasMediaElement&&(e._targetElement.addEventListener("webkitpresentationmodechanged",e.pipEventHandler),e._targetElement.addEventListener("enterpictureinpicture",e.pipEventHandler),e._targetElement.addEventListener("leavepictureinpicture",e.pipEventHandler))}))()}removeEventHandlers(){if(super.removeEventHandlers(),!this.hasMediaElement)return;const{_targetElement:e}=this;e.removeEventListener("webkitpresentationmodechanged",this.pipEventHandler),e.removeEventListener("enterpictureinpicture",this.pipEventHandler),e.removeEventListener("leavepictureinpicture",this.pipEventHandler)}initializeMediaElement(){var e=this;return _asyncToGenerator$15((function*(){Ot.debug("videoPlayer.initializeMediaElement Initializing media element");const t=e.containerElement;t?(e.video=function(){let e=Nt.pop();return e?Ot.debug(`dom-helpers: retrieving video tag, ${Nt.length} remain`):(Ot.debug("dom-helpers: no available video tags, creating one"),e=document.createElement("video")),e}(),e.video.autoplay=!1,e.video.controls=!1,e.video.playsInline=!0,e.video.id="apple-music-video-player",t.appendChild(e.video)):Ot.warn("videoPlayer.initializeMediaElement No video element; no container defined")}))()}isPlayerSupported(){return Browser.supportsEs6()}_stopMediaElement(){var e=this,_superprop_get__stopMediaElement=()=>super._stopMediaElement;return _asyncToGenerator$15((function*(){yield _superprop_get__stopMediaElement().call(e),e.destroy()}))()}pipEventHandler(t){switch(t.type){case"enterpictureinpicture":this._dispatcher.publish(Mn,{mode:e.PresentationMode.pictureinpicture});break;case"leavepictureinpicture":this._dispatcher.publish(Mn,{mode:e.PresentationMode.inline});break;case"webkitpresentationmodechanged":{const e=this._targetElement;this._dispatcher.publish(Mn,{mode:this._translateStringToPresentationMode(e.webkitPresentationMode)});break}}}playItemFromEncryptedSource(t,r=!1,n={}){var i=this;return _asyncToGenerator$15((function*(){if(Ot.debug("videoPlayer.playItemFromEncryptedSource",t,r),i.playbackState===Ln)return void Ot.debug("video-player.playItemFromEncryptedSource aborting playback because player is stopped");t.playbackType=e.PlaybackType.encryptedFull,i.nowPlayingItem=t,t.state=P.loading,i.userInitiated=r;const a=generateAssetUrl(t,n);yield i.playHlsStream(a,t,n)}))()}playItemFromUnencryptedSource(e,t,r){var n=this;return _asyncToGenerator$15((function*(){if(Ot.debug("videoPlayer.playItemFromUnencryptedSource",e,t),n.playbackState===Ln)return void Ot.debug("videoPlayer.playItemFromUnencryptedSource aborting playback because player is stopped");const[r]=e.split("?");r.endsWith("m3u")||r.endsWith("m3u8")?yield n.playHlsStream(e):yield n._playAssetURL(e,t)}))()}setPresentationMode(t){var r=this;return _asyncToGenerator$15((function*(){const n=r._targetElement;if(n.webkitSupportsPresentationMode&&"function"==typeof n.webkitSetPresentationMode)return n.webkitSetPresentationMode(r._translatePresentationModeToString(t));if(n.requestPictureInPicture&&document.exitPictureInPicture){if(t===e.PresentationMode.pictureinpicture)return n.requestPictureInPicture();if(t===e.PresentationMode.inline)return document.exitPictureInPicture()}}))()}_translateStringToPresentationMode(t){let r=Cn[t];return void 0===r&&(Ot.warn(`videoPlayer._translateStringToPresentationMode ${t} is not a valid presentation mode, setting to inline`),r=e.PresentationMode.inline),r}_translatePresentationModeToString(e){let t=Dn[e];return void 0===t&&(Ot.warn(`videoPlayer._translatePresentationModeToString ${e} is not a valid presentation mode, setting to inline`),t="inline"),t}setNextSeamlessItem(e){return _asyncToGenerator$15((function*(){}))()}constructor(e){super(e),this.mediaPlayerType="video",this._textTrackManager=new TrackManagerStub,this._audioTrackManager=new TrackManagerStub,this._shouldLoadManifestsOnce=!1,this.userInitiated=!1,this.restrictPlatforms=!("restrict-platforms"in Dt.features)||Dt.features["restrict-platforms"],this.pipEventHandler=this.pipEventHandler.bind(this),this._shouldLoadManifestsOnce=shouldLoadManifestOnce()}}An([Bind(),Rn("design:type",Function),Rn("design:paramtypes",[void 0])],VideoPlayer.prototype,"onPlaybackLicenseError",null);const decayingOperation=(e,t,r,n=0)=>e().catch(i=>{const a=n+1;function possiblyRetry(n){if(n&&a<3){const n=1e3*a;return new Promise((i,o)=>{setTimeout(()=>{decayingOperation(e,t,r,a).then(i,o)},n)})}throw i}const o=t(i);return"boolean"==typeof o?possiblyRetry(o):o.then(possiblyRetry)});let Nn={developerToken:"developerTokenNotSet",musicUserToken:"musicUserTokenNotSet",cid:"cidNotSet"};function asyncGeneratorStep$14(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$14(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$14(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$14(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$B(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$B(e,t,r[t])}))}return e}function createHlsOffersLicenseChallengeBody(e){return{"adam-id":e.id,id:1}}function createStreamingKeysLicenseChallengeBody(e,t,r=0){var n;return _objectSpread$B({id:r,"lease-action":t},null!==(n=e.keyServerQueryParameters)&&void 0!==n?n:{})}function createLicenseChallengeBody(e,t,r,n,i,a,o){let s;const c={challenge:n.challenge||u(n.licenseChallenge),"key-system":i,uri:n.keyuri};return o&&(c["extended-lease"]=o),s=r.isUTS?e.startsWith("https://play.itunes.apple.com/WebObjects/MZPlay.woa/web/video/subscription/license")?_objectSpread$B({},c,function(e,t="start"){return{"extra-server-parameters":e.keyServerQueryParameters,"license-action":t}}(r,t)):{"streaming-request":{version:1,"streaming-keys":[_objectSpread$B({},c,createStreamingKeysLicenseChallengeBody(r,t))]}}:r.isLiveRadioStation?_objectSpread$B({},c,function(e){return{event:e.isLiveAudioStation?"beats1":"amtv"}}(r)):r.hasOffersHlsUrl?{"license-requests":[_objectSpread$B({},c,createHlsOffersLicenseChallengeBody(r))]}:_objectSpread$B({},c,function(e,t=!1){return{adamId:e.songId,isLibrary:e.isCloudItem,"user-initiated":t}}(r,a)),s}class License{fetch(e){const t={Authorization:"Bearer "+Nn.developerToken,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+Nn.musicUserToken};this.keySystem===Ct.WIDEVINE&&(t["X-Apple-Renewal"]=!0);const r=new Headers(t);return decayingOperation(()=>fetch(this.licenseUrl,{method:"POST",body:JSON.stringify(e),headers:r}),e=>e instanceof TypeError,"license fetch")}reset(){this.licenseUrl=void 0,this.playableItem=void 0,this.data=void 0,this.initiated=void 0,this.keySystem=void 0,this.startResponse=void 0}start(e,t,r,n,i=!1,a=!1){var o=this;return _asyncToGenerator$14((function*(){o.licenseUrl=e,o.playableItem=t,o.data=r,o.keySystem=n,o.initiated=i;const s=r.isRenewalRequest?"renew":"start",c=createLicenseChallengeBody(e,s,t,r,n,i,a);t.hasOffersHlsUrl&&(o.licenseUrl+="/"+s),o.startResponse=o.fetch(c);try{var l,u,d;const e=yield o.startResponse;if(!e.ok){let t;try{t=yield e.json()}catch(h){}o.processJsonError(t)}const t=yield e.json();let r=t;var p;return(null==t||null===(l=t["streaming-response"])||void 0===l||null===(u=l["streaming-keys"])||void 0===u?void 0:u.length)?r=t["streaming-response"]["streaming-keys"][0]:(null==t||null===(d=t["license-responses"])||void 0===d?void 0:d.length)&&(r=t["license-responses"][0]),r.status=null!==(p=r.status)&&void 0!==p?p:r.errorCode,0!==r.status&&o.processJsonError(r),r}catch(Tt){throw o.startResponse=void 0,Tt}}))()}processJsonError(e){let t=new MKError(MKError.MEDIA_LICENSE,"Error acquiring license");if((null==e?void 0:e.errorCode)&&(e.status=e.errorCode),-1021===(null==e?void 0:e.status)&&(e.status=190121),e&&0!==e.status){if(!e.message)switch(e.status){case-1004:e.message=MKError.DEVICE_LIMIT;break;case-1017:e.message=MKError.GEO_BLOCK;break;default:e.message=MKError.MEDIA_LICENSE}t=MKError.serverError(e),t.data=e,t.errorCode===MKError.PLAYREADY_CBC_ENCRYPTION_ERROR&&function(){const e=getSessionStorage();e&&e.setItem("mk-playready-cbcs-unsupported","true")}()}throw t}stop(){var e=this;return _asyncToGenerator$14((function*(){if(e.startResponse)try{yield e.startResponse}catch(Tt){}if(!e.playableItem||!e.data||!e.licenseUrl)return;if(!e.playableItem.isUTS)return;const t=createLicenseChallengeBody(e.licenseUrl,"stop",e.playableItem,e.data,e.keySystem,e.initiated),r=e.fetch(t);e.reset();try{yield r}catch(n){Ot.warn("license.stop request error",n)}}))()}}function asyncGeneratorStep$13(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$13(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$13(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$13(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}var $n={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},jn={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class KeySession extends Notifications{get extID(){if(this.extURI)return this.extURI.replace("data:;base64,","")}get isFairplay(){return this.keySystem===Ct.FAIRPLAY}get isPlayReady(){return this.keySystem===Ct.PLAYREADY}get isWidevine(){return this.keySystem===Ct.WIDEVINE}acquirePlaybackLicense(e,t,r,n){var i=this;return _asyncToGenerator$13((function*(){if(!i.keyServerURL||!i.developerToken||!i.userToken)return;const{keyServerURL:r,keySystem:a}=i,o=n.item;try{return yield i.license.start(r,o,{challenge:t,keyuri:e},a,i.initiated,i.isLegacyEme&&o.isUTS)}catch(s){i.dispatchEvent(jt.playbackLicenseError,s)}}))()}startLicenseSession(e){var t=this;return _asyncToGenerator$13((function*(){let r;Ot.debug("Starting License Session",e);const{message:n,target:i,messageType:a}=e;if(t.keySystem!==Ct.FAIRPLAY&&"license-request"!==a)return void Ot.debug("not making license request for",a);if(t.isPlayReady){const e=String.fromCharCode.apply(null,new Uint16Array(n.buffer||n));r=(new DOMParser).parseFromString(e,"application/xml").getElementsByTagName("Challenge")[0].childNodes[0].nodeValue}else r=u(new Uint8Array(n));const o=i.extURI||t.extURI,s=t.mediaKeySessions[o];if(!s)return void Ot.debug("no key session info, aborting license request");const c=t.acquirePlaybackLicense(o,r,t.initiated,s);if(s.delayCdmUpdate)s["license-json"]=c;else{const e=yield c;yield t.handleLicenseJson(e,i,o)}}))()}setKeyURLs(e){this.keyCertURL=e[this.isFairplay?"hls-key-cert-url":"widevine-cert-url"],this.keyServerURL=e["hls-key-server-url"]}dispatchKeyError(e){var t,r;this.isFairplay&&4294955417===(null==e||null===(t=e.target)||void 0===t||null===(r=t.error)||void 0===r?void 0:r.systemCode)?Ot.error("Ignoring error",e):(console.error(MKError.MEDIA_KEY+" error in dispatchKeyError:",e),this.dispatchEvent(jt.playbackSessionError,new MKError(MKError.MEDIA_KEY,e)))}dispatchSessionError(e){this.dispatchEvent(jt.playbackSessionError,new MKError(MKError.MEDIA_SESSION,e))}loadCertificateBuffer(){var e=this;return _asyncToGenerator$13((function*(){if(!e.keyCertURL)return Promise.reject(new MKError(MKError.MEDIA_SESSION,"No certificate URL"));const t=yield fetch(`${e.keyCertURL}?t=${Date.now()}`),r=yield t.arrayBuffer(),n=String.fromCharCode.apply(String,new Uint8Array(r));return/^\<\?xml/.test(n)?Promise.reject(new MKError(MKError.MEDIA_CERTIFICATE,"Invalid certificate.")):r}))()}handleSessionCreation(e){var t=this;return _asyncToGenerator$13((function*(){return t.createSession(e).catch(e=>{t.dispatchSessionError(e)})}))()}handleLicenseJson(e,t,r){var n=this;return _asyncToGenerator$13((function*(){if(Ot.debug(`updating session ${r} with license response`,e),null==e?void 0:e.license){const r=s(e.license);try{yield t.update(r)}catch(i){Ot.error("Failed to updated media keys",i),n.dispatchKeyError(i)}}}))()}addMediaKeySessionInfo(e,t,r,n=!1){const i=this.mediaKeySessions[e];i?(Ot.debug(`keySession info exists for ${r.title}, making existing session ${i.session.sessionId} the old session`),i.oldSession=i.session,i.session=t):(Ot.debug("creating key session info for "+r.title),this.mediaKeySessions[e]={session:t,item:r,delayCdmUpdate:n})}stopLicenseSession(){Ot.info("key session sending license stop"),this.license.stop()}constructor(){super([jt.playbackLicenseError,jt.playbackSessionError]),this.initiated=!0,this.isLibrary=!1,this.keySystem=Ct.FAIRPLAY,this.isLegacyEme=!1,this.mediaKeySessions={},this.boundDispatchKeyError=this.dispatchKeyError.bind(this),this.boundDispatchSessionError=this.dispatchSessionError.bind(this),this.boundHandleSessionCreation=this.handleSessionCreation.bind(this),this.boundStartLicenseSession=this.startLicenseSession.bind(this),this.license=new License}}function asyncGeneratorStep$12(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$12(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$12(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$12(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}$n([Bind(),jn("design:type",Function),jn("design:paramtypes",[void 0])],KeySession.prototype,"startLicenseSession",null);var Un={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Gn={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class FairplayEncryptedSession extends KeySession{attachMedia(e,t){var r=this;return _asyncToGenerator$12((function*(){r.keySystem=t.keySystem,r._keySystemAccess=t,e.addEventListener("encrypted",r.boundHandleSessionCreation,!1)}))()}detachMedia(e){e.removeEventListener("encrypted",this.boundHandleSessionCreation);const t=this._mediaKeySessions,r=this._mediaKeySessionRenewals;Object.values(t).forEach(e=>{e.removeEventListener("message",this.boundStartLicenseSession),asAsync(e.close())}),this._mediaKeySessions={},Object.values(r).forEach(e=>clearTimeout(e)),this._mediaKeySessionRenewals={}}createSession(e){var t=this;return _asyncToGenerator$12((function*(){Ot.debug("fairplay eme:  createSession",e);const r=t._keySystemAccess;if(!r)return;const{initData:n,target:i,initDataType:a}=e;var o;t._mediaKeysPromise||(t._mediaKeysPromise=new Promise((o=_asyncToGenerator$12((function*(e,n){const a=yield r.createMediaKeys();try{yield i.setMediaKeys(a),t._mediaKeys=a;const e=yield t.loadCertificateBuffer();yield a.setServerCertificate(e)}catch(Tt){t.dispatchKeyError(Tt),n(Tt)}e(a)})),function(e,t){return o.apply(this,arguments)})));const s=yield t._mediaKeysPromise,c=new Uint8Array(n),l=String.fromCharCode.apply(void 0,Array.from(c));if(t.mediaKeySessions[l])return void Ot.error("fairplay eme: not creating new session for extURI",l);const u=s.createSession();Ot.debug("fairplay eme: creating new key session for",l),t.addMediaKeySessionInfo(l,u,t.item),u.addEventListener("message",t.startFairplayLicenseSession),u.extURI=l,yield u.generateRequest(a,n),t._mediaKeySessions[u.sessionId]=u,Ot.debug("fairplay eme: created session",u)}))()}startFairplayLicenseSession(e){const{message:t,target:r}=e,n=u(new Uint8Array(t)),i=r.extURI||this.extURI,a=this.mediaKeySessions[i];if(a)return this.acquirePlaybackLicense(i,n,this.initiated,a).then(e=>this.handleLicenseJson(e,r,i));Ot.debug("fairplay eme: no key session info, aborting license request",i)}handleLicenseJson(e,t,r){var n=this,_superprop_get_handleLicenseJson=()=>super.handleLicenseJson;return _asyncToGenerator$12((function*(){if(!e)return;const i=n.mediaKeySessions[r];if(!i)return void Ot.debug("fairplay eme: media key session does not exist, not updating");const a=e["renew-after"];if(e.license&&a){Ot.debug("fairplay eme: got renew after value",a,r);const e=n._mediaKeySessionRenewals,o=e[t.sessionId];o&&clearTimeout(o),e[t.sessionId]=setTimeout(()=>n._renewMediaKeySession(i,r),1e3*a)}yield _superprop_get_handleLicenseJson().call(n,e,t,r)}))()}_renewMediaKeySession(e,t){delete this._mediaKeySessionRenewals[e.session.sessionId],Ot.debug("fairplay eme: renewing session",e),e.session.update(c("renew"))}applyDelayedCdmUpdates(){}loadKeys(e){return _asyncToGenerator$12((function*(){}))()}clearSessions(){return _asyncToGenerator$12((function*(){}))()}constructor(...e){super(...e),this._mediaKeySessions={},this._mediaKeySessionRenewals={}}}function asyncGeneratorStep$11(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$11(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$11(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$11(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}Un([Bind(),Gn("design:type",Function),Gn("design:paramtypes",[void 0])],FairplayEncryptedSession.prototype,"startFairplayLicenseSession",null);const Fn=/^(?:.*)(skd:\/\/.+)$/i;class WebKitSession extends KeySession{attachMedia(e,t){return this.target=e,e.addEventListener("webkitneedkey",this.boundHandleSessionCreation,!1),e.addEventListener("webkitkeyerror",this.boundDispatchKeyError),e}detachMedia(e){e&&(e.removeEventListener("webkitneedkey",this.boundHandleSessionCreation,!1),e.removeEventListener("webkitkeyerror",this.boundDispatchKeyError))}destroy(){Ot.debug("FPS destroy"),this.detachMedia(this.target),this.session&&(this.session.removeEventListener("webkitkeyerror",this.boundDispatchKeyError),this.session.removeEventListener("webkitkeymessage",this.boundStartLicenseSession))}createSession(e){Ot.debug("FPS createSession",e);const{initData:t,target:r}=e,{item:n}=this;if(!n)return Ot.error("Cannot createSession without item"),Promise.resolve();const i=this._extractAssetId(t);if(Ot.debug("extURI",i),!r.webkitKeys&&window.WebKitMediaKeys){const e=new window.WebKitMediaKeys(this.keySystem);r.webkitSetMediaKeys(e)}return this.loadCertificateBuffer().then(e=>{const a=this._concatInitDataIdAndCertificate(t,i,e),o="VIDEO"===r.tagName?Ut.AVC1:Ut.MP4,s=r.webkitKeys.createSession(o,a);this.addMediaKeySessionInfo(i,s,n),this.session=s,s.extURI=i,s.addEventListener("webkitkeyerror",this.boundDispatchKeyError),s.addEventListener("webkitkeymessage",this.boundStartLicenseSession)})}_extractAssetId(e){let t=String.fromCharCode.apply(null,new Uint16Array(e.buffer||e));const r=t.match(Fn);return r&&r.length>=2&&(t=r[1]),Ot.debug("Extracted assetId from EXT-X-KEY URI",t),t}_concatInitDataIdAndCertificate(e,t,r){"string"==typeof t&&(t=l(t)),r=new Uint8Array(r);let n=0;const i=new ArrayBuffer(e.byteLength+4+t.byteLength+4+r.byteLength),a=new DataView(i);new Uint8Array(i,n,e.byteLength).set(e),n+=e.byteLength,a.setUint32(n,t.byteLength,!0),n+=4;const o=new Uint8Array(i,n,t.byteLength);o.set(t),n+=o.byteLength,a.setUint32(n,r.byteLength,!0),n+=4;return new Uint8Array(i,n,r.byteLength).set(r),new Uint8Array(i,0,i.byteLength)}applyDelayedCdmUpdates(){}loadKeys(e){return _asyncToGenerator$11((function*(){}))()}clearSessions(){return _asyncToGenerator$11((function*(){}))()}constructor(...e){super(...e),this.isLegacyEme=!0}}function asyncGeneratorStep$10(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$10(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$10(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$10(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}class MSSession extends KeySession{attachMedia(e,t){return this.keySystem=t.keySystem,e.addEventListener("msneedkey",this.boundHandleSessionCreation,!1),e.addEventListener("mskeyerror",this.boundDispatchKeyError),e}detachMedia(e){e.removeEventListener("msneedkey",this.boundHandleSessionCreation,!1),e.removeEventListener("mskeyerror",this.boundDispatchKeyError)}createSession(e){const{initData:t,target:r}=e;if(!r.msKeys){const e=new MSMediaKeys(this.keySystem);r.msSetMediaKeys(e)}const n=r.msKeys.createSession(Ut.MP4,t);return n.addEventListener("mskeyerror",this.dispatchKeyError),n.addEventListener("mskeymessage",this.startLicenseSession.bind(this)),n}applyDelayedCdmUpdates(){}loadKeys(e){return _asyncToGenerator$10((function*(){}))()}clearSessions(){return _asyncToGenerator$10((function*(){}))()}}const Bn={[Ct.WIDEVINE]:Gt.WIDEVINE,[Ct.FAIRPLAY]:Gt.FAIRPLAY,[Ct.PLAYREADY]:Gt.PLAYREADY},Kn=[0,0,1,222,112,115,115,104,0,0,0,0,154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149,0,0,1,190],Vn=[190,1,0,0,1,0,1,0,180,1];function concatenate(e,...t){let r=0;for(const a of t)r+=a.length;const n=new e(r);let i=0;for(const a of t)n.set(a,i),i+=a.length;return n}const{WIDEVINE:Hn,PLAYREADY:Wn}=Ct,qn={};qn[Hn]=e=>{Ot.debug("generating Widevine pssh for keyId");const t=new Uint8Array([0,0,0,52,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,20,8,1,18,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);for(let r=0;r<e.length;r++)t[t.length-16+r]=e[r];return Ot.debug("generatePSSH",t),t},qn[Wn]=e=>{Ot.debug("generating Playready pssh for keyId"),(e=>{const swap=(e,t,r)=>{const n=e[t];e[t]=e[r],e[r]=n};swap(e,0,3),swap(e,1,2),swap(e,4,5),swap(e,6,7)})(e);const t=u(e),r='<WRMHEADER xmlns="http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader" version="4.3.0.0"><DATA><PROTECTINFO><KIDS><KID ALGID="AESCTR" VALUE="[KEYID]"></KID></KIDS></PROTECTINFO></DATA></WRMHEADER>'.replace("[KEYID]",t),n=l(r),i=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);return concatenate(Uint8Array,Kn,Vn,i)};function asyncGeneratorStep$$(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$$(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$$(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$$(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}class PreloadingEncryptedSession extends KeySession{attachMedia(e,t){this.keySystem=t.keySystem,this._keySystemAccess=t,this._target=e}detachMedia(){asAsync(this.clearSessions())}createSession(e){return _asyncToGenerator$$((function*(){}))()}_mediaKeysSetup(){var e=this;return _asyncToGenerator$$((function*(){const t=e._keySystemAccess;var r;t&&(e._mediaKeysPromise||(e._mediaKeysPromise=new Promise((r=_asyncToGenerator$$((function*(r,n){const i=yield t.createMediaKeys();try{var a;yield null===(a=e._target)||void 0===a?void 0:a.setMediaKeys(i),e._mediaKeys=i}catch(Tt){e.dispatchKeyError(Tt),n(Tt)}if(e.isWidevine){const t=yield e.loadCertificateBuffer();yield i.setServerCertificate(t)}r(i)})),function(e,t){return r.apply(this,arguments)}))),yield e._mediaKeysPromise)}))()}createSessionAndGenerateRequest(e,t,r){var n=this;return _asyncToGenerator$$((function*(){var i;const a=!!(null==r?void 0:r.isRenewal),o=!!(null==r?void 0:r.delayCdmUpdate);if(!a&&n.mediaKeySessions[e])return;Ot.debug(`createSessionAndGenerateRequest for item ${t.title}, isRenewal ${a}`);const c=null===(i=n._mediaKeys)||void 0===i?void 0:i.createSession(),{keySystem:l}=n;if(!c)return;n.addMediaKeySessionInfo(e,c,t,o);const d=(e=>{if(e.includes("data")){const[t,r]=e.split(",");return r}return e})(e),p=s(d),h=n.isWidevine&&t.isSong||16===p.length;let y;var f;return Ot.debug("extracted uri",e),n.isPlayReady&&!h?(Ot.debug("handling Playready object"),c.extURI=e,f=p,y=concatenate(Uint8Array,new Uint8Array(Kn),f)):h?(Ot.debug("handling keyId only initData"),c.extURI="data:;base64,"+u(p),y=((e,t)=>{const r=qn[t];if(!r)return Ot.warn("No pssh generator for ",t),e;return r(Uint8Array.from(e))})(p,l)):(Ot.debug("handling pssh initData"),c.extURI=e,y=p),c.addEventListener("message",n.startLicenseSession),c.generateRequest("cenc",y).catch(e=>{if(e.message.match(/generateRequest.*\(75\)/))return c.generateRequest("cenc",y);throw e})}))()}handleLicenseJson(e,t,r){var n=this,_superprop_get_handleLicenseJson=()=>super.handleLicenseJson;return _asyncToGenerator$$((function*(){var i;if(!e)return;const a=n.mediaKeySessions[r];if(!a)return void Ot.debug("media key session does not exist, not updating");const o=e["renew-after"];if(e.license&&o){Ot.debug("Got renew after value",o,r);const e=n._mediaKeySessionRenewals,i=e[t.sessionId];i&&clearTimeout(i),e[t.sessionId]=setTimeout(()=>n._renewMediaKeySession(a,r),1e3*o)}yield _superprop_get_handleLicenseJson().call(n,e,t,r);const s=null===(i=n.mediaKeySessions[r])||void 0===i?void 0:i.oldSession;s&&(Ot.debug("removing old key session after updating",r),yield n._removeAndCloseSession(s),delete n.mediaKeySessions[r].oldSession,delete n._mediaKeySessionRenewals[s.sessionId])}))()}_renewMediaKeySession(e,t){delete this._mediaKeySessionRenewals[e.session.sessionId],asAsync(this.createSessionAndGenerateRequest(t,e.item,{isRenewal:!0}))}applyDelayedCdmUpdates(){var e=this;return _asyncToGenerator$$((function*(){Ot.debug("applying delayed CDM updates");const t=Object.entries(e.mediaKeySessions);for(const r of t){const[t,n]=r;if(n.delayCdmUpdate){const r=yield n["license-json"];Ot.debug("delayed update of license",r),yield e.handleLicenseJson(r,n.session,t),n.delayCdmUpdate=!1}}}))()}loadKeys(e,t,r){var n=this;return _asyncToGenerator$$((function*(){yield n._mediaKeysSetup();const i=n.filterKeyValues(e);for(const e of i){const{dataUri:i}=e;yield n.createSessionAndGenerateRequest(i,t,r)}if(null==t?void 0:t.isLiveAudioStation){const e=Object.keys(n.mediaKeySessions),t=i.reduce((e,t)=>(e[t.dataUri]=!0,e),{});for(const r of e)t[r]||(yield n._scheduleRemoveSession(r))}}))()}filterKeyValues(e){let t;if(1===e.length)t=e;else{const r=Bn[this.keySystem];t=e.filter(e=>e.keyFormat===r)}return t}clearSessions(e){var t=this;return _asyncToGenerator$$((function*(){const r=t.mediaKeySessions;if(null==e?void 0:e.length){const r=t.filterKeyValues(e);for(const e of r){const r=e.dataUri;clearTimeout(t._sessionRemovalTimeouts[r]),yield t._removeSessionImmediately(r)}}else{Object.values(t._sessionRemovalTimeouts).forEach(e=>clearTimeout(e)),Ot.debug("clearing key sessions",r);for(const e of Object.keys(r))yield t._removeSessionImmediately(e)}}))()}_scheduleRemoveSession(e){var t=this;return _asyncToGenerator$$((function*(){if(!t.mediaKeySessions[e])return void Ot.warn("no session for dataUri, not scheduling remove",e);if(t._sessionRemovalTimeouts[e])return;const r=setTimeout(()=>{asAsync(t._removeSessionImmediately(e))},6e4);Ot.debug("deferring removal of keysession for dataUri",e),t._sessionRemovalTimeouts[e]=r}))()}_removeSessionImmediately(e){var t=this;return _asyncToGenerator$$((function*(){const r=t.mediaKeySessions[e];if(!r)return void Ot.warn("no session for dataUri, not removing",e);Ot.debug("removing keysession for",e);const{session:n,oldSession:i}=r;t._clearSessionRenewal(n),delete t.mediaKeySessions[e],yield t._removeAndCloseSession(n),i&&(yield t._removeAndCloseSession(i))}))()}_removeAndCloseSession(e){var t=this;return _asyncToGenerator$$((function*(){e.removeEventListener("message",t.startLicenseSession),Ot.debug("tearing down session",e.sessionId);try{yield e.remove()}catch(r){Ot.warn("Error invoking session.remove()",r)}finally{try{yield e.close()}catch(n){Ot.warn("Error invoking session.close()",n)}}}))()}_clearSessionRenewal(e){const t=this._mediaKeySessionRenewals[e.sessionId];t&&(Ot.debug("clearing scheduled license renewal for session",e.sessionId),clearTimeout(t),delete this._mediaKeySessionRenewals[e.sessionId])}constructor(...e){super(...e),this._sessionRemovalTimeouts={},this._mediaKeySessionRenewals={}}}function asyncGeneratorStep$_(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$_(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$_(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$_(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const zn=BooleanDevFlag.register("mk-safari-modern-eme");class MediaExtension extends Notifications{get hasMediaKeySupport(){return hasMediaKeySupport()}get hasMediaSession(){return void 0!==this._session}get isFairplay(){return this._session.isFairplay}set extURI(e){this._session.extURI=e}set initiated(e){this._session.initiated=e}get session(){return this._session}clearSessions(e){var t=this;return _asyncToGenerator$_((function*(){var r;return null===(r=t.session)||void 0===r?void 0:r.clearSessions(e)}))()}initializeKeySystem(){var e=this;return _asyncToGenerator$_((function*(){yield e._attachSession();const{_session:t}=e;t&&[jt.playbackLicenseError,jt.playbackSessionError].forEach(r=>{t.addEventListener(r,t=>{e.dispatchEvent(r,t)})})}))()}_requestModernFairplayAccess(){var e=this;return _asyncToGenerator$_((function*(){const{contentType:t}=e,r=[{initDataTypes:["skd"],audioCapabilities:[{contentType:t,robustness:""}],videoCapabilities:[{contentType:t,robustness:""}],distinctiveIdentifier:"not-allowed",persistentState:"not-allowed",sessionTypes:["temporary"]}],[,n]=yield findMediaKeySystemAccess([Ct.FAIRPLAY],r);return n}))()}_attachSession(){var e=this;return _asyncToGenerator$_((function*(){var t,r;const{mediaElement:n,contentType:i}=e;if(null===(t=window.WebKitMediaKeys)||void 0===t?void 0:t.isTypeSupported(Ct.FAIRPLAY+".1_0",Ut.MP4)){let t;zn.enabled&&e.hasMediaKeySupport&&(t=yield e._requestModernFairplayAccess()),t?(Ot.warn("media-extension: Using Fairplay modern EME"),e._session=new FairplayEncryptedSession,e._session.attachMedia(n,t)):(Ot.warn("media-extension: Using Fairplay legacy EME"),e._session=new WebKitSession,e._session.attachMedia(n,{keySystem:Ct.FAIRPLAY}))}else if(null===(r=window.MSMediaKeys)||void 0===r?void 0:r.isTypeSupported(Ct.PLAYREADY,Ut.MP4))e._session=new MSSession,e._session.attachMedia(n,{keySystem:Ct.PLAYREADY});else if(e.hasMediaKeySupport&&n.canPlayType(i)){e._session=new PreloadingEncryptedSession;const t=[{initDataTypes:["cenc","keyids"],audioCapabilities:[{contentType:i}],distinctiveIdentifier:"optional",persistentState:"required"}],r=potentialKeySystemsForAccess(),[,o]=yield findMediaKeySystemAccess(r,t);var a;if(o)null===(a=e._session)||void 0===a||a.attachMedia(n,o);else Ot.warn("media-extension: No keysystem detected!")}}))()}setMediaItem(e){!function(e,t){t.keyURLs&&(e.developerToken=Nn.developerToken,e.userToken=Nn.musicUserToken,e.item=t,e.adamId=t.songId,e.isLibrary=t.isCloudItem,e.setKeyURLs(t.keyURLs))}(this._session,e)}destroy(e){var t;null===(t=this._session)||void 0===t||t.detachMedia(e)}constructor(e,t){super([jt.playbackLicenseError,jt.playbackSessionError]),this.mediaElement=e,this.contentType=t}}const Yn=BooleanDevFlag.register("mk-force-audio-mse"),shouldForceAudioMse=()=>Yn.enabled;function asyncGeneratorStep$Z(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}class ByteRangeSegment{load(){var e,t=this;return(e=function*(){const{url:e,range:r}=t;if(!e)return new Uint8Array;const n=new Headers;n.append("Range",r);const i=yield fetch(e,{headers:n}),a=yield i.arrayBuffer();return new Uint8Array(a)},function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$Z(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$Z(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor({url:e,startByte:t,length:r,isInitSegment:n=!1}){this.url=e,this.isInitSegment=n,this.startByte=parseInt(t,10),this.length=parseInt(r,10),this.endByte=this.startByte+this.length-1,this.range=`bytes=${this.startByte}-${this.endByte}`}}function asyncGeneratorStep$Y(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}class ContinuousSegment{load(){var e,t=this;return(e=function*(){const{url:e}=t;if(!e)return new Uint8Array;const r=yield fetch(e),n=yield r.arrayBuffer();return new Uint8Array(n)},function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$Y(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$Y(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,t=!1){this.url=e,this.isInitSegment=t}}const Qn=/^#EXT-X-BYTERANGE:([^\n]+)\n/gim,Jn=/^#EXT-X-MAP:([^\n]+)\n/im,Xn=/#EXTINF:\d*\.\d*\,[\n](.+)|^#EXT-X-MAP:URI="([^"]*)"/gim,Zn=/#EXTINF:\d*\.\d*,\s*#EXT-X-BITRATE:\d{1,3}[\n](.+)|^#EXT-X-MAP:URI="([^"]*)"/gim;class SegmentList{get segments(){return this._segments}addSegment(e,t){this._addedSegments[t]||(Ot.debug("Adding segment",t),this._segments.push(e),this._addedSegments[t]=!0)}extractLiveRadioSegments(e,t){this._extractContinuousSegments(Xn,e,t)}extractHlsOffersSegments(e,t){this._extractContinuousSegments(Zn,e,t)}_extractContinuousSegments(e,t,r){if(!t||!e.test(t))return;let n;for(e.lastIndex=0;n=e.exec(t);){const e=n[0].startsWith("#EXT-X-MAP")?n[2]:n[1],t=rewriteLastUrlPath(r,e),i=n[0].startsWith("#EXT-X-MAP");this.addSegment(new ContinuousSegment(t,i),e)}}extractByteRangeSegments(e,t){if(!e||!Qn.test(e))return;const r=function(e){if(!e||!Jn.test(e))return;const[,t]=e.match(Jn);return t.split(",").reduce((e,t)=>{const[r,n]=t.split("=");return e[r.toLowerCase()]=n.replace(/\"/gi,""),e},{})}(e);var n;const i=null!==(n=t.split("/").pop())&&void 0!==n?n:"",a=t.replace(i,r.uri),[o,s]=r.byterange.split("@"),c=new ByteRangeSegment({url:a,startByte:s,length:o});var l;this.addSegment(c,c.range),(null!==(l=e.match(Qn))&&void 0!==l?l:[]).forEach(e=>{const[,t,r]=e.match(/^#EXT-X-BYTERANGE:(\d+)@(\d+)\n/),n=new ByteRangeSegment({url:a,startByte:r,length:t});this.addSegment(n,n.range)})}constructor(){this._segments=[],this._addedSegments={}}}var ei;function asyncGeneratorStep$X(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$X(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$X(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$X(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}!function(e){e.keysParsed="keysParsed"}(ei||(ei={}));var ti={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ri={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const ni=/^#EXT-X-TARGETDURATION:(\d+)/im,ii=/^#EXT-X-KEY:[^\n]+URI="([^"]+)"/im,ai=/^#EXT-X-KEY:[^\n]+URI="([^"]+)",KEYFORMAT="([^"]+)"/gim;function loadManifestData(e){return _loadManifestData.apply(this,arguments)}function _loadManifestData(){return(_loadManifestData=_asyncToGenerator$X((function*(e){return(yield fetch(e)).text()}))).apply(this,arguments)}class Manifest extends Notifications{parse(){const e=this._item,t=this._data;if(Ft!==Ct.FAIRPLAY||shouldForceAudioMse())if(this._detectKeyTags(),e.hasOffersHlsUrl)this._segmentList.extractHlsOffersSegments(t,e.assetURL);else if(e.isLiveRadioStation){this._segmentList.extractLiveRadioSegments(t,e.assetURL);const[,r]=this._data.match(ni);Ot.debug(`manifest: setting up manifest refresh interval at ${r} seconds`);const n=1e3*parseInt(r,10);this._manifestRefreshInterval=setInterval(this.liveRadioRefresh,n)}else this._segmentList.extractByteRangeSegments(t,e.assetURL)}static load(e,t=!0){var r=this;return _asyncToGenerator$X((function*(){Ot.debug("loading manifest for item",e.title);const n=e.assetURL;let i;const a=getSessionStorage(),o=!!a&&t;if(o&&(i=null==a?void 0:a.getItem(n),i))return new r(i,e);const s=(new Date).getTime();i=yield loadManifestData(n);const c=new r(i,e);return c.downlink=function(e,t){return 8*t.length/(((new Date).getTime()-e)/1e3)/1024}(s,i),o&&(null==a||a.setItem(n,i)),Promise.resolve(c)}))()}get downlink(){return this._downlink}set downlink(e){this._downlink=e}get mediaItem(){return this._item}liveRadioRefresh(){var e=this;return _asyncToGenerator$X((function*(){const t=yield loadManifestData(e._url);e._data=t,e._detectKeyTags(),e._segmentList.extractLiveRadioSegments(t,e._url),e.dispatchEvent(jt.manifestParsed)}))()}segmentsForTimeRange(e){const t=Math.floor(e.start/10)+1,r=Math.floor(e.end/10)+1,{segments:n}=this;return[n[0],...n.slice(t,r+1)]}get segments(){return this._segmentList.segments}get extURI(){if(!this._extURI){const e=this._data.match(ii);Ot.debug("manifest: EXT_X_KEY_URI matches",e),this._extURI=e&&e[1]||void 0}return this._extURI}get keyValues(){let e=this._modernKeys;return e.length||(e=this._legacyKeys),e}_detectKeyTags(){const e=this.keyValues;e.length&&this.dispatchEvent(ei.keysParsed,{item:this.mediaItem,keys:e})}get _legacyKeys(){const e=this._data.match(ii);Ot.debug("manifest: EXT_X_KEY_URI matches",e);const t=e&&e[1]||void 0;this._extURI=t;const r=[];return t&&r.push({keyFormat:Gt.WIDEVINE,dataUri:t}),r}get _modernKeys(){let e;ai.lastIndex=0;const t=[];for(;e=ai.exec(this._data);){const[r,n,i]=e;t.push({keyFormat:i,dataUri:n})}return t}stop(){this._manifestRefreshInterval&&clearInterval(this._manifestRefreshInterval)}constructor(e,t){super([jt.manifestParsed,ei.keysParsed]),this._downlink=0,this._segmentList=new SegmentList,this._data=e,this._item=t,this._url=t.assetURL}}ti([Bind(),ri("design:type",Function),ri("design:paramtypes",[])],Manifest.prototype,"liveRadioRefresh",null);const oi="seamlessAudioTransition",si="bufferTimedMetadataDidChange",ci=isNodeEnvironment$1()?require("util").TextDecoder:self.TextDecoder;function encodedArrayToString(e,t="utf-8"){if("iso-8859-1"===t)return String.fromCharCode(...e);return new ci(t).decode(e)}function readNullTerminatedString(e,t=0,r){const n=[];r=null!=r?r:e.length;for(let i=t;i<r;i++){const t=e[i];if("\0"===String.fromCharCode(t))break;n.push(String.fromCharCode(t))}return[n.join(""),n.length]}function isBitAtPositionOn(e,t){return 0!=(e&1<<t)}class BaseMp4Box{get size(){return this.end-this.start}get rawBytes(){return this.data.slice(this.start,this.end)}constructor(e,t,r,n){this.id=e,this.data=t,this.start=r,this.end=n}}const li=[237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237];class PsshBox extends BaseMp4Box{get systemId(){const{data:e,start:t}=this,r=t+12;return e.slice(r,r+16)}get dataSize(){return this.view.getUint32(28)}get psshData(){const{data:e,start:t,dataSize:r}=this,n=t+32;return e.slice(n,n+r)}get keyBytes(){const{psshData:e}=this;return e.slice(2,18)}get isWidevine(){return arrayEquals(this.systemId,li)}constructor(e,t,r){super("pssh",e,t,r),this.view=new DataView(e.buffer,t)}}class TencBox extends BaseMp4Box{get isProtected(){const{data:e,start:t}=this;return e[t+14]}get defaultKeyId(){const{data:e,start:t}=this;return e.slice(t+16,t+32)}set defaultKeyId(e){const{data:t,start:r}=this;for(let n=0;n<e.length;n++)t[n+r+16]=e[n]}constructor(e,t,r){super("tenc",e,t,r),this.data=e,this.start=t,this.end=r}}function findBox(e,t,r=[]){for(let n=t;n<e.length;){if(0===r.length)return;const t=new DataView(e.buffer,n).getUint32(0),i=encodedArrayToString(e.subarray(n+4,n+8)),a=n+t;if(1===r.length&&i===r[0])return new BaseMp4Box(i,e,n,a);if(i===r[0])return findBox(e,n+8,r.slice(1));n+=t}}const rewriteDefaultKid=e=>{const[t]=function(e){const t=findBox(e,0,["moov","trak","mdia","minf","stbl","stsd"]),r=[];if(!t)return r;for(let n=t.start+16;n<t.end;){let i=findBox(e,n,["enca"]),a=36;if(i||(i=findBox(e,n,["encv"]),a=86),!i)return r;const o=findBox(e,i.start+a,["sinf","schi","tenc"]);o?(r.push(new TencBox(o.data,o.start,o.end)),n=o.end):n=t.end}return r}(e);if(!t)return;const r=function(e){const t=findBox(e,0,["moov"]),r=[];if(!t)return r;const n=new DataView(e.buffer,0);for(let i=t.start+8;i<t.size;){const t=n.getUint32(i);"pssh"===encodedArrayToString(e.subarray(i+4,i+8))&&r.push(new PsshBox(e,i,i+t)),i+=t}return r}(e).find(e=>e.isWidevine);r&&(t.defaultKeyId=r.keyBytes)};function readSynchSafeUint32(e){return 2097152*(127&e[0])+16384*(127&e[1])+128*(127&e[2])+(127&e[3])}const ui={0:"iso-8859-1",1:"utf-16",2:"utf-16be",3:"utf-8"},di={TPE1:!0,TIT2:!0,WXXX:!0,PRIV:!0,TALB:!0,CHAP:!0};class ID3{_parseID3Flags(e){this.unsynchronized=isBitAtPositionOn(e,7),this.hasExtendedHeader=isBitAtPositionOn(e,6),this.isExperimental=isBitAtPositionOn(e,5),this.hasFooter=isBitAtPositionOn(e,4)}_parseID3Frames(e,t,r,n){const i=new DataView(t.buffer,0,n),{minor:a}=this;for(;r+8<=n;){const s=o(t.subarray(r,r+4));r+=4;const c=4===a?readSynchSafeUint32(t.subarray(r,r+4)):i.getUint32(r);if(r+=4,t[r++],t[r++],di[s]){const i=r,a=this._extractID3FramePayload(t,s,c,i,n);if(a){const t=this.decodeID3Frame(a);t&&e.frames.push(t)}r+=c}else r+=c}}_extractID3FramePayload(e,t,r,n,i){const a=n+r;let o;return a<=i&&(o={type:t,size:r,data:e.slice(n,a)}),o}decodeID3Frame(e){if("TXXX"!==e.type)return"WXXX"===e.type?this.decodeWxxxFrame(e):"PRIV"===e.type?this.decodePrivFrame(e):"CHAP"===e.type?this.decodeChapFrame(e):"T"===e.type[0]?this.decodeTextFrame(e):{key:e.type,data:e.data}}decodeChapFrame(e){const{data:t}=e,r=new DataView(t.buffer),n={key:"CHAP",frames:[]};let[i,a]=readNullTerminatedString(t,0,t.length);return n.id=i,a++,n.startTime=r.getUint32(a),a+=4,n.endTime=r.getUint32(a),a+=4,a+=4,a+=4,this._parseID3Frames(n,t,a,t.length),n}decodeTextFrame(e){const{data:t}=e,r=ui[t[0]],n=encodedArrayToString(t.subarray(1),r);return{key:e.type,text:n}}decodeWxxxFrame(e){const{data:t}=e,r=ui[t[0]];let n=1;const i=encodedArrayToString(t.subarray(n),r);n+=i.length+1;return{key:"WXXX",description:i,text:encodedArrayToString(t.subarray(n))}}decodePrivFrame(e){const t=encodedArrayToString(e.data);if(!t)return;return{key:"PRIV",info:t,data:e.data.slice(t.length+1)}}constructor(e){this.frames=[],this.unsynchronized=!1,this.hasExtendedHeader=!1,this.hasFooter=!1,this.isExperimental=!1;let t=0;const r=o(e.subarray(t,t+3));if(t+=3,"ID3"!==r)return;this.minor=e[t++],this.revision=e[t++];const n=e[t++];this._parseID3Flags(n);const i=readSynchSafeUint32(e.subarray(t,t+4));t+=4,this.frameLength=i;const a=t+i;if(this.endPos=a,this.hasExtendedHeader){t+=readSynchSafeUint32(e.subarray(t,t+4))}this.minor>2&&this._parseID3Frames(this,e,t,a)}}var pi;function checkBoxName(e,t,r){return!(t+4>e.length)&&(e[t]===r[0]&&e[t+1]===r[1]&&e[t+2]===r[2]&&e[t+3]===r[3])}function findEmsgs(e){const t=e.length,r=[];if(function(e){return(null==e?void 0:e.length)>=8&&checkBoxName(e,4,[102,116,121,112])}(e))return r;for(let n=0;n<t;n++){if(checkBoxName(e,n,[109,111,111,102]))return r;if(checkBoxName(e,n,[101,109,115,103])){const t=n-4,i=new DataView(e.buffer,t).getUint32(0),a=e.subarray(t,t+i);n=n+i-1,r.push(a)}}return r}!function(e){e[e.THREE=51]="THREE",e[e.C_A=65]="C_A",e[e.C_C=67]="C_C",e[e.C_D=68]="C_D",e[e.C_H=72]="C_H",e[e.C_I=73]="C_I",e[e.C_P=80]="C_P",e[e.A=97]="A",e[e.C=99]="C",e[e.D=100]="D",e[e.E=101]="E",e[e.F=102]="F",e[e.G=103]="G",e[e.H=104]="H",e[e.I=105]="I",e[e.K=107]="K",e[e.M=109]="M",e[e.O=111]="O",e[e.P=112]="P",e[e.S=115]="S",e[e.T=116]="T",e[e.V=118]="V",e[e.Y=121]="Y"}(pi||(pi={}));const hi={TALB:"album",TIT2:"title",TPE1:"performer"},yi=["performer","title","album"];class TimedMetadata{resolveAdamIdFromStorefront(e){const t=this.storefrontToIds[e];this._adamId=t}get adamId(){return this._adamId}equals(e){if(!yi.every(t=>this[t]===e[t]))return!1;const{links:t}=this,r=e.links;if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++){const e=t[n].description===r[n].description,i=t[n].url===r[n].url;if(!e||!i)return!1}return!0}constructor(e){this.links=[],this.storefrontToIds={},e.forEach(e=>{const{key:t}=e,r=hi[t];var n;if(r)this[r]=null===(n=e.text)||void 0===n?void 0:n.replace(/\0/g,"");else if("WXXX"===e.key){if(e.description){const[t,r]=e.description.split("\0");this.links.push({description:t,url:r})}}else if("PRIV"===e.key){var i;const t=null===(i=e.info)||void 0===i?void 0:i.split("\0");if(t&&t.length&&t[0].startsWith("com.apple.radio.adamid")){t[1].split(",").forEach(e=>{const[t,r]=e.split(":");t&&r&&"0"!==r&&!hasOwn(this.storefrontToIds,t)&&(this.storefrontToIds[t]=r)})}}})}}class Emsg{get length(){return this.data.length}get elementPresentationTime(){const{presentationTime:e,timeScale:t}=this;return e&&t?Math.round(e/t):NaN}get timedMetadata(){var e;if(this._timedMetadata)return this._timedMetadata;const t=null===(e=this.id3)||void 0===e?void 0:e.frames;return t?(this._timedMetadata=new TimedMetadata(t),this._timedMetadata):void 0}constructor(e){this.data=e;const t=new DataView(e.buffer);let r=8;if(1!==e[r])return;r+=4,this.timeScale=t.getUint32(r),r+=4;const n=t.getUint32(r);r+=4;const i=t.getUint32(r);if(r+=4,this.presentationTime=Math.pow(2,32)*n+i,!Number.isSafeInteger(this.presentationTime))throw this.presentationTime=Number.MAX_SAFE_INTEGER,new Error("Failed to create 64 bit integer");this.eventDuration=t.getUint32(r),r+=4,this.id=t.getUint32(r),r+=4;const[a,o]=readNullTerminatedString(e,r);r+=o+1,this.schemeIdUri=a;const[s,c]=readNullTerminatedString(e,r);r+=c+1,this.payload=e.subarray(r,e.byteLength),this.id3=new ID3(this.payload)}}class TimedMetadataManager{processEmsgs(e){const t=findEmsgs(e);t.length&&(this._currentEmsgInterval||(this._currentEmsgInterval=setInterval(this._getCurrentEmsg,1e3)),t.forEach(e=>{const t=new Emsg(e);this._emsgLookup[t.elementPresentationTime]=t}))}stop(){const{_currentEmsgInterval:e}=this;e&&clearInterval(e)}_getCurrentEmsg(){const{_currentTime:e,_emsgLookup:t}=this,r=Math.round(e()),n=[],i=Object.keys(t);for(let o=0;o<i.length;o++){const e=parseInt(i[o],10);if(!(e<r))break;n.push(e)}const a=n.pop();if(a){const e=t[a];if(!e)return;const{_currentEmsg:r,_onDidChange:n}=this,i=null==r?void 0:r.payload,o=e.payload;i&&arrayEquals(i,o)||(this._currentEmsg=e,n(e)),this._cleanupEmsgs(a)}}_cleanupEmsgs(e){const{_emsgLookup:t}=this;Object.keys(t).forEach(r=>{parseInt(r,10)<e&&delete t[r]})}constructor(e,t){this._currentTime=e,this._onDidChange=t,this._emsgLookup={},this._getCurrentEmsg=this._getCurrentEmsg.bind(this)}}class SegmentProcessor{process(e,t){const{_item:r}=this;try{r.isLiveRadioStation?this._processLiveRadioSegment(t):r.hasOffersHlsUrl&&this._processHlsOffersSegment(e,t)}catch(n){Ot.error("Error processing segment",n)}}stop(){this._timedMetadataManager.stop()}_processHlsOffersSegment(e,t){e.isInitSegment&&rewriteDefaultKid(t)}_processLiveRadioSegment(e){this._timedMetadataManager.processEmsgs(e)}constructor(e,t,r){this._item=e,this._timedMetadataManager=new TimedMetadataManager(()=>t.currentTime,e=>{r.publish(si,e.timedMetadata)})}}function asyncGeneratorStep$W(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$W(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$W(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$W(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}var fi={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},mi={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const gi=Ot.createChild("mse"),vi=BooleanDevFlag.get("mk-mse-buffer"),{manifestParsed:bi}=jt;class MseBuffer{onSourceOpen(){gi.debug("mediaSource open handler");const{mediaSource:e}=this;if(e.activeSourceBuffers.length>0)return void gi.debug("not adding new source buffer");gi.debug("adding new source buffer");const t=e.addSourceBuffer(xt);this.sourceBuffer=t,t.addEventListener("updateend",this.updateEndHandler);const{clip:r,hasAppendWindowSupport:n}=this;r&&(n?(gi.debug("appendWindowStart/End",r.start,r.end),t.appendWindowStart=r.start,t.appendWindowEnd=r.end):(gi.debug("seeking for clip",r.start),asAsync(this.seek(r.start)))),this.updateSegmentToFetch(0,!0)}setNextManifest(e){gi.debug("setting next manifest for ",e.mediaItem.title),this.nextSeamlessTransition?(gi.debug("abandoning transition scheduled for "+this.nextSeamlessTransition),this.revertSeamlessTransition(!0),this.playbackTimeline.next={manifest:e}):(this.playbackTimeline.next={manifest:e},this.isFullyBuffered&&(gi.debug("current song is fully buffered, beginning transition to next"),this.transitionToNextManifest()))}isItemPlaying(e){var t,r;const{playbackTimeline:n}=this,i=this.nextSeamlessTransition?null===(t=n.previous)||void 0===t?void 0:t.manifest.mediaItem:null===(r=n.current)||void 0===r?void 0:r.manifest.mediaItem;return!!i&&(gi.debug(`isItemPlaying ${e.title}, ${i.title}, ${e.id===i.id}`),e.id===i.id)}get currentItem(){return this.manifest.mediaItem}get playableUrl(){let e=this._playableUrl;return e||(e=window.URL.createObjectURL(this.mediaSource),gi.debug("created url",e),this._playableUrl=e,e)}get segments(){const{manifest:e,clip:t}=this;return t?e.segmentsForTimeRange(t):e.segments||[]}get currentTime(){return this._currentTime}set currentTime(e){if(e+=this.currentTimestampOffset,this._currentTime===e)return;const{nextSeamlessTransition:t}=this;if(t&&e>=t){var r,n;gi.debug("setting offset to",t),this.currentTimestampOffset=t||0,this.nextSeamlessTransition=void 0,this.duration=this.manifest.mediaItem.playbackDuration/1e3,gi.debug("buffer setting duration to",this.duration);const e={previous:null===(r=this.playbackTimeline.previous)||void 0===r||null===(n=r.manifest)||void 0===n?void 0:n.mediaItem,current:this.manifest.mediaItem};gi.debug("dispatching seamless audio transition",e),this.dispatcher.publish(oi,e)}this._currentTime=e;const{isOverBufferLimit:i,timeToTrim:a}=this,o=e>this.timeToTrim;i&&o&&(gi.debug("buffer over limit, trimming to ",a),this.removeToTime(a),this.timeToTrim+=10)}get hasAppendWindowSupport(){var e;return void 0!==(null===(e=this.sourceBuffer)||void 0===e?void 0:e.appendWindowStart)}seek(e){var t=this;return _asyncToGenerator$W((function*(){const{duration:r,seekWhenUpdated:n,sourceBuffer:i}=t;if(t.resolveSeekPromise(!1),gi.debug("seek to ",e),(e=+e)>r&&(gi.debug("rounding seek time to duration",e,r),e=r),!i)return!1;if(t.revertSeamlessTransition(),i.updating)return gi.debug("sourcebuffer updating, deferring seek"),new Promise(r=>{n&&n.resolve(!1),t.seekWhenUpdated={seek:t.seek.bind(t,e),resolve:r}});t.currentlyLoadingSegmentIndex=void 0,t.updateSegmentToFetch(0,!0),t.removeToTime(e),t.timeToTrim=10*Math.floor(e/10);const a=t.getSegmentForTime(e);0!==a&&(yield t.firstSegmentLoadPromise),gi.debug("seeking to",e,"segment",a),t.updateSegmentToFetch(a,!0);const o=new Promise(r=>{t.seekResolver={time:e,resolve:r}});return t.checkSeekBuffered(),o}))()}clearNextManifest(){this.revertSeamlessTransition(!0),this.playbackTimeline.next=void 0}revertSeamlessTransition(e=!1){const{playbackTimeline:t,nextSeamlessTransition:r}=this;if(!r||!t.previous)return void gi.debug("no need to revert, no transition");this.isAtEndOfStream=e,gi.debug("reverting seamless transition with discardNextManifest",e),e?this.clearBufferToEnd(r):this.clearBuffer(),gi.debug("abandoning transition to "+this.manifest.mediaItem.title),t.next=e?void 0:t.current,t.current=t.previous,t.previous=void 0;const n=this.manifest.mediaItem;gi.debug("current item reverted to "+n.title),this.nextSeamlessTransition=void 0,this.duration=n.playbackDuration/1e3,gi.debug("reverted duration to "+this.duration),e||(this.currentTimestampOffset=0,this.timestampOffsetAdjustment=0,gi.debug("reverted currentTimestampOffset and timestampOffsetAdjustment to 0")),this.printInfo(),this.segmentIndexToFetch=-1}get streamHasEnding(){return!this.manifest.mediaItem.isLiveRadioStation}stop(){this.segmentProcessor.stop(),this.setEndOfStream(),this.remove()}remove(){var e;gi.debug("removing sourceBuffer and mediaSource");const{sourceBuffer:t,mediaSource:r}=this;null===(e=this.seekResolver)||void 0===e||e.resolve(!1),this.manifest.removeEventListener(bi,this.onManifestParsed);const n=this._playableUrl;n&&(gi.debug("revoking url",n),window.URL.revokeObjectURL(n)),r.removeEventListener("sourceopen",this.onSourceOpen),t&&(t.removeEventListener("updateend",this.updateEndHandler),this.sourceBuffer=void 0)}onManifestParsed(){const e=this.segmentIndexToFetch+1;gi.debug("manifestParsed, loading segment",e),this.updateSegmentToFetch(e,!0)}updateEndHandler(){if(this.kickstartBuffer(),this.clearDeferredRemove())return;if(gi.debug("update end",this.seekWhenUpdated),this.seekWhenUpdated){gi.debug("updateEndHandler resolving seekWhenUpdated");const{seekWhenUpdated:e}=this;return asAsync(e.seek().then(e.resolve)),void(this.seekWhenUpdated=void 0)}this.checkSeekBuffered();const{clip:e,sourceBuffer:t,hasAppendWindowSupport:r}=this;if(e&&t&&!r){const{buffered:r}=t;if(this.isTimeBuffered(e.end+1)){const n=r.end(r.length-1);return gi.debug("clipping sourcebuffer to",e.end,n),void t.remove(e.end,n)}}if(this.isAtEndOfStream)return gi.debug("buffer is at end of stream"),this.streamHasEnding&&(gi.debug("isAtEndOfStream, not fetching any more segments"),this.playbackTimeline.next||this.setEndOfStream(),this.transitionToNextManifest()),void(this.isAtEndOfStream=!1);gi.debug("updateEndHandler invoking loadSegment"),asAsync(this.loadSegment())}clearDeferredRemove(){var e;if(0===this.deferredRemoves.length)return!1;const t=this.deferredRemoves.shift();return null===(e=this.sourceBuffer)||void 0===e||e.remove(t.start,t.end),!0}transitionToNextManifest(){var e;gi.debug("beginning transition to next manifest");const{playbackTimeline:t,sourceBuffer:r}=this;if(!t.next||!r)return void gi.debug("no next manifest");const n=this.endOfBufferTime||this.currentTimestampOffset;gi.debug("setting seamless transition at",n),this.nextSeamlessTransition=n,this.timestampOffsetAdjustment=n,this.playbackTimeline.current.endTime=n,t.previous=t.current,gi.debug("previous manifest set to",null===(e=t.previous)||void 0===e?void 0:e.manifest.mediaItem.title),t.current=t.next,gi.debug("current manifest set to",t.current.manifest.mediaItem.title),t.next=void 0,this.updateSegmentToFetch(0,!0),this.printInfo()}updateSegmentToFetch(e,t=!1){this.segments.length&&e<this.segments.length&&e!==this.segmentIndexToFetch&&(this.segmentIndexToFetch=e,t&&(gi.debug("updateSegmentToFetch invoking loadSegment"),asAsync(this.loadSegment())))}loadSegment(){var e=this;return _asyncToGenerator$W((function*(){const t=e.segmentIndexToFetch,r=e.segments[t];if(t!==e.currentlyLoadingSegmentIndex){if(r)try{gi.debug("begin loadSegment "+t),e.currentlyLoadingSegmentIndex=t;const i=r.load();0===t&&(e.firstSegmentLoadPromise=i);const a=yield i;if(0!==t&&t!==e.segmentIndexToFetch)return void gi.debug("load segment index to fetch changed, not processing bytes for segment",t);e.segmentProcessor.process(r,a),gi.debug("loadSegment processed: "+t);const{sourceBuffer:o,timestampOffsetAdjustment:s}=e;if(!o)return;try{"number"==typeof s&&(gi.debug("adjusting timestampOffset of sourcebuffer to",s),o.timestampOffset=s,e.timestampOffsetAdjustment=void 0),o.appendBuffer(a),e.isFullyBuffered=!1,e.isOverBufferLimit=!1,gi.debug("appended to buffer",a.length),e.printBufferTimes(),t===e.segments.length-1?e.isAtEndOfStream=!0:t===e.segmentIndexToFetch&&(gi.debug("loadSegment bumping segment index to fetch to ",t+1),e.updateSegmentToFetch(t+1))}catch(n){"QuotaExceededError"===n.name?(e.isOverBufferLimit=!0,gi.debug("reached buffer limit")):gi.warn("Error appending to source buffer",n)}}catch(i){gi.error("Error loading segment",i)}finally{e.currentlyLoadingSegmentIndex=void 0}}else gi.debug(`segment ${t} is currently loading, not loading it again`)}))()}setEndOfStream(){const{sourceBuffer:e,mediaSource:t}=this;e&&"ended"!==t.readyState&&(e.updating||"open"!==t.readyState?gi.error("Could not end of stream (updating, readyState)",e.updating,t.readyState):(gi.debug("mediaSource.endOfStream"),t.endOfStream(),this.isFullyBuffered=!0))}removeToTime(e){gi.debug("removing to time",e),e>0&&(this.isTimeBuffered(e)||this.isOverBufferLimit)&&this.safeSourceBufferRemove(0,e)}safeSourceBufferRemove(e,t){const{sourceBuffer:r}=this;r&&(r.updating?this.deferredRemoves.push({start:e,end:t}):r.remove(e,t))}get previousOffset(){var e,t;return(null===(e=this.playbackTimeline)||void 0===e||null===(t=e.previous)||void 0===t?void 0:t.endTime)||0}get manifest(){var e;return null===(e=this.playbackTimeline.current)||void 0===e?void 0:e.manifest}checkSeekBuffered(){const{seekResolver:e,currentTimestampOffset:t}=this;if(!e)return;const{time:r}=e,n=r+t,i=this.isTimeBuffered(n);gi.debug("resolving seek for time, adjustedTime, isBuffered",r,n,i),this.printBufferTimes(),i&&(gi.debug("resolving seek to true for time:",n),this.element.currentTime=n,this.resolveSeekPromise(!0))}resolveSeekPromise(e){this.seekResolver&&(this.seekResolver.resolve(e),this.seekResolver=void 0)}get endOfBufferTime(){var e;const t=null===(e=this.sourceBuffer)||void 0===e?void 0:e.buffered;return!(!t||!t.length)&&t.end(t.length-1)}isTimeBuffered(e){var t;const r=null===(t=this.sourceBuffer)||void 0===t?void 0:t.buffered;if(!r)return!1;for(let n=0;n<r.length;n++)if(gi.debug("isTimeBuffered",r.start(n),e,r.end(n)),e>=r.start(n)&&e<=r.end(n))return!0;return!1}clearBufferToEnd(e){const{sourceBuffer:t}=this;if(!t||!t.buffered)return;const r=t.buffered.end(t.buffered.length-1);this.safeSourceBufferRemove(e,r)}clearBuffer(){const{sourceBuffer:e}=this;if(!e||!e.buffered)return;const t=e.buffered;for(let r=0;r<t.length;r++)this.safeSourceBufferRemove(t.start(r),t.end(r))}get bufferTimesString(){var e;const t=null===(e=this.sourceBuffer)||void 0===e?void 0:e.buffered;if(!t)return"";const r=[];for(let n=0;n<t.length;n++)r.push(`start ${t.start(n)} end: ${t.end(n)}`);return r.join(",")}printBufferTimes(){vi&&gi.debug("buffer times",this.bufferTimesString)}getSegmentForTime(e){return Math.floor(e/10)+1}kickstartBuffer(){const{hasKickstarted:e,element:t,clip:r}=this,{buffered:n}=t;e||(this.manifest.mediaItem.isSong?r&&this.isTimeBuffered(r.start)&&(t.currentTime=r.start,this.hasKickstarted=!0):n.length&&(t.currentTime=n.start(0),this.hasKickstarted=!0))}printInfo(){var e,t;const{playbackTimeline:r}=this;gi.info("---- Buffer Info ----"),gi.info("currently buffering item",r.current.manifest.mediaItem.title),gi.info("next item to buffer",null===(e=r.next)||void 0===e?void 0:e.manifest.mediaItem.title),gi.info("previously buffered item",null===(t=r.previous)||void 0===t?void 0:t.manifest.mediaItem.title),gi.info("currentTimestampOffset",this.currentTimestampOffset),gi.info("currentTime",this.currentTime),gi.info("duration",this.duration),gi.info("nextSeamlessTransition",this.nextSeamlessTransition),gi.info("timestampOffsetAdjustment",this.timestampOffsetAdjustment),gi.info("buffered times",this.bufferTimesString),gi.info("isAtEndOfStream",this.isAtEndOfStream),gi.info("isFullyBuffered",this.isFullyBuffered),gi.info("segmentIndexToFetch",this.segmentIndexToFetch),gi.info("segments.length",this.segments.length),gi.info("---- End Buffer Info ----")}constructor({dispatcher:e,element:t,manifest:r,currentTime:n,duration:i,clip:a}){this.firstSegmentLoadPromise=Promise.resolve(),this.hasKickstarted=!1,this.segmentIndexToFetch=-1,this.timeToTrim=10,this.isAtEndOfStream=!1,this.isFullyBuffered=!1,this.deferredRemoves=[],this.currentTimestampOffset=0,this.dispatcher=e,this.clip=a,this.element=t,this.mediaSource=new MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.segmentProcessor=new SegmentProcessor(r.mediaItem,t,e),this.playbackTimeline={current:{manifest:r}},r.addEventListener(bi,this.onManifestParsed),this._currentTime=n||0,this.duration=i,window.mseBuffer=this}}function asyncGeneratorStep$V(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$V(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$V(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$V(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}fi([Bind(),mi("design:type",Function),mi("design:paramtypes",[])],MseBuffer.prototype,"onSourceOpen",null),fi([Bind(),mi("design:type",Function),mi("design:paramtypes",[])],MseBuffer.prototype,"onManifestParsed",null),fi([Bind(),mi("design:type",Function),mi("design:paramtypes",[])],MseBuffer.prototype,"updateEndHandler",null);var _i={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Si={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const{mediaPlaybackError:Ti}=Qt;class AudioPlayer extends BasePlayer{get currentPlayingDate(){}get isPlayingAtLiveEdge(){return!1}get seekableTimeRanges(){return this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}get supportsPreviewImages(){return!1}get _targetElement(){return this.audio}initializeExtension(){var e=this;return _asyncToGenerator$V((function*(){e.extension=new MediaExtension(e.audio,xt),yield e.extension.initializeKeySystem(),e.extension.addEventListener(jt.playbackLicenseError,t=>{e.resetDeferredPlay(),e._dispatcher.publish(Ti,t)}),e.extension.addEventListener(jt.playbackSessionError,t=>{e._dispatcher.publish(Ti,new MKError(MKError.MEDIA_SESSION,t))})}))()}initializeMediaElement(){var e=this;return _asyncToGenerator$V((function*(){const t=function(){let e=$t.pop();return e?Ot.debug(`dom-helpers: retrieving audio tag, ${$t.length} remain`):(Ot.debug("dom-helpers: no available audio tags, creating one"),e=document.createElement("audio")),e}();t.autoplay=!1,t.id="apple-music-player",t.controls=!1,t.muted=!1,t.playbackRate=1,t.preload="metadata",t.volume=1,e.audio=t,document.body.appendChild(t),Ot.debug("initializedMediaElement",t)}))()}removeEventHandlers(){this._targetElement.removeEventListener("timeupdate",this.onTimeUpdate),this._targetElement.removeEventListener("timeupdate",this.delayedCdmUpdateCheck),super.removeEventHandlers()}isPlayerSupported(){return!0}_stopMediaElement(){var e=this,_superprop_get__stopMediaElement=()=>super._stopMediaElement;return _asyncToGenerator$V((function*(){var t;yield _superprop_get__stopMediaElement().call(e),yield e.tearDownManifests(),null===(t=e._buffer)||void 0===t||t.stop(),e._buffer=void 0}))()}setNextSeamlessItem(e){var t=this;return _asyncToGenerator$V((function*(){const{extension:r,nextManifest:n}=t,i=t._buffer;if(!i||!r)return;if((null==n?void 0:n.mediaItem.id)===e.id)return void Ot.debug("already have next manifest for ",e.title);t._targetElement.removeEventListener("timeupdate",t.onTimeUpdate),t._targetElement.addEventListener("timeupdate",t.onTimeUpdate),Ot.debug("player preparing next manifest for",e.title);const a=yield t.loadAndParseManifest(e,!1);i.setNextManifest(a),r.setMediaItem(e),r.extURI=a.extURI,t.nextManifest=a}))()}playItemFromEncryptedSource(t,r=!1,n){var i=this;return _asyncToGenerator$V((function*(){const a=i._paused&&!r;Ot.debug("playItemFromEncryptedSource",t.title);const o=a?void 0:i.startPlaybackSequence();if(t.playRawAssetURL)return t.playbackType=e.PlaybackType.unencryptedFull,i.nowPlayingItem=t,yield i._playAssetURL(t.assetURL,a),i.finishPlaybackSequence();const{extension:s}=i;if(!s)return o;s.initiated=r,s.setMediaItem(t),t.playbackType=e.PlaybackType.encryptedFull,i.nowPlayingItem=t,t.state=P.loading;const c=yield i.getManifestForItem(t);i.manifest=c;const l=shouldForceAudioMse();if((t.isSong||s.isFairplay&&l)&&(s.extURI=c.extURI),t.state=P.ready,s.isFairplay&&!l){let e=t.assetURL;(null==n?void 0:n.startTime)&&(e+="#t="+n.startTime),yield i._playAssetURL(e,a)}else{const e=i._buffer;e&&i.isSeamlessAudioTransitionsEnabled&&e.isItemPlaying(c.mediaItem)?Ot.debug("already have buffer, continuing playback"):yield i.beginNewBufferForItem(a,c,n)}return i.finishPlaybackSequence()}))()}getManifestForItem(e){var t=this;return _asyncToGenerator$V((function*(){var r,n;Ot.debug("reconciling item to play against playing item");const{nextManifest:i,manifest:a,isSeamlessAudioTransitionsEnabled:o}=t,s=t._buffer;if(!s||!a)return Ot.debug("no buffer or manifest, creating manifest [title, buffer, manifest]",e.title,!!s,!!a),t.loadAndParseManifest(e);if(!o)return Ot.debug("seamless transitions disabled, stopping and creating manifest for",e.title),yield t.tearDownManifests(),t.loadAndParseManifest(e);const c=!s.isItemPlaying(e);let l;return Ot.debug("itemMismatch",c),i&&!c?(Ot.debug(`replacing manifest for ${a.mediaItem.title} with next manifest ${i.mediaItem.title}`),l=i,t.nextManifest=void 0,Ot.debug("cease listening for keys on manifest for",a.mediaItem.title),yield t.tearDownManifest(a)):c?(null==i?void 0:i.mediaItem.id)!==e.id?(Ot.debug(`item to play ${e.title} does not match playing or next items, tearing down all manifests`),yield t.tearDownManifests(),l=yield t.loadAndParseManifest(e)):(Ot.debug(`item to play ${e.title} matches next item, tearing down current manifest`),yield t.tearDownManifest(a),l=i):(Ot.debug("item is already playing, returning existing manifest"),l=a),Ot.debug("getManifestForItem loading keys for",a.mediaItem.title),null===(r=t.extension)||void 0===r||null===(n=r.session)||void 0===n||n.loadKeys(l.keyValues,l.mediaItem),l}))()}seekToTime(e){var t=this;return _asyncToGenerator$V((function*(){const r=t._buffer;if(r){Ot.debug("audio-player: buffer seek to",e);if(!(yield r.seek(e)))return;t.isSeamlessAudioTransitionsEnabled&&t.onTimeUpdate()}else Ot.debug("audio-player: media element seek to",e),t._targetElement.currentTime=e}))()}tearDownManifests(){var e=this;return _asyncToGenerator$V((function*(){e.manifest=yield e.tearDownManifest(e.manifest),e.nextManifest=yield e.tearDownManifest(e.nextManifest)}))()}tearDownManifest(e){var t=this;return _asyncToGenerator$V((function*(){const{extension:r}=t;e&&(Ot.debug("tearing down manifest for",e.mediaItem.title),e.stop(),r&&(yield r.clearSessions(e.keyValues)),e.removeEventListener(ei.keysParsed,t.loadKeysHandler))}))()}loadAndParseManifest(e,t=!0){var r=this;return _asyncToGenerator$V((function*(){Ot.debug(`will load and parse manifest for ${e.title}, loadKeys ${t}`);const n=yield Manifest.load(e,!1);return t&&n.addEventListener(ei.keysParsed,r.loadKeysHandler),n.parse(),n}))()}onTimeUpdate(){if(!this._buffer)return;const{currentPlaybackTimeRemaining:e,nextManifest:t,delaySeamlessCdmUpdates:r}=this;if(t&&e<15){var n,i,a,o;if(Ot.debug("player loading keys for",t.mediaItem.title,r),r)null===(n=this.extension)||void 0===n||null===(i=n.session)||void 0===i||i.loadKeys(t.keyValues,t.mediaItem,{delayCdmUpdate:!0}),this._targetElement.addEventListener("timeupdate",this.delayedCdmUpdateCheck);else null===(a=this.extension)||void 0===a||null===(o=a.session)||void 0===o||o.loadKeys(t.keyValues,t.mediaItem);this._targetElement.removeEventListener("timeupdate",this.onTimeUpdate)}}delayedCdmUpdateCheck(){var e;const t=null===(e=this.nowPlayingItem)||void 0===e?void 0:e.playbackDuration,r=t?t/1e3:this.currentPlaybackDuration,n=this._currentTime,i=Number((r-n).toFixed(3));if(i<1){const e=1e3*i;Ot.debug("delayed CDM update in ",e),setTimeout(()=>{var e,t;Ot.debug("applying delayed CDM update"),null===(e=this.extension)||void 0===e||null===(t=e.session)||void 0===t||t.applyDelayedCdmUpdates()},e),this._targetElement.removeEventListener("timeupdate",this.delayedCdmUpdateCheck)}}loadKeysHandler(e){var t,r;null===(t=this.extension)||void 0===t||null===(r=t.session)||void 0===r||r.loadKeys(e.keys,e.item)}beginNewBufferForItem(e,t,r){var n=this;return _asyncToGenerator$V((function*(){if(Ot.debug("creating new MseBuffer for item",t.mediaItem.title,e),n._buffer&&(Ot.debug("stopping old buffer"),n._buffer.stop()),n._buffer=new MseBuffer({dispatcher:n._dispatcher,element:n._targetElement,duration:t.mediaItem.playbackDuration/1e3,manifest:t}),yield n._playAssetURL(n._buffer.playableUrl,!0),!e){let e=Promise.resolve();return(null==r?void 0:r.startTime)&&(e=n.seekToTime(r.startTime)),e.then(()=>n._playMedia())}}))()}setPresentationMode(e){return _asyncToGenerator$V((function*(){return Promise.resolve()}))()}loadPreviewImage(e){return _asyncToGenerator$V((function*(){}))()}constructor(e){var t,r;super(e),this.currentAudioTrack=void 0,this.currentTextTrack=void 0,this.textTracks=[],this.audioTracks=[],this.isSeamlessAudioTransitionsEnabled=!1,this.delaySeamlessCdmUpdates=!1,this.mediaPlayerType="audio";const n=null!==(r=null===(t=e.bag)||void 0===t?void 0:t.features)&&void 0!==r?r:{};this.isSeamlessAudioTransitionsEnabled=!!n["seamless-audio-transitions"],this.delaySeamlessCdmUpdates=!!n["delay-seamless-cdm-updates"],window.audioPlayer=this}}function asyncGeneratorStep$U(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$U(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$U(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$U(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}_i([AsyncDebounce(250),Si("design:type",Function),Si("design:paramtypes",[Number])],AudioPlayer.prototype,"seekToTime",null),_i([Bind(),Si("design:type",Function),Si("design:paramtypes",[])],AudioPlayer.prototype,"onTimeUpdate",null),_i([Bind(),Si("design:type",Function),Si("design:paramtypes",[])],AudioPlayer.prototype,"delayedCdmUpdateCheck",null),_i([Bind(),Si("design:type",Function),Si("design:paramtypes",[void 0])],AudioPlayer.prototype,"loadKeysHandler",null);class EncryptedSession extends KeySession{attachMedia(e,t){var r=this;return _asyncToGenerator$U((function*(){r.keySystem=t.keySystem,r._keySystemAccess=t,e.addEventListener("encrypted",r.boundHandleSessionCreation,!1)}))()}detachMedia(e){e.removeEventListener("encrypted",this.boundHandleSessionCreation)}createSession(e){var t=this;return _asyncToGenerator$U((function*(){Ot.debug("Encrypted createSession",e);const r=t._keySystemAccess;if(!r)return;const{initData:n,initDataType:i,target:a}=e;var o;return t._mediaKeysPromise||(t._mediaKeysPromise=new Promise((o=_asyncToGenerator$U((function*(e,n){const i=yield r.createMediaKeys();try{yield a.setMediaKeys(i)}catch(Tt){t.dispatchKeyError(Tt),n(Tt)}const o=yield t.loadCertificateBuffer();yield i.setServerCertificate(o),t._mediaKeysServerCertificate=o,e(i)})),function(e,t){return o.apply(this,arguments)}))),yield t._mediaKeysPromise,t._mediaKeysServerCertificate?t._createSession(a,n,i):void 0}))()}generatePSSH(e){const t=new Uint8Array([0,0,0,52,112,115,115,104,0,0,0,0,237,239,139,169,121,214,74,206,163,200,39,220,213,29,33,237,0,0,0,20,8,1,18,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),r=s(e);for(let n=0;n<r.length;n++)t[t.length-16+n]=r[n];return Ot.debug("generatePSSH",t),t}_createSession(e,t,r){const n=e.mediaKeys.createSession(),{item:i}=this;if(!i)return;this._teardownCurrentSession(),Ot.debug("creating media key session",n);let a;if(this.isWidevine&&i.isSong)a=this.generatePSSH(this.extID);else{const e=function(e){const t=[],r=new DataView(e.buffer);for(let n=0;n<e.length;){const i=r.getUint32(n);t.push(new PsshBox(e,n,n+i)),n+=i}return t}(new Uint8Array(t)).find(e=>e.isWidevine),r=null==e?void 0:e.rawBytes,i=u(r);Ot.debug("extracted uri",i),n.extURI=i,a=t}return n.addEventListener("message",this.startLicenseSession),this._currentSession=n,n.generateRequest(r,a).catch(e=>{if(e.message.match(/generateRequest.*\(75\)/))return n.generateRequest(r,a);throw e})}_teardownCurrentSession(){this._currentSession&&(Ot.debug("tearing down media key session",this._currentSession),this._currentSession.removeEventListener("message",this.startLicenseSession),this._currentSession=void 0)}applyDelayedCdmUpdates(){}loadKeys(e,t,r){return _asyncToGenerator$U((function*(){}))()}clearSessions(){return _asyncToGenerator$U((function*(){}))()}}function asyncGeneratorStep$T(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$T(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$T(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$T(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}class MediaExtensionStub extends Notifications{destroy(e){}setMediaItem(e){}initializeKeySystem(){var e=this;return _asyncToGenerator$T((function*(){e.session=new EncryptedSession}))()}clearSessions(){return _asyncToGenerator$T((function*(){}))()}constructor(e){super(e),this.audioTracks=[],this.textTracks=[],this.extURI="",this.hasMediaKeySupport=!0,this.initiated=!0,this.isFairplay=!0,this.hasMediaKeySupport=!0,this.hasMediaSession=!0}}function asyncGeneratorStep$S(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$S(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$S(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$S(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}class PlayerStub{get hasMediaElement(){return!0}get isEngagedInPlayback(){return!this.paused}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._dispatcher.publish(Qt.playbackRateDidChange,new Event("ratechange"))}get volume(){return this._volume}set volume(e){this._volume=e,this._dispatcher.publish(Qt.playbackVolumeDidChange,new Event("volumeChange"))}destroy(){}dispatch(){}exitFullscreen(){return _asyncToGenerator$S((function*(){}))()}loadPreviewImage(e){return _asyncToGenerator$S((function*(){}))()}initialize(){return _asyncToGenerator$S((function*(){}))()}isPaused(){return this.paused}calculateTime(e){return e}clearNextManifest(){}mute(){}newSeeker(){return new PlayerSeeker(this)}pause(e){return _asyncToGenerator$S((function*(){}))()}play(){return _asyncToGenerator$S((function*(){}))()}playItemFromEncryptedSource(e,t,r){return _asyncToGenerator$S((function*(){}))()}playItemFromUnencryptedSource(e,t,r){return _asyncToGenerator$S((function*(){}))()}preload(){return _asyncToGenerator$S((function*(){}))()}prepareToPlay(e,t,r){return _asyncToGenerator$S((function*(){}))()}seekToTime(e){return _asyncToGenerator$S((function*(){}))()}requestFullscreen(){return _asyncToGenerator$S((function*(){}))()}setPlaybackState(e,t){}setPresentationMode(e){return _asyncToGenerator$S((function*(){}))()}showPlaybackTargetPicker(){}stop(e){return _asyncToGenerator$S((function*(){}))()}stopMediaAndCleanup(){return _asyncToGenerator$S((function*(){}))()}supportsPictureInPicture(){return!1}tsidChanged(){}setNextSeamlessItem(e){return _asyncToGenerator$S((function*(){}))()}constructor(t){this.bitrate=e.PlaybackBitrate.STANDARD,this.audioTracks=[],this.currentBufferedProgress=0,this.currentPlaybackDuration=0,this.currentPlaybackProgress=0,this.currentPlaybackTime=0,this.currentPlaybackTimeRemaining=0,this.currentPlayingDate=void 0,this.isPlayingAtLiveEdge=!1,this.isPlaying=!1,this.isPrimaryPlayer=!0,this.isReady=!1,this.paused=!1,this.playbackState=e.PlaybackStates.none,this.playbackTargetAvailable=!1,this.playbackTargetIsWireless=!1,this.previewOnly=!1,this.supportsPreviewImages=!1,this.textTracks=[],this.extension=new MediaExtensionStub([]),this.hasAuthorization=!0,this.isDestroyed=!1,this._volume=1,this._playbackRate=1,this._dispatcher=t.services.dispatcher,this.windowHandlers=new WindowHandlers(this)}}e.version="2.2320.5";const Pi=e.version.split("."),Ei=Pi[0],ki=Pi[Pi.length-1];var wi;Pi[0]="3",Pi[Pi.length-1]=ki+"-prerelease",Pi[0]=Ei,Pi[Pi.length-1]=ki,e.version=Pi.join("."),function(e){e.REPEAT="REPEAT",e.SHUFFLE="SHUFFLE",e.AUTOPLAY="AUTOPLAY"}(wi||(wi={}));const Ii={configured:"musickitconfigured",loaded:"musickitloaded",audioTrackAdded:Qt.audioTrackAdded,audioTrackChanged:Qt.audioTrackChanged,audioTrackRemoved:Qt.audioTrackRemoved,authorizationStatusDidChange:le.authorizationStatusDidChange,authorizationStatusWillChange:le.authorizationStatusWillChange,bufferedProgressDidChange:Qt.bufferedProgressDidChange,capabilitiesChanged:"capabilitiesChanged",autoplayEnabledDidChange:"autoplayEnabledDidChange",drmUnsupported:Qt.drmUnsupported,eligibleForSubscribeView:le.eligibleForSubscribeView,forcedTextTrackChanged:Qt.forcedTextTrackChanged,mediaCanPlay:Qt.mediaCanPlay,mediaElementCreated:Qt.mediaElementCreated,mediaItemStateDidChange:ht.mediaItemStateDidChange,mediaItemStateWillChange:ht.mediaItemStateWillChange,mediaPlaybackError:Qt.mediaPlaybackError,mediaSkipAvailable:"mediaSkipAvailable",mediaRollEntered:"mediaRollEntered",mediaUpNext:"mediaUpNext",metadataDidChange:Qt.metadataDidChange,needsGDPRDidChange:"needsGDPRDidChange",nowPlayingItemDidChange:Qt.nowPlayingItemDidChange,nowPlayingItemWillChange:Qt.nowPlayingItemWillChange,playbackBitrateDidChange:Qt.playbackBitrateDidChange,playbackDurationDidChange:Qt.playbackDurationDidChange,playbackProgressDidChange:Qt.playbackProgressDidChange,playbackRateDidChange:Qt.playbackRateDidChange,playbackStateDidChange:Qt.playbackStateDidChange,playbackStateWillChange:Qt.playbackStateWillChange,playbackTargetAvailableDidChange:Qt.playbackTargetAvailableDidChange,playbackTargetIsWirelessDidChange:Qt.playbackTargetIsWirelessDidChange,playbackTimeDidChange:Qt.playbackTimeDidChange,playbackVolumeDidChange:Qt.playbackVolumeDidChange,playerTypeDidChange:Qt.playerTypeDidChange,presentationModeDidChange:Qt.presentationModeDidChange,primaryPlayerDidChange:Qt.primaryPlayerDidChange,queueIsReady:"queueIsReady",queueItemsDidChange:"queueItemsDidChange",queueItemForStartPosition:"queueItemForStartPosition",queuePositionDidChange:"queuePositionDidChange",shuffleModeDidChange:"shuffleModeDidChange",repeatModeDidChange:"repeatModeDidChange",storefrontCountryCodeDidChange:le.storefrontCountryCodeDidChange,storefrontIdentifierDidChange:le.storefrontIdentifierDidChange,textTrackAdded:Qt.textTrackAdded,textTrackChanged:Qt.textTrackChanged,textTrackRemoved:Qt.textTrackRemoved,timedMetadataDidChange:Qt.timedMetadataDidChange,userTokenDidChange:le.userTokenDidChange,webComponentsLoaded:"musickitwebcomponentsloaded"};function parseSkipItems(e){const t=parseInt(e.hlsMetadata["skip.count"],10),r=[];if(isNaN(t)||0===t)return r;for(let n=0;n<t;n++)r.push({start:parseFloat(e.hlsMetadata[`skip.${n}.start`]),duration:parseFloat(e.hlsMetadata[`skip.${n}.duration`]),target:parseFloat(e.hlsMetadata[`skip.${n}.target`]),label:e.hlsMetadata[`skip.${n}.label`]});return r}function parseRollItems(e,t=["pre-roll","mid-roll","post-roll"]){if(void 0===e.hlsMetadata)return[];const r=[];return t.forEach(t=>{const n=parseInt(e.hlsMetadata[t+".count"],10);if(!isNaN(n))for(let i=0;i<n;i++){const n=`${t}.${i}`,a={index:i,type:t,skippable:"true"===e.hlsMetadata[n+".skippable"],"adam-id":e.hlsMetadata[n+".adam-id"],start:Math.round(parseFloat(e.hlsMetadata[n+".start"])),duration:Math.round(parseFloat(e.hlsMetadata[n+".duration"]))},o=n+".dynamic-slot.data-set-id";void 0!==e.hlsMetadata[o]&&(a["dynamic-id"]=e.hlsMetadata[o]),r.push(a)}}),r}const addRollItemDuration=(e,t)=>e+t.duration;function asyncGeneratorStep$R(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}var Oi={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ai={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class SpanWatcher{startMonitor(){this.dispatcher.unsubscribe(Ii.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(Ii.playbackTimeDidChange,this.handleTimeChange)}stopMonitor(){this.dispatcher.unsubscribe(Ii.playbackTimeDidChange,this.handleTimeChange)}handleTimeChange(e,{currentPlaybackTime:t}){var r,n=this;return(r=function*(){!Number.isFinite(t)||t<n.start||t>n.stop?n.inWatchSpan=!1:n.inWatchSpan||(n.allowMultiple||n.stopMonitor(),n.inWatchSpan=!0,yield n.callback(t,n))},function(){var e=this,t=arguments;return new Promise((function(n,i){var a=r.apply(e,t);function _next(e){asyncGeneratorStep$R(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$R(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}constructor(e,t,r,n,i=!1){this.dispatcher=e,this.callback=t,this.start=r,this.stop=n,this.allowMultiple=i,this.inWatchSpan=!1}}Oi([Bind(),Ai("design:type",Function),Ai("design:paramtypes",[void 0,void 0])],SpanWatcher.prototype,"handleTimeChange",null);var Ri={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ci={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class PlaybackMonitor{activate(){this.isActive=!0,this.startMonitor()}deactivate(){this.isActive=!1,this.clearMonitor()}clearMonitor(){this.isMonitoring&&(this.watchers.forEach(e=>e.stopMonitor()),this.isMonitoring=!1)}shouldMonitor(){return this.isActive}startMonitor(){this.shouldMonitor()&&(this.watchers.forEach(e=>e.startMonitor()),this.isMonitoring=!0)}handleMediaItemChange(){this.isActive&&(this.clearMonitor(),this.shouldMonitor()&&this.startMonitor())}constructor(e){this.isActive=!1,this.isMonitoring=!1,this.watchers=[],this.handlePlaybackThreshold=this.handlePlaybackThreshold.bind(this),this.playbackController=e.controller,this.dispatcher=e.services.dispatcher,this.dispatcher.subscribe(Ii.nowPlayingItemDidChange,this.handleMediaItemChange),this.apiManager=e.services.apiManager}}function asyncGeneratorStep$Q(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}Ri([Bind(),Ci("design:type",Function),Ci("design:paramtypes",[])],PlaybackMonitor.prototype,"handleMediaItemChange",null);class RollMonitor extends PlaybackMonitor{handlePlaybackThreshold(e,t){var r,n=this;return(r=function*(){if(!n.rollMap.has(t))return;const e=n.rollMap.get(t);n.dispatcher.publish(Ii.mediaRollEntered,e),n.rollMap.delete(t)},function(){var e=this,t=arguments;return new Promise((function(n,i){var a=r.apply(e,t);function _next(e){asyncGeneratorStep$Q(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$Q(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;return this.getRollMetadata().length>0}startMonitor(){this.setupWatchers(this.getRollMetadata()),super.startMonitor()}getRollMetadata(){const e=this.playbackController.nowPlayingItem;return void 0===e?[]:parseRollItems(e,["pre-roll","post-roll"])}setupWatchers(e){const t=[];e.forEach(e=>{const{start:r,duration:n}=e,i=new SpanWatcher(this.dispatcher,this.handlePlaybackThreshold,r,r+n);t.push(i),this.rollMap.set(i,e)}),this.watchers=t}constructor(e){super(e),this.rollMap=new Map}}function asyncGeneratorStep$P(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}class SkipAvailable extends PlaybackMonitor{handlePlaybackThreshold(e,t){var r,n=this;return(r=function*(){if(!n.skipMap.has(t))return;const e=n.skipMap.get(t);n.dispatcher.publish(Ii.mediaSkipAvailable,e),n.skipMap.delete(t)},function(){var e=this,t=arguments;return new Promise((function(n,i){var a=r.apply(e,t);function _next(e){asyncGeneratorStep$P(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$P(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))})()}shouldMonitor(){if(!super.shouldMonitor())return!1;return this.getNowPlayingMetadata().length>0}startMonitor(){this.setupWatchers(this.getNowPlayingMetadata()),super.startMonitor()}getNowPlayingMetadata(){const e=this.playbackController.nowPlayingItem;return void 0===e?[]:parseSkipItems(e)}setupWatchers(e){const t=[];e.forEach(e=>{const{start:r,duration:n}=e,i=new SpanWatcher(this.dispatcher,this.handlePlaybackThreshold,r,r+n);t.push(i),this.skipMap.set(i,e)}),this.watchers=t}constructor(e){super(e),this.skipMap=new Map}}const Di=BooleanDevFlag.register("mk-send-manifest-headers");function asyncGeneratorStep$O(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$O(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$O(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$O(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const Mi=["https://play.itunes.apple.com/","https://linear.tv.apple.com/","https://play-edge.itunes.apple.com"];const xi=new class{fetchManifest(e){var t=this;return _asyncToGenerator$O((function*(){return Ot.info("fetching manifest at",e),shouldLoadManifestOnce()?t.fetchForCache(e):t.fetchOnly(e)}))()}getManifest(e){return this.cache.get(e)}clear(e){e?this.cache.delete(e):this.cache.clear()}fetchForCache(e){var t=this;return _asyncToGenerator$O((function*(){const r=function(e){const t={};Mi.some(t=>e.startsWith(t))&&Nn.musicUserToken&&Di.configured&&Di.enabled&&(t["media-user-token"]=Nn.musicUserToken,t.Authorization="Bearer "+Nn.developerToken);return t}(e),n=yield t.fetch(e,{headers:new Headers(r)});let i=yield n.text();var a;i=((e,t)=>{Ot.info("converting manifest URIs to absolute paths");const r=new URL(e);let n=t.replace(/URI="([^"]*)"/g,(function(e,t){return`URI="${new URL(t,r).href}"`}));return n=n.replace(/^(#EXT-X-STREAM-INF:[^\n]*\n)(.*$)/gim,(function(e,t,n){return`${t}${new URL(n,r).href}`})),n})(e,i);const o={url:e,content:i,contentType:null!==(a=n.headers.get("content-type"))&&void 0!==a?a:void 0};return t.cache.set(e,o),o}))()}fetchOnly(e){var t=this;return _asyncToGenerator$O((function*(){const r=yield t.fetch(e),n=yield r.text();var i;return{url:e,content:n,contentType:null!==(i=r.headers.get("content-type"))&&void 0!==i?i:void 0}}))()}constructor(e={}){var t,r;this.fetch=null!==(t=e.fetch)&&void 0!==t?t:fetch.bind(globalThis),this.cache=null!==(r=e.cache)&&void 0!==r?r:new Map}},Li=new Logger$1("services");function asyncGeneratorStep$N(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _defineProperty$A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const getContentCompletionThreshold=e=>Math.min(Math.round(getUpNextStart(e)),Math.round(getWatchedTime(e))),hasContentCompletionThresholdData=e=>!isNaN(getUpNextStart(e))&&!isNaN(getWatchedTime(e)),getUpNextStart=e=>parseFloat(e.hlsMetadata["up-next.start"]),getWatchedTime=e=>parseFloat(e.hlsMetadata["watched.time"]),Ni=($i=function*(e,t){if(e.isUTS&&e.assetURL)try{const r=generateAssetUrl(e,t),n=yield xi.fetchManifest(r);e.hlsMetadata=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$A(e,t,r[t])}))}return e}({},e.hlsMetadata,function(e,t={}){const r=/^(?:#EXT-X-SESSION-DATA:?)DATA-ID="([^"]+)".+VALUE="([^"]+)".*$/,n={};for(const i of e.split("\n")){const e=i.match(r);if(e){let r=e[1];e[1].startsWith("com.apple.hls.")&&!1!==t.stripPrefix&&(r=e[1].slice("com.apple.hls.".length));const i=e[2];n[r]=i}}return n}(n.content))}catch(Tt){Li.error(Tt.message,Tt)}},ji=function(){var e=this,t=arguments;return new Promise((function(r,n){var i=$i.apply(e,t);function _next(e){asyncGeneratorStep$N(i,r,n,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$N(i,r,n,_next,_throw,"throw",e)}_next(void 0)}))},function(e,t){return ji.apply(this,arguments)});var $i,ji;function asyncGeneratorStep$M(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}var Ui={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Gi={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class UpNextMonitor extends PlaybackMonitor{handlePlaybackThreshold(){var e=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$M(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$M(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){e.dispatcher.publish(Ii.mediaUpNext)}))()}shouldMonitor(){if(!super.shouldMonitor())return!1;const e=this.playbackController.nowPlayingItem;return void 0!==e&&hasContentCompletionThresholdData(e)}startMonitor(){this.setupWatchers(),super.startMonitor()}setupWatchers(){const e=this.playbackController.nowPlayingItem;e&&hasContentCompletionThresholdData(e)&&(this.watchers=[new SpanWatcher(this.dispatcher,this.handlePlaybackThreshold,Math.round(this.getStartTime(e)),Number.POSITIVE_INFINITY)])}getStartTime(e){const t=getUpNextStart(e);return isNaN(t)?getWatchedTime(e):t}constructor(e){super(e)}}Ui([Bind(),Gi("design:type",Function),Gi("design:paramtypes",[])],UpNextMonitor.prototype,"handlePlaybackThreshold",null);const Fi=getHlsJsCdnConfig(),Bi={app:{},autoplay:{maxQueueSizeForAutoplay:50,maxQueueSizeInRequest:10,maxUpcomingTracksToMaintain:10},features:{xtrick:!0,isWeb:!0,bookmarking:!1,"seamless-audio-transitions":!0,"enhanced-hls":!1},urls:{hls:Fi.hls,rtc:Fi.rtc,mediaApi:"https://amp-api.music.apple.com/v1",webPlayback:`https://${getCommerceHostname("play")}/WebObjects/MZPlay.woa/wa/webPlayback`}},Ki=JsonDevFlag.register("mk-offers-key-urls").get();function asyncGeneratorStep$L(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$L(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$L(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$L(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$z(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpreadProps$n(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}let Vi;Ki&&(Bi.urls.hlsOffersKeyUrls=Ki);class Store{get authorizationStatus(){return this.storekit.authorizationStatus}get cid(){return this.storekit.cid}get developerToken(){return this.storekit.developerToken}get hasAuthorized(){return this._hasAuthorized}get isAuthorized(){return this.storekit.hasAuthorized}get isRestricted(){return this.storekit.authorizationStatus===ne.RESTRICTED}get metricsClientId(){return this._metricsClientId}set metricsClientId(e){this._metricsClientId=e}get musicUserToken(){return this.storekit.userToken}set musicUserToken(e){this.storekit.userToken=e}updateUserTokenFromStorage(){return this.storekit.updateUserTokenFromStorage()}set dynamicMusicUserToken(e){this.storekit.dynamicUserToken=e}get needsGDPR(){Li.error("needsGDPR has been deprecated. Plesae migrate to shouldDisplayPrivacyLink()")}get realm(){return this.storekit.realm}set requestUserToken(e){this._providedRequestUserToken=!0,this.storekit.requestUserToken=e}get restrictedEnabled(){return this.storekit.restrictedEnabled}set restrictedEnabled(e){this.storekit.overrideRestrictEnabled(e)}get storefrontCountryCode(){var e;return this.isAuthorized?this.storekit.storefrontCountryCode:null!==(e=this._defaultStorefrontCountryCode)&&void 0!==e?e:this.storekit.storefrontCountryCode}get storefrontId(){return this._apiStorefrontId||this.storekit.storefrontCountryCode}set storefrontId(e){e&&(e=e.toLowerCase()),e!==this._apiStorefrontId&&(this._apiStorefrontId=e,this._dispatcher.publish(zt.apiStorefrontChanged,{storefrontId:e}))}get subscribeURL(){return this.storekit.deeplinkURL({p:"subscribe"})}get subscribeFamilyURL(){return this.storekit.deeplinkURL({p:"subscribe-family"})}get subscribeIndividualURL(){return this.storekit.deeplinkURL({p:"subscribe-individual"})}get subscribeStudentURL(){return this.storekit.deeplinkURL({p:"subscribe-student"})}get userToken(){return this.musicUserToken}authorize(){var e=this;return _asyncToGenerator$L((function*(){if(e.storekit.userTokenIsValid)return e.storekit.userToken;let t;try{t=yield e.storekit.requestUserToken()}catch(Tt){try{yield e.unauthorize()}catch(r){}throw new MKError(MKError.AUTHORIZATION_ERROR,"Unauthorized")}return e._providedRequestUserToken&&(e.storekit.userToken=t),e.storekit.userTokenIsValid?(yield e.storekit.requestStorefrontCountryCode().catch(function(){var t=_asyncToGenerator$L((function*(t){return yield e.unauthorize(),Promise.reject(t)}));return function(e){return t.apply(this,arguments)}}()),t):void 0}))()}shouldDisplayPrivacyLink(e){var t=this;return _asyncToGenerator$L((function*(){return t.storekit.shouldDisplayPrivacyLink(e)}))()}unauthorize(){var e=this;return _asyncToGenerator$L((function*(){return e.storekit.revokeUserToken()}))()}validateAgeVerification(t){var r=this;return _asyncToGenerator$L((function*(){var n;if(r.storekit.realm!==e.SKRealm.TV)return;const i=yield r.storekit.me();if(i.info){var a;if(i.info.webAgeVerificationData&&!i.info.webAgeVerificationData.isVerified&&r._ageVerificationRequired(t.type,null!==(a=null===(n=t.defaultPlayable)||void 0===n?void 0:n.rating)&&void 0!==a?a:t.rating)&&!t.isLinearStream)return Promise.reject(new MKError(MKError.AGE_VERIFICATION,"Age verification required"));if(t.rating&&i.info.parentalControlsData&&i.info.parentalControlsData.videoContentRestrictions){const e=t.rating.system.replace(/[^a-z0-9]+/i,"-");if(i.info.parentalControlsData.videoContentRestrictions[e]<t.rating.value)return Promise.reject(new MKError(MKError.CONTENT_RESTRICTED,"Content restricted"))}}}))()}constructor(t,r={}){this._hasAuthorized=!1,this._providedRequestUserToken=!1,this._ageVerificationRequired=(e,t)=>!0,this._dispatcher=r.services.dispatcher,r.precache&&(this.precache=r.precache),r.storefrontId&&(this.storefrontId=r.storefrontId),this._defaultStorefrontCountryCode=r.storefrontCountryCode,(r.affiliateToken||r.campaignToken)&&(r.linkParameters=_objectSpreadProps$n(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$z(e,t,r[t])}))}return e}({},r.linkParameters||{}),{at:r.affiliateToken,ct:r.campaignToken})),r.ageVerificationRequired&&(this._ageVerificationRequired=r.ageVerificationRequired),this.storekit=new StoreKit(t,{apiBase:Bi.urls.mediaApi,authenticateMethod:Bi.features["legacy-authenticate-method"]?"POST":"GET",deeplink:r.linkParameters,disableAuthBridge:r.disableAuthBridge,iconURL:Bi.app.icon,meParameters:r.meParameters,persist:r.persist,realm:r.realm||e.SKRealm.MUSIC,disableLogoutURL:r.disableLogoutURL}),this.storekit.addEventListener(Ii.authorizationStatusDidChange,e=>{const{authorizationStatus:t}=e;this._hasAuthorized=[ne.AUTHORIZED,ne.RESTRICTED].includes(t)})}}function formattedSeconds(e){return{hours:Math.floor(e/3600),minutes:Math.floor(e%3600/60)}}function asyncGeneratorStep$K(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$K(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$K(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$K(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function hasAuthorization(e){return void 0===e&&(e=Vi&&Vi.storekit),void 0!==e&&e.hasAuthorized&&e.userTokenIsValid}function hasMusicSubscription(e){return _hasMusicSubscription.apply(this,arguments)}function _hasMusicSubscription(){return(_hasMusicSubscription=_asyncToGenerator$K((function*(e){return void 0===e&&(e=Vi&&Vi.storekit),e.hasMusicSubscription()}))).apply(this,arguments)}var Hi,Wi={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},qi={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class MediaSessionManager{onCapabilitiesChanged(){this._resetHandlers(),this._setMediaSessionHandlers()}onNowPlayingItemDidChange(e,{item:t}){this._setMediaSessionMetadata(t)}_setMediaSessionMetadata(e){var t,r;this.session&&"MediaMetadata"in window&&e&&(this.session.metadata=new window.MediaMetadata({title:e.title,artist:null!==(r=e.artistName)&&void 0!==r?r:null===(t=e.attributes)||void 0===t?void 0:t.showTitle,album:e.albumName,artwork:e.artwork?[96,128,192,256,384,512].map(t=>({src:formatArtworkURL(e.artwork,t,t),sizes:`${t}x${t}`,type:"image/jpeg"})):[]}))}_setMediaSessionHandlers(){this.session&&(this._resetHandlers(),this.session.setActionHandler("play",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.play()}),this.capabilities.canPause?this.session.setActionHandler("pause",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.pause()}):this.session.setActionHandler("pause",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.stop()}),this.capabilities.canSeek&&(this.session.setActionHandler("seekforward",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.seekForward()}),this.session.setActionHandler("seekbackward",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.seekBackward()})),this.capabilities.canSkipToNextItem&&this.session.setActionHandler("nexttrack",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.skipToNextItem()}),this.capabilities.canSkipToPreviousItem&&this.session.setActionHandler("previoustrack",()=>{var e;return null===(e=this.controller)||void 0===e?void 0:e.skipToPreviousItem()}))}_resetHandlers(){this.session&&(this.session.setActionHandler("play",void 0),this.session.setActionHandler("pause",void 0),this.session.setActionHandler("seekforward",void 0),this.session.setActionHandler("seekbackward",void 0),this.session.setActionHandler("nexttrack",void 0),this.session.setActionHandler("previoustrack",void 0))}constructor(e,t){this.capabilities=e,this.dispatcher=t,this.session=navigator.mediaSession,this.session&&(this.dispatcher.subscribe(Ii.nowPlayingItemDidChange,this.onNowPlayingItemDidChange),this.dispatcher.subscribe(Ii.capabilitiesChanged,this.onCapabilitiesChanged),this._setMediaSessionHandlers())}}Wi([Bind(),qi("design:type",Function),qi("design:paramtypes",[])],MediaSessionManager.prototype,"onCapabilitiesChanged",null),Wi([Bind(),qi("design:type",Function),qi("design:paramtypes",[void 0,void 0])],MediaSessionManager.prototype,"onNowPlayingItemDidChange",null),function(e){e[e.PAUSE=0]="PAUSE",e[e.EDIT_QUEUE=1]="EDIT_QUEUE",e[e.SEEK=2]="SEEK",e[e.REPEAT=3]="REPEAT",e[e.SHUFFLE=4]="SHUFFLE",e[e.SKIP_NEXT=5]="SKIP_NEXT",e[e.SKIP_PREVIOUS=6]="SKIP_PREVIOUS",e[e.SKIP_TO_ITEM=7]="SKIP_TO_ITEM"}(Hi||(Hi={}));class Capabilities{set controller(e){this._mediaSession.controller=e}updateChecker(e){this._checkCapability!==e&&(this._checkCapability=e,this._dispatcher.publish(Ii.capabilitiesChanged))}get canEditPlaybackQueue(){return this._checkCapability(Hi.EDIT_QUEUE)}get canPause(){return this._checkCapability(Hi.PAUSE)}get canSeek(){return this._checkCapability(Hi.SEEK)}get canSetRepeatMode(){return this._checkCapability(Hi.REPEAT)}get canSetShuffleMode(){return this._checkCapability(Hi.SHUFFLE)}get canSkipToNextItem(){return this._checkCapability(Hi.SKIP_NEXT)}get canSkipToMediaItem(){return this._checkCapability(Hi.SKIP_TO_ITEM)}get canSkipToPreviousItem(){return this._checkCapability(Hi.SKIP_PREVIOUS)}constructor(e){this._dispatcher=e,this._checkCapability=e=>!1,this._mediaSession=new MediaSessionManager(this,e)}}function _defineProperty$y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function transform$7(e){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$y(e,t,r[t])}))}return e}({attributes:{}},transform$9({id:"metadata.itemId",type:"metadata.itemType","attributes.contentRating"(){var t;if(1===(null==e||null===(t=e.metadata)||void 0===t?void 0:t.isExplicit))return"explicit"},"attributes.playParams"(){var t,r,n;return 0!==(null==e||null===(t=e.metadata)||void 0===t?void 0:t.isPlayable)&&{id:null==e||null===(r=e.metadata)||void 0===r?void 0:r.itemId,kind:null==e||null===(n=e.metadata)||void 0===n?void 0:n.itemType}},"container.id":"metadata.containerId","container.name":"metadata.containerName","container.type":"metadata.containerType"},e))}const zi=StringDevFlag.register("mk-logging-levels"),Yi=BooleanDevFlag.register("mk-console-logging"),Qi=N.ERROR;let Ji=Qi;const Xi=new Logger$1("mk",{level:Ji,handlers:{console:new class{get hasConsole(){return void 0!==typeof console}process(e){if(!this.enabled||!this.hasConsole)return;let t="log";if(this.mapLevels){const n=this.levelMapping.get(e.level);void 0!==(r=n)&&r in console&&(t=n)}var r,n;const i=null!==(n=e.args)&&void 0!==n?n:[],a=this.format(e);console[t](a,...i)}constructor(e={}){var t,r,n,i;this.enabled=null===(t=e.enabled)||void 0===t||t,this.mapLevels=null===(r=e.mapLevels)||void 0===r||r,this.levelMapping=null!==(n=e.levelMapping)&&void 0!==n?n:B,this.format=null!==(i=e.formatter)&&void 0!==i?i:V}}({enabled:!1}),external:new CallbackHandler(()=>{})}});function applyLoggingLevels(e){!function(e,t){walk(e,(function(e){let r;const n=e.namespace;e.clearLevel(),void 0===e.parent&&void 0!==t["*"]?r=getLoggingLevel(t["*"]):void 0!==t[n]&&(r=getLoggingLevel(t[n])),void 0!==r&&e.setLevel(r)}))}(Xi,function(e){const t=getLoggingLevel(e.trim(),{allowShorthands:!0});if(void 0!==t)return{"*":t};const r={},n=e.split(",").filter(e=>""!==e.trim());for(const c of n){var i,a;const e=c.split("=",2);if(2!==e.length)continue;var o;const t=null!==(o=null===(i=e[0])||void 0===i?void 0:i.trim())&&void 0!==o?o:"";var s;const n=getLoggingLevel(null!==(s=null===(a=e[1])||void 0===a?void 0:a.trim())&&void 0!==s?s:"",{allowShorthands:!0});""!==t&&void 0!==n&&(r[t]=n)}return r}(e))}function clearLoggingLevels(){Xi.setLevel(Ji),function(e,t={includeRoot:!0}){walk(e,(function(e){(void 0!==e.parent||t.includeRoot)&&e.clearLevel()}))}(Xi,{includeRoot:!1})}function setConsoleOutput(e){Xi.handlers.console.enabled=null!=e&&e}function setRootLoggingLevel(e){var t;Ji=null!==(t=getLoggingLevel(e))&&void 0!==t?t:Ji}const Zi={getLogger:(e="*")=>Xi.getByNamespace(null!=e?e:"*"),setConsoleOutput(e){!0===e?(Yi.enable(),setConsoleOutput(!0),Xi.info("Console output is enabled with level "+Xi.levelName)):(Yi.disable(),setConsoleOutput(!1))},setLoggingLevels(e,t){""!==e.trim()?(zi.set(e),applyLoggingLevels(e),Zi.setConsoleOutput(null==t||t)):Zi.clearLoggingLevels(null!=t&&t)},clearLoggingLevels(e=!1){Zi.setConsoleOutput(e),zi.clear(),clearLoggingLevels()}};function _defineProperty$x(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$x(e,t,r[t])}))}return e}function _objectSpreadProps$m(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}Yi.enabled&&Zi.setConsoleOutput(Yi.enabled),void 0!==zi.value&&Zi.setLoggingLevels(zi.value,Yi.enabled);const ea={condition:()=>!0,toOptions:(e,t,r)=>[_objectSpreadProps$m(_objectSpread$x({},e),{context:r})]};function _defineProperty$w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$w(e,t,r[t])}))}return e}function _objectSpreadProps$l(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const ta={condition:e=>{var t;return"stations"===e.type&&(null===(t=e.attributes)||void 0===t?void 0:t.isLive)},toOptions:(e,t,r)=>[_objectSpreadProps$l(_objectSpread$w({},e),{context:r,container:{attributes:e.attributes,id:e.id,type:e.type,name:null==r?void 0:r.featureName}})]},hasRelationship=e=>t=>{var r,n;return!!(null===(r=t.relationships)||void 0===r||null===(n=r[e])||void 0===n?void 0:n.data)},typeIs=(...e)=>({type:t})=>e.includes(t),withBagPrefix=e=>{if(void 0===e||""===e)return;const{prefix:t}=Bi;return t?`${t}:${e}`:e};function _defineProperty$v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpreadProps$k(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var ra;const getContainerName=(e,t)=>{var r;return null!==(ra=null!=t?t:null==e||null===(r=e.container)||void 0===r?void 0:r.name)&&void 0!==ra?ra:Jt.SONG},na={toOptions:(e,t,r)=>{const n=_objectSpreadProps$k(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$v(e,t,r[t])}))}return e}({id:e.id},t),{name:withBagPrefix(getContainerName(e,null==r?void 0:r.featureName))});return[{relationships:e.relationships,attributes:e.attributes,id:e.id,type:e.type,container:n,context:r}]},condition:typeIs("songs","library-songs","music-videos")};function _defineProperty$u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$u(e,t,r[t])}))}return e}function _objectSpreadProps$j(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const parseAssets=({type:e,attributes:{assetTokens:t}})=>e.includes("udio")?(e=>{if(void 0===e)return;const[t]=Object.keys(e);return e[t]})(t):(e=>{if(void 0===e)return;const t=Object.keys(e);return e[t[t.length-1]]})(t),ia={condition:typeIs("uploaded-audios","uploadedAudio","uploaded-videos","uploadedVideo"),toOptions:(e,t,r)=>{var n,i;const a=_objectSpreadProps$j(_objectSpread$u({},e),{context:r,attributes:_objectSpreadProps$j(_objectSpread$u({},e.attributes),{assetUrl:parseAssets(e),playParams:null!==(i=null==e||null===(n=e.attributes)||void 0===n?void 0:n.playParams)&&void 0!==i?i:{id:e.id,kind:e.type}})});return void 0!==t&&(a.container=t),void 0!==(null==r?void 0:r.featureName)&&(a.container=_objectSpreadProps$j(_objectSpread$u({},a.container),{name:null==r?void 0:r.featureName})),[a]}};function _defineProperty$t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpreadProps$i(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const aa={toOptions:(e,t,r)=>e.relationships.episodes.data.map(e=>_objectSpreadProps$i(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$t(e,t,r[t])}))}return e}({},e),{context:r})),condition:hasRelationship("episodes"),requiredRelationships:["episodes"]};function asyncGeneratorStep$J(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$J(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$J(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$J(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$s(e,t,r[t])}))}return e}function formatRatingsContentType(e,t){return n(t)&&i(t)?e.replace(/^library-/,""):n(t)&&!/^library-/.test(e)?"library-"+e:e}function normalizeAdamId(e){return e.replace(/^a\./,"")}function makeRequest(e,t,r){return _makeRequest.apply(this,arguments)}function _makeRequest(){return(_makeRequest=_asyncToGenerator$J((function*(e,t,r,n={}){let i,a=t;const o=r&&r.ids;n=_objectSpread$s({},n);const{shouldCacheResults:s=!0,returnRawJSONApiRecords:c=!1,includePagination:l=e.defaultIncludePaginationMetadata,includeResponseMeta:u=!1}=n;delete n.shouldCacheResults,delete n.returnRawJSONApiRecords,delete n.includePagination,delete n.includeResponseMeta,"string"==typeof o&&(a=`${t}/${encodeURIComponent(o)}`,r&&delete r.ids);try{(l||u)&&(n.useRawResponse=!0),i=yield e.request(a,r,n)}catch(d){return"status"in d?404===d.status?Promise.reject(new MKError(MKError.CONTENT_UNAVAILABLE,"The requested content is not available.")):Promise.reject(MKError.responseError(d)):Promise.reject(MKError.internalError(d))}try{const t=i.results||i.data||i;if("object"==typeof i&&"results"in i&&"meta"in i&&(t.meta=i.meta),0===t.length)return Promise.reject(new MKError(MKError.CONTENT_UNAVAILABLE,"The requested content is not available."));const a=c?t:e.parseResultData(s,t);if(!l&&!u)return a;if("results"in i){for(const t in i.results)"meta"!==t&&(a[t]=paginateResultSet(i.results[t],a[t],e,r,n));return a}return paginateResultSet(i,a,e,r,n)}catch(Tt){return Promise.reject(MKError.parseError(Tt))}}))).apply(this,arguments)}function paginateResultSet(e,t,r,n,i={}){let a,o;i.includePagination=!0;const s=_objectSpread$s({},i);return delete s.offset,e.next&&(a=()=>makeRequest(r,formatPaginatedUrl(r.url,e.next),n,s)),e.previous&&(o=()=>makeRequest(r,formatPaginatedUrl(r.url,e.previous),n,s)),{data:t,next:a,previous:o,meta:e.meta}}function mapRequestResult(e,t){return"data"in e?(e.data=t(e.data),e):t(e)}function formatPaginatedUrl(e,t){if("function"!=typeof URL)throw new Error("formatPaginatedUrl requires an implementation of URL");const{pathname:r}=new URL(e),n=new RegExp(`^${r}/`);return t.replace(n,"")}const getFeatureName=(e,t)=>{if(t)return t;const r=function(e=[]){return 0!==e.length&&e.filter(({attributes:e})=>!!e&&(e.workName||e.movementName||e.movementCount||e.movementNumber)).length>0}(e.relationships.tracks.data);return"albums"===e.type||"library-albums"===e.type?r?Jt.ALBUM_CLASSICAL:Jt.ALBUM:"playlists"===e.type||"library-playlists"===e.type?r?Jt.PLAYLIST_CLASSICAL:Jt.PLAYLIST:void 0},oa=[{toOptions:(e,t,r)=>{const n={attributes:e.attributes,id:e.id,type:e.type,name:withBagPrefix(getFeatureName(e,null==r?void 0:r.featureName))};return e.relationships.tracks.data.map(e=>({attributes:e.attributes,id:e.id,type:e.type,container:n,context:r}))},condition:hasRelationship("tracks"),requiredRelationships:["tracks"]},aa,na,ta,ia],sa=oa.reduce((e,t)=>{const r=t.requiredRelationships;return r&&e.push(...r),e},[]),ca=new Set(sa),isArrayOf=(e,t)=>Array.isArray(e)&&(0===e.length||t(e[0])),isMediaAPIResource=e=>e&&void 0!==e.id&&void 0!==e.type,isMediaItem=e=>e&&void 0!==e.id,isMPMediaItem=e=>e&&void 0!==e.contentId&&void 0!==e.metadata&&void 0!==e.metadata.itemId&&void 0!==e.metadata.itemType,isQueueLoaded=e=>e&&e.loaded,isQueueURLOption=e=>e&&e.url;function _defineProperty$r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const la=Xi.linkChild(new Logger$1("queue")),descriptorToMediaItems=e=>{if(!(e=>e&&e.items&&Array.isArray(e.items))(e)&&!isQueueLoaded(e))return[];const t=isQueueLoaded(e)?loadedDescriptorToMediaItem(e):unloadedDescriptorToMediaItem(e);return t.forEach(t=>t.context=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$r(e,t,r[t])}))}return e}({},e.context,t.context)),t},unloadedDescriptorToMediaItem=({items:e})=>isArrayOf(e,isMPMediaItem)?e.map(e=>new MediaItem(transform$7(e))):isArrayOf(e,isMediaItem)?e.map(e=>new MediaItem(e)):[],loadedDescriptorToMediaItem=e=>{const t=[],{loaded:r,container:n,context:i}=e;return void 0===r?[]:isArrayOf(r,isDataRecord)?(r.forEach(e=>{t.push(...dataRecordToMediaItems(e,n,i))}),t):isArrayOf(r,isMediaAPIResource)?(r.forEach(e=>{t.push(...resourceToMediaItem(e,n,i))}),t):isDataRecord(r)?dataRecordToMediaItems(r,n,i):isMediaAPIResource(r)?resourceToMediaItem(r,n,i):[]},dataRecordToMediaItems=(e,t,r={})=>{const{data:n}=e.serialize(!0,void 0,{includeRelationships:ca,allowFullDuplicateSerializations:!0});return resourceToMediaItem(n,t,r)},resourceToMediaItem=(e,t,r={})=>(la.debug("_resourceToMediaItem",e),((e,t,r={})=>{var n,i,a;t=null!==(i=null==t||null===(n=t.serialize)||void 0===n?void 0:n.call(t).data)&&void 0!==i?i:t;return(null!==(a=oa.find(n=>n.condition(e,t,r)))&&void 0!==a?a:ea).toOptions(e,t,r).map(e=>new MediaItem(e))})(e,t,r));class BaseModifiableQueue{append(e){Li.warn("Append is not supported for this type of playback")}clear(){Li.warn("Clear is not supported for this type of playback")}insertAt(e,t){Li.warn("InsertAt is not supported for this type of playback")}prepend(e,t=!1){Li.warn("Prepend is not supported for this type of playback")}constructor(){this.canModifyQueue=!1}}class ModifiableQueue{append(e){const t=descriptorToMediaItems(e);this.queue.splice(this.queue.appendTargetIndex,0,t)}clear(){this.queue.length&&(this.queue.splice(0,this.queue.length),this.queue.reset())}insertAt(e,t){const r=descriptorToMediaItems(t);this.queue.splice(e,0,r)}prepend(e,t=!1){const r=descriptorToMediaItems(e),n=this.queue.position+1;t&&this.queue.splice(n,this.queue.length),this.queue.splice(n,0,r)}constructor(e,t){this.canModifyQueue=!0,this.queue=e,this._mediaItemPlayback=t}}var ua;!function(e){e[e.none=0]="none",e[e.one=1]="one",e[e.all=2]="all"}(ua||(ua={}));class BaseRepeatable{get repeatMode(){return ua.none}set repeatMode(e){e!==this.repeatMode&&Li.warn("setting repeatMode is not supported in this playback method")}constructor(){this.canSetRepeatMode=!1}}class Repeatable{get repeatMode(){return this._repeatMode}set repeatMode(e){e in ua&&e!==this._repeatMode&&(this._repeatMode=e,this.dispatcher.publish(Ii.repeatModeDidChange,this._repeatMode))}constructor(e,t=ua.none){this.canSetRepeatMode=!0,this.dispatcher=e,this._repeatMode=t}}function _defineProperty$q(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const da=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$q(e,t,r[t])}))}return e}({},{NEXT_ITEM:"NEXT"},Zt);function asyncGeneratorStep$I(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$I(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$I(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$I(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const pa=["EditorialVideoClip","uploaded-videos","uploadedVideo","musicVideo"],ha=function(){var e=_asyncToGenerator$I((function*(){}));return function(){return e.apply(this,arguments)}}();class BaseSeekable{getSeekSeconds(e){return Li.warn("Seeking by predetermined amounts are not supported in this playback method"),{BACK:0,FORWARD:0}}seekBackward(e=ha){Li.warn("seekBackward is not supported in this playback method")}seekForward(e=ha){Li.warn("seekForward is not supported in this playback method")}seekToTime(e,t){return _asyncToGenerator$I((function*(){Li.warn("seekToTime is not supported in this playback method")}))()}constructor(e){this.mediaItemPlayback=e,this.canSeek=!1}}class Seekable{getSeekSeconds(e){return(e=>(null==e?void 0:e.isUTS)||pa.includes(null==e?void 0:e.type)?{FORWARD:10,BACK:10}:{FORWARD:30,BACK:15})(e)}seekBackward(t=this._seekToBeginning){var r=this;return _asyncToGenerator$I((function*(){if(void 0===r.mediaItemPlayback.nowPlayingItem)return void Li.warn("Cannot seekBackward when nowPlayingItem is not yet set.");const n=r.mediaItemPlayback.currentPlaybackTime-r.getSeekSeconds(r.mediaItemPlayback.nowPlayingItem).BACK;n<0?yield t.call(r):yield r.seekToTime(n,e.SeekReasonType.Interval)}))()}seekForward(t=this._seekToEnd){var r=this;return _asyncToGenerator$I((function*(){if(void 0===r.mediaItemPlayback.nowPlayingItem)return void Li.warn("Cannot seekForward when nowPlayingItem is not yet set.");const n=r.mediaItemPlayback.currentPlaybackTime+r.getSeekSeconds(r.mediaItemPlayback.nowPlayingItem).FORWARD;n>r.mediaItemPlayback.currentPlaybackDuration?yield t.call(r):yield r.seekToTime(n,e.SeekReasonType.Interval)}))()}seekToTime(t,r=e.SeekReasonType.Manual){var n=this;return _asyncToGenerator$I((function*(){if(void 0===n.mediaItemPlayback.nowPlayingItem)return void Li.warn("Cannot seekToTime when nowPlayingItem is not yet set.");const e=n.mediaItemPlayback.nowPlayingItem,i=n.mediaItemPlayback.currentPlaybackTime,a=n.mediaItemPlayback.currentPlayingDate,o=Math.min(Math.max(0,t),n.mediaItemPlayback.currentPlaybackDuration-1);let s;if(e.isLinearStream&&void 0!==a){const e=1e3*(o-i);s=new Date(a.getTime()+e)}yield n.mediaItemPlayback.seekToTime(o,r),n._dispatcher.publish(zt.playbackSeek,{item:e,startPosition:i,position:o,playingDate:s,startPlayingDate:a,seekReasonType:r})}))()}_seekToBeginning(){var t=this;return _asyncToGenerator$I((function*(){yield t.seekToTime(0,e.SeekReasonType.Interval)}))()}_seekToEnd(){var t=this;return _asyncToGenerator$I((function*(){yield t.seekToTime(t.mediaItemPlayback.currentPlaybackDuration,e.SeekReasonType.Interval)}))()}constructor(e,t){this._dispatcher=e,this.mediaItemPlayback=t,this.canSeek=!0}}const shuffleCollection=e=>{const t=[...e],{length:r}=t;for(let n=0;n<r;++n){const e=n+Math.floor(Math.random()*(r-n)),i=t[e];t[e]=t[n],t[n]=i}return t};function _objectWithoutProperties$1(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}const ya=Xi.createChild("queue");class QueueItem{restrict(){return this.item.restrict()}constructor(e,t){var r;this.isAutoplay=!1,this.item=e,this.isAutoplay=null!==(r=null==t?void 0:t.isAutoplay)&&void 0!==r&&r}}function toQueueItems(e,t){return e.map(e=>new QueueItem(e,t))}function toMediaItems(e){return e.map(e=>e.item)}const{queueItemsDidChange:fa,queuePositionDidChange:ma}=Ii;class Queue{get isEmpty(){return 0===this.length}set isRestricted(e){this._isRestricted=e,this._isRestricted&&this._queueItems&&this._queueItems.forEach(e=>{e.restrict()})}get isRestricted(){return this._isRestricted}get appendTargetIndex(){let e=this.length;const t=this._queueItems.findIndex(e=>e.isAutoplay);return-1!==t&&this.position<t&&(e=t),e}get items(){return toMediaItems(this._queueItems)}get autoplayItems(){return toMediaItems(this._queueItems.filter(e=>e.isAutoplay))}get unplayedAutoplayItems(){return toMediaItems(this._unplayedQueueItems.filter(e=>e.isAutoplay))}get userAddedItems(){return toMediaItems(this._queueItems.filter(e=>!e.isAutoplay))}get unplayedUserItems(){return toMediaItems(this._unplayedQueueItems.filter(e=>!e.isAutoplay))}get playableItems(){return toMediaItems(this._queueItems.filter(e=>canPlay(e.item)))}get unplayedPlayableItems(){return toMediaItems(this._unplayedQueueItems.filter(e=>canPlay(e.item)))}get length(){return this._queueItems.length}get nextPlayableItem(){if(-1!==this.nextPlayableItemIndex)return this.item(this.nextPlayableItemIndex)}get nextPlayableItemIndex(){return this._nextPlayableItemIndex=this.findPlayableIndexForward(),this._nextPlayableItemIndex}get position(){return this._position}set position(e){this._updatePosition(e)}get isInitiated(){return this.position>=0}get previousPlayableItem(){if(-1!==this.previousPlayableItemIndex)return this.item(this.previousPlayableItemIndex)}get previousPlayableItemIndex(){return this.findPlayableIndexBackward()}removeQueueItems(e){for(let t=this.length-1;t>=0;t--)e(this.queueItem(t),t)&&this.spliceQueueItems(t,1)}indexForItem(e){return("string"==typeof e?this._itemIDs:this.items).indexOf(e)}item(e){var t;return null===(t=this.queueItem(e))||void 0===t?void 0:t.item}get currentItem(){return this.item(this.position)}queueItem(e){var t;return null===(t=this._queueItems)||void 0===t?void 0:t[e]}get currentQueueItem(){return this.queueItem(this.position)}remove(e){if(deprecationWarning("remove",{message:"The queue remove function has been deprecated"}),e===this.position)throw new MKError(MKError.INVALID_ARGUMENTS);this.splice(e,1)}append(e=[]){return this.appendQueueItems(toQueueItems(e))}appendQueueItems(e=[]){return this.spliceQueueItems(this.appendTargetIndex,0,e)}splice(e,t,r=[]){return toMediaItems(this.spliceQueueItems(e,t,toQueueItems(r)))}spliceQueueItems(e,t,r=[],n=!0){r=r.filter(e=>isPlayable(null==e?void 0:e.item));const i=this._queueItems.splice(e,t,...r);return this._itemIDs.splice(e,t,...r.map(e=>e.item.id)),n&&(this._dispatcher.publish(zt.queueModified,{start:e,added:toMediaItems(r),removed:toMediaItems(i)}),this._dispatcher.publish(fa,this.items)),i}reset(){const e=this.position;this._position=-1,this._dispatcher.publish(ma,{oldPosition:e,position:this.position})}_isSameItems(e){if(e.length!==this.length)return!1;const t=e.map(e=>e.id).sort(),r=[...this._itemIDs].sort();let n,i;try{n=JSON.stringify(t),i=JSON.stringify(r)}catch(a){return!1}return n===i}_reindex(){this._queueItems&&(this._itemIDs=this._queueItems.map(e=>e.item.id))}_updatePosition(e){if(e===this._position)return;const t=this._position;this._position=e;const r=this.item(e);r&&canPlay(r)||(this._position=this.findPlayableIndexForward(e)),this._position!==t&&this._dispatcher.publish(ma,{oldPosition:t,position:this._position})}findPlayableIndexForward(e=this.position){var t;if(this.isEmpty)return-1;if(this.isInitiated&&!indexInBounds([0,this.position],e))return-1;const r=null===(t=this.repeatable)||void 0===t?void 0:t.repeatMode;if(e<this.length)for(let n=e+1;n<this.length;n++){if(canPlay(this.item(n)))return n}if(r===ua.all)for(let n=0;n<=e;n++){if(canPlay(this.item(n)))return n}return-1}findPlayableIndexBackward(e=this.position){var t;if(this.isEmpty)return-1;if(!indexInBounds([0,this.position],e))return-1;const r=null===(t=this.repeatable)||void 0===t?void 0:t.repeatMode;if(e>0)for(let n=e-1;n>=0;n--){if(canPlay(this.item(n)))return n}if(r===ua.all)for(let n=this.length-1;n>=e;n--){if(canPlay(this.item(n)))return n}return-1}get _unplayedQueueItems(){const e=this.position<0?0:this.position;return this._queueItems.slice(e)}_getStartItemPosition(e){if(void 0===e)return-1;if("object"==typeof e&&"id"in e&&(e=e.id),"string"==typeof e)return this.indexForItem(e);const t=parseInt(""+e,10);return t>=0&&t<this.length?t:-1}constructor(e){if(this.hasAutoplayStation=!1,this._itemIDs=[],this._queueItems=[],this._isRestricted=!1,this._nextPlayableItemIndex=-1,this._position=-1,this._dispatcher=e.services.dispatcher,!e.descriptor)return;const t=descriptorToMediaItems(e.descriptor).filter(e=>isPlayable(e));this._queueItems=toQueueItems(t),this._reindex(),void 0!==e.descriptor.startWith&&(this.position=this._getStartItemPosition(e.descriptor.startWith))}}function isPlayable(e){return e.isPlayable||void 0!==e.previewURL}function canPlay(e){return isPlayable(e)&&!function(e){return e.isRestricted}(e)&&!function(e){return e.isUnavailable}(e)}function indexInBounds(e,t){return e[0]<=t&&t<=e[1]}var ga,va={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ba={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){e[e.off=0]="off",e[e.songs=1]="songs"}(ga||(ga={}));const _a="Shuffling is not supported in this playback method.";class BaseShuffler{set shuffle(e){Li.warn(_a)}get shuffleMode(){return ga.off}set shuffleMode(e){Li.warn(_a)}checkAndReshuffle(e){Li.warn(_a)}constructor(){this.canSetShuffleMode=!1}}class Shuffler{get queue(){return this._queue}set queue(e){this._queue=e,this._unshuffledIDs=e.userAddedItems.map(e=>e.id),this.checkAndReshuffle(!1)}queueModifiedHandler(e,t){if(this._isSpliceFromShuffle)return void(this._isSpliceFromShuffle=!1);const{start:r,added:n,removed:i}=t;if(i.length>0){const e=i.map(e=>e.id);this._unshuffledIDs=this._unshuffledIDs.filter(t=>!e.includes(t))}n.length>0&&this._unshuffledIDs.splice(r,0,...n.map(e=>e.id))}set shuffle(e){this.shuffleMode=e?ga.songs:ga.off}get shuffleMode(){return this.mode}set shuffleMode(e){e!==this.shuffleMode&&e in ga&&(Li.debug(`mk: set shuffleMode from ${this.shuffleMode} to ${e}`),this.mode=e,this.mode===ga.songs?this.shuffleQueue():this.unshuffleQueue(),this.controller.nowPlayingItem&&(this._queue.position=this._queue.indexForItem(this.controller.nowPlayingItem.id)),this.dispatcher.publish(Ii.shuffleModeDidChange,this.shuffleMode))}checkAndReshuffle(e=!1){this.shuffleMode===ga.songs&&this.shuffleQueue(e)}shuffleQueue(e=!0){const{userAddedItems:t}=this._queue;if(t.length<=1)return t;const r=t.slice(0),n=this._queue.position>-1?r.splice(this._queue.position,1):[];let i=[];do{i=shuffleCollection(r)}while(r.length>1&&arrayEquals(i,r));const a=[...n,...i];this._isSpliceFromShuffle=!0,this._queue.spliceQueueItems(0,a.length,toQueueItems(a),e)}unshuffleQueue(e=!0){let t=[];const r=this._unshuffledIDs.reduce((e,t,r)=>(e[t]=r,e),{}),n=[];let i=0;const a=this._queue.item(this._queue.position);this._queue.userAddedItems.forEach(e=>{const o=r[e.id];void 0===o&&n.push(e),t[o]=e,e.id===(null==a?void 0:a.id)&&(i=o)}),t=t.filter(Boolean);const o=t.concat(n);this._isSpliceFromShuffle=!0,this._queue.spliceQueueItems(0,o.length,toQueueItems(o),e),this._queue.position=i}constructor(e,{dispatcher:t}){this.controller=e,this.canSetShuffleMode=!0,this.mode=ga.off,this._unshuffledIDs=[],this._isSpliceFromShuffle=!1,this.dispatcher=t,this.dispatcher.subscribe(zt.queueModified,this.queueModifiedHandler),this._queue=e.queue}}function asyncGeneratorStep$H(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$H(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$H(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$H(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$p(e,t,r[t])}))}return e}function _objectSpreadProps$h(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}va([Bind(),ba("design:type",Function),ba("design:paramtypes",[String,Object])],Shuffler.prototype,"queueModifiedHandler",null);var Sa,Ta={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Pa={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){e.continuous="continuous",e.serial="serial"}(Sa||(Sa={}));const{queueItemsDidChange:Ea}=Ii;class PlaybackController{updateAutoplay(e,t){this.autoplayEnabled=t}constructContext(e,t){let r=e.context;var n;return void 0!==e.featureName&&void 0===(null==r?void 0:r.featureName)&&(Li.warn("featureName is deprecated, pass it inside context"),r||(r={}),r.featureName=e.featureName),null!==(n=null!=r?r:t)&&void 0!==n?n:{}}get context(){return this._context}get continuous(){return this._continuous||this.hasAuthorization}set continuous(e){this._continuous=e}get autoplayEnabled(){return this._autoplayEnabled}set autoplayEnabled(e){this._autoplayEnabled=e}get previewOnly(){return this._mediaItemPlayback.previewOnly}get _dispatcher(){return this._services.dispatcher}get hasAuthorization(){return hasAuthorization(this.storekit)}get isPlaying(){return this._mediaItemPlayback.isPlaying}get isPrimaryPlayer(){return this._mediaItemPlayback.isPrimaryPlayer}set isPrimaryPlayer(e){this._mediaItemPlayback.isPrimaryPlayer=e}get isReady(){return this._mediaItemPlayback.isReady}get _mediaItemPlayback(){return this._services.mediaItemPlayback}get nowPlayingItem(){return this._mediaItemPlayback.nowPlayingItem}get nowPlayingItemIndex(){return this.queue?this.queue.position:-1}get queue(){return this._queue}set queue(e){this._prepareQueue(e),this._queue=e,this._shuffler.queue=this._queue,this._queueModifier.queue=this._queue,this._dispatcher.publish(Ea,e.items)}get repeatMode(){return this._repeatable.repeatMode}set repeatMode(e){this._repeatable.repeatMode=e}get seekSeconds(){const{nowPlayingItem:e}=this;if(void 0!==e)return this._seekable.getSeekSeconds(e)}set shuffle(e){this._shuffler.shuffle=e}get shuffleMode(){return this._shuffler.shuffleMode}set shuffleMode(e){this._shuffler.shuffleMode=e}get storekit(){return this._storekit}set storekit(e){if(e){var t=this;e.addEventListener(le.authorizationStatusWillChange,function(){var e=_asyncToGenerator$H((function*({authorizationStatus:e,newAuthorizationStatus:r}){e>ne.DENIED&&r<ne.RESTRICTED?yield t.stop({endReasonType:Zt.PLAYBACK_SUSPENDED,userInitiated:!1}):yield t.stop({userInitiated:!1})}));return function(t){return e.apply(this,arguments)}}()),this._storekit=e}}append(e){var t=this;return _asyncToGenerator$H((function*(){const r=yield t._dataForQueueOptions(e);return t._queueModifier.append(r),t.queue}))()}insertAt(e,t){var r=this;return _asyncToGenerator$H((function*(){const n=yield r._dataForQueueOptions(t);return r._queueModifier.insertAt(e,n),r.queue}))()}_dataForQueueOptions(e){var t=this;return _asyncToGenerator$H((function*(){const r=t.constructContext(e,t.context);return _objectSpreadProps$h(_objectSpread$p({},e),{context:r})}))()}clear(){var e=this;return _asyncToGenerator$H((function*(){return e._queueModifier.clear(),e.queue}))()}changeToMediaAtIndex(e=0){var t=this;return _asyncToGenerator$H((function*(){var r,n,i;yield t.stop();const a=null===(r=t.queue.item(e))||void 0===r?void 0:r.id,o=null===(n=t._mediaItemPlayback)||void 0===n||null===(i=n.playOptions)||void 0===i?void 0:i.get(a);let s=(null==o?void 0:o.startTime)||0;const c=yield t._changeToMediaAtIndex(e,{userInitiated:!0});c&&(c.id!==a&&(s=0),t._dispatcher.publish(zt.playbackPlay,{item:c,position:s}))}))()}changeToMediaItem(e){var t=this;return _asyncToGenerator$H((function*(){const r=t.queue.indexForItem(e);return-1===r?Promise.reject(new MKError(MKError.MEDIA_DESCRIPTOR)):t.changeToMediaAtIndex(r)}))()}activate(){Li.debug("mk: base controller - activate"),this._dispatcher.unsubscribe(Ii.playbackStateDidChange,this.onPlaybackStateDidChange),this._dispatcher.subscribe(Ii.playbackStateDidChange,this.onPlaybackStateDidChange),this._skipIntro.activate(),this._upNext.activate(),this._rollMonitor.activate()}deactivate(){var e=this;return _asyncToGenerator$H((function*(){yield e.stop(),e._dispatcher.unsubscribe(Ii.playbackStateDidChange,e.onPlaybackStateDidChange),e._skipIntro.deactivate(),e._upNext.deactivate(),e._rollMonitor.deactivate()}))()}destroy(){var e=this;return _asyncToGenerator$H((function*(){yield e.deactivate(),e._dispatcher.unsubscribe(Ii.autoplayEnabledDidChange,e.updateAutoplay)}))()}hasCapabilities(e){switch(e){case Hi.SEEK:return this._seekable.canSeek;case Hi.REPEAT:return this._repeatable.canSetRepeatMode;case Hi.SHUFFLE:return this._shuffler.canSetShuffleMode;case Hi.EDIT_QUEUE:return this._queueModifier.canModifyQueue;case Hi.PAUSE:case Hi.SKIP_NEXT:case Hi.SKIP_TO_ITEM:return!0;case Hi.SKIP_PREVIOUS:default:return!1}}pause(e){var t=this;return _asyncToGenerator$H((function*(){return t._mediaItemPlayback.pause(e)}))()}play(){var e=this;return _asyncToGenerator$H((function*(){if(e.nowPlayingItem)return e._mediaItemPlayback.play();if(!e._queue||e._queue.isEmpty)return;if(e.nowPlayingItemIndex>=0)return e.changeToMediaAtIndex(e.nowPlayingItemIndex);const{queue:t}=e;if(-1!==t.nextPlayableItemIndex)return e.changeToMediaAtIndex(t.nextPlayableItemIndex);t.isRestricted&&t.items.every(e=>e.isRestricted)&&e._dispatcher.publish(Ii.mediaPlaybackError,new MKError(MKError.CONTENT_RESTRICTED,"Content restricted"))}))()}playSingleMediaItem(e,t){var r=this;return _asyncToGenerator$H((function*(){yield Ni(e,t),r._dispatcher.publish(Ii.queueItemsDidChange,[e]);const n=yield r._mediaItemPlayback.startMediaItemPlayback(e,!0);if(n){var i;const e={item:n,position:null!==(i=r._mediaItemPlayback.currentPlaybackTime)&&void 0!==i?i:0,playingDate:r._mediaItemPlayback.currentPlayingDate,userInitiated:!0};Li.debug("playSingleMediaItem: Dispatching DispatchTypes.playbackPlay event",e),r._dispatcher.publish(zt.playbackPlay,e)}}))()}onPlaybackStateDidChange(t,r){var n=this;return _asyncToGenerator$H((function*(){r.state===e.PlaybackStates.ended&&(n.continuous||n.repeatMode===ua.one)&&(Li.debug("controller detected track ended event, moving to next item."),n._dispatcher.publish(zt.applicationActivityIntent,{endReasonType:Zt.TRACK_SKIPPED_FORWARDS,userInitiated:!1}),yield n._next())}))()}preload(){var e=this;return _asyncToGenerator$H((function*(){return e._mediaItemPlayback.preload()}))()}prepend(e,t){var r=this;return _asyncToGenerator$H((function*(){const n=yield r._dataForQueueOptions(e);return r._queueModifier.prepend(n,t),r.queue}))()}prepareToPlay(e){var t=this;return _asyncToGenerator$H((function*(){return t._mediaItemPlayback.prepareToPlay(e)}))()}showPlaybackTargetPicker(){this._mediaItemPlayback.showPlaybackTargetPicker()}seekBackward(){var e=this;return _asyncToGenerator$H((function*(){return e._seekable.seekBackward()}))()}seekForward(){var e=this;return _asyncToGenerator$H((function*(){return e._seekable.seekForward(e.skipToNextItem.bind(e))}))()}skipToNextItem(){var e=this;return _asyncToGenerator$H((function*(){return e._next({userInitiated:!0})}))()}getNewSeeker(){return this._mediaItemPlayback.getNewSeeker()}seekToTime(e,t){var r=this;return _asyncToGenerator$H((function*(){yield r._seekable.seekToTime(e,t)}))()}setQueue(e){var t=this;return _asyncToGenerator$H((function*(){return yield t.extractGlobalValues(e),yield t._mediaItemPlayback.stop(),t.returnQueueForOptions(e)}))()}extractGlobalValues(e){var t=this;return _asyncToGenerator$H((function*(){t._context=t.constructContext(e),void 0!==e.featureName&&e.context&&(Li.warn("featureName is deprecated, pass it inside context"),e.context.featureName=e.featureName)}))()}stop(e){var t=this;return _asyncToGenerator$H((function*(){yield t._mediaItemPlayback.stop(e)}))()}_changeToMediaAtIndex(e=0,t={}){var r=this;return _asyncToGenerator$H((function*(){if(r.queue.isEmpty)return;r.queue.position=e;const n=r.queue.item(r.queue.position);if(!n)return;var i;const a=yield r._mediaItemPlayback.startMediaItemPlayback(n,null!==(i=t.userInitiated)&&void 0!==i&&i);if(a||n.state!==P.unsupported)return a;yield r.skipToNextItem()}))()}_next(e={}){var t=this;return _asyncToGenerator$H((function*(){return t._nextAtIndex(t.queue.nextPlayableItemIndex,e)}))()}_nextAtIndex(t,r={}){var n=this;return _asyncToGenerator$H((function*(){if(n.queue.isEmpty)return;const{_mediaItemPlayback:i}=n;var a;const o=null!==(a=r.userInitiated)&&void 0!==a&&a;if(t<0)return Li.debug("controller/index._next no next item available, stopping playback"),yield n.stop({userInitiated:o,seamlessAudioTransition:r.seamlessAudioTransition}),void(i.playbackState=e.PlaybackStates.completed);const s=n.isPlaying,c=i.currentPlaybackTime,l=yield n._changeToMediaAtIndex(t,{userInitiated:o});var u;return n._notifySkip(s,l,{userInitiated:o,seamlessAudioTransition:null!==(u=r.seamlessAudioTransition)&&void 0!==u&&u,position:c,direction:Zt.TRACK_SKIPPED_FORWARDS}),l}))()}_notifySkip(e,t,r){const{userInitiated:n,direction:i,position:a,seamlessAudioTransition:o=!1}=r,s=this._dispatcher;o?(Li.debug("seamlessAudioTransition transition, PAF play"),s.publish(zt.playbackPlay,{item:t,position:0,endReasonType:Zt.NATURAL_END_OF_TRACK})):e?t?s.publish(zt.playbackSkip,{item:t,userInitiated:n,direction:i,position:a}):s.publish(zt.playbackStop,{item:t,userInitiated:n,position:a}):t&&s.publish(zt.playbackPlay,_objectSpread$p({item:t,position:0},n?{endReasonType:Zt.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM}:{}))}_prepareQueue(e){Li.debug("mk: _prepareQueue"),this.hasAuthorization&&(e.isRestricted=this.storekit.restrictedEnabled||!1),e.repeatable=this._repeatable}constructor(e){var t;this._context={},this.onPlaybackStateDidChange=this.onPlaybackStateDidChange.bind(this),this._autoplayEnabled=null!==(t=null==e?void 0:e.autoplayEnabled)&&void 0!==t&&t,this._services=e.services,this._playerOptions=e,this.storekit=e.storekit,this._skipIntro=new SkipAvailable({controller:this,services:e.services}),this._upNext=new UpNextMonitor({controller:this,services:e.services}),this._rollMonitor=new RollMonitor({controller:this,services:e.services}),this._queueModifier=new BaseModifiableQueue,this._shuffler=new BaseShuffler,this._seekable=new BaseSeekable(this._mediaItemPlayback),this._repeatable=new BaseRepeatable,this._dispatcher.subscribe(Ii.autoplayEnabledDidChange,this.updateAutoplay)}}Ta([Bind(),Pa("design:type",Function),Pa("design:paramtypes",[String,Boolean])],PlaybackController.prototype,"updateAutoplay",null);function rejectOnLast(){return Promise.reject("The last middleware in the stack should not call next")}function processMiddleware(e,...t){return e.length?function createNextFunction([e,...t]){return(...r)=>e(createNextFunction(t),...r)}([...e,rejectOnLast])(...t):Promise.reject("processMiddleware requires at mimimum one middleware function")}function parameterizeString(e,t){return function(e){try{return function recursiveTokenizeParameterizedString(e,t=[]){if(e.startsWith("{{")){const r=e.indexOf("}}");if(-1===r)throw new Error("UNCLOSED_PARAMETER");const n={type:ka.Parameter,value:e.slice(2,r)};return r+2<e.length?recursiveTokenizeParameterizedString(e.slice(r+2),[...t,n]):[...t,n]}{const r=e.indexOf("{{");return-1===r?[...t,{type:ka.Static,value:e}]:recursiveTokenizeParameterizedString(e.slice(r),[...t,{type:ka.Static,value:e.slice(0,r)}])}}(e)}catch(Tt){if("UNCLOSED_PARAMETER"===Tt.message)throw new Error(`Unclosed parameter in path: "${e}"`);throw Tt}}(e).map(e=>{switch(e.type){case ka.Parameter:return e.value in t?encodeURIComponent(""+t[e.value]):`{{${e.value}}}`;case ka.Static:default:return e.value}}).join("")}var ka;function _defineProperty$o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpreadProps$g(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function constructUrlMiddleware(e,t){let r=t.url;return r||(r=addPathToURL(t.baseUrl,t.path)),t.urlParameters&&(r=parameterizeString(r,t.urlParameters)),t.queryParameters&&(r=addQueryParamsToURL(r,t.queryParameters)),e(_objectSpreadProps$g(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$o(e,t,r[t])}))}return e}({},t),{url:r}))}function asyncGeneratorStep$G(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$G(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$G(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$G(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function unwrapJSONFromResponse(e){return _unwrapJSONFromResponse.apply(this,arguments)}function _unwrapJSONFromResponse(){return(_unwrapJSONFromResponse=_asyncToGenerator$G((function*(e){try{return yield e.json()}catch(Tt){return}}))).apply(this,arguments)}function fetchMiddlewareFactory(e){return t=_asyncToGenerator$G((function*(t,r){const n=yield e(r.url,r.fetchOptions),i={request:r,response:n,data:yield unwrapJSONFromResponse(n)};if(!n.ok)throw MKError.responseError(n);return i})),function(e,r){return t.apply(this,arguments)};var t}!function(e){e[e.Static=0]="Static",e[e.Parameter=1]="Parameter"}(ka||(ka={}));const wa=fetchMiddlewareFactory("undefined"!=typeof fetch?fetch:()=>{throw new Error("window.fetch is not defined")});function _defineProperty$n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$n(e,t,r[t])}))}return e}function _objectSpreadProps$f(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var Ia;!function(e){e.Replace="REPLACE",e.Merge="MERGE"}(Ia||(Ia={}));const Oa=["url"];class APISession{get config(){return this._config}request(e,t={},r={}){var n;return processMiddleware(this.middlewareStack,_objectSpreadProps$f(_objectSpread$n({},this.config.defaultOptions,r),{baseUrl:this.config.url,path:e,fetchOptions:mergeFetchOptions(null===(n=this.config.defaultOptions)||void 0===n?void 0:n.fetchOptions,r.fetchOptions),queryParameters:_objectSpread$n({},this.config.defaultQueryParameters,t),urlParameters:_objectSpread$n({},this.config.defaultUrlParameters,r.urlParameters)}))}reconfigure(e,t=Ia.Replace){t===Ia.Merge&&(e=deepmerge(this.config,e)),Oa.forEach(t=>{if(void 0===e[t])throw new Error(`Session requires a valid SessionConfig, missing "${t}"`)}),this._config=e,this.middlewareStack=this.createMiddlewareStack()}createMiddlewareStack(){return Array.isArray(this.config.middleware)?[constructUrlMiddleware,...this.config.middleware,this.makeFetchMiddleware()]:[constructUrlMiddleware,this.makeFetchMiddleware()]}makeFetchMiddleware(){return"function"==typeof this.config.fetchFunction?fetchMiddlewareFactory(this.config.fetchFunction):wa}constructor(e){this.reconfigure(e)}}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}const Aa={music:{url:"https://api.music.apple.com"},apps:{url:"https://amp-api.apps.apple.com"},books:{url:"https://amp-api.books.apple.com"},fitness:{url:"https://amp-api.fitness.apple.com"}};Aa.music={url:"https://amp-api.music.apple.com"},Aa.videos={url:"https://amp-api.videos.apple.com"},Aa.podcasts={url:"https://amp-api.podcasts.apple.com"};class MediaAPIV3{configure(e,t,r=Ia.Merge){this.storefrontId=t.storefrontId;const n=function(e){let t={};e.url&&(t.url=e.url);e.storefrontId&&(t.defaultUrlParameters={storefrontId:e.storefrontId});e.mediaUserToken&&(t.defaultOptions={fetchOptions:{headers:{"Media-User-Token":e.mediaUserToken}}});e.developerToken&&(t=deepmerge(t,{defaultOptions:{fetchOptions:{headers:{Authorization:"Bearer "+e.developerToken}}}}));e.options&&(t=deepmerge(t,e.options));return t}(t);if(this[e])this[e].session.reconfigure(n,r);else{var i;const t=new APISession(n),r=t.request.bind(t);r.session=t;const a="undefined"!=typeof process&&"test"===(null===(i=process.env)||void 0===i?void 0:i.NODE_ENV);Object.defineProperty(this,e,{value:r,writable:a,enumerable:!0})}}constructor(e){const{realmConfig:t}=e,r=_objectWithoutProperties(e,["realmConfig"]);for(const n in Aa){let e=deepmerge(Aa[n],r);const i=null==t?void 0:t[n];i&&(e=deepmerge(e,i)),this.configure(n,e)}}}function asyncGeneratorStep$F(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}var Ra,Ca,Da={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ma={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class StationTrackLoader{activate(){this.dispatcher.unsubscribe(Ii.queuePositionDidChange,this.checkLoadMore),this.dispatcher.subscribe(Ii.queuePositionDidChange,this.checkLoadMore),this.isActive=!0}deactivate(){this.dispatcher.unsubscribe(Ii.queuePositionDidChange,this.checkLoadMore),this.isActive=!1}start(){return this.isActive||this.activate(),this.loadNextTracks()}checkLoadMore(){if(!(this.queue.isEmpty||this.queue.nextPlayableItemIndex>=0))return this.loadNextTracks()}loadNextTracks(){var e=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$F(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$F(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){let t=[];const{apiManager:r}=e;if((null==r?void 0:r.api)instanceof MediaAPIV3){var n;const i=yield r.api.music("v1/me/stations/next-tracks/"+e.station.id,void 0,{fetchOptions:{method:"POST"}});t=null==i||null===(n=i.data)||void 0===n?void 0:n.data}else{var i;const n={};var a;Bi.features["enhanced-hls"]&&(n.extend={songs:["extendedAssetUrls"]}),t=null!==(a=yield null===(i=r.mediaAPI)||void 0===i?void 0:i.nextStationTracks(e.station.id,null,{queryParameters:n}))&&void 0!==a?a:[]}if(0===t.length)throw Li.warn("No track data is available for the current station",{stationId:e.station.id}),new MKError(MKError.CONTENT_UNAVAILABLE,"No track data is available for the current station.");const o=descriptorToMediaItems({context:e.context,loaded:t,container:e.station});e.queue.splice(e.queue.length,0,o)}))()}constructor(e,t,{dispatcher:r,apiManager:n},i={}){this.queue=e,this.station=t,this.context=i,this.isActive=!1,this.dispatcher=r,this.apiManager=n}}Da([Bind(),Ma("design:type",Function),Ma("design:paramtypes",[])],StationTrackLoader.prototype,"checkLoadMore",null),function(e){e.artist="artist",e.song="song",e.station="station",e.radioStation="radioStation"}(Ra||(Ra={})),function(e){e.BEATS1="beats1"}(Ca||(Ca={}));const isIdentityQueue=e=>e&&void 0!==e.identity;function asyncGeneratorStep$E(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$E(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$E(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$E(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$m(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var xa={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},La={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const{queueIsReady:Na}=Ii;class ContinuousPlaybackController extends PlaybackController{get continuous(){return!0}set continuous(e){if(!0!==e)throw new MKError(MKError.UNSUPPORTED_ERROR,"Continuous playback cannot be disabled for station queues.")}get context(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$m(e,t,r[t])}))}return e}({featureName:Jt.STATION},this._context)}get isLive(){return this._isLive}set isLive(e){e!==this._isLive&&(this._isLive=e,this._dispatcher.publish(Ii.capabilitiesChanged))}changeToMediaItem(e){var t=this;return _asyncToGenerator$E((function*(){t.generateMethodNotAvailable("changeToMediaItem")}))()}hasCapabilities(e){switch(e){case Hi.PAUSE:case Hi.SKIP_NEXT:return!this.isLive;case Hi.SKIP_PREVIOUS:case Hi.SKIP_TO_ITEM:return!1;default:return super.hasCapabilities(e)}}pause(e){var t=this,_superprop_get_pause=()=>super.pause;return _asyncToGenerator$E((function*(){if(!t.isLive)return _superprop_get_pause().call(t,e);t.generateMethodNotAvailable("pause")}))()}skipToPreviousItem(){var e=this;return _asyncToGenerator$E((function*(){e.generateMethodNotAvailable("skipToPreviousItem")}))()}_dataForQueueOptions(e){var t=this,_superprop_get__dataForQueueOptions=()=>super._dataForQueueOptions;return _asyncToGenerator$E((function*(){const r=yield _superprop_get__dataForQueueOptions().call(t,e);return t.isLive&&(r.loaded=t.station),r}))()}returnQueueForOptions(e){var t=this;return _asyncToGenerator$E((function*(){var r;const n=isIdentityQueue(e)?yield t.loadStationByIdentity(e.identity):yield t.loadStationByStationId(t.generateStationId(e));if(void 0===n)return Promise.reject(new MKError(MKError.UNSUPPORTED_ERROR,"Cannot load requested station"));t.station=n,t.isLive=isIdentityQueue(e)||!!(null==n?void 0:n.isLive)||!!(null==n||null===(r=n.attributes)||void 0===r?void 0:r.isLive);const i={services:{dispatcher:t._dispatcher},descriptor:yield t._dataForQueueOptions(e)};return t.queue=new Queue(i),t.isLive||(t.trackLoader=new StationTrackLoader(t.queue,n,{dispatcher:t._dispatcher,apiManager:t._services.apiManager},t.context),yield t.trackLoader.start()),t._seekable=t.isLive?new BaseSeekable(t._mediaItemPlayback):new Seekable(t._dispatcher,t._mediaItemPlayback),t._dispatcher.publish(Na,t.queue.items),t.queue}))()}getNewSeeker(){return this.hasCapabilities(Hi.SEEK)?super.getNewSeeker():new UnsupportedSeeker}skipToNextItem(){var e=this,_superprop_get_skipToNextItem=()=>super.skipToNextItem;return _asyncToGenerator$E((function*(){if(!e.isLive)return _superprop_get_skipToNextItem().call(e);e.generateMethodNotAvailable("skipToNextItem")}))()}generateMethodNotAvailable(e){Li.warn(e+" is not supported for this type of playback")}generateStationId(e){let t;if(isQueueURLOption(e)){const{contentId:r,kind:n,storefrontId:i}=formattedMediaURL(e.url);e[n]=r,Vi.storefrontId=i,t=n}const r=e;if(r.artist)return"ra."+r.artist;if(r.song)return"ra."+r.song;if(r.station)return r.station;if(r.radioStation)return r.radioStation;throw new MKError(MKError.UNSUPPORTED_ERROR,t?t+" is not a supported option. Use setQueue instead.":"Unsupported options specified for setStationQueue. You may want setQueue instead.")}loadStationByIdentity(e){var t=this;return _asyncToGenerator$E((function*(){var r;const{apiManager:n}=t._services;if((null==n?void 0:n.api)instanceof MediaAPIV3){var i,a;const t=yield n.api.music("v1/catalog/{{storefrontId}}/stations",{filter:{identity:e}});return null==t||null===(i=t.data)||void 0===i||null===(a=i.data)||void 0===a?void 0:a[0]}const o=yield null==n||null===(r=n.mediaAPI)||void 0===r?void 0:r.stations(void 0,{filter:{identity:e}});return o&&o[0]}))()}loadStationByStationId(e){var t=this;return _asyncToGenerator$E((function*(){var r;const{apiManager:n}=t._services;if((null==n?void 0:n.api)instanceof MediaAPIV3){var i,a;const t=yield n.api.music("v1/catalog/{{storefrontId}}/stations/"+e);return null==t||null===(i=t.data)||void 0===i||null===(a=i.data)||void 0===a?void 0:a[0]}return null==n||null===(r=n.mediaAPI)||void 0===r?void 0:r.station(e)}))()}activate(){super.activate(),this.trackLoader&&this.trackLoader.activate()}deactivate(){var e=this,_superprop_get_deactivate=()=>super.deactivate;return _asyncToGenerator$E((function*(){yield _superprop_get_deactivate().call(e),e.trackLoader&&e.trackLoader.deactivate()}))()}constructor(e){super(e),this.type=Sa.continuous,this._isLive=!1,this._continuous=!0}}function asyncGeneratorStep$D(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}xa([Bind(),La("design:type",Function),La("design:paramtypes",[void 0===Hi?Object:Hi])],ContinuousPlaybackController.prototype,"hasCapabilities",null);var $a={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ja={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class PercentageWatcher{startMonitor(){this.dispatcher.unsubscribe(Ii.playbackDurationDidChange,this.updateThreshold),this.dispatcher.unsubscribe(Ii.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(Ii.playbackDurationDidChange,this.updateThreshold),this.dispatcher.subscribe(Ii.playbackTimeDidChange,this.handleTimeChange)}stopMonitor(){this.dispatcher.unsubscribe(Ii.playbackDurationDidChange,this.updateThreshold),this.dispatcher.unsubscribe(Ii.playbackTimeDidChange,this.handleTimeChange),this.threshold=-1}handleTimeChange(e,{currentPlaybackDuration:t,currentPlaybackTime:r}){var n=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$D(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$D(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){n.threshold<0&&n.updateThreshold(e,{duration:t}),r<n.threshold||(n.stopMonitor(),yield n.callback(r,n))}))()}updateThreshold(e,{duration:t}){this.threshold=t*this.percentage}constructor(e,t,r){this.dispatcher=e,this.callback=t,this.percentage=r,this.threshold=-1}}function asyncGeneratorStep$C(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}$a([Bind(),ja("design:type",Function),ja("design:paramtypes",[void 0,void 0])],PercentageWatcher.prototype,"handleTimeChange",null),$a([Bind(),ja("design:type",Function),ja("design:paramtypes",[void 0,void 0])],PercentageWatcher.prototype,"updateThreshold",null);class Preloader extends PlaybackMonitor{handlePlaybackThreshold(){var e=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$C(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$C(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){const t=e.getNextPlayableItem();t&&(yield e.playbackController.prepareToPlay(t,!0))}))()}shouldMonitor(){if(!super.shouldMonitor())return!1;if(!this.playbackController.hasAuthorization||this.playbackController.previewOnly)return!1;const e=this.getNextPlayableItem(),t=void 0!==e;return this.isSeamlessAudioTransitionsEnabled?t:t&&!(null==e?void 0:e.isPreparedToPlay)}getNextPlayableItem(){return this.playbackController.queue.nextPlayableItem}constructor(e){super(e),this.isSeamlessAudioTransitionsEnabled=!1,this.watchers=[new PercentageWatcher(this.dispatcher,this.handlePlaybackThreshold,.3)],this.isSeamlessAudioTransitionsEnabled=Bi.features["seamless-audio-transitions"]}}function dasherize(e){return e.replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()}function asyncGeneratorStep$B(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$B(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$B(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$B(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$l(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$l(e,t,r[t])}))}return e}function _objectSpreadProps$e(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function loadRelationshipData(e,t,r){return _loadRelationshipData.apply(this,arguments)}function _loadRelationshipData(){return(_loadRelationshipData=_asyncToGenerator$B((function*(e,t,r,n={}){if(void 0===t)return r;void 0===n.limit&&(n.limit=100),void 0===n.offset&&(n.offset=0);const{relationship:i,method:a}=t,o=e[a].bind(e);let s;return isDataRecord(r)?(void 0===r[i]&&r.setProperty(i,[],"relationships"),s=r[i]):(r.relationships=r.relationships||{},void 0===r.relationships[i]&&Object.defineProperty(r.relationships,i,{value:{data:[]},enumerable:!0}),s=r.relationships[i].data),yield Ua(o,[r.id,i,n],s),r}))).apply(this,arguments)}const Ua=function(){var e=_asyncToGenerator$B((function*(e,t,r){const[n,i,a]=t,o=r.length;if(o>0&&o<a.limit+a.offset)return r;const s=_objectSpread$l({},a);let c;s.offset=o;try{c=yield e(n,i,s)}catch(l){return r}return r.push(...c),c.length<s.limit?r:Ua(e,t,r)}));return function(t,r,n){return e.apply(this,arguments)}}(),getNamedQueueOptions=(e,t)=>{const r=[],n=e.namedQueueOptions;for(const i in t)Object.keys(n).includes(i)&&r.push([i,n[i]]);return r},Ga=function(){var e=_asyncToGenerator$B((function*(e,t,r){const[n]=r,i=t[n];if(!Array.isArray(i))return loadSelectedQueueValue(e,t,r,i);const a=new Map;i.forEach(e=>{const t=e.indexOf("."),r=-1===t?"":e.substring(0,t);a.has(r)||a.set(r,[]);const n=a.get(r);n&&n.push(e)});const o=(yield Promise.all([...a.values()].map(n=>loadSelectedQueueValue(e,t,r,n)))).reduce((e,t)=>{var r;return(t=null!==(r=t.data)&&void 0!==r?r:t).forEach(t=>{e.set(t.id,t)}),e},new Map),s=[];return i.forEach(e=>{const t=o.get(e);t&&s.push(t)}),s}));return function(t,r,n){return e.apply(this,arguments)}}();function loadSelectedQueueValue(e,t,r,n){return _loadSelectedQueueValue.apply(this,arguments)}function _loadSelectedQueueValue(){return(_loadSelectedQueueValue=_asyncToGenerator$B((function*(e,t,r,n){const i=yield e.getAPIForItem(Array.isArray(n)?n[0]:n);return i instanceof MediaAPIV3?loadSelectedQueueValueV3(i,t,r,n):loadSelectedQueueValueV2(i,t,r,n)}))).apply(this,arguments)}function loadSelectedQueueValueV2(e,t,r,n){return _loadSelectedQueueValueV2.apply(this,arguments)}function _loadSelectedQueueValueV2(){return(_loadSelectedQueueValueV2=_asyncToGenerator$B((function*(e,t,r,n){const[,i]=r;let a=t.parameters;Bi.features["enhanced-hls"]&&(a=_objectSpreadProps$e(_objectSpread$l({},a),{extend:{songs:["extendedAssetUrls"]}}));let o=yield e[i.apiMethod](n,a);return i.loadedQueueTransform&&(o=i.loadedQueueTransform(o)),Array.isArray(n)||(yield loadRelationshipData(e,i.relationshipMethod,o)),o}))).apply(this,arguments)}function loadSelectedQueueValueV3(e,t,r,n){return _loadSelectedQueueValueV3.apply(this,arguments)}function _loadSelectedQueueValueV3(){return(_loadSelectedQueueValueV3=_asyncToGenerator$B((function*(e,t,r,i){const[a]=r,o=Array.isArray(i),s=n(o?""+i[0]:""+i),c=/^(?:playlists?|albums?)$/i.test(a);let l=dasherize(a);l.endsWith("s")||(l+="s");let u=(s?"/v1/me/library":"/v1/catalog/{{storefrontId}}")+"/"+l;o||(u+="/{{id}}");const d={};o&&(d.ids=i),s&&c&&(d.include="tracks");const p=yield e.music(u,d,{urlParameters:{id:i}});return o?p.data.data:p.data.data[0]}))).apply(this,arguments)}function asyncGeneratorStep$A(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$A(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$A(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$A(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$k(e,t,r[t])}))}return e}function _objectSpreadProps$d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var Fa={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ba={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const Ka=["library-songs","songs"];class AutoplayTrackLoader{activate(){this.isActive||(this.dispatcher.unsubscribe(Ii.queuePositionDidChange,this.onQueueChanged),this.dispatcher.subscribe(Ii.queuePositionDidChange,this.onQueueChanged),this.dispatcher.unsubscribe(Ii.repeatModeDidChange,this.onRepeatableChanged),this.dispatcher.subscribe(Ii.repeatModeDidChange,this.onRepeatableChanged),this.isActive=!0)}deactivate(){this.isActive&&(this.dispatcher.unsubscribe(Ii.queuePositionDidChange,this.onQueueChanged),this.dispatcher.unsubscribe(Ii.repeatModeDidChange,this.onRepeatableChanged),this.isActive=!1,this.station=void 0,this.queue.hasAutoplayStation=!1)}start(){if(!this.isActive)return this.activate(),this.loadNextTracks()}stop(){this.isActive&&(this.deactivate(),this.cleanupQueue())}onRepeatableChanged(){this.repeatable.repeatMode===ua.none?this.checkLoadMore():this.cleanupQueue()}onQueueChanged(){if(!(this.queue.nextPlayableItemIndex>=0))return this.checkLoadMore()}get api(){const e=this.apiManager.mediaAPI;var t;return null!==(t=null==e?void 0:e.v3)&&void 0!==t?t:e}checkLoadMore(){var e;const t=null!==(e=this.queue.unplayedAutoplayItems.length)&&void 0!==e?e:0,r=Bi.autoplay.maxUpcomingTracksToMaintain;if(!(this.queue.isEmpty||this.queue.unplayedUserItems.length>Bi.autoplay.maxQueueSizeForAutoplay))return t<r?this.loadNextTracks(r-t):this.loadNextTracks()}cleanupQueue(){this.queue.removeQueueItems((e,t)=>!(t<=this.queue.position)&&!!e.isAutoplay)}loadNextTracks(e=Bi.autoplay.maxUpcomingTracksToMaintain){var t=this;return _asyncToGenerator$A((function*(){var r;if(t.repeatable.repeatMode!==ua.none)return;let n,{station:i}=t;if(t.station){try{var a;n=yield t.api.music("v1/me/stations/next-tracks/"+t.station.id,{limit:e},{fetchOptions:{method:"POST"}}),n=null==n||null===(a=n.data)||void 0===a?void 0:a.data}catch(c){return}if(!t.isActive)return}else{var o;const r=yield t.startStation(e);if(!r||!t.isActive)return void(t.queue.hasAutoplayStation=!1);i=t.station=r.station,t.queue.hasAutoplayStation=!0,n=r.tracks,(null==r||null===(o=r.tracks)||void 0===o?void 0:o.length)||Li.warn("No track data is available for the current station",{stationId:null==i?void 0:i.id})}const s=descriptorToMediaItems({context:_objectSpreadProps$d(_objectSpread$k({},t.context),{featureName:"now_playing",reco_id:(null===(r=t.context.featureName)||void 0===r?void 0:r.startsWith("listen-now"))?void 0:t.context.reco_id}),loaded:n,container:i});t.queue.appendQueueItems(toQueueItems(s,{isAutoplay:!0}))}))()}startStation(e){var t=this;return _asyncToGenerator$A((function*(){const{userAddedItems:r}=t.queue;var i;const a=null!==(i=r[r.length-2])&&void 0!==i?i:r[r.length-1],o=null==a?void 0:a.container,s=o?{container:{id:o.id,type:o.type}}:void 0,c=t.queue.items.slice(-1*Bi.autoplay.maxQueueSizeInRequest).reduce((e,{id:r,type:i})=>{const a=((e,t)=>(n(e)&&!(null!=t?t:"").startsWith("library-")?"library-":"")+normalizeContentType(t))(r,i);return(e=>Ka.includes(e))(a)&&!t.errorIds.has(r)&&e.push({id:r,type:a,meta:s}),e},[]);if(0===c.length)return;const l={data:c};let u;try{var d;u=yield t.api.music("v1/me/stations/continuous",{"limit[results:tracks]":e,with:["tracks"]},{fetchOptions:{method:"POST",body:JSON.stringify(l,void 0,2)}}),u=null==u||null===(d=u.data)||void 0===d?void 0:d.results}catch(p){c.forEach(e=>t.errorIds.add(e.id))}return u}))()}constructor(e,t,{dispatcher:r,apiManager:n},i={}){this.queue=e,this.repeatable=t,this.context=i,this.isActive=!1,this.errorIds=new Set,this.dispatcher=r,this.apiManager=n}}function asyncGeneratorStep$z(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$z(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$z(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$z(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$j(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$j(e,t,r[t])}))}return e}function _objectSpreadProps$c(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}Fa([Bind(),Ba("design:type",Function),Ba("design:paramtypes",[])],AutoplayTrackLoader.prototype,"onRepeatableChanged",null),Fa([Bind(),Ba("design:type",Function),Ba("design:paramtypes",[])],AutoplayTrackLoader.prototype,"onQueueChanged",null),Fa([(e,t,r)=>{const n=r.value,i="_singlePromise_"+t,a="undefined"!=typeof Symbol?Symbol(i):i;return r.value=function(...e){if(this[a])return this[a];const t=this[a]=n.apply(this,e),reset=()=>{this[a]=void 0};return t.then(reset,reset),t},r},Ba("design:type",Function),Ba("design:paramtypes",[Number])],AutoplayTrackLoader.prototype,"loadNextTracks",null);var Va={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ha={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const{queueIsReady:Wa}=Ii;var qa,za;!function(e){e.album="album",e.musicVideo="musicVideo",e.playlist="playlist",e.song="song",e.episode="episode",e.podcast="podcast",e.uploadedAudio="uploadedAudio",e.uploadedVideo="uploadedVideo"}(qa||(qa={})),function(e){e.albums="albums",e.musicVideos="musicVideos",e.playlists="playlists",e.songs="songs",e.episodes="episodes",e.podcasts="podcasts",e.uploadedAudio="uploadedAudios",e.uploadedVideo="uploadedVideos"}(za||(za={}));class SerialPlaybackController extends PlaybackController{get autoplayEnabled(){return this._autoplayEnabled}set autoplayEnabled(e){var t;this._autoplayEnabled=e;const r=e?"start":"stop";null===(t=this._autoplayTrackLoader)||void 0===t||t[r]()}activate(){super.activate(),this._preloader.activate(),this._dispatcher.subscribe(oi,this.onSeamlessAudioTransition),this._dispatcher.subscribe(Ii.repeatModeDidChange,this.onRepeatModeChange)}deactivate(){var e=this,_superprop_get_deactivate=()=>super.deactivate;return _asyncToGenerator$z((function*(){yield _superprop_get_deactivate().call(e),e._preloader.deactivate(),e._dispatcher.unsubscribe(oi,e.onSeamlessAudioTransition),e._dispatcher.unsubscribe(Ii.repeatModeDidChange,e.onRepeatModeChange)}))()}onSeamlessAudioTransition(e,t){Li.debug("controller handling seamless audio transition, PAF stop",t),this._next({userInitiated:!1,seamlessAudioTransition:!0,endReasonType:Zt.NATURAL_END_OF_TRACK,position:t.previous.playbackDuration/1e3,isPlaying:!1})}hasCapabilities(e){var t,r,n;return e===Hi.SKIP_PREVIOUS||(e!==Hi.REPEAT&&e!==Hi.SHUFFLE||!(null===(t=this.queue)||void 0===t||null===(r=t.currentQueueItem)||void 0===r?void 0:r.isAutoplay))&&((e!==Hi.SEEK&&e!==Hi.PAUSE||!(null===(n=this.nowPlayingItem)||void 0===n?void 0:n.isAssetScrubbingDisabled))&&super.hasCapabilities(e))}onRepeatModeChange(){var e;this.queue.nextPlayableItem&&(Li.info("SerialPlaybackController: preparing new item after RepeatMode change",null===(e=this.queue.nextPlayableItem)||void 0===e?void 0:e.title),this.prepareToPlay(this.queue.nextPlayableItem,!0))}prepareToPlay(e,t=!1){var r=this;return _asyncToGenerator$z((function*(){if(Li.debug("mk: SerialController - prepareToPlay - ",{item:e,preload:t}),e.isPlayable)return r._mediaItemPlayback.prepareToPlay(e).catch(e=>{const n=!t&&-1===[MKError.DEVICE_LIMIT,MKError.STREAM_UPSELL].indexOf(e.errorCode);if(r.continuous&&n)return r._dispatcher.publish(zt.applicationActivityIntent,{endReasonType:Zt.TRACK_SKIPPED_FORWARDS,userInitiated:!1}),r._next();throw e})}))()}prepend(e,t){var r=this,_superprop_get_prepend=()=>super.prepend;return _asyncToGenerator$z((function*(){const n=yield _superprop_get_prepend().call(r,e,t);if(r.shouldTransitionSeamlessly){const e=r.queue,t=e.position,n=e.item(t+1);Li.debug("prepend preparing ",n.title),yield r._mediaItemPlayback.prepareToPlay(n)}return n}))()}returnQueueForOptions(e){var t=this;return _asyncToGenerator$z((function*(){void 0!==(e=(e=>{if(!isQueueURLOption(e))return e;const{url:t}=e,r=_objectWithoutProperties$1(e,["url"]),{contentId:n,kind:i,storefrontId:a}=formattedMediaURL(t);return r[i]=n,Vi.storefrontId=a,ya.debug("parseQueueURLOption",r),r})(e)).startPosition&&(deprecationWarning("startPosition",{message:"startPosition has been deprecated in favor of startWith"}),void 0===e.startWith&&(e.startWith=e.startPosition));const r=yield t._dataForQueueOptions(e),n={services:{dispatcher:t._dispatcher,mediaItemPlayback:t._mediaItemPlayback},descriptor:r};if(void 0!==e.shuffleMode&&(t.shuffleMode=e.shuffleMode),t.queue=new Queue(n),"number"==typeof e.startTime){const r=t.queue.nextPlayableItem;r&&t._mediaItemPlayback.playOptions.set(r.id,{startTime:e.startTime})}if(0===t.queue.length)throw Li.warn("No item data is available for the current media queue",e),new MKError(MKError.CONTENT_UNAVAILABLE,"No item data is available for the current media queue.");return t._autoplayTrackLoader&&t._autoplayTrackLoader.deactivate(),t._autoplayTrackLoader=new AutoplayTrackLoader(t.queue,t._repeatable,{dispatcher:t._dispatcher,apiManager:t._services.apiManager},t._context),t.autoplayEnabled&&t._autoplayTrackLoader.start(),t._dispatcher.publish(Wa,t.queue.items),t.queue}))()}skipToPreviousItem(){var e=this;return _asyncToGenerator$z((function*(){return e._previous({userInitiated:!0})}))()}_dataForQueueOptions(e){var t=this,_superprop_get__dataForQueueOptions=()=>super._dataForQueueOptions;return _asyncToGenerator$z((function*(){var r;const n=e,i=((e,t)=>{const r=getNamedQueueOptions(e,t);if(r.length>1)throw new MKError(MKError.UNSUPPORTED_ERROR,"Queues with multiple media types are not supported.");if(0===r.length)return;const[n]=r,[i,a]=n;if(Array.isArray(t[i])!==a.isPlural)throw new MKError(MKError.UNSUPPORTED_ERROR,a.isPlural?`Queue option ${i} must be an array of id values`:`Queue option ${i} must be a single id value`);return n})(t._services.apiManager.apiService,e);return void 0===i||((null===(r=t.storekit)||void 0===r?void 0:r.restrictedEnabled)&&(e.parameters=_objectSpreadProps$c(_objectSpread$j({},e.parameters),{restrict:"explicit"})),n.loaded=yield Ga(t._services.apiManager.apiService,e,i)),_objectSpread$j({},yield _superprop_get__dataForQueueOptions().call(t,e),n)}))()}_changeToMediaAtIndex(e=0,t={userInitiated:!1}){var r=this,_superprop_get__changeToMediaAtIndex=()=>super._changeToMediaAtIndex;return _asyncToGenerator$z((function*(){const n=yield _superprop_get__changeToMediaAtIndex().call(r,e,t),i=r.queue.nextPlayableItem;return i&&r.shouldTransitionSeamlessly&&(yield r.prepareToPlay(i)),n}))()}_next(e={}){var t=this;return _asyncToGenerator$z((function*(){if(t.queue.isEmpty)return;const{userInitiated:r=!1}=e;return t.repeatMode===ua.one&&void 0!==t.queue.currentItem?(yield t.stop(_objectSpread$j({userInitiated:r},e)),void(yield t.play())):(!r&&e.seamlessAudioTransition&&(t._dispatcher.publish(zt.playbackStop,_objectSpread$j({userInitiated:r,endReasonType:Zt.NATURAL_END_OF_TRACK},e)),e={userInitiated:e.userInitiated,seamlessAudioTransition:!0}),t._nextAtIndex(t.queue.nextPlayableItemIndex,e))}))()}_previous(e={}){var t=this;return _asyncToGenerator$z((function*(){if(t.queue.isEmpty)return;const{userInitiated:r=!1}=e;if(t.repeatMode===ua.one&&void 0!==t.queue.currentItem)return yield t.stop({endReasonType:Zt.TRACK_SKIPPED_BACKWARDS,userInitiated:r}),void(yield t.play());const n=t.queue.previousPlayableItemIndex;if(r&&t.repeatMode===ua.none&&void 0!==t.nowPlayingItem&&-1===n)return yield t.stop({endReasonType:Zt.TRACK_SKIPPED_BACKWARDS,userInitiated:!0}),void(yield t.play());if(-1===n)return;const i=t.isPlaying,a=t._mediaItemPlayback.currentPlaybackTime,o=yield t._changeToMediaAtIndex(n,{userInitiated:r});return t._notifySkip(i,o,{userInitiated:r,seamlessAudioTransition:!1,direction:Zt.TRACK_SKIPPED_BACKWARDS,position:a}),o}))()}_prepareQueue(e){super._prepareQueue(e),this._shuffler.checkAndReshuffle()}get shouldTransitionSeamlessly(){return this._isSeamlessAudioTransitionsEnabled&&this.hasAuthorization&&!this.previewOnly}constructor(e){var t;super(e),this.type=Sa.serial,this._queue=new Queue(e),this._repeatable=new Repeatable(this._dispatcher),this._seekable=new Seekable(this._dispatcher,this._mediaItemPlayback),this._shuffler=new Shuffler(this,{dispatcher:this._dispatcher}),this._queueModifier=new ModifiableQueue(this._queue,this._mediaItemPlayback),this._isSeamlessAudioTransitionsEnabled=!!(null==e||null===(t=e.bag)||void 0===t?void 0:t.features["seamless-audio-transitions"]);const r={controller:this,services:e.services};this._preloader=new Preloader(r)}}Va([Bind(),Ha("design:type",Function),Ha("design:paramtypes",[void 0,void 0])],SerialPlaybackController.prototype,"onSeamlessAudioTransition",null),Va([Bind(),Ha("design:type",Function),Ha("design:paramtypes",[void 0===Hi?Object:Hi])],SerialPlaybackController.prototype,"hasCapabilities",null),Va([Bind(),Ha("design:type",Function),Ha("design:paramtypes",[])],SerialPlaybackController.prototype,"onRepeatModeChange",null);class MKDialog{static presentError(e){const t=e.dialog;void 0!==t?MKDialog.serverDialog(t).present():new MKDialog(e.message).present()}static serverDialog(e){const t=new this(e.message,e.explanation);return e.okButtonAction&&e.okButtonAction.url&&(t._okButtonActionURL=e.okButtonAction.url),e.okButtonString&&(t._okButtonString=e.okButtonString),e.cancelButtonString&&(t._cancelButtonString=e.cancelButtonString),t}static clientDialog(e){const t=new this(e.message,e.explanation);return e.okButtonAction&&(t._okButtonAction=e.okButtonAction),e.cancelButtonAction&&(t._cancelButtonAction=e.cancelButtonAction),e.okButtonString&&(t._okButtonString=e.okButtonString),e.cancelButtonString&&(t._cancelButtonString=e.cancelButtonString),t}get actions(){return this.cancelButton?`<div id="mk-dialog-actions">${this.cancelButton}${this.okButton}</div>`:`<div id="mk-dialog-actions">${this.okButton}</div>`}get cancelButton(){if("string"==typeof this._cancelButtonString)return`<button type="button">${this._cancelButtonString}</button>`}set cancelButton(e){this._cancelButtonString=e}get explanation(){return`<p id="mk-dialog-explanation">${this._explanation}</p>`}get hasOKButtonAction(){return!!this._okButtonActionURL||!!this._okButtonAction}get message(){return`<h5 id="mk-dialog-title">${this._message}</h5>`}get okButton(){return this.hasOKButtonAction&&this._okButtonActionURL?`<button type="button" data-ok-action-url='${this._okButtonActionURL}'>${this._okButtonString}</button>`:`<button type="button">${this._okButtonString}</button>`}present(){const e=document.createDocumentFragment(),t=document.createElement("div");t.id=this.scrimId,e.appendChild(t);const r=document.createElement("div");r.id=this.id,r.classList.add("mk-dialog"),r.setAttribute("role","alertDialog"),r.setAttribute("aria-modal","true"),r.setAttribute("aria-labeledby","mk-dialog-title"),r.setAttribute("aria-describedby","mk-dialog-explanation");let n=`\n      <div id="mk-dialog-body">\n        ${this.message}\n        ${this.explanation}\n      </div>`;n=`\n      ${n}\n      ${this.actions}\n    `,r.innerHTML=n,e.appendChild(r),document.body.appendChild(e),document.querySelector(`#${r.id} #mk-dialog-actions *:first-child`).focus(),setTimeout(()=>{document.querySelector(`#${r.id} #mk-dialog-actions *:first-child`).addEventListener("click",()=>{this._cancelButtonAction&&this._cancelButtonAction(),r.parentElement.removeChild(r),t.parentElement.removeChild(t)}),this.hasOKButtonAction&&(this._okButtonActionURL?document.querySelector(`#${r.id} #mk-dialog-actions *:last-child`).addEventListener("click",e=>{window.open(e.target.dataset.okActionUrl,"_blank"),r.parentElement.removeChild(r),t.parentElement.removeChild(t)}):this._okButtonAction&&document.querySelector(`#${r.id} #mk-dialog-actions *:last-child`).addEventListener("click",e=>{this._okButtonAction(),r.parentElement.removeChild(r),t.parentElement.removeChild(t)}))})}_appendStyle(e){const t=document.createElement("style");t.id=this.styleId,t.styleSheet?t.styleSheet.cssText=e:t.innerHTML=e,document.body.appendChild(t)}constructor(e,t=""){this._message=e,this._explanation=t,this.id="musickit-dialog",this.scrimId=this.id+"-scrim",this.styleId=this.id+"-style",this._okButtonString="OK",[this.id,this.scrimId,this.styleId].forEach(e=>{try{const t=document.getElementById(e);t.parentElement.removeChild(t)}catch(t){}}),this._appendStyle("\n#musickit-dialog {\n  --mk-dialog-background: rgba(255, 255, 255, 1);\n  --mk-dialog-text: rgba(0, 0, 0, 0.95);\n  --mk-dialog-border: rgba(0, 0, 0, 0.07);\n  --mk-dialog-scrim: rgba(255, 255, 255, 0.8);\n  --mk-dialog-primary: rgba(0, 122, 255, 1);\n}\n\n@media (prefers-color-scheme: dark) {\n  #musickit-dialog {\n      --mk-dialog-background: rgba(30, 30, 30, 1);\n      --mk-dialog-text: rgba(255, 255, 255, 0.85);\n      --mk-dialog-border: rgba(255, 255, 255, 0.1);\n      --mk-dialog-scrim: rgba(38, 38, 38, 0.8);\n      --mk-dialog-primary: rgba(8, 132, 255, 1);\n  }\n}\n\n#musickit-dialog-scrim {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: rgba(0, 0, 0, 0.35);\n}\n\n#musickit-dialog * {\n  -webkit-tap-highlight-color: transparent;\n  -webkit-touch-callout: none;\n  -ms-touch-action: none;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  font-family: -apple-system, SF UI Text, Helvetica Neue, Helvetica, sans-serif;\n  font-size: 15px;\n  line-height: 20px;\n}\n\n#musickit-dialog *:focus { outline: 0; }\n\n#musickit-dialog {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  -webkit-justify-content: space-between;\n  -moz-justify-content: space-between;\n  justify-content: space-between;\n  min-width: 277px;\n  max-width: 290px;\n  min-height: 109px;\n  background: var(--mk-dialog-background);\n  box-shadow: 0px 0px 9px rgba(0, 0, 0, 0.18);\n  border-radius: 10px;\n  color: var(--mk-dialog-text);\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  margin-left: -142px;\n  margin-top: -67px;\n  z-index: 9999999999999999999999999;\n}\n\n#musickit-dialog #mk-dialog-body {\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: column;\n  -moz-flex-direction: column;\n  flex-direction: column;\n  flex-grow: 1;\n  -webkit-justify-content: space-evenly;\n  -moz-justify-content: space-evenly;\n  justify-content: space-evenly;\n  -webkit-align-items: stretch;\n  align-items: stretch;\n  padding: 10px 20px;\n  min-height: 74px;\n  text-align: center;\n}\n\n#musickit-dialog .mk-dialog h5 {\n  font-weight: 500;\n  line-height: 20px;\n  margin: 7px 0 0 0;\n  padding: 0;\n}\n\n#musickit-dialog .mk-dialog p {\n  margin: 0 0 7px 0;\n  padding: 0;\n  paddin-top: 3px;\n  line-height: 18px;\n  font-size: 13px;\n  font-weight: 300;\n}\n\n#musickit-dialog #mk-dialog-actions {\n  border-top: 1px solid var(--mk-dialog-border);\n  display: -webkit-box;\n  display: -moz-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-flex-direction: row;\n  -moz-flex-direction: colrowumn;\n  flex-direction: row;\n  max-height: 41px;\n  min-height: 34px;\n  -webkit-justify-self: flex-end;\n  -moz-justify-self: flex-end;\n  justify-self: flex-end;\n}\n\n#musickit-dialog #mk-dialog-actions button {\n  flex-grow: 1;\n  border: 0;\n  background: none;\n  color: var(--mk-dialog-primary);\n  padding: 0;\n  margin: 0;\n  min-height: 34px;\n  height: 41px;\n  text-align: center;\n}\n\n#musickit-dialog #mk-dialog-actions *:nth-child(2) {\n  border-left: 1px solid var(--mk-dialog-border);\n  font-weight: 500;\n}\n")}}var Ya;function asyncGeneratorStep$y(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}e.SupportedAPIs=void 0,(Ya=e.SupportedAPIs||(e.SupportedAPIs={})).MEDIA_API="media-api",Ya.UTS_CLIENT="uts-client";class APIServiceManager{get api(){return this.getApiByType(this._defaultAPI)}get apiService(){if(void 0!==this._defaultAPI)return this._apisByType[this._defaultAPI];Li.error("There is no API instance configured")}get mediaAPI(){return this.getApiByType(e.SupportedAPIs.MEDIA_API)}get utsClient(){return this.getApiByType(e.SupportedAPIs.UTS_CLIENT)}getApiByType(e){let t;if(void 0!==e&&(t=this._apisByType[e]),void 0===t||void 0===t.api)throw new MKError(MKError.CONFIGURATION_ERROR,"There is no API instance configured for the requested type: "+e);return t.api}set defaultApiType(e){this._defaultAPI=e}registerAPIService(e){var t=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$y(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$y(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){const{apiType:r,configureFn:n,options:i}=e,a=i.apiOptions||{};void 0===t._defaultAPI&&(t._defaultAPI=r),t._apisByType[r]=yield n.call(t,{apiOptions:a,store:t.store,dispatcher:t._dispatcher})}))()}constructor(e,t){this.store=e,this._dispatcher=t,this._apisByType={}}}const Qa={};function adaptAddEventListener(e,t,r,n={}){const{once:i}=n,a=function(e,t){const r=getCallbacksForName(e),wrappedCallback=(e,r)=>{t(r)};return r.push([t,wrappedCallback]),wrappedCallback}(t,r);!0===i?e.subscribeOnce(t,a):e.subscribe(t,a)}function getCallbacksForName(e){let t=Qa[e];return t||(t=[],Qa[e]=t),t}function asyncGeneratorStep$x(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$x(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$x(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$x(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const Ja=Li.createChild("rtc");class RTCStreamingTracker{configure(e,t){var r=this;return _asyncToGenerator$x((function*(){r.instance=e}))()}handleEvent(e,t,r){}loadScript(){return _asyncToGenerator$x((function*(){if(!Bi.urls.rtc)throw new Error("bag.urls.rtc is not configured");yield loadScript(Bi.urls.rtc)}))()}prepareReportingAgent(e){this.clearReportingAgent();const t=e||this.instance.nowPlayingItem,r=t?t.defaultPlayable:void 0,{Sender:n,ClientName:i,ServiceName:a,ApplicationName:o,ReportingStoreBag:s,DeviceName:c}=window.rtc.RTCReportingAgentConfigKeys,l={firmwareVersion:this.generateBrowserVersion(),model:this.options.browserName};var u;r?((null===(u=r.mediaMetrics)||void 0===u?void 0:u.MediaIdentifier)&&(l.MediaIdentifier=r.mediaMetrics.MediaIdentifier),r.channelId&&(l.ContentProvider=r.channelId)):"musicVideo"===(null==e?void 0:e.type)?l.MediaIdentifier="adamid="+e.id:(null==e?void 0:e.isLiveVideoStation)&&(l.MediaIdentifier="raid="+e.id);void 0===this._storeBag&&(this._storeBag=this.generateStoreBag());const d={[n]:"HLSJS",[i]:this.options.clientName,[a]:this.options.serviceName,[o]:this.options.applicationName,[s]:this._storeBag,[c]:this.options.osVersion,userInfoDict:l};return Ja.debug("RTC: creating reporting agent with config",d),this.reportingAgent=new window.rtc.RTCReportingAgent(d),Ja.debug("RTC: created reporting agent",this.reportingAgent),this.reportingAgent}cleanup(){var e=this;return _asyncToGenerator$x((function*(){e.clearReportingAgent()}))()}clearReportingAgent(){void 0!==this.reportingAgent&&(this.reportingAgent.destroy(),Ja.debug("RTC: called destroy on reporting agent",this.reportingAgent),this.reportingAgent=void 0)}generateBrowserVersion(){return this.options.browserMajorVersion?`${this.options.browserMajorVersion}.${this.options.browserMinorVersion||0}`:"unknown"}generateStoreBag(){var e;const{storeBagURL:t,clientName:r,applicationName:n,serviceName:i,browserName:a}=this.options,o={iTunesAppVersion:`${`${Bi.app.name}-${Bi.app.build}`}/${null===(e=this.instance)||void 0===e?void 0:e.version}`},s=new window.rtc.RTCStorebag.RTCReportingStoreBag(t,r,i,n,a,o);return Ja.debug("RTC: created store bag",s),s}constructor(e){this.requestedEvents=[],this.options=e}}function asyncGeneratorStep$w(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _defineProperty$i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Xa={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Za={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class PlayActivityService{cleanup(){this.trackers.forEach(e=>{var t;return null===(t=e.cleanup)||void 0===t?void 0:t.call(e)}),this.clearIntention(),this.teardownListeners(),this.registeredEvents.clear()}configure(e,t){var r=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$w(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$w(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){r.cleanup(),r.registeredEvents=function(e){const t=[];for(const r of e)t.push(...r.requestedEvents);return new Set(t)}(r.trackers),r.setupListeners();try{yield Promise.all(r.trackers.map(r=>r.configure(e,t)))}catch(n){Li.error("Error configuring a play activity service",n)}}))()}getTrackerByType(e){return this.trackers.find(t=>t instanceof e)}handleEvent(e,t={}){const r=this.addIntention(e,t);e===zt.playerActivate&&(r.flush="boolean"==typeof t.isPlaying?!t.isPlaying:void 0);for(const n of this.trackers)n.handleEvent(e,r,t.item)}addIntention(e,t){if(![zt.playbackPause,zt.playbackStop].includes(e))return t;const r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$i(e,t,r[t])}))}return e}({},this.lastUserIntent,this.lastApplicationIntent,t);return this.clearIntention(),r}clearIntention(){this.lastUserIntent=void 0,this.lastApplicationIntent=void 0}recordApplicationIntent(e,t){this.lastApplicationIntent=t}recordUserIntent(e,t){this.lastUserIntent=t}setupListeners(){this.registeredEvents.forEach(e=>{this.dispatcher.subscribe(e,this.handleEvent)}),this.dispatcher.subscribe(zt.userActivityIntent,this.recordUserIntent),this.dispatcher.subscribe(zt.applicationActivityIntent,this.recordApplicationIntent)}teardownListeners(){this.registeredEvents.forEach(e=>{this.dispatcher.unsubscribe(e,this.handleEvent)}),this.dispatcher.unsubscribe(zt.userActivityIntent,this.recordUserIntent),this.dispatcher.unsubscribe(zt.applicationActivityIntent,this.recordApplicationIntent)}constructor(e,t){this.dispatcher=e,this.trackers=t,this.registeredEvents=new Set}}function asyncGeneratorStep$v(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$v(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$v(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$v(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}Xa([Bind(),Za("design:type",Function),Za("design:paramtypes",[String,Object])],PlayActivityService.prototype,"handleEvent",null),Xa([Bind(),Za("design:type",Function),Za("design:paramtypes",[String,"undefined"==typeof ActivityIntention?Object:ActivityIntention])],PlayActivityService.prototype,"recordApplicationIntent",null),Xa([Bind(),Za("design:type",Function),Za("design:paramtypes",[String,"undefined"==typeof ActivityIntention?Object:ActivityIntention])],PlayActivityService.prototype,"recordUserIntent",null);const eo=BooleanDevFlag.register("mk-force-safari-hlsjs");function useNativeSafariPlayback(){return!eo.enabled}function requiresHlsJs(e){return _requiresHlsJs.apply(this,arguments)}function _requiresHlsJs(){return(_requiresHlsJs=_asyncToGenerator$v((function*(e){const t=null!=e?e:yield findKeySystemPreference(),r=!useNativeSafariPlayback();return t!==Ct.FAIRPLAY||r}))).apply(this,arguments)}function asyncGeneratorStep$u(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _defineProperty$h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpreadProps$b(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const to=function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$u(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$u(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(e,t,r){const n=new Headers({Authorization:"Bearer "+t,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+r}),i=urlEncodeParameters(_objectSpreadProps$b(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$h(e,t,r[t])}))}return e}({},e.playParams),{keyFormat:"web"})),a=`${Bi.urls.mediaApi}/play/assets?${i}`,o=yield fetch(a,{method:"GET",headers:n});if(500===o.status){const t=new MKError(MKError.SERVER_ERROR);throw t.data=e,t}if(403===o.status){let t;try{var s;t=yield o.json(),t=null==t||null===(s=t.errors)||void 0===s?void 0:s[0]}catch(u){}const r="40303"===(null==t?void 0:t.code)?MKError.SUBSCRIPTION_ERROR:MKError.ACCESS_DENIED;var c;const n=new MKError(r,null!==(c=null==t?void 0:t.title)&&void 0!==c?c:null==t?void 0:t.detail);throw n.data=e,n}if(!o.ok){const t=new MKError(MKError.CONTENT_UNAVAILABLE);throw t.data=e,t}const l=(yield o.json()).results;return Li.debug(`media-item: loaded data from ${a}: ${JSON.stringify(l)}`),l}));return function(t,r,n){return e.apply(this,arguments)}}();function asyncGeneratorStep$t(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$t(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$t(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$t(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const ro=function(){var e=_asyncToGenerator$t((function*(e,t,r){e.hasOffersHlsUrl?yield no(e):e.isLiveRadioStation?yield io(e,t,r):yield oo(e,t,r)}));return function(t,r,n){return e.apply(this,arguments)}}(),no=function(){var e=_asyncToGenerator$t((function*(e){const t=Bi.urls.hlsOffersKeyUrls;if(!t)throw new MKError(MKError.CONTENT_UNSUPPORTED,"HLS OFFERS");e.updateWithLoadedKeys(t),yield ao(e,e.offersHlsUrl)}));return function(t){return e.apply(this,arguments)}}(),io=function(){var e=_asyncToGenerator$t((function*(e,t,r){if(!Bi.features["playready-live-radio"]&&Ft===Ct.PLAYREADY&&"video"!==e.attributes.mediaKind&&!Bi.features["mse-live-radio"])throw new MKError(MKError.CONTENT_UNSUPPORTED,"LIVE_RADIO");const n=(yield to(e,t,r)).assets[0];e.updateWithLoadedKeys({"hls-key-cert-url":n.fairPlayKeyCertificateUrl,"hls-key-server-url":n.keyServerUrl,"widevine-cert-url":n.widevineKeyCertificateUrl}),filterUnavailableLiveRadioUrls(n,e),e.isLiveVideoStation?e.assetURL=n.url:yield ao(e,n.url)}));return function(t,r,n){return e.apply(this,arguments)}}(),ao=function(){var e=_asyncToGenerator$t((function*(e,t){let r;try{r=yield fetch(t)}catch(i){throw makeContentUnavailableError(e)}const n=yield r.text();extractAssetsFromMasterManifest(n,t,e)}));return function(t,r){return e.apply(this,arguments)}}(),extractAssetsFromMasterManifest=(e,t,r)=>{const n=/^#EXT-X-STREAM-INF:.*BANDWIDTH=(\d+),CODECS="(.*)"\s*\n(.*$)/gim;let i;for(;i=n.exec(e);){let[e,n,a,o]=i;/^http(s)?:\/\//.test(o)||(o=rewriteLastUrlPath(t,o)),r.assets.push({bandwidth:Number(n),codec:a,URL:o})}},filterUnavailableLiveRadioUrls=(e,t)=>{const r=new URL(e.url);if(!r.host.endsWith(".apple.com")&&!r.host.endsWith(".applemusic.com"))throw makeContentUnavailableError(t)},makeContentUnavailableError=e=>{const t=new MKError(MKError.CONTENT_UNAVAILABLE);return t.data=e,t},oo=function(){var e=_asyncToGenerator$t((function*(e,t,r){if(Li.debug("mk: loadWithMZPlay",e.playParams),"podcast-episodes"===e.type)return void(e.assetURL=e.attributes.assetUrl);if(!(yield hasMusicSubscription()))return;const i=e.playParams.id,a=new Headers({Authorization:"Bearer "+t,Accept:"application/json","Content-Type":"application/json","X-Apple-Music-User-Token":""+r});let o={salableAdamId:i};if(e.isCloudItem){o={},e.playParams.purchasedId&&(o.purchaseAdamId=e.playParams.purchasedId),e.playParams.catalogId&&(o.subscriptionAdamId=e.playParams.catalogId);const t=/^a\.(\d+)$/;t.test(i)?o.subscriptionAdamId=i.replace(t,"$1"):n(i)&&(o.universalLibraryId=i)}if(!Bi.urls.webPlayback)throw new Error("bag.urls.webPlayback is not configured");const s=yield fetch(Bi.urls.webPlayback,{method:"POST",body:JSON.stringify(o),headers:a}),c=yield s.text(),l=JSON.parse(c);if(!l||!l.songList){const t=MKError.serverError(l,MKError.UNSUPPORTED_ERROR);return e.updateFromLoadError(t),Li.debug("mk: prepareItemWithMZPlay - rejecting with error",t),Promise.reject(t)}const[u]=l.songList;e.updateFromSongList(u)}));return function(t,r,n){return e.apply(this,arguments)}}();function asyncGeneratorStep$s(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$s(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$s(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$s(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function prepareToPlayMediaItem(e,t){return _prepareToPlayMediaItem.apply(this,arguments)}function _prepareToPlayMediaItem(){return(_prepareToPlayMediaItem=_asyncToGenerator$s((function*(e,t){const{developerToken:r,userToken:n}=e.store;if(void 0===r||void 0===n)return Promise.reject(new MKError(MKError.AUTHORIZATION_ERROR,"Unable to prepare media item for play."));if(t.isPreparedToPlay)Li.warn("media-item: item is prepared to play");else{if(Li.debug("media-item: item.prepareToPlay playParams",t.playParams),t.state=P.loading,t.isUTS)return Promise.reject(new MKError(MKError.UNSUPPORTED_ERROR,"Item was not prepared to play"));yield ro(t,r,n)}}))).apply(this,arguments)}function _shouldPlayPreview(){return(_shouldPlayPreview=_asyncToGenerator$s((function*(e,t){return!!e.previewURL&&(!!t||!e.playRawAssetURL&&(!e.isUTS&&!(yield hasMusicSubscription())||(!hasAuthorization()||!e.isPlayable||(e.isUTS?"Preview"===e.type:!supportsDrm()))))}))).apply(this,arguments)}function _prepareForEncryptedPlayback(){return(_prepareForEncryptedPlayback=_asyncToGenerator$s((function*(e,t,r){if(Li.debug("prepareForEncryptedPlayback"),!hasAuthorization())return Promise.reject(new MKError(MKError.AUTHORIZATION_ERROR,"Unable to prepare for playback."));try{yield e.store.validateAgeVerification(t)}catch(Tt){return Tt.errorCode===MKError.CONTENT_RESTRICTED&&t.restrict(),Promise.reject(Tt)}try{yield prepareToPlayMediaItem(e,t)}catch(n){if([MKError.AUTHORIZATION_ERROR].includes(n.errorCode))yield e.store.storekit.revokeUserToken();else if(n.errorCode===MKError.TOKEN_EXPIRED)try{return yield e.store.storekit.renewUserToken(),yield prepareToPlayMediaItem(e,t),t.playbackData=_playbackDataForItem(t,r),t}catch(i){}if(n)return Promise.reject(n)}return t.playbackData=_playbackDataForItem(t,r),t}))).apply(this,arguments)}function _playbackDataForItem(t,r){if(Li.debug("mk: _playbackDataForItem",t),t.isCloudUpload)return t.assets[0];if("musicVideo"!==t.type&&!t.isLiveVideoStation){if(!t.isLiveRadioStation&&!t.hasOffersHlsUrl){const[e]=t.assets.filter(e=>{if(!("flavor"in e))return!1;const t=new RegExp(`\\d{1,2}\\:(c${function(){var e;return null===(e=window.WebKitMediaKeys)||void 0===e?void 0:e.isTypeSupported(Kt+".1_0",Ut.AVC1)}()?"bc":"tr"}p)(\\d{2,3})`,"i"),n=t.test(e.flavor);var i;const a=null!==(i=e.flavor.match(t))&&void 0!==i?i:[];return n&&parseInt(a[2],10)<=r.bitrate});return e}{const n=t.assets.reduce((e,t)=>{const r=t.bandwidth;return e[r]||(e[r]=[]),e[r].push(t),e},{}),i=Object.keys(n).sort((e,t)=>parseInt(e,10)-parseInt(t,10)),a=r.bitrate===e.PlaybackBitrate.STANDARD?i[0]:i[i.length-1];t.assetURL=n[a][0].URL}}}const so=["contributors","modalities","movie","musicVideo","musicMovie","trailer","tvEpisode","uploadedVideo","uploaded-videos","music-videos","music-movies","tv-episodes","workouts"];function getPlayerType(e){var t,r;return(null==e?void 0:e.isUTS)||so.includes(null==e?void 0:e.type)?"video":"podcast-episodes"===(null==e?void 0:e.type)?"audio":null!==(r=null==e||null===(t=e.attributes)||void 0===t?void 0:t.mediaKind)&&void 0!==r?r:"audio"}class HlsJsPreviewImageLoader{loadPreviewImage(e){return this.lastPosition===e||(this.lastPosition=e,this.lastPromise=new Promise((t,r)=>{this.hls.loadImageIframeData$(e).subscribe(e=>{const{data:r}=e,n=new Blob([r],{type:"image/jpeg"});t(n)})})),this.lastPromise}constructor(e){this.hls=e}}function _defineProperty$g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$g(e,t,r[t])}))}return e}function _objectSpreadProps$a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var co={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},lo={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const{audioTracksSwitched:uo,audioTracksUpdated:po,inlineStylesParsed:ho,textTracksSwitched:yo,textTracksUpdated:fo}=jt;class HlsJsTracks extends Notifications{get audioTracks(){return this._audioTracks}get textTracks(){return this._textTracks}set audioTrack(e){this.session&&e&&void 0!==e.id&&(this.session.audioSelectedPersistentID=e.id)}set textTrack(e){var t;this.session.subtitleSelectedPersistentID=null!==(t=null==e?void 0:e.id)&&void 0!==t?t:-1}selectForcedTrack(){const{session:e}=this;if(!(null==e?void 0:e.audioTracks))return;const t=e.audioTracks.filter(t=>t.persistentID===e.audioSelectedPersistentID),r=t&&t.length&&t[0];if(!r)return;const n=e.subtitleMediaOptions.filter(e=>0===e.MediaSelectionOptionsDisplaysNonForcedSubtitles&&e.MediaSelectionOptionsExtendedLanguageTag===r.lang),i=null==n?void 0:n[0];let a;return i?(Ot.debug("hlsjsTracks: found forced track for "+i.MediaSelectionOptionsExtendedLanguageTag),e.subtitleSelectedPersistentID=i.MediaSelectionOptionsPersistentID,a=this.normalizeTextTrack(i)):e.subtitleSelectedPersistentID=-1,a}audioTracksUpdated(e,t){const r=(t&&t.audioMediaSelectionGroup&&t.audioMediaSelectionGroup.MediaSelectionGroupOptions||[]).map(this.normalizeAudioTrack,this);this._audioTracks=r,this.dispatchEvent(po,r)}handleAudioTrackSwitched(){this.dispatchEvent(uo,{selectedId:this.session.audioSelectedPersistentID})}handleInlineStylesParsed(e,t){this.dispatchEvent(ho,t)}handleManifestLoaded(e,t){this.audioTracksUpdated(e,t),this.subtitleTracksUpdated(e,t)}handleSubtitleTrackSwitch(e,t){this.dispatchEvent(yo,t)}subtitleTracksUpdated(e,t){const r=t&&t.subtitleMediaSelectionGroup&&t.subtitleMediaSelectionGroup.MediaSelectionGroupOptions||[],n=[];r.forEach(e=>{0!==e.MediaSelectionOptionsDisplaysNonForcedSubtitles&&n.push(this.normalizeTextTrack(e))}),this._textTracks=n,this.dispatchEvent(fo,n)}normalizeAudioTrack(e){const t=e.MediaSelectionOptionsTaggedMediaCharacteristics,r=(null!=t?t:[]).includes("public.accessibility.describes-video")?"description":"main";return _objectSpreadProps$a(_objectSpread$g({},this.normalizeSelectionOption(e)),{enabled:!1,kind:r,characteristics:t})}normalizeTextTrack(e){var t;let r;return r=(null===(t=e.MediaSelectionOptionsTaggedMediaCharacteristics)||void 0===t?void 0:t.includes("public.accessibility.describes-music-and-sound"))||"clcp"===e.MediaSelectionOptionsMediaType?"captions":"subtitles",_objectSpreadProps$a(_objectSpread$g({},this.normalizeSelectionOption(e)),{mode:"disabled",kind:r})}normalizeSelectionOption(e){return{id:e.MediaSelectionOptionsPersistentID,label:e.MediaSelectionOptionsName,language:e.MediaSelectionOptionsExtendedLanguageTag}}destroy(){const{MANIFEST_LOADED:e,AUDIO_TRACK_SWITCHED:t,SUBTITLE_TRACK_SWITCH:r,INLINE_STYLES_PARSED:n}=window.Hls.Events;this.session.off(e,this.handleManifestLoaded),this.session.off(t,this.handleAudioTrackSwitched),this.session.off(r,this.handleSubtitleTrackSwitch),this.session.off(n,this.handleInlineStylesParsed)}constructor(e){super([uo,po,ho,yo,fo]),this.session=e,this._audioTracks=[],this._textTracks=[];const{MANIFEST_LOADED:t,AUDIO_TRACK_SWITCHED:r,SUBTITLE_TRACK_SWITCH:n,INLINE_STYLES_PARSED:i}=window.Hls.Events;this.session.on(t,this.handleManifestLoaded),this.session.on(r,this.handleAudioTrackSwitched),this.session.on(n,this.handleSubtitleTrackSwitch),this.session.on(i,this.handleInlineStylesParsed)}}function asyncGeneratorStep$r(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$r(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$r(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$r(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}co([Bind(),lo("design:type",Function),lo("design:paramtypes",[])],HlsJsTracks.prototype,"handleAudioTrackSwitched",null),co([Bind(),lo("design:type",Function),lo("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleInlineStylesParsed",null),co([Bind(),lo("design:type",Function),lo("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleManifestLoaded",null),co([Bind(),lo("design:type",Function),lo("design:paramtypes",[void 0,void 0])],HlsJsTracks.prototype,"handleSubtitleTrackSwitch",null);var mo={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},go={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const vo={keySystemGenericError:"keySystemGenericError"},bo=new Set([MKError.DEVICE_LIMIT,MKError.GEO_BLOCK,MKError.WIDEVINE_CDM_EXPIRED]),_o={};_o[Ct.FAIRPLAY]="fairplaystreaming",_o[Ct.PLAYREADY]="playready",_o[Ct.WIDEVINE]="widevine";const So=BooleanDevFlag.get("mk-block-report-cdn-server"),configureCdnReporting=e=>{const{Hls:t}=window;if(t&&So){const r=function deepClone(e){const t=Object.prototype.toString.call(e).toLowerCase().slice(8,-1);switch(t){case"set":return new Set([...e].map(e=>deepClone(e)));case"map":return new Map([...e].map(([e,t])=>[deepClone(e),deepClone(t)]));case"date":return new Date(e.getTime());case"regexp":{const t=e,r="string"==typeof t.flags?t.flags:[t.global?"g":void 0,t.ignoreCase?"i":void 0,t.multiline?"m":void 0,t.sticky?"y":void 0,t.unicode?"u":void 0].filter(e=>void 0!==e).join("");return RegExp(e.source,r)}case"arraybuffer":{const t=e;if("function"==typeof t.slice)return t.slice(0);{const r=new e.constructor(t.byteLength);return new Uint8Array(r).set(new Uint8Array(t)),r}}case"dataview":case"int8array":case"uint8array":case"uint8clampedarray":case"int16array":case"uint16array":case"int32array":case"uint32array":case"float32array":case"float64array":case"bigint64array":case"biguint64array":{const r=e;return new(0,r.constructor)(deepClone(r.buffer),r.byteOffset,"dataview"===t?r.byteLength:r.length)}case"array":case"object":{const t=Array.isArray(e)?[]:{};for(const r in e)hasOwn(e,r)&&(t[r]=deepClone(e[r]));return t}default:return e}}(t.DefaultConfig.fragLoadPolicy);r.default.reportCDNServer=!1,r.customURL.reportCDNServer=!1,e.fragLoadPolicy=r}},To={nightly:!0,carry:!0},Po=JsonDevFlag.register("mk-hlsjs-config-overrides");class HlsJsVideoPlayer extends VideoPlayer{get shouldDispatchErrors(){return!this.userInitiated||this._playbackDidStart}get supportsPreviewImages(){var e,t;return!(Rt.isAndroid||Rt.isiOS||Rt.isMacOs&&navigator.maxTouchPoints>2)&&(null===(e=this._hls)||void 0===e||null===(t=e.iframeVariants)||void 0===t?void 0:t.some(e=>"mjpg"===e.imageCodec))}get currentPlayingDate(){var e;return null===(e=this._hls)||void 0===e?void 0:e.playingDate}get isPlayingAtLiveEdge(){var e;const t=this._hls;return!(!t||!(null===(e=this.nowPlayingItem)||void 0===e?void 0:e.isLinearStream))&&!!t.isPlayingAtLive}get seekableTimeRanges(){const e=this._hls;return e?e.seekableTimeRanges:this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}initializeExtension(){var e=this;return _asyncToGenerator$r((function*(){e._keySystem=yield findKeySystemPreference();try{var t;if(!Dt.urls.hls)throw new Error("bag.urls.hls is not configured");yield Promise.all([loadScript(Dt.urls.hls),null===(t=e._rtcTracker)||void 0===t?void 0:t.loadScript()])}catch(r){throw Ot.error("hlsjs-video-player failed to load script "+Dt.urls.hls,r),r}}))()}destroy(){var e;if(Ot.debug("hlsjs-video-player.destroy"),null===(e=this._hlsJsTracks)||void 0===e||e.destroy(),this._hls){const{ERROR:e,INTERNAL_ERROR:t,MANIFEST_PARSED:r,KEY_REQUEST_STARTED:n,LICENSE_CHALLENGE_CREATED:i,LEVEL_SWITCHED:a,UNRESOLVED_URI_LOADING:o}=window.Hls.Events,s=this._hls;s.stopLoad(),s.detachMedia(),s.off(e,this.handleHlsError),s.off(t,this.handleHlsError),s.off(r,this.handleManifestParsed),s.off(n,this.handleKeyRequestStarted),s.off(i,this.handleLicenseChallengeCreated),s.off(a,this.handleLevelSwitched),this._shouldLoadManifestsOnce&&s.off(o,this.handleUnresolvedUriLoading),s.destroy(),window.hlsSession=void 0}super.destroy(),asAsync(this._license.stop())}playHlsStream(e,t,r={}){var n=this;return _asyncToGenerator$r((function*(){Ot.debug("hlsjs-video-player.playHlsStream",e,t);const{_keySystem:i}=n;if(!i)return;let a,o;n._unrecoverableError=void 0,n.createHlsPlayer();const hasKey=(e,t)=>{var r;return void 0!==(null==t||null===(r=t.keyURLs)||void 0===r?void 0:r[e])};i===Ct.WIDEVINE&&hasKey("widevine-cert-url",t)&&(a="WIDEVINE_SOFTWARE",o={initDataTypes:["cenc","keyids"],distinctiveIdentifier:"optional",persistentState:"required"});const s={subs:"accepts-css",platformInfo:{requiresCDMAttachOnStart:i!==Ct.NONE,maxSecurityLevel:a,keySystemConfig:o},appData:{serviceName:Dt.app.name}},{_rtcTracker:c,_hls:l}=n;if(c){const e=c.prepareReportingAgent(t);void 0!==e&&(s.appData.reportingAgent=e)}Ot.debug("RTC: loadSource with load options",s);const u=n.startPlaybackSequence();return n._shouldLoadManifestsOnce&&(e=e.replace("https://","manifest://"),Ot.info("Manifest already loaded, passing url to HLSJS",e)),l.loadSource(e,s,r.startTime),l.attachMedia(n.video),t&&(n._licenseServerUrl=t.keyURLs["hls-key-server-url"],i===Ct.FAIRPLAY&&hasKey("hls-key-cert-url",t)?l.setProtectionData({fairplaystreaming:{serverCertUrl:t.keyURLs["hls-key-cert-url"]}}):hasKey("widevine-cert-url",t)&&l.setProtectionData({widevine:{serverCertUrl:t.keyURLs["widevine-cert-url"]}})),u}))()}createHlsPlayer(){const{_keySystem:e}=this,{Hls:t}=window,r=M.get(),n={clearMediaKeysOnPromise:!1,customTextTrackCueRenderer:!0,debug:!!r,debugLevel:r,enableIFramePreloading:!1,enablePerformanceLogging:!!r,enablePlayReadyKeySystem:!0,enableQueryParamsForITunes:!this._shouldLoadManifestsOnce,enableRtcReporting:void 0!==this._rtcTracker,keySystemPreference:_o[e],useMediaKeySystemAccessFilter:!0,nativeControlsEnabled:Rt.isAndroid};configureCdnReporting(n),(e=>{const t=A.value;if(!t)return;var r;const n=null!==(r=determineCdnPathPrefix())&&void 0!==r?r:"";t.socketurl&&isAppleHostname(t.socketurl)&&To[n.split(".")[0]]&&(e.socketurl=t.socketurl,e.socketid=t.socketid,e.log=t.log)})(n),(e=>{const t=Po.value;t&&"object"==typeof t&&Object.assign(e,t)})(n);const i=new t(n),{ERROR:a,INTERNAL_ERROR:o,MANIFEST_PARSED:s,KEY_REQUEST_STARTED:c,LICENSE_CHALLENGE_CREATED:l,LEVEL_SWITCHED:u,UNRESOLVED_URI_LOADING:d}=t.Events;i.on(a,this.handleHlsError),i.on(o,this.handleHlsError),i.on(s,this.handleManifestParsed),i.on(c,this.handleKeyRequestStarted),i.on(l,this.handleLicenseChallengeCreated),i.on(u,this.handleLevelSwitched),this._shouldLoadManifestsOnce&&i.on(d,this.handleUnresolvedUriLoading),this._hls=i,window.hlsSession=i,this._hlsJsTracks=new HlsJsTracks(this._hls),this.setupTrackManagers(this._hlsJsTracks),this._hlsPreviewImageLoader=new HlsJsPreviewImageLoader(this._hls)}handleUnresolvedUriLoading(e,t){var r=this;return _asyncToGenerator$r((function*(){const e=r._hls,n=t.uri,i=n.replace("manifest://","https://");var a;Ot.debug("handleUnresolvedUriLoading for uri ",n);const o=null!==(a=xi.getManifest(i))&&void 0!==a?a:yield xi.fetchManifest(i);o?(xi.clear(i),e.off(window.Hls.Events.UNRESOLVED_URI_LOADING,r.handleUnresolvedUriLoading),e.handleResolvedUri(n,{url:i,status:200,data:o.content})):Ot.error("No cached manifest for "+i)}))()}handleLevelSwitched(e,t){var r,n;const{level:i}=t;if(!i)return;const a=null===(r=this._levels)||void 0===r?void 0:r.find(e=>e.persistentId===i);if(!a||(null===(n=this._currentLevel)||void 0===n?void 0:n.persistentId)===(null==a?void 0:a.persistentId))return;this._currentLevel=a;const o=void 0!==a.audioGroupId?this._channelsByGroup[a.audioGroupId]:void 0;this._dispatcher.publish(zt.hlsLevelUpdated,{level:a,channels:o})}handleHlsError(e,t){if(Ot.warn("HLS.js error",JSON.stringify(t)),this._unrecoverableError)return;let r=new MKError(MKError.UNSUPPORTED_ERROR,t.reason);r.data=t;const{keySystemGenericError:n}=vo;if(t.details!==n){if("output-restricted"===t.reason&&(r=new MKError(MKError.OUTPUT_RESTRICTED,t.reason)),t.fatal){if(this._hls.destroy(),!this.shouldDispatchErrors)throw r;this._dispatcher.publish(Qt.mediaPlaybackError,r)}}else this._dispatcher.publish(n,r)}handleManifestParsed(e,t){var r=this;return _asyncToGenerator$r((function*(){var e,n;let i;Ot.debug("handleManifestParsed",t),r._levels=null!==(e=t.levels)&&void 0!==e?e:[],r.nowPlayingItem.state=P.ready,r._channelsByGroup=(null!==(n=t.audioTracks)&&void 0!==n?n:[]).reduce((e,t)=>(e[t.groupId]=t.channels,e),{});try{yield r._playMedia()}catch(a){throw Ot.warn("error from media element, possibly non-fatal",a),a}finally{i=yield r.finishPlaybackSequence()}return i}))()}handleKeyRequestStarted(e,t){Ot.debug("hlsjs-video.handleKeyRequestStarted"),this._hls.generateKeyRequest(t.keyuri,{})}handleLicenseChallengeCreated(e,t){var r=this;return _asyncToGenerator$r((function*(){const{_licenseServerUrl:e,nowPlayingItem:n,_keySystem:i,userInitiated:a}=r;try{var o;const c=yield null===(o=r._license)||void 0===o?void 0:o.start(e,n,t,i,a),l={statusCode:c.status};(null==c?void 0:c.license)&&(i===Ct.FAIRPLAY?l.ckc=s(c.license):l.license=s(c.license));const u=c["renew-after"];u&&(l.renewalDate=new Date(Date.now()+1e3*u)),r._hls.setLicenseResponse(t.keyuri,l)}catch(c){if(r._unrecoverableError)return;const e=c.data,n={};void 0!==(null==e?void 0:e.status)&&(n.statusCode=+e.status),Ot.warn("Passing license response error to Hls.js",n),r._hls.setLicenseResponse(t.keyuri,n),bo.has(c.name)&&(r._unrecoverableError=c,r.resetDeferredPlay(),yield r.stop({endReasonType:Zt.FAILED_TO_LOAD,userInitiated:a})),r.onPlaybackLicenseError(c)}}))()}seekToTime(e){var t=this;return _asyncToGenerator$r((function*(){t._hls?(Ot.debug("hlsjs-video: hls seekTo",e),t._hls.seekTo=e):(Ot.debug("hlsjs-video: media element seek to",e),t._targetElement.currentTime=e)}))()}loadPreviewImage(e){var t=this;return _asyncToGenerator$r((function*(){var r;return null===(r=t._hlsPreviewImageLoader)||void 0===r?void 0:r.loadPreviewImage(e)}))()}constructor(e){var t;super(e),this._channelsByGroup={},this._rtcTracker=null==e||null===(t=e.playbackServices)||void 0===t?void 0:t.getRTCStreamingTracker(),this._license=new License}}var Eo;mo([Bind(),go("design:type",Function),go("design:paramtypes",[String,"undefined"==typeof HlsUnresolvedUriData?Object:HlsUnresolvedUriData])],HlsJsVideoPlayer.prototype,"handleUnresolvedUriLoading",null),mo([Bind(),go("design:type",Function),go("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleLevelSwitched",null),mo([Bind(),go("design:type",Function),go("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleHlsError",null),mo([Bind(),go("design:type",Function),go("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleManifestParsed",null),mo([Bind(),go("design:type",Function),go("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleKeyRequestStarted",null),mo([Bind(),go("design:type",Function),go("design:paramtypes",[void 0,void 0])],HlsJsVideoPlayer.prototype,"handleLicenseChallengeCreated",null),mo([AsyncDebounce(250),go("design:type",Function),go("design:paramtypes",[Number])],HlsJsVideoPlayer.prototype,"seekToTime",null),mo([(Eo=250,(e,t,r)=>{const n=function(e,t){let r,n,i=0;const resetState=()=>{clearTimeout(n),n=0,r=void 0};return function(...a){const o=this;return new Promise((function(s,c){const l=Date.now();l-i<t?(r&&(r.resolve(void 0),resetState()),r={resolve:s,reject:c,args:a},n=setTimeout(()=>{e.apply(o,r.args).then(r.resolve).catch(r.reject),resetState()},t-(l-i+1))):(resetState(),i=l,e.apply(o,a).then(s).catch(c))}))}}(r.value,Eo);r.value=n}),go("design:type",Function),go("design:paramtypes",[Number])],HlsJsVideoPlayer.prototype,"loadPreviewImage",null);class VideoMediaExtension extends MediaExtension{destroy(e){var t;null===(t=this._session)||void 0===t||t.stopLicenseSession(),super.destroy(e)}}function asyncGeneratorStep$q(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$q(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$q(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$q(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}var ko={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},wo={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const{mediaPlaybackError:Io}=Qt,{playbackLicenseError:Oo,playbackSessionError:Ao}=jt;class NativeSafariVideoPlayer extends VideoPlayer{get currentPlayingDate(){}get isPlayingAtLiveEdge(){return!1}get seekableTimeRanges(){return this.currentPlaybackDuration?[{start:0,end:this.currentPlaybackDuration}]:void 0}get supportsPreviewImages(){return!1}initializeExtension(){var e=this;return _asyncToGenerator$q((function*(){if(!e.video)return void Ot.warn("NativeSafariVideoPlayer.initializeExtension No video element, not initializing extension");const t=new VideoMediaExtension(e.video,'video/mp4;codecs="avc1.42E01E"');e.extension=t,yield t.initializeKeySystem(),t.addEventListener(Oo,e.onPlaybackLicenseError),t.addEventListener(Ao,e.onPlaybackSessionError)}))()}destroy(){Ot.debug("native-safari-video-player.destroy");const{extension:e,video:t}=this;this._blobUrl&&(URL.revokeObjectURL(this._blobUrl),this._blobUrl=void 0),e&&t&&(e.removeEventListener(Oo,this.onPlaybackLicenseError),e.removeEventListener(Ao,this.onPlaybackSessionError),t.removeEventListener("loadedmetadata",this.onMetadataLoaded),super.destroy())}loadPreviewImage(e){return _asyncToGenerator$q((function*(){}))()}playHlsStream(e,t,r={}){var n=this;return _asyncToGenerator$q((function*(){Ot.debug("native-safari-video-player.playHlsStream",e);const{video:i}=n;if(!i){const e="NativeSafariVideoPlayer.playHlsStream(): No video element";throw Ot.error(e),new Error(e)}n.setupTrackManagers();const a=n.startPlaybackSequence(),o=(n._shouldLoadManifestsOnce?n.playByBlob(e,i,r):n.playBySource(e,i,r)).then(()=>a);var s;t&&(null===(s=n.extension)||void 0===s||s.setMediaItem(t));return i.addEventListener("loadedmetadata",n.onMetadataLoaded),o}))()}onPlaybackSessionError(e){this._dispatcher.publish(Io,new MKError(MKError.MEDIA_SESSION,e))}onMetadataLoaded(){var e=this;return _asyncToGenerator$q((function*(){Ot.debug("native-safari-video-player.onMetadataLoaded");const{nowPlayingItem:t}=e;t&&(t.state=P.ready),yield e._playMedia(),e.finishPlaybackSequence()}))()}seekToTime(e){var t=this;return _asyncToGenerator$q((function*(){Ot.debug("native-safari-video-player: media element seek to",e),t._targetElement.currentTime=e}))()}playByBlob(e,t,r={}){var n=this;return _asyncToGenerator$q((function*(){Ot.debug("native-safari-video-player: playing video by blob");let i=xi.getManifest(e);if(!i&&(Ot.debug("native-safari-video-player: fetching manifest"),i=yield xi.fetchManifest(e),!i))throw Ot.error("No manifest for "+e),new MKError(MKError.CONTENT_UNAVAILABLE,"Failed to load manifest");Ot.debug("native-safari-video-player: loaded manifest",!!i),xi.clear(e);const a=i.contentType,o=i.content.replace(/^#EXT-X-SESSION-DATA-ITUNES:.*$/gm,""),s=new Blob([o],{type:a});e=URL.createObjectURL(s),n._blobUrl=e;const c=document.createElement("source");c.setAttribute("src",e),a&&c.setAttribute("type",a),Ot.debug("native-safari-video-player: blob url",e),void 0!==r.startTime&&(t.currentTime=r.startTime),t.appendChild(c)}))()}playBySource(e,t,r={}){return _asyncToGenerator$q((function*(){Ot.debug("native-safari-video-player: playing video by source"),void 0!==r.startTime&&(e+="#t="+r.startTime),t.src=e}))()}}function asyncGeneratorStep$p(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}ko([Bind(),wo("design:type",Function),wo("design:paramtypes",[void 0])],NativeSafariVideoPlayer.prototype,"onPlaybackSessionError",null),ko([Bind(),wo("design:type",Function),wo("design:paramtypes",[])],NativeSafariVideoPlayer.prototype,"onMetadataLoaded",null),ko([AsyncDebounce(250),wo("design:type",Function),wo("design:paramtypes",[Number])],NativeSafariVideoPlayer.prototype,"seekToTime",null);const Ro=BooleanDevFlag.register("mk-safari-force-native-live-stream");class Factory{getPlayerForMediaItem(e,t,r){var n=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$p(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$p(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){Ot.debug("mk: getPlayerForMediaItem",e,t);const i=getPlayerType(e);let a=n._playersByType[i];if((null==a?void 0:a.isDestroyed)&&(Ot.debug("mk: existingPlayer was previously destroyed. Removing from factory."),a=void 0,delete n._playersByType[i]),a&&a===r)return r;if(a)return n._applyPlayerState(a,t),a;const{_playerOptions:o}=n;let s;switch(i){case"audio":s=new AudioPlayer(o),n._playersByType[i]=s;break;case"video":{var c;const t=yield null===(c=n._playerOptions.playbackServices)||void 0===c?void 0:c.requiresHlsJs(),r=n._shouldForceHlsJsPlayer(e);s=t||r?new HlsJsVideoPlayer(o):new NativeSafariVideoPlayer(o);break}default:throw new Error("Invalid player type requested: "+i)}return yield s.initialize(),n._applyPlayerState(s,t),s}))()}_shouldForceHlsJsPlayer(e){var t,r,n;return!Ro.enabled&&(e.isLiveVideoStation||e.isLinearStream||(null===(t=e.defaultPlayable)||void 0===t||null===(r=t.assets)||void 0===r||null===(n=r.fpsKeyServerUrl)||void 0===n?void 0:n.startsWith("https://linear.tv.apple.com")))}_applyPlayerState(e,t){return t?(Ot.debug("_applyPlayerState",t),Object.keys(t).forEach(r=>{void 0!==e[r]&&(e[r]=t[r])}),e):e}destroy(){Object.values(this._playersByType).forEach(e=>e.destroy())}constructor(e){this._playersByType={},this._playerOptions=e}}function asyncGeneratorStep$o(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$o(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$o(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$o(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}var Co={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Do={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const{mediaPlaybackError:Mo,playerTypeDidChange:xo}=Qt,{playbackLicenseError:Lo}=jt,{keySystemGenericError:No}=vo,$o=function(){var e=_asyncToGenerator$o((function*(e,t){var r,n;if(null===(r=e.container)||void 0===r||null===(n=r.attributes)||void 0===n?void 0:n.requiresSubscription){if(!(yield t())){const t=new MKError(MKError.SUBSCRIPTION_ERROR);throw t.data=e,t}}}));return function(t,r){return e.apply(this,arguments)}}();let jo=!1;class MediaItemPlayback{get currentPlaybackTime(){return this._currentPlayer.currentPlaybackTime}get currentPlaybackTimeRemaining(){return this._currentPlayer.currentPlaybackTimeRemaining}get currentPlayingDate(){return this._currentPlayer.currentPlayingDate}get isPlayingAtLiveEdge(){return this._currentPlayer.isPlayingAtLiveEdge}get seekableTimeRanges(){return this._currentPlayer.seekableTimeRanges}get audioTracks(){return this._currentPlayer.audioTracks}get currentAudioTrack(){return this._currentPlayer.currentAudioTrack}set currentAudioTrack(e){this._currentPlayer.currentAudioTrack=e}get currentPlaybackDuration(){return this._currentPlayer.currentPlaybackDuration}get currentBufferedProgress(){return this._currentPlayer.currentBufferedProgress}get currentPlaybackProgress(){return this._currentPlayer.currentPlaybackProgress}get currentTextTrack(){return this._currentPlayer.currentTextTrack}set currentTextTrack(e){this._currentPlayer.currentTextTrack=e}get previewOnly(){return this._previewOnly}set previewOnly(e){this._previewOnly=e}get isPlaying(){return this._currentPlayer.isPlaying}get isPrimaryPlayer(){return this._currentPlayer.isPrimaryPlayer}set isPrimaryPlayer(e){this._currentPlayer.isPrimaryPlayer=e}get isReady(){return this._currentPlayer.isReady}get nowPlayingItem(){return this._currentPlayer.nowPlayingItem}get playbackRate(){return this._currentPlayer.playbackRate}set playbackRate(e){this._updatePlayerState("playbackRate",e)}get playbackState(){return this._currentPlayer.playbackState}set playbackState(e){this._currentPlayer.setPlaybackState(e,this.nowPlayingItem)}get playbackTargetAvailable(){return this._currentPlayer.playbackTargetAvailable}get playbackTargetIsWireless(){return this._currentPlayer.playbackTargetIsWireless}get supportsPreviewImages(){return this._currentPlayer.supportsPreviewImages}get textTracks(){return this._currentPlayer.textTracks}get volume(){return this._currentPlayer.volume}set volume(e){var t;this._currentPlayer.isDestroyed&&(null===(t=this._dispatcher)||void 0===t||t.publish(Qt.playbackVolumeDidChange,{}));this._updatePlayerState("volume",e)}clearNextManifest(){this._currentPlayer.clearNextManifest()}destroy(){var e,t;this._playerFactory.destroy(),null===(e=this._dispatcher)||void 0===e||e.unsubscribe(Lo,this.onPlaybackLicenseError),null===(t=this._dispatcher)||void 0===t||t.unsubscribe(No,this.onKeySystemGenericError)}exitFullscreen(){return this._currentPlayer.exitFullscreen()}loadPreviewImage(e){var t=this;return _asyncToGenerator$o((function*(){return t._currentPlayer.loadPreviewImage(e)}))()}getNewSeeker(){return this._currentPlayer.newSeeker()}mute(){this._volumeAtMute=this.volume,this.volume=0}pause(e){var t=this;return _asyncToGenerator$o((function*(){return t._currentPlayer.pause(e)}))()}play(){var e=this;return _asyncToGenerator$o((function*(){return e._currentPlayer.play()}))()}preload(){var e=this;return _asyncToGenerator$o((function*(){return e._currentPlayer.preload()}))()}prepareToPlay(e){var t=this;return _asyncToGenerator$o((function*(){var r;Xi.debug("invoking prepareToPlay for ",e.title);const n=yield t.prepareForEncryptedPlayback(e,{bitrate:t._bitrateCalculator.bitrate}),i=null===(r=t._currentPlayback)||void 0===r?void 0:r.item,a=Dt.features["seamless-audio-transitions"],o="song"===(null==i?void 0:i.type)&&"song"===e.type,s=!e.playRawAssetURL;return a&&o&&s&&(Xi.debug(`setting ${e.title} for seamless audio transition`),yield t._currentPlayer.setNextSeamlessItem(e)),n}))()}requestFullscreen(e){return this._currentPlayer.requestFullscreen(e)}showPlaybackTargetPicker(){this._currentPlayer.showPlaybackTargetPicker()}seekToTime(t,r=e.SeekReasonType.Manual){var n=this;return _asyncToGenerator$o((function*(){yield n._currentPlayer.seekToTime(t,r)}))()}setPresentationMode(e){var t=this;return _asyncToGenerator$o((function*(){return t._currentPlayer.setPresentationMode(e)}))()}startMediaItemPlayback(e,t=!1){var r=this;return _asyncToGenerator$o((function*(){var n;Xi.debug("MediaItemPlayback: startMediaItemPlayback",e),e.resetState(),(e=>{if(e.isLinearStream&&(Rt.isiOS||Rt.isMacOs&&navigator.maxTouchPoints>2)){Xi.warn("Cannot play linear stream on iOS or iPad");const t=new MKError(MKError.CONTENT_UNSUPPORTED,"IOS LINEAR");throw t.data={item:e},t}})(e),yield $o(e,r.hasMusicSubscription);const i=yield r._getPlayerForMediaItem(e);if(yield r.setCurrentPlayer(i),!(null===(n=r._currentPlayer)||void 0===n?void 0:n.hasMediaElement))return Xi.warn(`MediaItemPlayback: Could not play media of type ${e.type}, marking item as unsupported and skipping.`),void e.notSupported();try{e.beginMonitoringStateDidChange(e=>{var t;return null===(t=r._dispatcher)||void 0===t?void 0:t.publish(ht.mediaItemStateDidChange,e)}),e.beginMonitoringStateWillChange(e=>{var t;return null===(t=r._dispatcher)||void 0===t?void 0:t.publish(ht.mediaItemStateWillChange,e)});const n=r.playOptions.get(e.id);n&&r.playOptions.delete(e.id);const i=yield r._playAccordingToPlaybackType(e,t,n);return r._currentPlayback={item:e,userInitiated:t},i}catch(Tt){throw e.updateFromLoadError(Tt),Xi.error(Tt.message,Tt),Tt}}))()}_playAccordingToPlaybackType(e,t,r){var n=this;return _asyncToGenerator$o((function*(){return(yield function(e,t){return _shouldPlayPreview.apply(this,arguments)}(e,n._previewOnly))?n._playPreview(e,t):function(e){return!(!e.playRawAssetURL||!e.attributes.assetUrl)}(e)?n._playRawAsset(e,t,r):isBroadcastRadio(e)?n._playBroadcastRadio(e,t):((e=>{if(!supportsDrm()){const t=new MKError(MKError.CONTENT_UNSUPPORTED,"NO DRM");throw t.data={item:e},Xi.warn("No DRM detected"),t}})(e),n._playEncryptedFull(e,t,r))}))()}_playEncryptedFull(e,t,r){var n=this;return _asyncToGenerator$o((function*(){if(Xi.debug("MediaItemPlayback: play encrypted full",e),!e||!e.isPlayable)return Promise.reject(new MKError(MKError.MEDIA_PLAYBACK,"Not Playable"));const i=n._currentPlayer;try{yield n.prepareForEncryptedPlayback(e,{bitrate:n._bitrateCalculator.bitrate})}catch(Tt){return Xi.error("prepareForEncryptedPlayback Error: userInitiated "+t),i.destroy(),t?Promise.reject(Tt):void i.dispatch(Qt.mediaPlaybackError,Tt)}return yield function(e){return new Promise((t,r)=>{const{ageGatePolicy:n}=e;if(!n||!n.age||!n.frequencyInMinutes)return Li.debug("No ageGatePolicy. Resolving handleAgeGate()"),t(void 0);const i=getLocalStorage(),a=null==i?void 0:i.ageGatePolicyAge,o=null==i?void 0:i.ageGatePolicyExpiration;if(a&&o&&parseInt(o,10)>Date.now()&&parseInt(a,10)>=n.age)return t(void 0);MKDialog.clientDialog({okButtonString:"Yes",okButtonAction:()=>(null==i||i.setItem("ageGatePolicyAge",n.age.toString()),null==i||i.setItem("ageGatePolicyExpiration",(Date.now()+60*n.frequencyInMinutes*1e3).toString()),t(void 0)),cancelButtonString:"No",cancelButtonAction:()=>r(new MKError("AGE_GATE","Age Gate Declined")),explanation:`This content may not be appropriate for ages younger than ${n.age}.`,message:`Are you ${n.age} or older?`}).present()})}(e),Xi.debug("About to play item as encrypted",e),yield i.playItemFromEncryptedSource(e,t,r),e}))()}_playBroadcastRadio(t,r){var n=this;return _asyncToGenerator$o((function*(){if(Xi.debug("MediaItemPlayback: play broadcast radio",t),!Dt.features["broadcast-radio"]){const e=new MKError(MKError.CONTENT_UNAVAILABLE);throw e.data=t,e}const i=n._currentPlayer,a=i.isPaused()&&!r,o=yield to(t,Nn.developerToken,Nn.musicUserToken),s=o.assets[0];return t.playbackType=e.PlaybackType.unencryptedFull,t.trackInfo=o["track-info"],i.nowPlayingItem=t,yield i.playItemFromUnencryptedSource(s.url,a),t}))()}_playRawAsset(t,r,n){var i=this;return _asyncToGenerator$o((function*(){Xi.debug("MediaItemPlayback: play raw asset",t);const a=i._currentPlayer,o=a.isPaused()&&!r;return t.playbackType=e.PlaybackType.unencryptedFull,a.nowPlayingItem=t,yield a.playItemFromUnencryptedSource(t.attributes.assetUrl,o,n),t}))()}_playPreview(t,r){var n=this;return _asyncToGenerator$o((function*(){Xi.debug("MediaItemPlayback: play preview",t);const i=n._currentPlayer,a=i.isPaused()&&!r;return supportsDrm()||i.dispatch(Qt.drmUnsupported,{item:t}),t.playbackType=e.PlaybackType.preview,i.nowPlayingItem=t,yield i.playItemFromUnencryptedSource(t.previewURL,a),t}))()}stop(e){var t=this;return _asyncToGenerator$o((function*(){yield t._currentPlayer.stop(e)}))()}unmute(){this.volume>0||(this.volume=this._volumeAtMute||1,this._volumeAtMute=void 0)}_getPlayerForMediaItem(e){var t=this;return _asyncToGenerator$o((function*(){Xi.debug("MediaItemPlayback:  _getPlayerForMediaItem",e.id);return yield t._playerFactory.getPlayerForMediaItem(e,t.playerState,t._currentPlayer)}))()}setCurrentPlayer(e){var t=this;return _asyncToGenerator$o((function*(){var r;t._currentPlayer!==e&&(Xi.debug("MediaItemPlayback: setting currentPlayer",e),yield t._currentPlayer.stop(),t._currentPlayer=e,null===(r=t._dispatcher)||void 0===r||r.publish(xo,{player:e}))}))()}onKeySystemGenericError(e,t){var r=this;return _asyncToGenerator$o((function*(){var e;jo?null===(e=r._dispatcher)||void 0===e||e.publish(Mo,t):(jo=!0,Xi.warn("Retrying playback after keysystemGenericError"),yield r.restartPlayback())}))()}onPlaybackLicenseError(e,t){var r=this;return _asyncToGenerator$o((function*(){var e;t.errorCode===MKError.PLAYREADY_CBC_ENCRYPTION_ERROR?(Xi.warn("MediaItemPlayback: PLAYREADY_CBC_ENCRYPTION_ERROR...retrying with different key system"),yield r.restartPlayback()):null===(e=r._dispatcher)||void 0===e||e.publish(Mo,t)}))()}restartPlayback(){var e=this;return _asyncToGenerator$o((function*(){yield e.stop();const{_currentPlayback:t}=e;if(t){const{item:r,userInitiated:n}=t;r.resetState(),yield e.startMediaItemPlayback(r,n)}}))()}_updatePlayerState(e,t){this.playerState[e]=t,this._currentPlayer[e]=t}constructor(e){this.playerState={playbackRate:1,volume:1},this.playOptions=new Map,this._previewOnly=!1;const{playbackServices:t}=e;var r,n;this.hasMusicSubscription=t.hasMusicSubscription,this.prepareForEncryptedPlayback=t.prepareForEncryptedPlayback,r=e.tokens,Nn=r,e.bag&&(n=e.bag,Object.assign(Dt,n)),this._dispatcher=e.services.dispatcher,this._bitrateCalculator=e.services.bitrateCalculator,this._playerFactory=new Factory(e),this._currentPlayer=new PlayerStub(e),this._dispatcher.subscribe(Lo,this.onPlaybackLicenseError),this._dispatcher.subscribe(No,this.onKeySystemGenericError)}}function asyncGeneratorStep$n(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$n(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$n(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$n(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$f(e,t,r[t])}))}return e}Co([Bind(),Do("design:type",Function),Do("design:paramtypes",[void 0,void 0])],MediaItemPlayback.prototype,"onKeySystemGenericError",null),Co([Bind(),Do("design:type",Function),Do("design:paramtypes",[void 0,void 0])],MediaItemPlayback.prototype,"onPlaybackLicenseError",null);var Uo={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Go={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const Fo=[MKError.AGE_VERIFICATION,MKError.CONTENT_EQUIVALENT,MKError.CONTENT_RESTRICTED,MKError.CONTENT_UNAVAILABLE,MKError.CONTENT_UNSUPPORTED,MKError.SERVER_ERROR,MKError.SUBSCRIPTION_ERROR,MKError.UNSUPPORTED_ERROR,MKError.USER_INTERACTION_REQUIRED];var Bo;e.PlaybackMode=void 0,(Bo=e.PlaybackMode||(e.PlaybackMode={}))[Bo.PREVIEW_ONLY=0]="PREVIEW_ONLY",Bo[Bo.MIXED_CONTENT=1]="MIXED_CONTENT",Bo[Bo.FULL_PLAYBACK_ONLY=2]="FULL_PLAYBACK_ONLY";const Ko=JsonDevFlag.register("mk-bag-features-overrides");class MKInstance{get developerToken(){return Vi.developerToken}get api(){return this._services.apiManager.api}get audioTracks(){return this._mediaItemPlayback.audioTracks}get authorizationStatus(){return Vi.authorizationStatus}get bitrate(){return this._services.bitrateCalculator.bitrate}set bitrate(e){this._services.bitrateCalculator.bitrate=e}get browserSupportsPictureInPicture(){return function(){if(At)return!1;const e=Lt,t=e&&e.webkitSupportsPresentationMode&&"function"==typeof e.webkitSetPresentationMode,r=document.pictureInPictureEnabled;return!(!t&&!r)}()}get browserSupportsVideoDrm(){return supportsDrm()}get cid(){return(this.realm===e.SKRealm.TV||this.sourceType!==fr.MUSICKIT)&&Vi.cid}get continuous(){return this._playbackController.continuous}set continuous(e){this._playbackController.continuous=e}get autoplayEnabled(){return this._autoplayEnabled}set autoplayEnabled(t){this.realm!==e.SKRealm.MUSIC&&(t=!1),t!==this.autoplayEnabled&&(this._autoplayEnabled=t,this._services.dispatcher.publish(Ii.autoplayEnabledDidChange,this.autoplayEnabled))}get currentAudioTrack(){return this._mediaItemPlayback.currentAudioTrack}set currentAudioTrack(e){this._mediaItemPlayback.currentAudioTrack=e}get currentPlaybackDuration(){return this._mediaItemPlayback.currentPlaybackDuration}get currentPlaybackProgress(){return this._mediaItemPlayback.currentPlaybackProgress}get currentPlaybackTime(){return this._mediaItemPlayback.currentPlaybackTime}get currentPlayingDate(){return this._mediaItemPlayback.currentPlayingDate}get isPlayingAtLiveEdge(){return this._mediaItemPlayback.isPlayingAtLiveEdge}get seekableTimeRanges(){return this._mediaItemPlayback.seekableTimeRanges}get currentPlaybackTimeRemaining(){return this._mediaItemPlayback.currentPlaybackTimeRemaining}get currentTextTrack(){return this._mediaItemPlayback.currentTextTrack}set currentTextTrack(e){this._mediaItemPlayback.currentTextTrack=e}get isAuthorized(){return Vi.isAuthorized}get isPlaying(){return this._playbackController.isPlaying}get isRestricted(){return Vi.isRestricted}get metricsClientId(){return Vi.metricsClientId}set metricsClientId(e){Vi.metricsClientId=e}get musicUserToken(){return Vi.musicUserToken}set musicUserToken(e){e&&Vi.musicUserToken===e||(Vi.musicUserToken=e)}updateUserTokenFromStorage(){return Vi.updateUserTokenFromStorage()}get needsGDPR(){return Vi.needsGDPR}get nowPlayingItem(){return this._mediaItemPlayback.nowPlayingItem}get nowPlayingItemIndex(){return this._playbackController.nowPlayingItemIndex}get playbackMode(){return this._playbackMode}set playbackMode(t){if(-1===Object.values(e.PlaybackMode).indexOf(t))return;this._playbackMode=t;const r=t===e.PlaybackMode.PREVIEW_ONLY,n=this._services.mediaItemPlayback;n&&(n.previewOnly=r)}get playbackRate(){return this._mediaItemPlayback.playbackRate}set playbackRate(e){this._mediaItemPlayback.playbackRate=e}get playbackState(){return this._mediaItemPlayback.playbackState}get playbackTargetAvailable(){return this._mediaItemPlayback.playbackTargetAvailable}get playbackTargetIsWireless(){return this._mediaItemPlayback.playbackTargetIsWireless}get previewOnly(){return this.playbackMode===e.PlaybackMode.PREVIEW_ONLY}set previewOnly(t){this.playbackMode=t?e.PlaybackMode.PREVIEW_ONLY:e.PlaybackMode.MIXED_CONTENT}get queue(){return this._playbackController.queue}get queueIsEmpty(){return this._playbackController.queue.isEmpty}get realm(){return Vi.realm}get repeatMode(){return this._playbackController.repeatMode}set repeatMode(e){this._playbackController.repeatMode=e}set requestUserToken(e){Vi.requestUserToken=e}get restrictedEnabled(){return Vi.restrictedEnabled}set restrictedEnabled(e){Vi.restrictedEnabled=e}get supportsPreviewImages(){return this._mediaItemPlayback.supportsPreviewImages}get seekSeconds(){return this._playbackController.seekSeconds}get services(){return this._services}set shuffle(e){this._playbackController.shuffle=e}get shuffleMode(){return this._playbackController.shuffleMode}set shuffleMode(e){this._playbackController.shuffleMode=e}get storefrontCountryCode(){return Vi.storefrontCountryCode}get subscribeURL(){return Vi.subscribeURL}get subscribeFamilyURL(){return Vi.subscribeFamilyURL}get subscribeIndividualURL(){return Vi.subscribeIndividualURL}get subscribeStudentURL(){return Vi.subscribeStudentURL}get textTracks(){return this._mediaItemPlayback.textTracks}get videoContainerElement(){return this.context.videoContainerElement}set videoContainerElement(e){this.context.videoContainerElement=e}get volume(){return this._mediaItemPlayback.volume}set volume(e){this._mediaItemPlayback.volume=e}get storefrontId(){return Vi.storefrontId}set storefrontId(e){Vi.storefrontId=e}get _mediaItemPlayback(){return this._services.mediaItemPlayback}get _playbackController(){if(void 0!==this._playbackControllerInternal)return this._playbackControllerInternal;Xi.debug("setting _playbackController");const e=this._getPlaybackControllerByType(Sa.serial);return this._playbackController=e,e}set _playbackController(e){this._playbackControllerInternal=e,this._playbackControllerInternal.autoplayEnabled=this._autoplayEnabled,this._playbackControllerInternal.activate(),this.capabilities.updateChecker(this._playbackControllerInternal.hasCapabilities),this.capabilities.controller=this._playbackControllerInternal}addEventListener(e,t,r={}){adaptAddEventListener(this._services.dispatcher,e,t,r)}authorize(){var e=this;return _asyncToGenerator$n((function*(){return e.deferPlayback(),Vi.authorize()}))()}canAuthorize(){return supportsDrm()&&!this.isAuthorized}canUnauthorize(){return supportsDrm()&&this.isAuthorized}changeToMediaAtIndex(e){var t=this;return _asyncToGenerator$n((function*(){t._isPlaybackSupported()&&(yield t._validateAuthorization(),t._signalChangeItemIntent(),yield t._playbackController.changeToMediaAtIndex(e))}))()}changeToMediaItem(e){var t=this;return _asyncToGenerator$n((function*(){Xi.debug("instance.changeToMediaItem",e),t._isPlaybackSupported()&&(yield t._validateAuthorization(),t._signalChangeItemIntent(),yield t._playbackController.changeToMediaItem(e))}))()}changeUserStorefront(e){var t=this;return _asyncToGenerator$n((function*(){t.storefrontId=e}))()}cleanup(){var e=this;return _asyncToGenerator$n((function*(){var t;null===(t=e._services.mediaItemPlayback)||void 0===t||t.destroy(),e._signalIntent({endReasonType:Zt.EXITED_APPLICATION});const r=Object.keys(e._playbackControllers).map(t=>e._playbackControllers[t].destroy());try{yield Promise.all(r)}catch(n){Xi.error("Error cleaning up controller",n)}e._services.dispatcher.clear()}))()}configure(e){var t=this;return _asyncToGenerator$n((function*(){return t._whenConfigured=t._configure(e),t._whenConfigured}))()}_configure(e){var t=this;return _asyncToGenerator$n((function*(){yield Vi.storekit.whenAuthCompleted;const r=e.map(t._services.apiManager.registerAPIService,t._services.apiManager);yield Promise.all(r),yield t._configurePlayActivity(),t._initializeExternalEventPublishing()}))()}deferPlayback(){Xi.debug("deferPlayback",this._playbackControllerInternal),deferPlayback()}getApiByType(e){var t;return null===(t=this._services.apiManager)||void 0===t?void 0:t.getApiByType(e)}me(){return _asyncToGenerator$n((function*(){try{return yield Vi.storekit.me()}catch(e){return Promise.reject(new MKError(MKError.AUTHORIZATION_ERROR,"Unauthorized"))}}))()}musicSubscriptionOffers(){return Vi.storekit.musicSubscriptionOffers(this.storefrontId)}musicSubcriptionOffers(){return deprecationWarning("musicSubcriptionOffers",{message:"musicSubcriptionOffers has been deprecated, use musicSubscriptionOffers instead"}),this.musicSubscriptionOffers()}hasMusicSubscription(){return hasMusicSubscription(Vi.storekit)}mute(){return this._mediaItemPlayback.mute()}pause(e){var t=this;return _asyncToGenerator$n((function*(){if(t._isPlaybackSupported()){try{t._signalIntent({endReasonType:Zt.PLAYBACK_MANUALLY_PAUSED}),yield t._playbackController.pause(e)}catch(Tt){t._handlePlaybackError(Tt)}return Promise.resolve()}}))()}play(){var e=this;return _asyncToGenerator$n((function*(){if(Xi.debug("instance.play()"),e._isPlaybackSupported()){yield e._validateAuthorization();try{yield e._playbackController.play()}catch(Tt){e._handlePlaybackError(Tt)}return Promise.resolve()}}))()}playMediaItem(e,t){var r=this;return _asyncToGenerator$n((function*(){if(Xi.debug("mk: playMediaItem",e),(null==t?void 0:t.bingeWatching)||r.deferPlayback(),t=_objectSpread$f({},t),(null==e?void 0:e.playEvent)&&!hasOwn(t,"startTime")){const{playEvent:r}=e;r.isDone||void 0===r.playCursorInSeconds||(t.startTime=r.playCursorInSeconds)}try{t&&r._mediaItemPlayback.playOptions.set(e.id,t);const n=yield r._playbackController.playSingleMediaItem(e,t);return r.services.dispatcher.publish(Ii.capabilitiesChanged),n}catch(Tt){Xi.error("mk:playMediaItem error",Tt),r._handlePlaybackError(Tt)}}))()}removeEventListener(e,t){!function(e,t,r){const n=getCallbacksForName(t);let i;for(let a=n.length-1;a>=0;a--){const[e,t]=n[a];if(e===r){i=t,n.splice(a,1);break}}i&&e.unsubscribe(t,i)}(this._services.dispatcher,e,t)}shouldDisplayPrivacyLink(e){return _asyncToGenerator$n((function*(){return Vi.shouldDisplayPrivacyLink(e)}))()}exitFullscreen(){return this._mediaItemPlayback.exitFullscreen()}requestFullscreen(e){return this._mediaItemPlayback.requestFullscreen(e)}loadPreviewImage(e){var t=this;return _asyncToGenerator$n((function*(){return t._mediaItemPlayback.loadPreviewImage(e)}))()}getNewSeeker(){return this._playbackController.getNewSeeker()}seekToTime(t,r=e.SeekReasonType.Manual){var n=this;return _asyncToGenerator$n((function*(){if(n._isPlaybackSupported()){yield n._validateAuthorization();try{yield n._playbackController.seekToTime(t,r)}catch(Tt){n._handlePlaybackError(Tt)}return Promise.resolve()}}))()}setPresentationMode(e){var t=this;return _asyncToGenerator$n((function*(){return t._mediaItemPlayback.setPresentationMode(e)}))()}skipToNextItem(){var e=this;return _asyncToGenerator$n((function*(){if(e._isPlaybackSupported()){yield e._validateAuthorization(),e._signalIntent({endReasonType:Zt.TRACK_SKIPPED_FORWARDS,direction:Zt.TRACK_SKIPPED_FORWARDS});try{yield e._playbackController.skipToNextItem()}catch(Tt){e._handlePlaybackError(Tt)}}}))()}skipToPreviousItem(){var e=this;return _asyncToGenerator$n((function*(){if(e._isPlaybackSupported()){yield e._validateAuthorization(),e._signalIntent({endReasonType:Zt.TRACK_SKIPPED_BACKWARDS,direction:Zt.TRACK_SKIPPED_BACKWARDS});try{yield e._playbackController.skipToPreviousItem()}catch(Tt){e._handlePlaybackError(Tt)}}}))()}seekForward(){var e=this;return _asyncToGenerator$n((function*(){if(e._isPlaybackSupported()){yield e._validateAuthorization();try{e._signalIntent({endReasonType:Zt.TRACK_SKIPPED_FORWARDS,direction:Zt.TRACK_SKIPPED_FORWARDS}),yield e._playbackController.seekForward()}catch(Tt){e._handlePlaybackError(Tt)}}}))()}seekBackward(){var e=this;return _asyncToGenerator$n((function*(){if(e._isPlaybackSupported()){yield e._validateAuthorization();try{yield e._playbackController.seekBackward()}catch(Tt){e._handlePlaybackError(Tt)}}}))()}showPlaybackTargetPicker(){this._playbackController.showPlaybackTargetPicker()}stop(e){var t=this;return _asyncToGenerator$n((function*(){if(t._isPlaybackSupported()){var r;t._signalIntent({endReasonType:null==e?void 0:e.endReasonType,userInitiated:null===(r=null==e?void 0:e.userInitiated)||void 0===r||r});try{yield t._playbackController.stop(e)}catch(Tt){t._handlePlaybackError(Tt)}}}))()}resetSubscribeViewEligibility(){Vi.storekit.resetSubscribeViewEligibility()}unauthorize(){return _asyncToGenerator$n((function*(){return Vi.unauthorize()}))()}unmute(){return this._mediaItemPlayback.unmute()}_createPlayerControllerOptions(){return{tokens:Vi,bag:Bi,playbackServices:{getRTCStreamingTracker:()=>{var e;return null===(e=this._services.playActivity)||void 0===e?void 0:e.getTrackerByType(RTCStreamingTracker)},hasMusicSubscription:hasMusicSubscription,prepareForEncryptedPlayback:(e,t)=>function(e,t,r){return _prepareForEncryptedPlayback.apply(this,arguments)}(this._services.apiManager,e,t),requiresHlsJs:requiresHlsJs},services:this._services,context:this.context,autoplayEnabled:this.autoplayEnabled,privateEnabled:this.privateEnabled,siriInitiated:this.siriInitiated,storekit:null==Vi?void 0:Vi.storekit}}_getPlaybackControllerByType(e){const t=this._playbackControllers[e];if(t)return t;let r;switch(e){case Sa.serial:r=new SerialPlaybackController(this._createPlayerControllerOptions());break;case Sa.continuous:r=new ContinuousPlaybackController(this._createPlayerControllerOptions());break;default:throw new MKError(MKError.UNSUPPORTED_ERROR,"Unsupported controller requested: "+e)}return this._playbackControllers[e]=r,r}_handlePlaybackError(e){if(Xi.error("mediaPlaybackError",e),Fo.includes(e.name))throw e;this._playbackErrorDialog&&!At&&MKDialog.presentError(e)}_initializeInternalEventHandling(){Vi.storekit.addEventListener(Ii.userTokenDidChange,()=>{this._whenConfigured&&this._whenConfigured.then(()=>this._configurePlayActivity().catch()).catch()});const t=this._services.dispatcher;t.subscribe(Ii.mediaPlaybackError,(e,t)=>this._handlePlaybackError(t)),t.subscribe(Ii.playbackStateDidChange,(t,r)=>{r.state===e.PlaybackStates.paused&&(Xi.debug("mk: playbackStateDidChange callback - calling storekit.presentSubscribeViewForEligibleUsers"),Vi.storekit.presentSubscribeViewForEligibleUsers({state:r.state,item:this.nowPlayingItem},!1))})}_initializeExternalEventPublishing(){[Ii.authorizationStatusDidChange,Ii.needsGDPRDidChange,Ii.storefrontCountryCodeDidChange,Ii.storefrontIdentifierDidChange,Ii.userTokenDidChange,Ii.eligibleForSubscribeView].forEach(e=>{Vi.storekit.addEventListener(e,t=>this._services.dispatcher.publish(e,t))});const e=k[this.storefrontId.toUpperCase()],t=E[e];this._services.dispatcher.subscribe(si,(e,r)=>{r.resolveAdamIdFromStorefront(t),this._services.dispatcher.publish(Ii.timedMetadataDidChange,r)})}configureLogger(e){var t;Xi.level===Qi&&(!0===e.debug?setRootLoggingLevel(N.DEBUG):void 0!==e.logLevel&&setRootLoggingLevel(e.logLevel)),void 0!==e.logHandler&&(t=e.logHandler,Xi.handlers.external=new CallbackHandler(t))}_configurePlayActivity(){var e=this;return _asyncToGenerator$n((function*(){void 0!==e._services.playActivity&&(yield e._services.playActivity.configure(e,{services:e._services}))}))()}_isPlaybackSupported(){return!At||(Xi.warn("Media playback is not supported in Node environments."),!1)}_updatePlaybackController(e){var t=this;return _asyncToGenerator$n((function*(){Xi.debug("mk: _updatePlaybackController",e),t._playbackControllerInternal!==e&&(t._playbackControllerInternal&&(yield t._playbackControllerInternal.deactivate()),t._playbackController=e)}))()}_signalChangeItemIntent(){this._signalIntent({endReasonType:Zt.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM})}_signalIntent(e){this.services.dispatcher.publish(zt.userActivityIntent,_objectSpread$f({userInitiated:!0},e))}_validateAuthorization(t=!1){var r=this;return _asyncToGenerator$n((function*(){(t||r.playbackMode===e.PlaybackMode.FULL_PLAYBACK_ONLY)&&(void 0!==r._playbackControllerInternal&&r._playbackControllerInternal.isReady&&r._playbackControllerInternal.isPlaying||(yield r.authorize()))}))()}constructor(t,r={}){if(this._autoplayEnabled=!1,this.privateEnabled=!1,this.siriInitiated=!1,this.sourceType=fr.MUSICKIT,this.version=e.version,this._bag=Bi,this._playbackControllers={},this._playbackErrorDialog=!0,this._playbackMode=e.PlaybackMode.MIXED_CONTENT,this._whenConfigured=void 0,"string"!=typeof t)throw new Error("MusicKit was initialized without an developerToken.");Object.assign(Bi.features,function(e=[]){const t={};return e.forEach(e=>{"-"===e.charAt(0)?(e=e.substr(1),t[e]=!1):t[e]=!0}),t}(r.features));const n=Ko.get();n&&(Xi.warn("Overriding bag.features with",n),Bi.features=_objectSpread$f({},Bi.features,n)),Object.assign(Bi.autoplay,r.autoplay),this.context={};const i=new PubSub;this.capabilities=new Capabilities(i),r.playbackActions&&(this.playbackActions=r.playbackActions),r.guid&&(this.guid=r.guid);const a=new TimingAccuracy(!!Bi.features["player-accurate-timing"]),o=new BitrateCalculator(i,r.bitrate);this._services={dispatcher:i,timing:a,bitrateCalculator:o},void 0!==r.playActivityAPI&&(this._services.playActivity=new PlayActivityService(i,r.playActivityAPI)),r.services=this._services,this.configureLogger(r),Bi.app=r.app||{},Bi.store=new DataStore({filter:getFilterFromFlags(r.storeFilterTypes||[]),shouldDisableRecordReuse:!!Bi.features["disable-data-store-record-reuse"]}),Object.assign(Bi.urls,r.urls||{});const s=function(e,t){return Vi=new Store(e,t),Vi}(t,r);this._services.apiManager=new APIServiceManager(s,i);const c=new MediaItemPlayback(this._createPlayerControllerOptions());if(this._services.mediaItemPlayback=c,r.sourceType&&(this.sourceType=r.sourceType),this._initializeInternalEventHandling(),r.bitrate&&(this.bitrate=r.bitrate),r.prefix&&/^(?:web|preview)$/.test(r.prefix)&&(this.prefix=Bi.prefix=r.prefix),r.suppressErrorDialog&&(this._playbackErrorDialog=!r.suppressErrorDialog),void 0!==r.playbackMode&&(this.playbackMode=r.playbackMode),this.privateEnabled=r.privateEnabled||!1,this.siriInitiated=r.siriInitiated||!1,this.id=generateUUID(),Xi.info("MusicKit JS Version: "+this.version),Xi.info("InstanceId",this.id),Xi.debug("Link Parameters",r.linkParameters),Bi.app&&Xi.debug("App",Bi.app),r.userToken){const{userToken:e}=r;"function"==typeof e?Vi.dynamicMusicUserToken=e:this.musicUserToken=e}}}function asyncGeneratorStep$m(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$m(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$m(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$m(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function dispatchDocumentEvent(e){if(At)return;const t=new Event(e,{bubbles:!0,cancelable:!0});setTimeout(()=>document.dispatchEvent(t))}function _loadWebComponents(){return(_loadWebComponents=_asyncToGenerator$m((function*(){var e;if(At)return;const t=findScript("musickit.js");if(""!==(null==t||null===(e=t.dataset)||void 0===e?void 0:e.webComponents))return;const r="noModule"in t,n=`components/musickit-components/musickit-components${r?".esm":""}.js`,i="https:"+cdnBaseURL(n)+n,a={};r&&(a.type="module"),t.hasAttribute("async")&&(a.async=""),t.hasAttribute("defer")&&(a.defer=""),yield loadScript(i,a),dispatchDocumentEvent(Ii.webComponentsLoaded)}))).apply(this,arguments)}function asyncGeneratorStep$l(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$l(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$l(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$l(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$e(e,t,r[t])}))}return e}Uo([AsyncDebounce(250,{isImmediate:!0}),Go("design:type",Function),Go("design:paramtypes",["undefined"==typeof ActivityNotificationOptions?Object:ActivityNotificationOptions])],MKInstance.prototype,"pause",null),Uo([AsyncDebounce(250,{isImmediate:!0}),Go("design:type",Function),Go("design:paramtypes",[])],MKInstance.prototype,"play",null),Uo([SerialAsync("skip"),Go("design:type",Function),Go("design:paramtypes",[])],MKInstance.prototype,"skipToNextItem",null),Uo([SerialAsync("skip"),Go("design:type",Function),Go("design:paramtypes",[])],MKInstance.prototype,"skipToPreviousItem",null),Uo([SerialAsync("seek"),Go("design:type",Function),Go("design:paramtypes",[])],MKInstance.prototype,"seekForward",null),Uo([SerialAsync("seek"),Go("design:type",Function),Go("design:paramtypes",[])],MKInstance.prototype,"seekBackward",null);const Vo="undefined"!=typeof window&&"undefined"!=typeof document;let Ho=!1;const Wo=[];function cleanupInstances(){return _cleanupInstances.apply(this,arguments)}function _cleanupInstances(){return(_cleanupInstances=_asyncToGenerator$l((function*(){const e=Wo.map(e=>e.cleanup());yield Promise.all(e),Wo.splice(0,Wo.length)}))).apply(this,arguments)}function configure$3(e){return _configure$2.apply(this,arguments)}function _configure$2(){return(_configure$2=_asyncToGenerator$l((function*(e,t=MKInstance,r){if(!e)throw new MKError(MKError.INVALID_ARGUMENTS,"configuration required");const n={},{developerToken:i,mergeQueryParams:a}=e;if(!i)throw new MKError(MKError.CONFIGURATION_ERROR,"Missing developer token");a&&Vo&&window.location&&(n.linkParameters=_objectSpread$e({},e.linkParameters||{},parseQueryParams(window.location.href))),yield findKeySystemPreference();const o=new t(i,_objectSpread$e({},e,n));return Ho||(yield cleanupInstances()),r&&(yield r(o)),Wo.push(o),dispatchDocumentEvent(Ii.configured),o}))).apply(this,arguments)}function _defineProperty$d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$d(e,t,r[t])}))}return e}function transformParameters(e,t=25){if(e)return e.limit&&(e.limit=e.limit>t?t:e.limit),e}function transformStoreData(e){const t=_objectSpread$d({},e),{href:r}=t;return void 0!==r&&(delete t.href,t.attributes=_objectSpread$d({},t.attributes,{href:r})),t}Vo&&(asAsync(function(){return _loadWebComponents.apply(this,arguments)}()),dispatchDocumentEvent(Ii.loaded));function transformTrackParameters(e){return e.map(e=>"string"==typeof e?{id:e,type:"songs"}:{id:e.id,type:e.type||"songs"})}const qo=["extend","include","l","platform","views"];class LocalDataStore{get hasDataStore(){return this.enableDataStore&&void 0!==this._store}delete(e,t){this.hasDataStore&&this._store.remove(e,t)}read(e,t,r,n){n||"function"!=typeof r||(n=r,r=void 0);const i={};let a=!1;if(r&&(a=Object.keys(r).some(e=>/^(fields|extend)/.test(e)),r.views&&(i.views=r.views),r.include&&(i.relationships=r.include)),this.hasDataStore&&!a){let n,a=[];if(r&&(a=Object.keys(r).reduce((e,t)=>(-1===qo.indexOf(t)&&e.push([t,r[t]]),e),a)),n=a&&1===a.length?this._store.query(a[0][0],a[0][1]):this._store.peek(e,t,i),Array.isArray(n)){if(!r&&n.length)return n}else if(n)return n}if("function"==typeof n)return n()}write(e){return this._prepareDataForDataStore(e,e=>this._store.save(e))}parse(e){return this._prepareDataForDataStore(e,e=>this._store.populateDataRecords(e,{}))}_prepareDataForDataStore(e,t){return this.hasDataStore?Array.isArray(e)?t({data:e}):Object.keys(e).reduce((r,n)=>{const i=e[n];return hasOwn(i,"data")&&(r[n]=t({data:i.data})),"meta"===n&&(r[n]=e[n]),r},{}):e}constructor(e={}){this.enableDataStore=!1;let t=!1;e.features&&hasOwn(e.features,"api-data-store")&&(this.enableDataStore=!!e.features["api-data-store"]),e.features&&hasOwn(e.features,"disable-data-store-record-reuse")&&(t=!!e.features["disable-data-store-record-reuse"]),this.enableDataStore&&(this._store=e.store||new DataStore({shouldDisableRecordReuse:t}),this._store.mapping=transformStoreData)}}function asyncGeneratorStep$k(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$k(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$k(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$k(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}const ChunkedIdApi=(e,t=100,r=1e3)=>(n,i,a)=>{if(void 0===a||"function"!=typeof a.value)throw new TypeError(`Only methods can be decorated with @ChunkedIdApi, but ${i} is not a method.`);return{configurable:!0,get(){const n=a.value;function chunkedIdApi(){return _chunkedIdApi.apply(this,arguments)}function _chunkedIdApi(){return(_chunkedIdApi=_asyncToGenerator$k((function*(...i){const a=i[e];if(a&&Array.isArray(a)){const o=a[0].length||20,s=Math.min(t,Math.floor(r/o)),c=Math.ceil(a.length/s);if(c>1){const t=i.slice(0,e),r=i.slice(e+1),o=[];let l=0;for(let e=1;e<=c;e++){const i=Math.min(e*s,a.length),c=[...t,a.slice(l,i),...r];o.push(n.apply(this,c)),l+=s}const u=yield Promise.all(o);return[].concat(...u)}}return n.apply(this,i)}))).apply(this,arguments)}return Object.defineProperty(this,i,{value:chunkedIdApi,configurable:!0,writable:!0}),chunkedIdApi}}},formatTimezoneOffset=(e=new Date)=>{const t=e.getTimezoneOffset(),r=Math.floor(Math.abs(t)/60),n=Math.round(Math.abs(t)%60);let i="+";return 0!==t&&(i=t>0?"-":"+"),`${i}${leadingZeros(r,2)}:${leadingZeros(n,2)}`},leadingZeros=(e,t=2)=>{let r=""+e;for(;r.length<t;)r="0"+r;return r};function asyncGeneratorStep$j(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$j(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$j(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$j(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpreadProps$9(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var zo={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Yo={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class Books extends TokenSession{audioBook(e,t,r){return this.resource("audio-books",e,t,r)}audioBooks(e,t,r){return this.collection("audio-books",e,t,r)}collection(e,t,r,n){var i=this;return _asyncToGenerator$j((function*(){const a=`catalog/${i.storefrontId}/${e}`;return t&&((r=r||{}).ids=t),makeRequest(i,a,r,n)}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}resource(e,t,r,n){var i=this;return _asyncToGenerator$j((function*(){if(!(null==n?void 0:n.reload)){const n=i._store.read(e,t,r);if(n)return n}const[a]=yield i.collection(e,t,r,n);return a}))()}constructor(e,t,r,n,i={},a){super("https://api.books.apple.com/v1",e,_objectSpreadProps$9(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$c(e,t,r[t])}))}return e}({},a),{userToken:t,storage:n})),this.storefrontId=ce.ID,r&&(this.storefrontId=r),this._store=new LocalDataStore(i),this.defaultIncludePaginationMetadata=i.features&&hasOwn(i.features,"api-pagination-metadata")}}function asyncGeneratorStep$i(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$i(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$i(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$i(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$b(e,t,r[t])}))}return e}function _objectSpreadProps$8(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}zo([ChunkedIdApi(1),Yo("design:type",Function),Yo("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],Books.prototype,"collection",null);var Qo={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Jo={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class Podcasts extends TokenSession{catalogResource(e,t,r,n){return this.resource(e,t,r,n)}catalogResources(e,t,r,n){return this.collection(e,t,r,n)}catalogResourceRelationship(e,t,r,n,i){return this.collection(`${e}/${t}/${r}`,void 0,n,i)}search(e,t,r){return this.collection("search",void 0,_objectSpread$b({term:e,types:"podcasts"},t),r)}artist(e,t,r){return this.catalogResource("artists",e,t,r)}artists(e,t,r){return this.catalogResources("artists",e,t,r)}artistRelationship(e,t,r,n){return this.catalogResourceRelationship("artists",e,t,r,n)}charts(e,t,r){return this.catalogResources("charts",void 0,_objectSpread$b({types:e},t),r)}podcast(e,t,r){return this.catalogResource("podcasts",e,_objectSpread$b({include:"episodes"},t),r)}podcasts(e,t,r){var n=this;return _asyncToGenerator$i((function*(){return n.catalogResources("podcasts",e,_objectSpread$b({include:"episodes"},t),r)}))()}podcastRelationship(e,t,r,n){var i=this;return _asyncToGenerator$i((function*(){return i.catalogResourceRelationship("podcasts",e,t,r,n)}))()}episode(e,t,r){var n=this;return _asyncToGenerator$i((function*(){return n.resource("podcast-episodes",e,t,r)}))()}episodes(e,t,r){var n=this;return _asyncToGenerator$i((function*(){return n.catalogResources("podcast-episodes",e,t,r)}))()}collection(e,t,r,n){var i=this;return _asyncToGenerator$i((function*(){let a;if(t){const n={};n["charts"===e?"types":"ids"]=t,a=Object.assign(n,r)}else a=r;const o=`catalog/${i.storefrontId}/${e}`;return makeRequest(i,o,a,n)}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}resource(e,t,r,n){var i=this;return _asyncToGenerator$i((function*(){if(!(null==n?void 0:n.reload)){const n=i._store.read(e,t,r);if(n)return n}const[a]=yield i.collection(e,t,r,n);return a}))()}constructor(e,t,r=ce.ID,n,i={},a){super("https://amp-api.podcasts.apple.com/v1",e,_objectSpreadProps$8(_objectSpread$b({},a),{userToken:t,storage:n})),this.storefrontId=r,this._store=new LocalDataStore(i),this.defaultIncludePaginationMetadata=i.features&&hasOwn(i.features,"api-pagination-metadata")}}function asyncGeneratorStep$h(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _defineProperty$a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$a(e,t,r[t])}))}return e}function _objectSpreadProps$7(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}Qo([ChunkedIdApi(1),Jo("design:type",Function),Jo("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],Podcasts.prototype,"collection",null);var Xo={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Zo={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const es=new Set(["editorial-items"]);class Fitness extends TokenSession{workout(e,t,r){return this.resource("workouts",e,t,r)}contributor(e,t,r){return this.resource("contributors",e,t,r)}editorialItem(e,t,r){return this.resource("editorial-items",e,t,r)}modalities(e,t,r){return this.collection("modalities",e,t,r)}modality(e,t,r){return this.resource("modalities",e,t,r)}workoutProgram(e,t,r){return this.resource("workout-programs",e,t,r)}collection(e,t,r,n){let i;i=t?_objectSpread$a({ids:t},r):r;let a="catalog";es.has(e)&&(a="editorial");return makeRequest(this,`${a}/${this.storefrontId}/${e}`,i,n)}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}resource(e,t,r,n){var i=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$h(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$h(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){const a=i._store.read(e,t,r);if(a)return a;const[o]=yield i.collection(e,t,r,n);return o}))()}constructor(e,t,r=ce.ID,n,i={},a){var o;super("https://amp-api.fitness.apple.com/v1",e,_objectSpreadProps$7(_objectSpread$a({},a),{userToken:t,storage:n})),this.storefrontId=ce.ID,this.storefrontId=r,this._store=new LocalDataStore(i),this.defaultIncludePaginationMetadata=!!(null==i||null===(o=i.features)||void 0===o?void 0:o["api-pagination-metadata"])}}function asyncGeneratorStep$g(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$g(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$g(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$g(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$9(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$9(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$9(e,t,r[t])}))}return e}function _objectSpreadProps$6(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}Xo([ChunkedIdApi(1),Zo("design:type",Function),Zo("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions])],Fitness.prototype,"collection",null);var ts={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},rs={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class TVLibrary extends TokenSession{genres(e,t){var r=this;return _asyncToGenerator$g((function*(){return r.collection("genres",_objectSpread$9({types:"tv-episodes,movies"},e),t)}))()}movies(e,t){var r=this;return _asyncToGenerator$g((function*(){return r.collection("movies",e,t)}))()}purchases(e,t){var r=this;return _asyncToGenerator$g((function*(){return r.collection("",_objectSpread$9({types:"tv-episodes,movies"},e),t)}))()}tvEpisodes(e,t){var r=this;return _asyncToGenerator$g((function*(){return r.collection("tv-episodes",e,t)}))()}collection(e,t,r){var n=this;return _asyncToGenerator$g((function*(){try{return yield makeRequest(n,"me/purchases/"+e,t,r)}catch(Tt){if(Tt.name===MKError.CONTENT_UNAVAILABLE)return(null==r?void 0:r.includePagination)?{data:[],meta:{}}:[];throw Tt}}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}constructor(e,t,r,n={},i){super("https://amp-api.videos.apple.com/v1",e,_objectSpreadProps$6(_objectSpread$9({},i),{userToken:t,storage:r})),this._store=new LocalDataStore(n),this.defaultIncludePaginationMetadata=n.features&&hasOwn(n.features,"api-pagination-metadata")}}function asyncGeneratorStep$f(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$f(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$f(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$f(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$8(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$8(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$8(e,t,r[t])}))}return e}function _objectSpreadProps$5(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}ts([ChunkedIdApi(1),rs("design:type",Function),rs("design:paramtypes",[String,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],TVLibrary.prototype,"collection",null);const RecommendationUpdate=()=>(e,t,r)=>{if(void 0===r||"function"!=typeof r.value)throw new TypeError(`Only methods can be decorated with @RecommendationUpdate, but ${t} is not a method.`);return{configurable:!0,get(){const e=r.value;function recommendationUpdate(){return _recommendationUpdate.apply(this,arguments)}function _recommendationUpdate(){return(_recommendationUpdate=_asyncToGenerator$f((function*(...t){const r=yield e.apply(this,t),n=new Map,i=[],a=new Date;if(!r||!Array.isArray(r))return r;if(r.forEach((e,t)=>{var r;const o=e.id;var s;const c=null!==(s=e.nextUpdateDate)&&void 0!==s?s:null===(r=e.attributes)||void 0===r?void 0:r.nextUpdateDate;if(!o||!c)return;new Date(c)<a&&(i.push(o),n.set(o,t))}),!i.length)return r;let[o,s,c,...l]=t;c=_objectSpreadProps$5(_objectSpread$8({},c),{reload:!0});const u=[i,s,c,...l];return(yield e.apply(this,u)).forEach(e=>{const t=n.get(e.id);void 0!==t&&(r[t]=e)}),r}))).apply(this,arguments)}return Object.defineProperty(this,t,{value:recommendationUpdate,configurable:!0,writable:!0}),recommendationUpdate}}};function asyncGeneratorStep$e(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function makeAlbumKey(e){var t;return(null===(t=e.artwork)||void 0===t?void 0:t.url)+""+e.artistName+""+e.name}class ServerLedger{_initData(){return{lastTimestamp:0,albums:{added:Object.create(null),removed:Object.create(null)},playlists:{added:Object.create(null),removed:Object.create(null)}}}_checkTimestamp(){const e=this._data.lastTimestamp;e&&e+24e5<Date.now()&&(this._data=this._initData(),this._sessionStorage&&this._sessionStorage.removeItem(this._storageKey))}added(e){this.load();const t=null==e?void 0:e.playlists,r=null==e?void 0:e.albums;return t||r?(t&&t.forEach(e=>{const t=Date.now();this._data.playlists.added[e]=t,this._data.lastTimestamp=t}),r&&r.forEach(e=>{const t=Date.now();this._data.albums.added[e]=t,this._data.lastTimestamp=t}),this.save(),e):e}removed(e){this.load();const t=null==e?void 0:e.playlists;return t?(ensureArray(t).forEach(e=>{if(0!==e.indexOf("pl.")){const t=Date.now();this._data.playlists.removed[e]=t,this._data.lastTimestamp=t}}),this.save(),e):e}reconcile(e,t,r,n,i){var a=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$e(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$e(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){a._checkTimestamp();const i=t.data||t;if(!i||!Array.isArray(i)||Array.isArray(r))return t;const o=a._data.albums.added,s=a._data.playlists.removed,c=a._data.playlists.added,l=[],u=n&&!n.offset||!!r&&(void 0===r.offset||0===r.offset);let d=!1;if("all"===e||"playlists"===e){for(let e=i.length-1;e>=0;e--){var p;const t=i[e],r=null===(p=t.playParams)||void 0===p?void 0:p.globalId;"library-playlists"===t.type&&(s[t.id]?i.splice(e,1):r&&c[r]&&(delete c[r],d=!0,u||i.splice(e,1)))}if(u&&a._catalogApi){const e=Object.keys(c);if(e.length){const t=yield a._catalogApi.playlists(e);l.splice(0,0,...t)}}}if(a._catalogApi&&("all"===e||"albums"===e)){const e=Object.keys(o);if(e.length){const t=yield a._catalogApi.albums(e),r=Object.create(null);t.forEach((t,n)=>{const i=makeAlbumKey(t);r[i]={catalogId:e[n],album:t}});for(let e=i.length-1;e>=0;e--){var h;const t=i[e];if(null===(h=t.playParams)||void 0===h||h.globalId,"library-albums"===t.type){const n=makeAlbumKey(t),a=r[n];a&&(delete o[a.catalogId],d=!0,u?delete r[n]:i.splice(e,1))}}if(u){const e=Object.keys(r).map(e=>r[e].album);e.length&&l.splice(0,0,...e)}}}if(d&&a.save(),u&&l.length&&(l.sort((e,t)=>{const r=a._data.albums.added[e.id]||a._data.playlists.added[e.id]||0;return(a._data.albums.added[t.id]||a._data.playlists.added[t.id]||0)-r}),i.splice(0,0,...l)),!i.length)throw new MKError(MKError.CONTENT_UNAVAILABLE,"The requested content is not available.");const y=t.meta;return y&&void 0===y.total&&(y.total=i.length),t}))()}load(){if(!this._sessionStorage)return;const e=this._sessionStorage.getItem(this._storageKey);if(e)try{this._data=JSON.parse(e),this._data.albums&&this._data.playlists||(this._data=this._initData())}catch(t){this._data||(this._data=this._initData())}else this._data=this._initData()}save(){if(!this._sessionStorage)return;const e=this._data,t=0===Object.keys(e.albums.added).length&&0===Object.keys(e.albums.removed).length&&0===Object.keys(e.playlists.added).length&&0===Object.keys(e.playlists.removed).length;try{if(t)this._sessionStorage.getItem(this._storageKey)&&this._sessionStorage.removeItem(this._storageKey);else{const e=JSON.stringify(this._data);this._sessionStorage.setItem(this._storageKey,e)}}catch(r){}}constructor(e,t,r){this._data=this._initData(),this._catalogApi=t,this._storageKey="mk-server-ledger:"+(e||""),this._sessionStorage=r||getSessionStorage(),this.load()}}function asyncGeneratorStep$d(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$d(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$d(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$7(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$7(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$7(e,t,r[t])}))}return e}function _objectSpreadProps$4(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var ns={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},is={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const as="me/library";class Library extends TokenSession{add(e){var t=this;return _asyncToGenerator$d((function*(){const r=transformKeys(e,dasherize),n=Date.now();if(n-t._last<1e3)return Promise.reject(new MKError(MKError.QUOTA_EXCEEDED));const i=new Headers({Authorization:"Bearer "+t.developerToken,[I]:t.userToken}),a=Object.keys(r).map(e=>`ids[${e}]=${r[e].join(",")}`).join("&");try{const e=yield fetch(`${t.url}/${as}?${a}`,{method:"POST",headers:i});return e.ok?(t._last=n,t._serverLedger.added(r)):Promise.reject(MKError.responseError(e))}catch(o){return Promise.reject(MKError.responseError(o))}}))()}remove(e){var t=this;return _asyncToGenerator$d((function*(){if(!t.developerToken||!t.userToken)return Promise.reject("Invalid tokens");const r=new Headers({Authorization:"Bearer "+t.developerToken,[I]:t.userToken}),n=transformKeys(e,dasherize),i=Object.keys(n)[0],a=Object.values(n)[0];try{const e=yield fetch(`${t.url}/${as}/${i}/${a}`,{method:"DELETE",headers:r});return e.ok?t._serverLedger.removed(n):Promise.reject(MKError.responseError(e))}catch(o){return Promise.reject(MKError.responseError(o))}}))()}album(e,t,r){var n=this;return _asyncToGenerator$d((function*(){return n.resource("albums",e,t,r)}))()}albumRelationship(e,t,r,n){var i=this;return _asyncToGenerator$d((function*(){return i.collection(`albums/${e}/${t}`,void 0,r,n)}))()}albums(e,t,r){var n=this;return _asyncToGenerator$d((function*(){let i;try{i=yield n.collection("albums",e,t,_objectSpreadProps$4(_objectSpread$7({},r),{shouldCacheResults:!1}))}catch(a){if(a.errorCode!==MKError.CONTENT_UNAVAILABLE)throw a;i={data:[],meta:{}}}return n._serverLedger.reconcile("albums",i,e,t,r)}))()}artist(e,t,r){var n=this;return _asyncToGenerator$d((function*(){return n.resource("artists",e,t,r)}))()}artistRelationship(e,t="albums",r,n){var i=this;return _asyncToGenerator$d((function*(){return i.collection(`artists/${e}/${t}`,void 0,r,n)}))()}artists(e,t,r){var n=this;return _asyncToGenerator$d((function*(){return n.collection("artists",e,t,r)}))()}createPlaylist(e={},t){var r=this;return _asyncToGenerator$d((function*(){let n;const{name:i,description:a,tracks:o=[]}=e,s={attributes:{name:i,description:a},relationships:{tracks:{data:transformTrackParameters(o)}}},c=JSON.stringify(s);try{n=yield r.request(as+"/playlists",t,{body:c,method:"POST"})}catch(Tt){return Promise.reject(MKError.responseError(Tt))}try{const[e]=r._store.write(n);return e}catch(l){return Promise.reject(MKError.parseError(l))}}))()}deletePlaylist(e,t){var r=this;return _asyncToGenerator$d((function*(){let n;const i=`${as}/playlists/${e}`;try{n=yield r.request(i,t,{method:"DELETE"})}catch(Tt){return Promise.reject(MKError.responseError(Tt))}r.purgePlaylistFromCaches(e)}))()}editPlaylist(e,t,r){var n=this;return _asyncToGenerator$d((function*(){let i;const a=JSON.stringify({attributes:t});try{i=yield n.request(`${as}/playlists/${e}`,r,{body:a,method:"PATCH"})}catch(Tt){return Promise.reject(MKError.responseError(Tt))}try{const r=t,i="library-playlists";return n._store.write({data:[{type:i,id:e,attributes:r}]}),t}catch(o){return Promise.reject(MKError.parseError(o))}}))()}updatePlaylistTracklist(e,t){var r=this;return _asyncToGenerator$d((function*(){yield r.putPlaylistTracklisting(e,t,"PUT"),r.purgePlaylistFromCaches(e)}))()}appendTracksToPlaylist(e,t){var r=this;return _asyncToGenerator$d((function*(){yield r.putPlaylistTracklisting(e,t,"POST"),r.purgePlaylistFromCaches(e)}))()}playlistFolder(e,t,r){return this.resource("playlist-folders",e,t,r)}playlistFolders(e,t,r){return this.collection("playlist-folders",e,t,r)}playlistFoldersRoot(e,t){return e=_objectSpreadProps$4(_objectSpread$7({},e),{filter:_objectSpreadProps$4(_objectSpread$7({},null==e?void 0:e.filter),{identity:"playlistsroot"})}),this.playlistFolders(void 0,e,t)}playlistFolderChildren(e,t,r){const n=`playlist-folders/${e}/children`;return this.collection(n,void 0,t,r)}musicVideo(e,t,r){var n=this;return _asyncToGenerator$d((function*(){return n.resource("music-videos",e,t,r)}))()}musicVideos(e,t,r){var n=this;return _asyncToGenerator$d((function*(){return n.collection("music-videos",e,t,r)}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}playlist(e,t,r){var n=this;return _asyncToGenerator$d((function*(){return t=_objectSpread$7({include:"tracks"},t),n.resource("playlists",e,t,r)}))()}createCatalogPlaylist(e,t,r){var n=this;return _asyncToGenerator$d((function*(){return r=_objectSpread$7({method:"POST"},r),n.resource(`playlists/${e}/catalog`,void 0,t,r)}))()}playlistRelationship(e,t="tracks",r,n){var i=this;return _asyncToGenerator$d((function*(){return i.collection(`playlists/${e}/${t}`,void 0,r,n)}))()}playlists(e,t,r){var n=this;return _asyncToGenerator$d((function*(){let i;try{i=e&&e.length>0?yield Promise.all(e.map(e=>n.playlist(e,t,r))):yield n.collection("playlists",e,t,_objectSpreadProps$4(_objectSpread$7({},r),{shouldCacheResults:!1}))}catch(a){if(a.errorCode!==MKError.CONTENT_UNAVAILABLE)throw a;i={data:[],meta:{}}}return n._serverLedger.reconcile("playlists",i,e,t,r)}))()}recentlyAdded(e,t){var r=this;return _asyncToGenerator$d((function*(){const n=null==e?void 0:e.limit;let i;try{i=yield r.collection("recently-added",void 0,transformParameters(e,n||10),_objectSpreadProps$4(_objectSpread$7({},t),{shouldCacheResults:!1}))}catch(a){if(a.errorCode!==MKError.CONTENT_UNAVAILABLE)throw a;i={data:[],meta:{}}}return r._serverLedger.reconcile("all",i,void 0,e,t)}))()}search(e,t,r){var n=this;return _asyncToGenerator$d((function*(){t=n._denormalizeLibraryTypes(t);const i=_objectSpread$7({term:e,types:"library-albums"},t);return n.collection("search",void 0,i,_objectSpreadProps$4(_objectSpread$7({},r),{shouldCacheResults:!1}))}))()}song(e,t,r){var n=this;return _asyncToGenerator$d((function*(){return n.resource("songs",e,t,r)}))()}songRelationship(e,t,r,n){var i=this;return _asyncToGenerator$d((function*(){return i.collection(`songs/${e}/${t}`,void 0,r,n)}))()}songs(e,t,r){var n=this;return _asyncToGenerator$d((function*(){return n.collection("songs",e,t,r)}))()}collection(e,t,r,n){var i=this;return _asyncToGenerator$d((function*(){!t||t.length||r||(r=transformParameters(t,100),t=void 0);const a=t?_objectSpread$7({ids:t},r):r;return makeRequest(i,`${as}/${e}`,a,n)}))()}resource(e,t,r,n){var i=this;return _asyncToGenerator$d((function*(){if(!(null==n?void 0:n.reload)){const n=i._store.read(e,t,r);if(n)return n}let a=`${as}/${e}`;t&&(a=`${a}/${t}`);const[o]=yield makeRequest(i,a,r,n);return o}))()}purgePlaylistFromCaches(e){this._store.delete("library-playlists",e),this.networkCache.removeItemsMatching(this.constructURL(`${as}/playlists/${e}`,{}),!1)}putPlaylistTracklisting(e,t,r="PUT"){var n=this;return _asyncToGenerator$d((function*(){const i=transformTrackParameters(t),a=JSON.stringify({data:i});try{yield n.request(`${as}/playlists/${e}/tracks`,void 0,{body:a,method:r})}catch(Tt){return Promise.reject(MKError.responseError(Tt))}}))()}_denormalizeLibraryTypes(e={},t="types"){let r=e[t];return r?("string"==typeof r&&(r=r.split(",")),e[t]=r.map(e=>e.replace(/^(albums|music-videos|playlists|songs)$/,"library-$1")),e):e}constructor(e,t,r,n={},i,a){super(e,t,_objectSpreadProps$4(_objectSpread$7({},a),{userToken:r})),this._last=0,this._store=new LocalDataStore(n),this._serverLedger=new ServerLedger(r,i),this.defaultIncludePaginationMetadata=n.features&&hasOwn(n.features,"api-pagination-metadata")}}function asyncGeneratorStep$c(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$c(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$c(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$c(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$6(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$6(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$6(e,t,r[t])}))}return e}function _objectSpreadProps$3(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}ns([ChunkedIdApi(1),is("design:type",Function),is("design:paramtypes",[String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions])],Library.prototype,"collection",null);var os,ss,cs={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ls={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){e[e.Global=0]="Global",e.Lyrics="lyrics",e.Catalog="catalog",e.Personalized="me",e.Editorial="editorial",e.Engagement="engagement",e.Social="social"}(os||(os={})),function(e){e.songs="songs",e.albums="albums",e.playlists="playlists",e.stations="stations",e["music-videos"]="music-videos",e["library-music-videos"]="library-music-videos",e["library-playlists"]="library-playlists",e["library-songs"]="library-songs"}(ss||(ss={}));class API extends TokenSession{get needsEquivalents(){const{userStorefrontId:e}=this;return void 0!==e&&""!==e&&e!==this.storefrontId}activity(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"activities",e,t,r)}))()}activities(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Catalog,"activities",e,t,r)}))()}album(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"albums",e,t,r)}))()}albumRelationship(e,t,r,n){var i=this;return _asyncToGenerator$c((function*(){return i.collection(os.Catalog,`albums/${e}/${t}`,void 0,r,n)}))()}albums(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Catalog,"albums",e,t,r)}))()}appleCurator(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"apple-curators",e,t,r)}))()}appleCurators(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Catalog,"apple-curators",e,t,r)}))()}artist(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"artists",e,t,r)}))()}artistRelationship(e,t,r,n){var i=this;return _asyncToGenerator$c((function*(){return i.collection(os.Catalog,`artists/${e}/${t}`,void 0,r,n)}))()}artistView(e,t,r,n){return this.collection(os.Catalog,`artists/${e}/view/${t}`,void 0,r,n)}artists(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Catalog,"artists",e,t,r)}))()}audioBook(e,t,r){return this.books.audioBook(e,t,r)}audioBooks(e,t,r){return this.books.audioBooks(e,t,r)}catalogResources(e,t={},r){const n=function(e){const t={};if(!e)return t;for(const r of e){if(!r)continue;const{type:e,id:n}=r;e in t||(t[e]=[]),t[e].push(n)}return t}(e);return t=_objectSpreadProps$3(_objectSpread$6({},t),{ids:n}),makeRequest(this,`${os.Catalog}/${this.storefrontId}`,t,r)}changeStation(e,t,r={}){var n=this;return _asyncToGenerator$c((function*(){return yield makeRequest(n,"me/stations/change-station/"+e,t,_objectSpreadProps$3(_objectSpread$6({},r),{reload:!0,method:"POST",shouldCacheResults:!1}))}))()}charts(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Catalog,"charts",e,t,_objectSpreadProps$3(_objectSpread$6({},r),{returnRawJSONApiRecords:!0}))}))()}contents(e,t,r){return this.collection(os.Catalog,"contents",e,t,r)}curator(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"contents",e,t,r)}))()}curators(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Catalog,"contents",e,t,r)}))()}curatorRelationship(e,t,r,n){var i=this;return _asyncToGenerator$c((function*(){return i.collection(os.Catalog,`curators/${e}/${t}`,void 0,r,n)}))()}episode(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n._podcastsAPI.catalogResource("podcast-episodes",e,t,r)}))()}episodes(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n._podcastsAPI.catalogResources("podcast-episodes",e,t,r)}))()}genre(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"genres",e,t,r)}))()}genres(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Catalog,"genres",e,t,r)}))()}grouping(e,t,r){var n=this;return _asyncToGenerator$c((function*(){!t&&isObject$1(e)&&(t=e,e=void 0);const i=_objectSpread$6({},{platform:"desktop"},t);return n.resource(os.Editorial,"groupings",e,i,_objectSpreadProps$3(_objectSpread$6({},r),{shouldCacheResults:!1}))}))()}groupings(e,t={},r){var n=this;return _asyncToGenerator$c((function*(){const i=_objectSpread$6({},{platform:"desktop"},t);return n.collection(os.Editorial,"groupings",e,i,_objectSpreadProps$3(_objectSpread$6({},r),{shouldCacheResults:!1}))}))()}lyric(e,t,r){return this.resource(os.Catalog,`songs/${e}/lyrics`,"",t,_objectSpread$6({reload:!0},r))}lyricSnippet(e,t,r){return this.collection(os.Lyrics,"snippet/songs",e,t,_objectSpreadProps$3(_objectSpread$6({},r),{returnRawJSONApiRecords:!0}))}historyHeavyRotation(e,t){var r=this;return _asyncToGenerator$c((function*(){return r.collection(os.Personalized,"history/heavy-rotation",void 0,transformParameters(e,10),t)}))()}multiplex(e,t,r){var n=this;return _asyncToGenerator$c((function*(){const i=n._store.read("multiplex",e,t);return i||(r=_objectSpread$6({returnRawJSONApiRecords:!0},r),makeRequest(n,`${os.Editorial}/${n.storefrontId}/multiplex/${e}`,t,r))}))()}multiroom(e,t,r){var n=this;return _asyncToGenerator$c((function*(){const i=n._store.read("multirooms",e,t);if(i)return i;const[a]=yield n.collection(os.Editorial,"multirooms/"+e,void 0,t,r);return a}))()}musicMovie(e,t,r){return this.resource(os.Catalog,"music-movies",e,t,r)}musicMovies(e,t,r){return this.collection(os.Catalog,"music-movies",e,t,r)}musicVideo(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"music-videos",e,t,r)}))()}musicVideos(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Catalog,"music-videos",e,t,r)}))()}nextStationTracks(e,t,r={}){var n=this;return _asyncToGenerator$c((function*(){var i;const a=null!==(i=r.queryParameters)&&void 0!==i?i:{};(null==t?void 0:t.clean)&&(a.clean=t.clean,delete t.clean),(null==t?void 0:t.limit)&&(a.limit=t.limit,delete t.limit);return yield makeRequest(n,"me/stations/next-tracks/"+e,t,_objectSpreadProps$3(_objectSpread$6({},r),{reload:!0,method:"POST",queryParameters:a,shouldCacheResults:!1}))}))()}continuousStation(e,t,r={}){var n=this;return _asyncToGenerator$c((function*(){return yield makeRequest(n,"me/stations/continuous",e,_objectSpreadProps$3(_objectSpread$6({},r),{reload:!0,method:"POST",queryParameters:t,returnRawJSONApiRecords:!0,shouldCacheResults:!1}))}))()}playlist(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"playlists",e,t,r)}))()}playlistRelationship(e,t,r,n){var i=this;return _asyncToGenerator$c((function*(){return i.collection(os.Catalog,`playlists/${e}/${t}`,void 0,r,n)}))()}playlists(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Catalog,"playlists",e,t,r)}))()}podcast(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n._podcastsAPI.catalogResource("podcasts",e,_objectSpread$6({include:"episodes"},t),r)}))()}podcastRelationship(e,t,r,n){var i=this;return _asyncToGenerator$c((function*(){return i._podcastsAPI.catalogResourceRelationship("podcasts",e,t,r,n)}))()}podcasts(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n._podcastsAPI.catalogResources("podcasts",e,_objectSpread$6({include:"episodes"},t),r)}))()}recentPlayed(e,t){var r=this;return _asyncToGenerator$c((function*(){return r.collection(os.Personalized,"recent/played",void 0,transformParameters(e,10),t)}))()}recentRadioStations(e,t){var r=this;return _asyncToGenerator$c((function*(){return r.collection(os.Personalized,"recent/radio-stations",void 0,transformParameters(e,10),t)}))()}recordLabel(e,t,r){return this.resource(os.Catalog,"record-labels",e,t,r)}recordLabels(e,t,r){return this.collection(os.Catalog,"record-labels",e,t,r)}recordLabelView(e,t,r,n){return this.collection(os.Catalog,`record-labels/${e}/view/${t}`,void 0,r,n)}personalRecommendation(e,t,r,n=!0){var i=this;return _asyncToGenerator$c((function*(){const a=yield i.personalRecommendations(e,t,r,n),[o]=a;return o}))()}refreshPersonalRecommendation(e,t,r){return t=_objectSpread$6({timezone:formatTimezoneOffset()},t),r=_objectSpreadProps$3(_objectSpread$6({},r),{method:"POST",queryParameters:t}),this.resource(os.Personalized,"recommendations",e,void 0,r)}personalRecommendations(e,t,r={},n=!0){var i=this;return _asyncToGenerator$c((function*(){const a=formatTimezoneOffset(),o=yield i.collection(os.Personalized,"recommendations",e,_objectSpread$6({timezone:a},t),_objectSpreadProps$3(_objectSpread$6({},r),{shouldCacheResults:n,returnRawJSONApiRecords:!0}));i._reindexRelationships(o,"recommendations");try{return mapRequestResult(o,e=>i.parseResultData(!1,e))}catch(Tt){return Promise.reject(MKError.parseError(Tt))}}))()}personalRecommendationView(e,t,r,n={}){var i=this;return _asyncToGenerator$c((function*(){return i.collection(os.Personalized,`recommendations/${e}/view/${t}`,void 0,r,n)}))()}recommendations(e,t,r={}){var n=this;return _asyncToGenerator$c((function*(){const i=formatTimezoneOffset(),a=yield n.collection(os.Global,"recommendations/"+n.storefrontId,e,_objectSpread$6({timezone:i},t),_objectSpreadProps$3(_objectSpread$6({},r),{shouldCacheResults:!1,returnRawJSONApiRecords:!0}));n._reindexRelationships(a,"recommendations");try{return mapRequestResult(a,e=>n.parseResultData(!1,e))}catch(Tt){return Promise.reject(MKError.parseError(Tt))}}))()}recommendedFriends(e,t,r={}){return r=_objectSpreadProps$3(_objectSpread$6({},r),{method:"POST",body:JSON.stringify(_objectSpread$6({ids:{socialProfiles:e}},r.body))}),this.collection(os.Global,"social/recommended-friends",void 0,t,_objectSpreadProps$3(_objectSpread$6({},r),{shouldCacheResults:!1,returnRawJSONApiRecords:!0}))}room(e,t,r){var n=this;return _asyncToGenerator$c((function*(){const i=n._store.read("rooms",e,t);if(i&&i.hasAttributes("title"))return i;const a=yield n.collection(os.Editorial,"rooms/"+e,void 0,t,r),[o]=a;return o}))()}roomContents(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Editorial,`rooms/${e}/contents`,void 0,t,r)}))()}search(e,t,r){var n=this;return _asyncToGenerator$c((function*(){const i=_objectSpread$6({term:e},t);return r=_objectSpreadProps$3(_objectSpread$6({},r),{useRawResponse:!0}),n.collection(os.Catalog,"search",void 0,i,_objectSpreadProps$3(_objectSpread$6({},r),{shouldCacheResults:!1}))}))()}searchHints(e,t,r){var n=this;return _asyncToGenerator$c((function*(){const i=_objectSpread$6({term:e},t),a=yield n.collection(os.Catalog,"search/hints",void 0,i,_objectSpreadProps$3(_objectSpread$6({},r),{returnRawJSONApiRecords:!0}));return"topResults"===(null==i?void 0:i.with)&&"topResults"in a&&(a.topResults=n.parseResultData(!0,a.topResults)),a}))()}searchQuery(e,t){var r=this;return _asyncToGenerator$c((function*(){return t=_objectSpreadProps$3(_objectSpread$6({},t),{useRawResponse:!0}),r.collection(os.Catalog,"search/query",void 0,e,_objectSpreadProps$3(_objectSpread$6({},t),{shouldCacheResults:!1}))}))()}searchSuggestions(e,t,r){var n=this;return _asyncToGenerator$c((function*(){t=_objectSpread$6({term:e},t);const i=yield n.collection(os.Catalog,"search/suggestions",void 0,t,_objectSpreadProps$3(_objectSpread$6({},r),{returnRawJSONApiRecords:!0}));return Array.isArray(null==i?void 0:i.suggestions)&&i.suggestions.forEach(e=>{"topResults"===e.kind&&(e.content=n.parseResultData(!0,[e.content])[0])}),i}))()}socialBadgingMap(e,t){return this.collection(os.Global,"social/badging-map",void 0,e,_objectSpreadProps$3(_objectSpread$6({},t),{returnRawJSONApiRecords:!0}))}socialProfile(e,t,r){return this.resource(os.Social,"social-profiles",e,t,r)}socialProfiles(e,t,r){return this.collection(os.Social,"social-profiles",e,t,r)}personalSocialProfile(e,t){return this.resource(os.Personalized,"social-profile",void 0,e,t)}socialPost(e,t={},r){var n=this;return _asyncToGenerator$c((function*(){e.startsWith("sa.")?t.filter={post:e}:t.ids=e;const[i]=yield n.collection(os.Catalog,"contents","",t,r);return i}))()}socialSearch(e,t={},r){var n=this;return _asyncToGenerator$c((function*(){return t=_objectSpreadProps$3(_objectSpread$6({},t),{term:e}),n.collection(os.Social,"search",void 0,t,r)}))()}song(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"songs",e,t,r)}))()}songRelationship(e,t,r,n){var i=this;return _asyncToGenerator$c((function*(){return i.collection(os.Catalog,`songs/${e}/${t}`,void 0,r,n)}))()}songs(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return!t&&isObject$1(e)&&(t=e,e=void 0),n.collection(os.Catalog,"songs",e,t,r)}))()}tastePreferences(e,t){var r=this;return _asyncToGenerator$c((function*(){return r.collection(os.Personalized,"taste/taste-preferences",void 0,e,_objectSpreadProps$3(_objectSpread$6({},t),{shouldCacheResults:!1}))}))()}saveTastePreferences(e){var t=this;return _asyncToGenerator$c((function*(){e=e.map(e=>e instanceof DataRecord?e.serialize().data:e);const r={method:"POST",body:JSON.stringify({data:e}),shouldCacheResults:!0};try{return yield makeRequest(t,"me/taste/taste-preferences",void 0,r)}catch(Tt){return Tt.name===MKError.CONTENT_UNAVAILABLE?[]:Promise.reject(MKError.parseError(Tt))}}))()}tvEpisode(e,t,r){return this.resource(os.Catalog,"tv-episodes",e,_objectSpread$6({include:"seasons"},t),r)}tvEpisodes(e,t,r){return this.collection(os.Catalog,"tv-episodes",e,_objectSpread$6({include:"seasons"},t),r)}tvSeason(e,t,r){return this.resource(os.Catalog,"tv-seasons",e,_objectSpread$6({include:"episodes"},t),r)}tvSeasons(e,t,r){return this.collection(os.Catalog,"tv-seasons",e,_objectSpread$6({include:"episodes"},t),r)}tvShow(e,t,r){return this.resource(os.Catalog,"tv-shows",e,t,r)}tvShows(e,t,r){return this.collection(os.Catalog,"tv-shows",e,t,r)}uploadedAudio(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return t=_objectSpread$6({include:"curator,artists"},t),n.resource(os.Catalog,"uploaded-audios",e,t,r)}))()}uploadedAudios(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return t=_objectSpread$6({include:"curator,artists"},t),n.collection(os.Catalog,"uploaded-audios",e,t,r)}))()}uploadedVideo(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return t=_objectSpread$6({include:"curator,artists"},t),n.resource(os.Catalog,"uploaded-videos",e,t,r)}))()}uploadedVideos(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return t=_objectSpread$6({include:"curator,artists"},t),n.collection(os.Catalog,"uploaded-videos",e,t,r)}))()}upsellMarketingItems(e,t){return this.collection(os.Engagement,"upsell/marketing-items",void 0,e,t)}station(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Catalog,"stations",e,t,r)}))()}stations(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return!t&&isObject$1(e)&&(t=e,e=void 0),n.collection(os.Catalog,"stations",e,t,r)}))()}storefront(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Global,"storefronts",e,t,r)}))()}storefronts(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.collection(os.Global,"storefronts",e,t,r)}))()}musicSummary(e,t,r){var n=this;return _asyncToGenerator$c((function*(){return n.resource(os.Personalized,"music-summaries",e,t,r)}))()}musicSummarySearch(e={},t){var r=this;return _asyncToGenerator$c((function*(){return r.collection(os.Personalized,"music-summaries/search",void 0,e,t)}))()}addToLibrary(e){var t=this;return _asyncToGenerator$c((function*(){return t.developerToken&&t.userToken&&t.library?t.library.add(e):Promise.reject("Invalid tokens")}))()}rating(e,t,r){var n=this;return _asyncToGenerator$c((function*(){const[i]=yield n.ratings(e,t,r);return i}))()}ratings(e,t,r){if(!this.developerToken||!this.userToken)return Promise.reject("Invalid tokens");const[n]=Object.keys(e),i=e[n],a=Array.isArray(i);if(a&&0===i.length)return Promise.resolve([]);let o="me/ratings/"+formatRatingsContentType(n,a?i[0]:i);return a?t=_objectSpreadProps$3(_objectSpread$6({},t),{ids:i.map(normalizeAdamId)}):o=`${o}/${normalizeAdamId(i)}`,makeRequest(this,o,t,_objectSpread$6({shouldCacheResults:!1,reload:!0,includePagination:!1},r))}putRating(e,t,r){var n=this;return _asyncToGenerator$c((function*(){if(!n.developerToken||!n.userToken)return Promise.reject("Invalid tokens");const[i]=Object.keys(e),a=e[i],o=formatRatingsContentType(i,a),s={method:"PUT",body:JSON.stringify({type:"rating",attributes:{value:t}}),includePagination:!1},c=yield makeRequest(n,`me/ratings/${o}/${normalizeAdamId(a)}`,r,_objectSpread$6({shouldCacheResults:!1},s)),[l]=c;return l}))()}deleteRating(e,t){var r=this;return _asyncToGenerator$c((function*(){if(!r.developerToken||!r.userToken)return Promise.reject("Invalid tokens");const[n]=Object.keys(e),i=e[n],a=formatRatingsContentType(n,i);if(Array.isArray(i))return Promise.all(i.map(e=>r.deleteRating({[n]:e},t))).then(()=>{});yield makeRequest(r,`me/ratings/${a}/${i}`,t,{method:"DELETE",shouldCacheResults:!1,returnRawJSONApiRecords:!0});try{r._store.delete(a,i)}catch(Tt){return Promise.reject(MKError.parseError(Tt))}}))()}equivalent(e,t){var r=this;return _asyncToGenerator$c((function*(){let n=`catalog/${r.userStorefrontId}/${e}`,i={};switch(e){case"albums":case"songs":i={"filter[equivalents]":t};break;case"artists":case"playlists":n=`${n}/${t}`;break;default:return Promise.reject(new MKError(MKError.INVALID_ARGUMENTS,"Invalid equivalent type"))}return r.resource(os.Global,n,"",i)}))()}collection(e,t,r,n,i){var a=this;return _asyncToGenerator$c((function*(){let o,s,c=null==i?void 0:i.shouldCacheResults;switch(o=r?_objectSpread$6({["charts"===t?"types":"ids"]:r},n):n,e){case os.Catalog:case os.Editorial:case os.Engagement:case os.Social:case os.Lyrics:const r=a.storefrontId;s=`${e}/${r}/${t}`;break;case os.Global:s=t;break;case os.Personalized:s=`${e}/${t}`,c=!1}return makeRequest(a,s,o,_objectSpreadProps$3(_objectSpread$6({},i),{shouldCacheResults:c}))}))()}parseResultData(e,t){return e?this._store.write(t):this._store.parse(t)}resource(e,t,r,n,i){var a=this;return _asyncToGenerator$c((function*(){if(!(null==i?void 0:i.reload)){const e=a._store.read(t,r,n);if(e)return e}const[o]=yield a.collection(e,t,r,n,i);return o}))()}_reindexRelationships(e,t){("data"in e?e.data:e).forEach(e=>{hasOwn(e,"relationships")&&hasOwn(e.relationships,t)&&hasOwn(e.relationships[t],"data")&&Array.isArray(e.relationships[t].data)&&e.relationships[t].data.forEach((e,t)=>{e.id=`${e.id}-${t}`})})}constructor(e,t,r,n,i,a,o={},s){super(e,t,_objectSpreadProps$3(_objectSpread$6({},s),{userToken:n,storage:a})),this.storefrontId=ce.ID,this.resourceRelatives={artists:{albums:{include:"tracks"},playlists:{include:"tracks"},songs:null}},this.defaultIncludePaginationMetadata=o.features&&hasOwn(o.features,"api-pagination-metadata"),this._store=new LocalDataStore(o),r&&(this.storefrontId=r.toLowerCase()),n&&i&&(this.userStorefrontId=i.toLowerCase()),this._podcastsAPI=new Podcasts(t,n,r,a,o,_objectSpread$6({},s)),this.fitness=new Fitness(t,n,r,a,o,_objectSpread$6({},s)),this.tvLibrary=new TVLibrary(t,n,a,o,_objectSpread$6({},s)),this.library=new Library(e,t,n,o,this,_objectSpread$6({},s)),this.books=new Books(t,n,r,a,o,_objectSpread$6({},s)),this.v3=new MediaAPIV3({developerToken:t,mediaUserToken:n,storefrontId:r,realmConfig:{music:{url:e.replace(/\/v[0-9]+(\/)?$/,"")}}})}}function asyncGeneratorStep$b(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$b(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$b(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$b(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}let us;cs([RecommendationUpdate(),ls("design:type",Function),ls("design:paramtypes",[Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions,void 0])],API.prototype,"personalRecommendations",null),cs([RecommendationUpdate(),ls("design:type",Function),ls("design:paramtypes",[Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof MakeRequestOptions?Object:MakeRequestOptions])],API.prototype,"recommendations",null),cs([ChunkedIdApi(2),ls("design:type",Function),ls("design:paramtypes",[void 0===os?Object:os,String,Object,"undefined"==typeof QueryParameters?Object:QueryParameters,"undefined"==typeof InternalMakeRequestOptions?Object:InternalMakeRequestOptions])],API.prototype,"collection",null);const ds=function(){var e=_asyncToGenerator$b((function*(e,t=!1){if(us&&!t){if(void 0===e.storefrontId||e.storefrontId===us.storefrontId)return us;us.clear()}return us=new MediaAPIService(e.dispatcher),us.configure(e)}));return function(t){return e.apply(this,arguments)}}(),ps={album:{isPlural:!1,apiMethod:"album",relationshipMethod:{method:"albumRelationship",relationship:"tracks"}},albums:{isPlural:!0,apiMethod:"albums"},audioBook:{isPlural:!1,apiMethod:"audioBook"},audioBooks:{isPlural:!0,apiMethod:"audioBooks"},episode:{isPlural:!1,apiMethod:"episode"},episodes:{isPlural:!0,apiMethod:"episodes"},musicVideo:{isPlural:!1,apiMethod:"musicVideo"},musicVideos:{isPlural:!0,apiMethod:"musicVideos"},musicMovie:{isPlural:!1,apiMethod:"musicMovie"},musicMovies:{isPlural:!0,apiMethod:"musicMovies"},podcast:{isPlural:!1,apiMethod:"podcast"},podcasts:{isPlural:!0,apiMethod:"podcasts"},playlist:{isPlural:!1,apiMethod:"playlist",relationshipMethod:{method:"playlistRelationship",relationship:"tracks"}},playlists:{isPlural:!0,apiMethod:"playlists"},song:{isPlural:!1,apiMethod:"song"},songs:{isPlural:!0,apiMethod:"songs"},tvEpisode:{isPlural:!1,apiMethod:"tvEpisode"},tvEpisodes:{isPlural:!0,apiMethod:"tvEpisodes"},uploadedAudio:{isPlural:!1,apiMethod:"uploadedAudio"},uploadedAudios:{isPlural:!0,apiMethod:"uploadedAudios"},uploadedVideo:{isPlural:!1,apiMethod:"uploadedVideo"},uploadedVideos:{isPlural:!0,apiMethod:"uploadedVideos"}};class MediaAPIService{get api(){if(void 0===this._api)throw new MKError(MKError.CONFIGURATION_ERROR,"The API cannot be accessed before it is configured.");return this._api}get storefrontId(){return this.store&&this.store.storefrontId}configure(e){var t=this;return _asyncToGenerator$b((function*(){if(void 0!==e.store)return t.store=e.store,[Ii.authorizationStatusDidChange,Ii.userTokenDidChange,Ii.storefrontIdentifierDidChange,Ii.storefrontCountryCodeDidChange].forEach(e=>{t.store.storekit.addEventListener(e,()=>t.resetAPI())}),t._initializeAPI(e),t}))()}clear(){this.api&&this.api.clearNetworkCache&&this.api.clearNetworkCache()}getAPIForItem(e){var t=this;return _asyncToGenerator$b((function*(){return n(e)?(yield t.store.authorize(),t.api.library||t.api):t.api}))()}resetAPI(){var e=this;return _asyncToGenerator$b((function*(){e.clear(),e._initializeAPI()}))()}_initializeAPI(e){if(void 0!==(null==e?void 0:e.api))return void(this._api=e.api);const t=e&&e.store||this.store;if(void 0===t)return;const r=Bi.features["api-session-storage"]?getSessionStorage():void 0,n=e&&e.storefrontId||t.storefrontId,i=new API(this.url,t.developerToken,n,t.storekit.userToken,t.storekit.storefrontCountryCode,r,Bi,e&&e.apiOptions&&e.apiOptions.sessionOptions);this._api=i.v3,this._api=i}_updateStorefrontId(e){var t=this;return _asyncToGenerator$b((function*(){t.api&&e===t.api.storefrontId||(yield t.configure({dispatcher:t._dispatcher,store:t.store,storefrontId:e}))}))()}constructor(e){if(this._dispatcher=e,!Bi.urls.mediaApi)throw new Error("bag.urls.mediaApi is not configured");this.url=Bi.urls.mediaApi,this.namedQueueOptions=ps;var t=this;this._dispatcher.subscribe(zt.apiStorefrontChanged,function(){var e=_asyncToGenerator$b((function*(e,{storefrontId:r}){yield t._updateStorefrontId(r)}));return function(t,r){return e.apply(this,arguments)}}())}}function asyncGeneratorStep$a(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$a(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$a(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$a(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _configure$1(){return(_configure$1=_asyncToGenerator$a((function*(e){const t=new UTSClientService;return yield t.configure(e),t}))).apply(this,arguments)}class UTSClientService{configure(e){var t=this;return _asyncToGenerator$a((function*(){var r;return t.api=(null!==(r=e.apiOptions)&&void 0!==r?r:{}).client,t}))()}clear(){}getAPIForItem(e){var t=this;return _asyncToGenerator$a((function*(){if(void 0===t.api)throw new Error("UTS has not been configured");return t.api}))()}constructor(){this.namedQueueOptions={},this.url=""}}function asyncGeneratorStep$9(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}class NpPlay{getNpPayloadContent(e,t,r,n="com.apple.tv"){var i,a,o,s;const c={context:{user:{id:r,keyspace:"cid"},userAgent:navigator.userAgent,appleStoreFront:null===(i=this.utsClient)||void 0===i||null===(a=i.configuration)||void 0===a||null===(o=a.applicationProps)||void 0===o||null===(s=o.storefront)||void 0===s?void 0:s.storefrontId,source:"Client_Device",cadence:"Contract",bundleId:n,millisecondsSinceEvent:0},event:{}};return"vod"===e?c.event.vodEvent=t:"live"===e&&(c.event.liveEvent=t),c}send(e,t,r,n="com.apple.tv"){var i=this;return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$9(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$9(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){var a;const o={headers:{Authorization:"Bearer "+i.tokens.developerToken,"Media-User-Token":null!==(a=i.tokens.musicUserToken)&&void 0!==a?a:""},method:"POST",body:JSON.stringify(i.getNpPayloadContent(e,t,r,n))};return yield fetch("/api/np/play/json",o)}))()}constructor(e,t){this.tokens=e,this.utsClient=t}}var hs={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ys={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class LegacyDecorateLiveMonitor{startMonitor(){this.dispatcher.unsubscribe(Ii.playbackTimeDidChange,this.handleTimeChange),this.dispatcher.subscribe(Ii.playbackTimeDidChange,this.handleTimeChange)}stopMonitor(){this.dispatcher.unsubscribe(Ii.playbackTimeDidChange,this.handleTimeChange)}handleTimeChange(){const e=Date.now(),t=this.decoratedLive.events[this.currentIndex];t?(e>=t.startTime&&!this.hasSentEventStart&&(this.hasSentEventStart=!0,this.callback("Event_Start",this.decoratedLive,t)),e>=t.endTime&&(this.hasSentEventStart=!1,this.currentIndex+=1,this.callback("Event_End",this.decoratedLive,t)),this.currentIndex>=this.decoratedLive.events.length&&this.stopMonitor()):this.stopMonitor()}constructor(e,t,r){this.dispatcher=e,this.callback=t,this.decoratedLive=r,this.currentIndex=0,this.hasSentEventStart=!1}}function asyncGeneratorStep$8(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}hs([Bind(),ys("design:type",Function),ys("design:paramtypes",[])],LegacyDecorateLiveMonitor.prototype,"handleTimeChange",null);class PlayMetadata{destroy(){var e;null===(e=this.watcher)||void 0===e||e.stopMonitor(),this.watcher=void 0}trackActivity(e,t){return function(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$8(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$8(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}((function*(){return Promise.resolve()}))()}getAppBundleIds(e,t){var r;const n=null==t?void 0:t.channels;if(!Array.isArray(n)||void 0===(null==e?void 0:e.channelId))return;const i=n.find(t=>t.id===e.channelId);var a;return null!==(a=null==i||null===(r=i.appBundleIds)||void 0===r?void 0:r[0])&&void 0!==a?a:void 0}determineRelativePosition(e,t){return e<=t.mainContentStarts?0:e>=t.mainContentEnds?t.mainContentEnds:e-t.mainContentStarts}constructor(e,t,r,n,i,a,o){this.dispatcher=e,this.item=r,this.mediaItemPlayback=t,this.npPlay=o,this.playable=n,this.pldfltcid=i,this.utsClient=a,this.appBundleIds=this.getAppBundleIds(n,r),this.itemTiming=function(e){const t=parseRollItems(e,["pre-roll"]),r=parseRollItems(e,["post-roll"]),n=t.reduce(addRollItemDuration,0),i=r.reduce(addRollItemDuration,0);var a,o;const s=null!==(o=null!==(a=e.hlsMetadata["up-next.start"])&&void 0!==a?a:e.hlsMetadata["watched.time"])&&void 0!==o?o:e.hlsMetadata["feature.duration"],c=parseFloat(s);return{mainContentStarts:n,mainContentEnds:c,mainContentLength:c-n,totalContentLength:c+i}}(r)}}function asyncGeneratorStep$7(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$7(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$7(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$7(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}var fs={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ms={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const gs=new Set(["play","stop","Event_End","Event_Start"]);class LegacyLive extends PlayMetadata{init(){var e=this;return _asyncToGenerator$7((function*(){var t,r;const{playable:n}=e,i=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("activityDecorateLive",{channelId:n.channelId,externalServiceId:n.externalServiceId});var a;e.legacyDecoratedLive=null!==(a=null==i?void 0:i.data)&&void 0!==a?a:i,e.legacyDecoratedLive&&(null===(r=e.legacyDecoratedLive.events)||void 0===r?void 0:r.length)&&e.setupLegacyLiveWatcher(e.legacyDecoratedLive)}))()}setupLegacyLiveWatcher(e){var t;this.watcher=new LegacyDecorateLiveMonitor(this.dispatcher,this.onLegacyLiveEvent,e),null===(t=this.watcher)||void 0===t||t.startMonitor()}onLegacyLiveEvent(e,t,r){var n=this;return _asyncToGenerator$7((function*(){if("Event_Start"===e||"Event_End"===e){var i;const a=n.pldfltcid,{appBundleIds:o,playable:s,utsClient:c}=n;if(!a||!c||!s)return;const l=n.generateLiveEvent(e,t,r);yield null===(i=n.npPlay)||void 0===i?void 0:i.send("live",l,a,null!=o?o:"com.apple.tv")}}))()}trackActivity(e,t){var r=this;return _asyncToGenerator$7((function*(){var t;const{legacyDecoratedLive:n}=r;if(!n||!r.playable||!gs.has(e))return;const i=r.generateLiveEvent(e,n);var a;yield null===(t=r.npPlay)||void 0===t?void 0:t.send("live",i,r.pldfltcid,null!==(a=r.appBundleIds)&&void 0!==a?a:"com.apple.tv")}))()}generateLiveEvent(e,t,r){let n;var i,a;"play"===e?n="Tune_In":"stop"===e?n="Tune_Out":"Event_Start"!==e&&"Event_End"!==e||(n=e);const o={bundleId:null!==(i=this.appBundleIds)&&void 0!==i?i:"com.apple.tv",millisecondsSinceEvent:0,channel:{channelCanonicalId:t.serviceId,channelBrandId:t.channelId,channelExternalLiveServiceId:t.externalServiceId,channelInternalLegId:null!==(a=t.legId)&&void 0!==a?a:t.serviceId},cause:n};if(o.expectedStartTimeEpochMillis=t.scheduleStartTime,o.cleanupTimeEpochMillis=t.scheduleEndTime,r){let e;"number"==typeof r.endTime&&"number"==typeof r.startTime&&(e=r.endAirTime-r.startAirTime),o.content={contentCanonicalId:r.canonicalId,contentBrandId:r.channelId,contentExternalPlayableId:r.playableExternalId,contentMediaLengthInMilliseconds:e,contentLiveFeatureOrLiveEndCredits:"Event_Start"===n?"Live_Feature":"Live_End_Credits",contentInternalLegId:r.legId},o.expectedStartTimeEpochMillis=r.startTime,o.cleanupTimeEpochMillis=r.endTime}return o}}function asyncGeneratorStep$6(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$6(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$6(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$6(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$5(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpreadProps$2(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}fs([Bind(),ms("design:type",Function),ms("design:paramtypes",["undefined"==typeof LiveEventCause?Object:LiveEventCause,"undefined"==typeof LegacyDecorateLiveProperties?Object:LegacyDecorateLiveProperties,"undefined"==typeof LegacyDecorateLiveEvent?Object:LegacyDecorateLiveEvent])],LegacyLive.prototype,"onLegacyLiveEvent",null);var vs={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},bs={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const _s=new Set(["exit","pause","play","scrub","seek","skip","stop"]);class LegacyVod extends PlayMetadata{init(){var e=this;return _asyncToGenerator$6((function*(){var t,r;const{item:n,playable:i}=e;if(hasContentCompletionThresholdData(n)){const t=getContentCompletionThreshold(n);e.setupLegacyVodWatcher(t,Number.POSITIVE_INFINITY)}const a=1e3*parseInt(""+i.duration,10),o=`${i.channelId}:${i.externalId}:${a}`,s=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("activityPlayablesDecorate",{ids:o});var c;e.legacyDecorated=null!==(c=null==s?void 0:s[o])&&void 0!==c?c:null==s||null===(r=s.data)||void 0===r?void 0:r[o]}))()}setupLegacyVodWatcher(e,t){this.watcher=new SpanWatcher(this.dispatcher,this.onContentCompletionThreshhold,e,t,!0),this.watcher.startMonitor()}onContentCompletionThreshhold(e){var t=this;return _asyncToGenerator$6((function*(){yield t.trackActivity("exit",e),t.dispatcher.publish(zt.mediaContentComplete,t.item)}))()}trackActivity(e,t){var r=this;return _asyncToGenerator$6((function*(){var n,i;const{appBundleIds:a,legacyDecorated:o,playable:s,pldfltcid:c}=r;let{itemTiming:l}=r;if(!(o&&s&&l&&_s.has(e)))return;if("stop"===e){var u;const e=r.itemTiming.totalContentLength;if(!(null===(u=r.item)||void 0===u?void 0:u.isLinearStream)&&void 0!==e&&void 0!==t){const r=e-t;r>=0&&r<5&&(t=e+.5)}}const d=null===(n=r.mediaItemPlayback)||void 0===n?void 0:n.currentPlaybackDuration;if(isNaN(l.totalContentLength)||d&&d<l.totalContentLength){const e=null!=d?d:NaN;isNaN(e)||(r.itemTiming=l=_objectSpreadProps$2(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$5(e,t,r[t])}))}return e}({},l),{mainContentEnds:e,mainContentLength:e,totalContentLength:e}))}const p=r.generateVodEvent(s,o,l,t);yield null===(i=r.npPlay)||void 0===i?void 0:i.send("vod",p,c,null!=a?a:"com.apple.tv")}))()}generateVodEvent(e,t,r,n){const i={playable:{externalPlayableId:e.externalId,brandId:t.brandId},internalLegId:t.internalLegId,canonicalId:t.canonicalId,mediaLengthInMilliseconds:Math.floor(1e3*r.totalContentLength),mainContentLengthInMilliseconds:Math.floor(1e3*r.mainContentLength),playHeadInMilliseconds:Math.floor(1e3*n),mainContentPlayHeadInMilliseconds:Math.floor(1e3*this.determineRelativePosition(n,r)),featureOrEndCredits:n>r.mainContentEnds?"End_Credits":"Feature"};return"Episode"===t.contentType&&(i.tvEpisode={externalShowId:t.externalShowId,canonicalShowId:t.canonicalShowId,currentOrPreviousEpisode:t.isCurrent?"Latest_And_Current_Episode":"Previous_Episode",openOrClosedShow:t.isShowClosed?"Show_Closed_No_More_Episodes_Expected":"Show_Open_More_Episodes_Expected"}),i}}function asyncGeneratorStep$5(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$5(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$5(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$5(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}vs([Bind(),bs("design:type",Function),bs("design:paramtypes",[Number])],LegacyVod.prototype,"onContentCompletionThreshhold",null);var Ss={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ts={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class Live extends PlayMetadata{init(){var e=this;return _asyncToGenerator$5((function*(){var t;const{playable:r}=e,n=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("getContentsPlayMetadataLive",{brandId:r.channelId,externalServiceId:r.externalServiceId});var i;e.playMetadataLive=null!==(i=null==n?void 0:n.data)&&void 0!==i?i:n,e.resetListening()}))()}destroy(){this.unsubscribe()}trackActivity(e,t){var r=this;return _asyncToGenerator$5((function*(){"scrub"!==e&&"seek"!==e||r.resetListening()}))()}handleTimeChange(){var e,t;const{scheduleItems:r}=this;var n;const i=null!==(n=null===(e=this.mediaItemPlayback)||void 0===e||null===(t=e.currentPlayingDate)||void 0===t?void 0:t.getTime())&&void 0!==n?n:0;if(0!==i&&r){for(let e=0;e<r.length;e++){const t=r[e];if(i>=t.startAirTime&&i<=t.endAirTime)r.splice(e,1),e-=1,this.onLiveEvent(t);else if(i>t.endAirTime)r.splice(e,1),e-=1;else if(i<t.startAirTime)return}0===r.length&&this.unsubscribe()}}onLiveEvent(e){var t=this;return _asyncToGenerator$5((function*(){var r;const n=t.pldfltcid,{appBundleIds:i,playable:a,utsClient:o}=t;if(!n||!o||!a)return;const s=t.generateEventStartEvent(e);yield null===(r=t.npPlay)||void 0===r?void 0:r.send("live",s,n,null!=i?i:"com.apple.tv")}))()}generateEventStartEvent(e){return{bundleId:"com.apple.tv",millisecondsSinceEvent:0,cause:"Event_Start",passThrough:null==e?void 0:e.nowPlayingPassThrough}}resetListening(){var e;const t=null===(e=this.playMetadataLive)||void 0===e?void 0:e.schedule;t&&t.length&&(this.scheduleItems=[...t],this.unsubscribe(),this.subscribe())}subscribe(){this.dispatcher.subscribe(Ii.playbackTimeDidChange,this.handleTimeChange)}unsubscribe(){this.dispatcher.unsubscribe(Ii.playbackTimeDidChange,this.handleTimeChange)}constructor(...e){super(...e),this.scheduleItems=[]}}function asyncGeneratorStep$4(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$4(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$4(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$4(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$4(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpreadProps$1(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}Ss([Bind(),Ts("design:type",Function),Ts("design:paramtypes",[])],Live.prototype,"handleTimeChange",null),Ss([Bind(),Ts("design:type",Function),Ts("design:paramtypes",["undefined"==typeof PlayMetadataLiveSchedule?Object:PlayMetadataLiveSchedule])],Live.prototype,"onLiveEvent",null);var Ps={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Es={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const ks=new Set(["exit","pause","play","scrub","seek","skip","stop"]);class Vod extends PlayMetadata{init(){var e=this;return _asyncToGenerator$4((function*(){var t;const{item:r,playable:n}=e;if(hasContentCompletionThresholdData(r)){const t=getContentCompletionThreshold(r);e.setupVodWatcher(t,Number.POSITIVE_INFINITY)}const i=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("getContentsPlayMetadataVOD",{externalId:n.externalId,brandId:n.channelId,hlsAssetDuration:e.mediaItemPlayback.currentPlaybackDuration});var a;e.metadata=null!==(a=null==i?void 0:i.data)&&void 0!==a?a:i}))()}setupVodWatcher(e,t){this.watcher=new SpanWatcher(this.dispatcher,this.onContentCompletionThreshhold,e,t,!0),this.watcher.startMonitor()}onContentCompletionThreshhold(e){var t=this;return _asyncToGenerator$4((function*(){yield t.trackActivity("exit",e),t.dispatcher.publish(zt.mediaContentComplete,t.item)}))()}trackActivity(e,t){var r=this;return _asyncToGenerator$4((function*(){var n,i;const{appBundleIds:a,metadata:o,playable:s,pldfltcid:c}=r;let{itemTiming:l}=r;if(!(o&&s&&l&&ks.has(e)))return;if("stop"===e){var u;const e=r.itemTiming.totalContentLength;if(!(null===(u=r.item)||void 0===u?void 0:u.isLinearStream)&&void 0!==e&&void 0!==t){const r=e-t;r>=0&&r<5&&(t=e+.5)}}const d=null===(n=r.mediaItemPlayback)||void 0===n?void 0:n.currentPlaybackDuration;if(isNaN(l.totalContentLength)||d&&d<l.totalContentLength){const e=null!=d?d:NaN;isNaN(e)||(r.itemTiming=l=_objectSpreadProps$1(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$4(e,t,r[t])}))}return e}({},l),{mainContentEnds:e,mainContentLength:e,totalContentLength:e}))}const p=r.generateVodEvent(s,o,l,t);yield null===(i=r.npPlay)||void 0===i?void 0:i.send("vod",p,c,null!=a?a:"com.apple.tv")}))()}generateVodEvent(e,t,r,n){var i,a;return{playHeadInMilliseconds:Math.floor(1e3*n),mediaLengthInMilliseconds:Math.floor(1e3*r.totalContentLength),mainContentInfo:{isDone:n>=r.mainContentEnds?"Done":"Not_Done",playHeadInMilliseconds:Math.floor(1e3*this.determineRelativePosition(n,r)),lengthInMilliseconds:Math.floor(1e3*r.mainContentLength),passThrough:null!==(a=null===(i=this.metadata)||void 0===i?void 0:i.nowPlayingPassThrough)&&void 0!==a?a:""}}}}function asyncGeneratorStep$3(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$3(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$3(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$3(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}Ps([Bind(),Es("design:type",Function),Es("design:paramtypes",[Number])],Vod.prototype,"onContentCompletionThreshhold",null);class Ebs extends PlayMetadata{init(){var e=this;return _asyncToGenerator$3((function*(){var t;const{playable:r}=e,n=yield null===(t=e.utsClient)||void 0===t?void 0:t.refresh("getContentsPlayMetadataEBS",{brandId:r.channelId,externalId:r.externalId});var i;const a=null!==(i=null==n?void 0:n.data)&&void 0!==i?i:n;e.playMetadataEbs=a}))()}trackActivity(e,t){var r=this;return _asyncToGenerator$3((function*(){if("exit"!==e&&"stop"!==e){if("play"===e&&!r.sentEventStart){var t;const e=r.pldfltcid,{appBundleIds:n,playable:i,utsClient:a}=r;if(!e||!a||!i)return;const o=r.generateEventStartEvent();yield null===(t=r.npPlay)||void 0===t?void 0:t.send("live",o,e,null!=n?n:"com.apple.tv"),r.sentEventStart=!0}}else r.sentEventStart=!1}))()}generateEventStartEvent(){var e,t;return{bundleId:"com.apple.tv",millisecondsSinceEvent:0,cause:"Event_Start",passThrough:null!==(t=null===(e=this.playMetadataEbs)||void 0===e?void 0:e.nowPlayingPassThrough)&&void 0!==t?t:""}}constructor(...e){super(...e),this.sentEventStart=!1}}function asyncGeneratorStep$2(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$2(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$2(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$2(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}class BookmarkTracker{get requestedEvents(){return Array.from(this.dispatchTable.keys())}configure(e,t){var r=this;return _asyncToGenerator$2((function*(){var n,i,a,o,s,c;if(!r.shouldConfigure(e))return;r.dispatcher=t.services.dispatcher,r.mediaItemPlayback=t.services.mediaItemPlayback,r.utsClient=null===(n=t.services.apiManager)||void 0===n?void 0:n.utsClient,r.npPlay=new NpPlay({get developerToken(){return e.developerToken},get musicUserToken(){var t;return null!==(t=e.musicUserToken)&&void 0!==t?t:""}},r.utsClient);const l=null===(i=r.utsClient)||void 0===i||null===(a=i.configuration)||void 0===a||null===(o=a.applicationProps)||void 0===o||null===(s=o.requiredParamsMap)||void 0===s||null===(c=s.Default)||void 0===c?void 0:c.v;parseInt(null!=l?l:"0",10)>=64&&(r.usePlayMetadataEndpoints=!0)}))()}cleanup(){var e=this;return _asyncToGenerator$2((function*(){e.clearItem()}))()}shouldConfigure(e){return _asyncToGenerator$2((function*(){return!!Bi.features.bookmarking&&e.isAuthorized}))()}shouldTrackPlayActivity(t,r){if(!r||!this.utsClient)return!1;const n=-1===[e.PlaybackType.none,e.PlaybackType.preview].indexOf(r.playbackType),i="Bonus"!==r.type&&"Extra"!==r.contentType;return Li.debug("Bookmark shouldTrackPlayActivity",n&&i,t),n&&i}handleEvent(e,t,r){if(!this.shouldTrackPlayActivity(e,r))return;const n=this.dispatchTable.get(e);void 0!==n&&"function"==typeof this[n]&&this[n](r,t)}exit(e,t={}){var r=this;return _asyncToGenerator$2((function*(){yield r.trackActivity("exit",void 0,t.position),r.clearItem()}))()}pause(e,t={}){var r=this;return _asyncToGenerator$2((function*(){yield r.trackActivity("pause",e,t.position)}))()}play(e,t={}){var r=this;return _asyncToGenerator$2((function*(){const n=void 0===t.position?0:t.position;yield r.trackActivity("play",e,n)}))()}scrub(e,t={}){var r=this;return _asyncToGenerator$2((function*(){yield r.trackActivity("scrub",e,t.position)}))()}seek(e,t={}){var r=this;return _asyncToGenerator$2((function*(){yield r.trackActivity("seek",e,t.position)}))()}skip(e,t={}){var r=this;return _asyncToGenerator$2((function*(){yield r.trackActivity("skip",e,t.position)}))()}stop(e,t={}){var r=this;return _asyncToGenerator$2((function*(){yield r.trackActivity("stop",e,t.position),r.clearItem()}))()}clearItem(){var e;this.currentItem=void 0,null===(e=this.playMetadata)||void 0===e||e.destroy(),this.playMetadata=void 0}trackActivity(e,t,r){var n=this;return _asyncToGenerator$2((function*(){var i,a;if(void 0!==r&&void 0!==n.utsClient&&(void 0!==t&&t.id!==(null===(i=n.currentItem)||void 0===i?void 0:i.id)&&(yield n.updateItem(t)),void 0!==n.currentItem))return null===(a=n.playMetadata)||void 0===a?void 0:a.trackActivity(e,r)}))()}updateItem(e){var t=this;return _asyncToGenerator$2((function*(){var r,n;const i=yield Vi.storekit.pldfltcid();if(void 0===t.utsClient||!t.dispatcher||!i)return;if(t.currentItem&&t.currentItem.id!==e.id&&t.clearItem(),void 0!==t.currentItem)return;t.currentItem=e;const a=e.defaultPlayable;if(void 0===a)return;let o;null===(r=t.playMetadata)||void 0===r||r.destroy(),o=e.isLinearStream?t.usePlayMetadataEndpoints?"EbsEvent"===a.type?Ebs:Live:LegacyLive:t.usePlayMetadataEndpoints?Vod:LegacyVod,t.playMetadata=new o(t.dispatcher,t.mediaItemPlayback,e,a,i,t.utsClient,t.npPlay),yield null===(n=t.playMetadata)||void 0===n?void 0:n.init()}))()}constructor(){this.usePlayMetadataEndpoints=!1,this.dispatchTable=new Map([[zt.playbackPlay,"play"],[zt.playbackPause,"pause"],[zt.playbackScrub,"scrub"],[zt.playbackSeek,"seek"],[zt.playbackSkip,"skip"],[zt.playbackStop,"stop"],[zt.playerExit,"exit"]])}}var ws={setDelegate:!0};function isDefined(e){return void 0!==e}function isDefinedNonNull(e){return isDefined(e)&&null!==e}function isEmptyString(e){return isString(e)&&0===e.length}function isEmptyArray(e){return isArray$1(e)&&0===e.length}function isEmptyObject(e){return isObject(e)&&0===Object.keys(e).length}function isFunction$1(e){return"function"==typeof e}function isNumber$1(e){return"number"==typeof e}function isInteger$2(e){return isNumber$1(e)&&e%1==0}function isString(e){return"string"==typeof e||e instanceof String}function isArray$1(e){return!!e&&e.constructor===Array}function isObject(e){return!!e&&e.constructor===Object}function hasGetterAndSetterMethods(e){return isObject(e)&&isFunction$1(e.__lookupGetter__)&&isFunction$1(e.__lookupSetter__)&&isFunction$1(e.__defineGetter__)&&isFunction$1(e.__defineSetter__)}function extend$5(e){var t=[!0,!0,!0].concat(Array.prototype.slice.call(arguments));return copyKeysAndValues$1.apply(null,t)}function copyKeysAndValues$1(e,t,r,n){for(var i,a=r&&n||{},o=3;o<arguments.length;o++)for(var s in i=arguments[o])if(Object.prototype.hasOwnProperty.call(i,s)){var c=i[s];(e||null!=c)&&(t||"function"!=typeof c)&&(a[s]=c)}return a}function attachMethods$1(e,t,r,n){var i=!1;if(e&&t){n=n||{},r=r||t;var captureFunction=function(e,t,r,n){var returnValue=function(){return r[n].apply(e,arguments)};return t&&(returnValue.origFunction=t),returnValue.attachedMethod=!0,returnValue};for(var a in t)if(!(a in n)&&t[a]&&isFunction$1(t[a])){var o=e[a],s=null;o&&isFunction$1(o)&&(s=!0===o.attachedMethod?o:o.bind(e)),e[a]=captureFunction(r,s,t,a),i=!0}}return i}function detachMethods(e){var t=!1;for(var r in e){if(isFunction$1(e[r])&&!0===e[r].attachedMethod)if(e[r].origFunction)for(;e[r].origFunction;)e[r]=e[r].origFunction,t=!0;else delete e[r]}return t}function dedupedArray(e,t){var r={};if(e)for(var n=0;n<e.length;n++)r[e[n]]=0;if(t)for(var i=0;i<t.length;i++)r[t[i]]=0;return Object.keys(r)}var Is=Object.freeze({__proto__:null,_utResetNonOverridableFunctions:function(){ws={setDelegate:!0}},shallowClone:function(e){var t,r,n={},i=hasGetterAndSetterMethods(e);for(var a in e)t=null,r=null,i&&(t=e.__lookupGetter__(a),r=e.__lookupSetter__(a)),t||r?(t&&n.__defineGetter__(a,t),r&&n.__defineSetter__(a,r)):n[a]=e[a];return n},isDefined:isDefined,isDefinedNonNull:isDefinedNonNull,isDefinedNonNullNonEmpty:function(e){return isDefinedNonNull(e)&&!isEmptyString(e)&&!isEmptyArray(e)&&!isEmptyObject(e)},isEmptyString:isEmptyString,isEmptyArray:isEmptyArray,isEmptyObject:isEmptyObject,isFunction:isFunction$1,isNumber:isNumber$1,isInteger:isInteger$2,isString:isString,isElement:function(e){return!!e&&1==e.nodeType},isArray:isArray$1,isObject:isObject,values:function(e){var t=[];for(var r in e){var n=e[r];e.hasOwnProperty(r)&&!isFunction$1(n)&&t.push(n)}return t},keys:function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&!isFunction$1(e[r])&&t.push(r);return t},hasAnyKeys:function(e){for(var t in e)if(e.hasOwnProperty(t))return!0},hasAnyNonNullKeys:function(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!0},hasGetterAndSetterMethods:hasGetterAndSetterMethods,methods:function(e){var t=[];for(var r in e){var n=e[r];e.hasOwnProperty(r)&&isFunction$1(n)&&t.push(n)}return t},invert:function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&!isFunction$1(e[r])&&(t[e[r]]=r);return t},extend:extend$5,copyKeysAndValues:copyKeysAndValues$1,addNonOverrideableFunctions:function(e){for(var t=0;t<e.length;t++){var r=e[t];ws[r]=!0}},attachMethods:attachMethods$1,detachMethods:detachMethods,attachDelegate:function(e,t){var r=!1;if(e&&t&&e!==t){var n={};Object.keys(t).forEach((function(t){e[t]||(n[t]=!0)})),extend$5(n,ws),r=attachMethods$1(e,t,null,n)}return r},setDelegates:function(e,t){var r={};for(var n in e)t[n]&&isFunction$1(e[n].setDelegate)&&(r[n]=e[n].setDelegate(t[n]));return r},resetDelegates:function(e){var t=!1;for(var r in e){var n=e[r];n&&"object"==typeof n&&isFunction$1(n.setDelegate)&&(t|=detachMethods(n))}return!!t},copyDelegatedFunctions:function(e,t){var r=null;if(e&&t&&t.setDelegate){var n,i={};for(n in e)isFunction$1(e[n])&&e[n].origFunction&&(i[n]=e[n]);r=t.setDelegate(i)}return r},dedupedArray:dedupedArray}),Os={maxWait:1500,initialDelay:100,factor:2},ExponentialStrategy=function(e,t,r){this.delay=e||Os.initialDelay,this.maxWait=isNumber$1(t)?t:Os.maxWait,this.factor=r||Os.factor,this.timeWaited=0};ExponentialStrategy.prototype.nextDelay=function(){var e=null,t=this.maxWait-this.timeWaited;return t>0&&(this.delay=Math.min(this.delay,t),this.timeWaited+=this.delay),(0===this.maxWait||t>0)&&(e=this.delay,this.delay=this.delay*this.factor),e};var As=Object.freeze({__proto__:null,exponentialBackoff:function(e,t,r,n,i,a){!function _backoff(e,t,r,n){t.call(t,r,(function(){var i=e.nextDelay();i?setTimeout(_backoff.bind(null,e,t,r,n),i):n.apply(n,arguments)}))}(new ExponentialStrategy(n,i,a),e,t,r)}});function disabled(e){return!!this.value("disabled",e)}function denylistedEvents(e){var t=this.value("denylistedEvents",e);return dedupedArray(this.value("blacklistedEvents",e),t)}function denylistedFields(e){var t=this.value("denylistedFields",e);return dedupedArray(this.value("blacklistedFields",e),t)}function removeDenylistedFields$1(e,t){if(e)for(var r=denylistedFields.call(this,t),n=0;n<r.length;n++){var i=r[n];i&&i in e&&delete e[i]}return e}function metricsDisabledOrDenylistedEvent$1(e,t){return disabled.call(this,t)||!!e&&denylistedEvents.call(this,t).indexOf(e)>-1}function deResFields(e){return this.value("deResFields",e)||[]}var Rs=Object.freeze({__proto__:null,disabled:disabled,blacklistedEvents:function(e){return denylistedEvents.call(this,e)},denylistedEvents:denylistedEvents,blacklistedFields:function(e){return denylistedFields.call(this,e)},denylistedFields:denylistedFields,removeBlacklistedFields:function(e,t){return removeDenylistedFields$1.call(this,e,t)},removeDenylistedFields:removeDenylistedFields$1,metricsDisabledOrBlacklistedEvent:function(e,t){return metricsDisabledOrDenylistedEvent$1.call(this,e,t)},metricsDisabledOrDenylistedEvent:metricsDisabledOrDenylistedEvent$1,deResFields:deResFields,applyDeRes:function(e,t){var r;return e&&deResFields.call(this,t).forEach((function(t){(r=t.fieldName)in e&&(e[r]=function(e,t,r){var n=void 0;if(isDefined(e))if(isDefined(t)||(t=1048576),isDefined(r)||(r=2),isNumber$1(e)&&isNumber$1(t)&&t>0&&isInteger$2(r)&&r>=0){var i=Math.pow(10,r);n=Math[e>0?"floor":"ceil"](e/t/i)*i}else n=NaN;return n}(e[r],t.magnitude,t.significantDigits))})),e}}),Cs="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxy",Ds=Cs+"z";function snakeCaseToCamelCase(e,t){var r="";if(e)for(var n,i=e.toLowerCase().split("_"),a=0;a<i.length;a++)n=i[a][0],(0!==a||t)&&(n=n.toUpperCase()),r+=n+i[a].slice(1);return r}function randomHexCharacter(e,r,n){var i,a=t.crypto||t.msCrypto;return i=e?(16*e()|0).toString(16):a&&a.getRandomValues?(15&a.getRandomValues(new Uint8Array(1))[0]).toString(16):a&&a.randomBytes?a.randomBytes(1).toString("hex")[0]:(16*Math.random()|0).toString(16),r&&n&&(i<r||i>n)&&(i=randomHexCharacter(e,r,n)),i}var Ms=Object.freeze({__proto__:null,base10Alphabet:"0123456789",base16Alphabet:"0123456789ABCDEF",base36Alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",base61Alphabet:Cs,base62Alphabet:Ds,startsWith:function(e,t,r){var n=!1;return e&&t&&(e=e.substr(0,t.length),r&&(e=e.toLowerCase(),t=t.toLowerCase()),n=0===e.indexOf(t)),n},endsWith:function(e,t,r){var n=!1;if(e&&t){r&&(e=e.toLowerCase(),t=t.toLowerCase());var i=e.length-t.length;n=i>=0&&e.lastIndexOf(t)===i}return n},trim:function(e,t,r){var n=null,i=new RegExp("^[\t\n\v\f\r             　\u2028\u2029​]+"),a=new RegExp("[\t\n\v\f\r             　\u2028\u2029​]+$");if(e)if(r||t&&"\t\n\v\f\r             　\u2028\u2029​"!=t||!e.trim){var o=null,s=null,c=null;t&&void 0!==t?(o="["+(t=t.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"))+"]",s=new RegExp("^"+o+"+"),c=new RegExp(o+"+$")):(o="\t\n\v\f\r             　\u2028\u2029​",s=i,c=a),n=e.replace(s,"").replace(c,"")}else n=e.trim();return n},snakeCaseToCamelCase:snakeCaseToCamelCase,snakeCaseToUpperCamelCase:function(e){return snakeCaseToCamelCase(e,!0)},exceptionString:function(e,t){return"The function "+e+"."+t+"() must be overridden with a platform-specific delegate function.If you have no data for this function, have your delegate return null or undefined (no 'return')"},paramString:function(e){var t="",r="",n=!0;for(var i in e){var a=e[i];(a||0===a||!1===a)&&(t+=r+i+"="+encodeURIComponent(a),n&&(r="&",n=!1))}return t},versionStringFromUserAgent:function(e,t){var r=null;t=t||"\\S+";var n=new RegExp("\\b"+t+"/(\\S+)\\b","i").exec(e);return n&&n[1]&&(r=n[1]),r},requestId:function(e){var t=Date.now(),r=Math.floor(1e5*Math.random());return e+"z"+(t=t.toString(36).toUpperCase())+"z"+(r=r.toString(36).toUpperCase())},uuid:function(e){for(var t,r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",n="",i=0,a=r.length;i<a;i++)n+="x"===(t=r.charAt(i))?randomHexCharacter(e):"y"===t?randomHexCharacter(e,"8","b"):t;return n},randomHexCharacter:randomHexCharacter,convertNumberToBaseAlphabet:function(e,t){var r="",n=t.length;if(n<=36)r=e.toString(n).toUpperCase();else{for(var i,a,o=[];e>0;)i=e%n,a=t.charAt(i),o.push(a),e=(e-i)/n;r=o.reverse().join("")}return""===r&&(r="0"),r},cryptoRandomBase62String:function(e){var r;if(16777215==Math.floor(4294967295/256)){var n,i,a,o,s,c=t.crypto||t.msCrypto;if(c&&c.getRandomValues)n=c.getRandomValues(new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT)),s=!0;else if(c&&c.randomBytes){var l=c.randomBytes(16);n=new Uint32Array(l.buffer,l.byteOffset,l.byteLength/Uint32Array.BYTES_PER_ELEMENT),s=!0}else for(n=new Uint32Array(16/Uint32Array.BYTES_PER_ELEMENT),i=0;i<n.length;i++)n[i]=Math.floor(Math.random()*Math.floor(4294967295));if(n){for(r="",i=0;i<n.length;i++)for(o=n[i],a=0;a<6;a++)r+=Ds[o%62],o=Math.floor(o/62);e&&(r="1_"+(s?"1":"2")+"_"+r)}}return r}});function _valueForKeyPath(e,t,r){var n=t;if(e&&t)for(var i=e.split("."),a=0;n&&a<i.length;a++){var o=i[a];!(o in n)&&r&&(n[o]={}),n=o in n?n[o]:null}return n}function valueForKeyPath$1(e){var t=null;if(e&&arguments.length>1)for(var r=sourcesArray(Array.prototype.slice.call(arguments,1)),n=r.length-1;n>=0;n--){var i=r[n];if(isDefinedNonNull(t=_valueForKeyPath(e,i)))break}return t}function sourcesArray(e){var t=[],r=[];r=r.concat(e),arguments&&arguments.length>1&&(r=r.concat(Array.prototype.slice.call(arguments,1)));for(var n=0;n<r.length;n++){var i=r[n];t=t.concat(i)}return t}var xs=Object.freeze({__proto__:null,valueForKeyPath:valueForKeyPath$1,createObjectAtKeyPath:function(e,t){return _valueForKeyPath(e,t,!0)},sourcesArray:sourcesArray});function mergeAndCleanEventFields(e){for(var t=[!1,!1,!1].concat(Array.prototype.slice.call(arguments)),r=[],n=0;n<t.length;n++){var i=t[n];if(i&&i.constructor===Array)for(var a=0;a<i.length;a++)r.push(i[a]);else r.push(i)}return copyKeysAndValues$1.apply(null,r)}var Ls=Object.freeze({__proto__:null,mergeAndCleanEventFields:mergeAndCleanEventFields,processMetricsData:function(e,t,r,n){var i=mergeAndCleanEventFields(n),a=i;if(e&&t){var o={};if(r||(t=t.filter((function(e){return e in i}))),t.length)for(var s=0;s<t.length;s++){var c=t[s],l=e[c];isFunction$1(l)&&(o[c]=l.call(e,i))}a=mergeAndCleanEventFields(a,o)}return a},applyFieldsMap:function(e,t,r,n){var i,a,o;if(e&&t&&r){var s,c;if(a={},i=valueForKeyPath$1(t,r,r.custom))if(isArray$1(i))for(s=0;s<i.length;++s)isDefinedNonNull(c=e[i[s]])&&(a[i[s]]=c);else if(isObject(i)){for(var l in i)for(s=0;s<i[l].length;++s)if(isDefinedNonNull(c=valueForKeyPath$1(i[l][s],e))){a[l]=c;break}}else o="metrics: incorrect data type provided to applyFieldsMap (only accepts objects and Arrays)";else o="metrics: unable to get "+t+" section from fieldsMap"}else{var u=[];e||u.push("data"),t||u.push("sectionName"),r||u.push("fieldsMap"),o="metrics: missing argument(s): "+u.join(",")+" not provided to applyFieldsMap"}return o&&isFunction$1(n)&&n(o),a}});function makeAjaxRequest$2(e,t,r,n,i,a){var o=new XMLHttpRequest;r=r||void 0,a=a||{},n=isFunction$1(n)?n:function(){},i=isFunction$1(i)?i:function(){};var s=!1!==a.async;a.timeout&&s&&(o.timeout=a.timeout),o.onload=function(){o.status>=200&&o.status<300?n(o.response):i(new Error("XHR error: server responded with status "+o.status+" "+o.statusText),o.status)},o.onerror=function(){i(new Error("XHR error"))},o.open(t,e,s),o.withCredentials="boolean"!=typeof a.withCredentials||a.withCredentials,o.setRequestHeader("Content-type","application/json"),o.send(r)}var Ns=Object.freeze({__proto__:null,makeAjaxGetRequest:function(e,t,r){makeAjaxRequest$2(e,"GET",null,t,r)},makeAjaxRequest:makeAjaxRequest$2}),$s={LOCAL_STORAGE:"localStorage",SESSION_STORAGE:"sessionStorage"},_storageObject=function(e){var t=null,r=!1;return function(){return e?t=e:(r||(console.error("storageObject: storage object not found. Override this function if there is a platform-specific implementation"),r=!0),t||(t={storage:{},getItem:function(e){return this.storage[e]},setItem:function(e,t){this.storage[e]=t},removeItem:function(e){delete this.storage[e]}})),t}};function _defaultStorageObject(e){var t=null,r=e===$s.LOCAL_STORAGE;try{t="undefined"!==(r?typeof localStorage:typeof sessionStorage)?r?localStorage:sessionStorage:null}catch(n){t=null,console.error("_utils.storage._defaultStorageObject: Unable to retrieve storage object: "+n)}return t}var js=_storageObject(_defaultStorageObject($s.LOCAL_STORAGE)),Us=_storageObject(_defaultStorageObject($s.SESSION_STORAGE));var Gs=Object.freeze({__proto__:null,_utDefaultStorageObject:function(e){return _defaultStorageObject(e)},localStorageObject:js,sessionStorageObject:Us,saveObjectToStorage:function(e,t,r){var n=null;if(r)try{e.setItem(t,JSON.stringify(r)),n=r}catch(i){}else n=e.removeItem(t);return n},objectFromStorage:function(e,t){var r=null,n=e.getItem(t);if(n)try{r=JSON.parse(n)}catch(i){r=void 0}return r}});function FlagSymbol(e){this.key=e}FlagSymbol.prototype.toString=function(){return this.key};var Fs={flagArguments:{INCLUDE_CALL_STACK:new FlagSymbol("INCLUDE_CALL_STACK"),MIRROR_TO_SERVER:new FlagSymbol("MIRROR_TO_SERVER"),SUPPRESS_CLIENT_OUTPUT:new FlagSymbol("SUPPRESS_CLIENT_OUTPUT")},setDelegate:function(e){return Is.attachDelegate(this,e)},execute:function(e,t,r){var n=e.levelStringToIntMap[t];if(e.level()!==e.NONE&&e.level()<=n){var i=Array.prototype.slice.call(r),a=Fs.nonFlagLogArguments(i),o=Fs.logOptions(e,n,i),s=o.includeCallStack?(new Error).stack:null,c=s?a.concat("\n"+s):a;if(e[t]._lastLog=c,o.mirrorToServer,o.throwInsteadOfPrint)throw new Error(a.toString());o.suppressClientOutput||(console[t]?console[t].apply(console,c):console.log.apply(console,c))}},isFlagObject:function(e){return e&&e===Fs.flagArguments[e.toString()]},nonFlagLogArguments:function(e){return e.filter((function(e){return!Fs.isFlagObject(e)}))},logOptions:function(e,t,r){var n,i={};return r.forEach((function(e){Fs.isFlagObject(e)&&(n=Ms.snakeCaseToCamelCase(e.toString()),i[n]=!0)})),Is.isFunction(e.mirrorToServerLevel)&&e.mirrorToServerLevel()!==e.NONE&&e.mirrorToServerLevel()<=t&&(i.mirrorToServer=!0),e.throwLevel()!==e.NONE&&e.throwLevel()<=t&&(i.throwInsteadOfPrint=!0),i},sendToServer:function(e,t,r,n){}},Bs={NONE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4},Ks={MIN_LEVEL:Bs.NONE,MAX_LEVEL:Bs.ERROR,levelIntToStringMap:{0:"none",1:"debug",2:"info",3:"warn",4:"error"},levelStringToIntMap:{none:0,debug:1,info:2,warn:3,error:4}};Is.extend(Ks,Bs);var Vs={loggerName:"defaultLogger",level:Ks.INFO,throwLevel:Ks.NONE},Hs=!1,Ws={};function Logger(e){this._loggerName=e,this._level,this._throwLevel,Hs||(Hs=!0,Is.extend(Logger.prototype,Ks),Is.extend(Logger.prototype,Fs.flagArguments))}function loggerNamed(e){var t=Ws[e=e||Vs.loggerName];return t||(t=new Logger(e),Ws[e]=t),t}Logger.level=function(){return Vs.level},Logger.throwLevel=function(){return Vs.throwLevel},Logger.prototype.setDelegate=function(e){return Is.attachDelegate(this,e)},Logger.prototype.loggerName=function(){return this._loggerName},Logger.prototype.levelParameterAsInt=function(e){var t,r=null;return Is.isString(e)?t=this.levelStringToIntMap[e.toLowerCase()]:Is.isNumber(e)&&(t=e),t>=this.MIN_LEVEL&&t<=this.MAX_LEVEL&&(r=t),r},Logger.prototype.setLevel=function(e){var t=this.levelParameterAsInt(e);null!==t&&(this._level=t)},Logger.prototype.setThrowLevel=function(e){var t=this.levelParameterAsInt(e);null!==t&&(this._throwLevel=t)},Logger.prototype.level=function(){var e=this._level;return Is.isNumber(e)?e:Logger.level()},Logger.prototype.levelString=function(){return this.levelIntToStringMap[this.level()]},Logger.prototype.throwLevel=function(){var e=this._throwLevel;return Is.isNumber(e)?e:Logger.throwLevel()},Logger.prototype.debug=function(){Fs.execute(this,"debug",arguments)},Logger.prototype.info=function(){Fs.execute(this,"info",arguments)},Logger.prototype.warn=function(){Fs.execute(this,"warn",arguments)},Logger.prototype.error=function(){Fs.execute(this,"error",arguments)},Logger.prototype.lastLog=function(e){return this[e]?this[e]._lastLog:null};var qs=Is.attachDelegate,zs={setDelegate:function(e){return qs(this,e)},localStorageObject:Gs.localStorageObject,sessionStorageObject:Gs.sessionStorageObject},Ys=Is.attachDelegate,Qs={setDelegate:function(e){return Ys(this,e)},makeAjaxRequest:Ns.makeAjaxRequest},Js=Is.attachDelegate,Xs=Is.hasAnyKeys,Zs=Is.isArray,ec=Gs.saveObjectToStorage,tc=Gs.objectFromStorage,rc=As.exponentialBackoff,nc=xs.valueForKeyPath,ic={blacklistedFields:["capacitySystem","capacitySystemAvailable","capacityDisk","capacityData","capacityDataAvailable"],compoundSeparator:"_",configBaseUrl:"https://xp.apple.com/config/1/report",constraints:{profiles:{AMPWeb:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedOut",expirationPeriod:864e5}}},{filters:{valueMatches:{isSignedIn:[!0]}},fieldConstraints:{clientId:{generateValue:!0,namespace:"AMPWeb_isSignedIn",expirationPeriod:15552e6}}}]},strict:{precedenceOrderedRules:[{filters:"any",fieldConstraints:{clientId:{generateValue:!0,scopeFieldName:"parentPageUrl",scopeStrategy:"mainDomain",expirationPeriod:864e5},consumerId:{blacklisted:!0},dsId:{blacklisted:!0},parentPageUrl:{scope:"hostname"}}},{filters:{valueMatches:{eventType:["click"],actionType:["signUp"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{eventType:["dialog"],dialogType:["upsell"],result:["upsell"]}},fieldConstraints:{parentPageUrl:{scope:"fullWithoutParams"}}},{filters:{valueMatches:{userType:["signedIn"]}},fieldConstraints:{clientId:{scopeStrategy:"all"}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["click","dialog","media","search"]}},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}},{filters:{valueMatches:{userType:["signedIn"],eventType:["page","impressions"]},nonEmptyFields:["pageHistory"]},fieldConstraints:{clientId:{blacklisted:!0},consumerId:{blacklisted:!1},dsId:{blacklisted:!1}}}]}}},fieldsMap:{cookies:["itcCt","itscc"],custom:{impressions:["id","adamId","link.type","station-hash"],location:["id","adamId","dataSetId","name","fcKind","kindIds","type","link.type","station-hash","core-seed-name"]},single:{targetId:["id","adamId","contentId","type","link.type","fcId","userPreference","label","station-hash","linkIdentifier"]}},metricsUrl:"https://xp.apple.com/report",postFrequency:6e4,postFrequencyLowLatency:5e3,tokenSeparator:"|"},ac={},_appendSectionAndSubsectionToConfigSources=function(e,t,r){if(r){e.push(r);var n=r[t];n&&Xs(n)&&e.push(n)}},Config=function(e){this._topic=e,this._debugSource=null,this._cachedSource=null,this._serviceSource=null,this._initCalled=!1,this._initialized=!1,this._showedDebugWarning=!1,this._showedNoProvidedSourceWarning=!1,this._keyPathsThatSuppressWarning={configBaseUrl:!0},this.DEBUG_SOURCE_KEY="mtClientConfig_debugSource"+ic.compoundSeparator+this._topic,this.CACHED_SOURCE_KEY="mtClientConfig_cachedSource"+ic.compoundSeparator+this._topic};Config.createConfig=function(e,t,r,n){var i=Config.getConfig(e);return e&&"noTopicConfig"!==e&&!i._initCalled&&i.init(t,r,n),i},Config.getConfig=function(e){var t=ac[e=e||"noTopicConfig"];return t||(t=new Config(e),ac[e]=t),t},Config.cleanupConfig=function(e){if(e&&ac[e]){var t=ac[e];t.setCachedSource(),t.setDebugSource(),delete ac[e]}},Config.defaultConfig=function(){return Config.getConfig()},Config.value=function(e,t){var r=t&&ac[t]||Config.defaultConfig();return r.value.call(r,e)},Config.environment=zs,Config.logger=loggerNamed("mt-client-config"),Config.network=Qs,Config.prototype._defaults=function(){return ic},Config.prototype._setInitialized=function(e){this._initialized=e},Config.prototype._setInitCalled=function(e){this._initCalled=e},Config.prototype._setShowedDebugWarning=function(e){this._showedDebugWarning=e},Config.prototype._setShowedNoProvidedSourceWarning=function(e){this._showedNoProvidedSourceWarning=e},Config.prototype.setDelegate=function(e){return Js(this,e)},Config.prototype.topic=function(){return this._topic},Config.prototype.configHostname=function(){},Config.prototype.configUrl=function(){var e,t=this.configHostname();return e=t?"https://"+t+"/config/1/report":this.value("configBaseUrl"),"noTopicConfig"!==this._topic?e+="/"+this.topic():Config.logger.error("config.configUrl(): Topic must be provided"),e},Config.prototype.sources=function(){},Config.prototype.value=function(e){var t,r=this.cachedSource(),n=this.serviceSource(),i=this.sources(),a=this.debugSource(),o=r||n||i||a;return i||n||e in this._keyPathsThatSuppressWarning||this._showedNoProvidedSourceWarning||(this._showedNoProvidedSourceWarning=!0,Config.logger.warn("Metrics config: No config provided via delegate or fetched via init(), using default/cached config values.")),a&&(this._showedDebugWarning||(this._showedDebugWarning=!0,Config.logger.warn('"debugSource" found.\nThis will override any same-named client-supplied configSource fields.\nThis setting "sticks" across session, use "setDebugSource(null)" to clear'))),Zs(i)||(i=[i]),t=0===e.indexOf("blacklisted")?o?[r,n,i,a]:[ic]:[ic,r,n,i,a],t=this.configSourcesWithOverrides(t,this.topic()),nc.apply(null,[e].concat(t))},Config.prototype.configSourcesWithOverrides=function(e,t){var r=e;if(e&&e.length&&t){r=[];for(var n=0;n<e.length;n++){var i=e[n];if(i)if(Zs(i)&&i.length){for(var a=[],o=0;o<i.length;o++)_appendSectionAndSubsectionToConfigSources(a,t,i[o]);r.push(a)}else _appendSectionAndSubsectionToConfigSources(r,t,i)}}return r},Config.prototype.setDebugSource=function(e){return this._debugSource=e||null,ec(zs.localStorageObject(),this.DEBUG_SOURCE_KEY,this._debugSource)},Config.prototype.debugSource=function(){return this._debugSource||(this._debugSource=tc(zs.localStorageObject(),this.DEBUG_SOURCE_KEY)),this._debugSource},Config.prototype.setCachedSource=function(e){return this._cachedSource=e||null,ec(zs.localStorageObject(),this.CACHED_SOURCE_KEY,this._cachedSource)},Config.prototype.cachedSource=function(){return this._cachedSource||(this._cachedSource=tc(zs.localStorageObject(),this.CACHED_SOURCE_KEY)),this._cachedSource},Config.prototype.setServiceSource=function(e){return this._serviceSource=e,this._serviceSource},Config.prototype.serviceSource=function(){return this._serviceSource},Config.prototype.fetchConfig=function(e,t,r){r=r||function(){};rc(Qs.makeAjaxRequest.bind(Qs,e,"GET",null),(function(e){var n;try{e=JSON.parse(e),n=!0}catch(i){r.call(r,i)}n&&t&&t.call(t,e)}),r)},Config.prototype.init=function(e,t,r){if(!this._initCalled){this._initCalled=!0,t=t||function(){};var n=function(){this._initialized=!0,t.call(t)}.bind(this);if(e)this.setDelegate({sources:e}),n();else{this.setCachedSource(this.cachedSource());var i=this.configUrl(),a=function(e){this.setCachedSource(e),this.setServiceSource(e),n()}.bind(this);this.fetchConfig(i,a,r)}}},Config.prototype.initialize=function(e,t,r){return this.init.apply(this,Array.prototype.slice.call(arguments))},Config.prototype.initialized=function(){return this._initialized},Is.attachDelegate;var oc=Rs.metricsDisabledOrDenylistedEvent,sc=Rs.removeDenylistedFields,cc={},lc=["dsId","consumerId"];function recordEvent(e,t,r){var n=null;return r&&!oc.call(Config,r.eventType,t)&&(sc.call(Config,r,t),_removeIdentifiableFieldsForTopic(t,r),e.apply(null,Array.prototype.slice.call(arguments,1)),n=r),n}function _removeIdentifiableFieldsForTopic(e,t){cc[e]=cc[e]||{},cc[e].anonymous&&lc.forEach((function(e){delete t[e]}))}var uc=Is.attachDelegate,dc={setDelegate:function(e){return uc(this,e)},makeAjaxRequest:Ns.makeAjaxRequest};Is.isString,Is.isFunction,Rs.disabled;var pc=1e4,hc="events",yc="1.0",fc=2;function enrichAndSerializeEvents(e){var t=null;if(e&&e.length){var r={};r.deliveryVersion=yc,r.postTime=Date.now(),r[hc]=e;try{t=JSON.stringify(r)}catch(n){loggerNamed("mt-event-queue").error("Error stringifying events as JSON: "+n)}}return t}function _immediateRecordEvent(e,t){var r=enrichAndSerializeEvents([t]);if(r){var n=function(e){return Config.value("metricsUrl",e)+"/"+fc+"/"+e}(e),i={timeout:function(e){var t=Config.value("requestTimeout",e)||pc;return t=Math.min(t,Config.value("postFrequency",e))}(e)};cc[e]&&cc[e].anonymous&&(i.withCredentials=!1),dc.makeAjaxRequest(n,"POST",r,null,null,i)}}Is.attachDelegate;var mc,gc,vc={_document:function(){if("undefined"!=typeof document)return document;throw"metricskit-delegates-html.environment HTML delegate 'document' object not found"},_window:function(){if("undefined"!=typeof window)return window;throw"metricskit-delegates-html.environment HTML delegate 'window' object not found"},cookie:function(){return vc._window().document.cookie},pageUrl:function(){return vc._window().location.href},parentPageUrl:function(){var e,t=vc._window(),r=t.parent;if(r!==t)try{e=r.location.href}catch(n){e=vc._document().referrer}return e},pixelRatio:function(){return vc._window().devicePixelRatio},screenHeight:function(){return vc._window().screen.height},screenWidth:function(){return vc._window().screen.width},userAgent:function(){return vc._window().navigator.userAgent},windowInnerHeight:function(){return vc._window().innerHeight},windowInnerWidth:function(){return vc._window().innerWidth},windowOuterHeight:function(){return vc._window().outerHeight},windowOuterWidth:function(){return vc._window().outerWidth},timeOriginOffset:function(){var e=null,t=vc._window().performance;return t&&t.timing&&(e=t.timing.navigationStart),e},app:function(){},appVersion:function(){},capacityData:function(){},capacityDataAvailable:function(){},capacityDisk:function(){},capacitySystem:function(){},capacitySystemAvailable:function(){},connectionType:function(){},dsId:function(){},hardwareBrand:function(){},hardwareFamily:function(){},hardwareModel:function(){},hostApp:function(){},hostAppVersion:function(){},os:function(){},osBuildNumber:function(){},osLanguages:function(){},osVersion:function(){},resourceRevNum:function(){},storeFrontCountryCode:function(){},storeFrontHeader:function(){},userType:function(){}},bc={recordEvent:function(e,t){return recordEvent.apply(null,[_immediateRecordEvent].concat(Array.prototype.slice.call(arguments)))},sendMethod:function(){return"javascript"},setProperties:function(e,t){cc[e]=cc[e]||{},cc[e]=t},cleanup:function(){cc={}}};function environmentBaseFieldNames(){return gc||(gc=["app","appVersion","hardwareFamily","hardwareModel","os","osBuildNumber","osLanguages","osVersion","resourceRevNum","screenHeight","screenWidth","userAgent"].concat(["delegateApp","hardwareBrand","storeFrontCountryCode","storeFrontHeader"])),gc}var _c,Sc=Is.attachDelegate,Tc=Ms.cryptoRandomBase62String,Pc=Ms.exceptionString;function Base$1(e){this.setDelegate({topic:e}),_c||(_c=!0,environmentBaseFieldNames().forEach((function(e){Base$1.prototype[e]=function(t){return t&&t.hasOwnProperty(e)?t[e]:this.environment()[e]()}})))}Base$1._className="eventHandlers.base",Base$1.prototype.setDelegate=function(e){return Sc(this,e)},Base$1.prototype.topic=function(){throw Pc(Base$1._className,"topic")},Base$1.prototype.environment=function(){throw Pc(Base$1._className,"environment")},Base$1.prototype.eventRecorder=function(){throw Pc(Base$1._className,"eventRecorder")},Base$1.prototype.metricsData=function(){throw Pc(Base$1._className,"metricsData")},Base$1.prototype.processMetricsData=function(){throw Pc(Base$1._className,"processMetricsData")},Base$1.prototype.knownFields=function(){return mc||(mc=environmentBaseFieldNames().concat(["baseVersion","clientEventId","connection","eventTime","eventType","eventVersion","timezoneOffset","xpPostFrequency","xpSendMethod"])),mc},Base$1.prototype.baseVersion=function(){return 1},Base$1.prototype.clientEventId=function(e){return e&&e.clientEventId||Tc(!0)},Base$1.prototype.connection=function(e){return e&&e.connection||this.environment().connectionType()},Base$1.prototype.dsId=function(e){return e&&e.dsId||this.environment().dsId()},Base$1.prototype.eventTime=function(e){return e&&e.eventTime||Date.now()},Base$1.prototype.eventVersion=function(e){return e&&e.eventVersion||null},Base$1.prototype.timezoneOffset=function(e){return e&&e.timezoneOffset||(new Date).getTimezoneOffset()},Base$1.prototype.xpPostFrequency=function(e){return e&&e.xpPostFrequency||Config.value("postFrequency",this.topic())},Base$1.prototype.xpSendMethod=function(e){return e&&e.xpSendMethod||this.eventRecorder().sendMethod()};var Ec,kc=Base$1,wc=Is.attachDelegate,Ic=Ms.exceptionString,Oc=Gs.localStorageObject,Ac=Gs.sessionStorageObject;function Environment$1(){Ec||(Ec=!0,["app","appVersion","hardwareFamily","hardwareModel","os","osBuildNumber","osLanguages","osVersion","resourceRevNum","screenHeight","screenWidth","userAgent"].forEach((function(e){Environment$1.prototype[e]=function(){throw Ic(Environment$1._className,e)}})),["delegateApp","hardwareBrand","storeFrontCountryCode","storeFrontHeader"].forEach((function(e){Environment$1.prototype[e]=function(){}})))}Environment$1._className="system.environment",Environment$1.prototype.setDelegate=function(e){return wc(this,e)},Environment$1.prototype.connectionType=function(){throw Ic(Environment$1._className,"connectionType")},Environment$1.prototype.dsId=function(){},Environment$1.prototype.localStorageObject=Oc,Environment$1.prototype.sessionStorageObject=Ac;var Rc=Environment$1,Cc=Is.extend;function MetricsData$2(){this._eventData={}}MetricsData$2.prototype.updateData=function(){Cc.apply(null,[this._eventData].concat(Array.prototype.slice.call(arguments)))};var Dc,Mc=MetricsData$2;function topic(){return Dc}var xc="unknown",Lc="next",Nc="previous",$c="location",jc="interval",Uc="playhead",Gc="scrub",Fc="transition",Bc="interruption",Kc="buffering",Vc="play",Hc="seek",Wc="skipIntro",qc="actionType",zc="consumerId",Yc="consumerNs",Qc="dsId",Jc="eventType",Xc="eventVersion",Zc="isOffline",el="videoViewportHeight",tl="videoViewportWidth",rl={TYPE:{MANUAL:"manual",AUTOMATIC:"automatic",UNKNOWN:xc},PLAY_START_REASON:{PLAY:Vc,UNPAUSE:"unpause",NEXT:Lc,PREVIOUS:Nc,SEEK:Hc,TRANSITION:Fc,INTERRUPTION:Bc,FOREGROUND:"foreground",FOCUS:"focus",BUFFERING:Kc,UNKNOWN:xc},PLAY_START_REASON_TYPE:{SKIP_INTRO:Wc},PLAY_STOP_REASON:{COMPLETE:"complete",TRANSITION:Fc,PLAY_OTHER:"playOther",PAUSE:"pause",SEEK:Hc,NEXT:Lc,INTERRUPTION:Bc,BACKGROUND:"background",EXIT:"exit",INACTIVITY:"inactivity",BUFFERING:Kc,ERROR:"error",FAILURE:"failure",UNKNOWN:xc,CLOSE_PLAYER:"closePlayer"},PLAY_STOP_REASON_TYPE:{SKIP_INTRO:Wc},SEEK_START_REASON:{NEXT:Lc,PREVIOUS:Nc,LOCATION:$c,INTERVAL:jc,PLAYHEAD:Uc,SCRUB:Gc,UNKNOWN:xc,SKIP_INTRO:Wc},SEEK_STOP_REASON:{NEXT:Lc,PREVIOUS:Nc,LOCATION:$c,INTERVAL:jc,PLAYHEAD:Uc,SCRUB:Gc,UNKNOWN:xc,SKIP_INTRO:Wc}},nl={ACTIVITY_TYPE:{PLAY:Vc,SEEK:Hc},ACTION_TYPE:{START:"start",STOP:"stop"},EVENT_TYPE:{PLAY_ACTIVITY:"playActivity",SEEK_ACTIVITY:"seekActivity"}},il={INCLUDES_START_POSITIONS:"includesStartPositions",INCLUDES_END_POSITIONS:"includesEndPositions"},al=Rc;function VPAFKitEnvironment(){al.apply(this,arguments)}VPAFKitEnvironment.prototype=new al,VPAFKitEnvironment.prototype.constructor=VPAFKitEnvironment,VPAFKitEnvironment.prototype.consumerId=function(){},VPAFKitEnvironment.prototype.consumerNs=function(){},VPAFKitEnvironment.prototype.isOffline=function(){},VPAFKitEnvironment.prototype.videoViewportHeight=function(){},VPAFKitEnvironment.prototype.videoViewportWidth=function(){};var ol=Is.attachDelegate,sl=Ms.exceptionString,cl={setDelegate:function(e){return ol(this,e)},recordEvent:function(e,t){throw sl("system.eventRecorder","recordEvent")},sendMethod:function(){throw sl("system.eventRecorder","sendMethod")},flushUnreportedEvents:function(e){}},ll={};ll.environment=new VPAFKitEnvironment,ll.eventRecorder=cl,ll.logger=loggerNamed("mt-vpafkit");var ul=kc,dl=Ls.processMetricsData,VPAFKitBase=function(){ul.apply(this,arguments)};(VPAFKitBase.prototype=new ul).constructor=VPAFKitBase,VPAFKitBase.prototype.environment=function(){return ll.environment},VPAFKitBase.prototype.eventRecorder=function(){return ll.eventRecorder},VPAFKitBase.prototype.knownFields=function(){var e=ul.prototype.knownFields().concat([qc,zc,Yc,Qc,Zc,el,tl]);return e},VPAFKitBase.prototype.consumerId=function(e){var t=zc;return e&&t in e?e[t]:this.environment().consumerId()},VPAFKitBase.prototype.consumerNs=function(e){var t=Yc;return e&&t in e?e[t]:this.environment().consumerNs()},VPAFKitBase.prototype.isOffline=function(e){var t=Zc;return e&&t in e?e[t]:this.environment().isOffline()},VPAFKitBase.prototype.videoViewportHeight=function(e){var t=el;return e&&t in e?e[t]:this.environment().videoViewportHeight()},VPAFKitBase.prototype.videoViewportWidth=function(e){var t=tl;return e&&t in e?e[t]:this.environment().videoViewportWidth()};var pl=new VPAFKitBase((function(){return topic()}));pl.metricsData=function(){return pl.processMetricsData.apply(pl,[null].concat(Array.prototype.slice.call(arguments)))},pl.processMetricsData=function(e){var t=null;if(!Config.metricsDisabledOrBlacklistedEvent(e,topic())){var r=Array.prototype.slice.call(arguments,1);if(this!==pl){var n=pl.metricsData.apply(pl,r);r=[n].concat(r)}t=dl(this,this.knownFields(),!0,r)}return Config.removeBlacklistedFields(t,topic()),t};var hl=Is.attachDelegate,yl=Is.extend,MediaActivity=function(e,t){this._defaultEventType=e,this._reasonConstants=t,this._defaultActionType};yl(MediaActivity,nl),Object.defineProperties(MediaActivity.prototype,{TYPE:{get:function(){return rl.TYPE}},REASON:{get:function(){return this._reasonConstants}}}),MediaActivity.prototype.setDelegate=function(e){return hl(this,e)},MediaActivity.prototype.knownFields=function(){var e=[qc,Jc,Xc];return e},MediaActivity.prototype.eventType=function(e){return this._defaultEventType},MediaActivity.prototype.eventVersion=function(e){var t=pl.eventVersion(e);return null!==t?t:1},MediaActivity.prototype.actionType=function(e){return this._defaultActionType};var StartMediaActivity=function(e,t){MediaActivity.apply(this,arguments),this._defaultActionType=MediaActivity.ACTION_TYPE.START};(StartMediaActivity.prototype=new MediaActivity).constructor=StartMediaActivity,StartMediaActivity.prototype.metricsData=function(e,t,r,n){var i=this.eventType(),a={position:e,overallPosition:t,startType:r,startReason:n},o=Array.prototype.slice.call(arguments,4);return pl.processMetricsData.apply(this,[i,a].concat(o))};var StopMediaActivity=function(e,t){MediaActivity.apply(this,arguments),this._defaultActionType=MediaActivity.ACTION_TYPE.STOP};(StopMediaActivity.prototype=new MediaActivity).constructor=StopMediaActivity,StopMediaActivity.prototype.metricsData=function(e,t,r,n,i){var a=this.eventType(),o={position:e,overallPosition:t,stopType:r,stopReason:n,startPosition:(i=i||{}).position,startOverallPosition:i.overallPosition,startTime:i.eventTime,startType:i.startType,startReason:i.startReason,startReasonType:i.startReasonType};a===MediaActivity.EVENT_TYPE.SEEK_ACTIVITY&&(o.startAssetId=i.assetId);var s=Array.prototype.slice.call(arguments,5);return pl.processMetricsData.apply(this,[a,o].concat(s))};var fl=new StartMediaActivity(MediaActivity.EVENT_TYPE.PLAY_ACTIVITY,rl.PLAY_START_REASON),ml=new StopMediaActivity(MediaActivity.EVENT_TYPE.PLAY_ACTIVITY,rl.PLAY_STOP_REASON),gl=new StartMediaActivity(MediaActivity.EVENT_TYPE.SEEK_ACTIVITY,rl.SEEK_START_REASON),vl=new StopMediaActivity(MediaActivity.EVENT_TYPE.SEEK_ACTIVITY,rl.SEEK_STOP_REASON),bl=Object.freeze({__proto__:null,base:pl,playStart:fl,playStop:ml,seekStart:gl,seekStop:vl}),_l=Is.extend,MediaActivity$1=function(e){this._activityType=e,this._startMetricsData=null,this._isStopped=!1};MediaActivity$1.ACTIVITY_TYPE=nl.ACTIVITY_TYPE,Object.defineProperties(MediaActivity$1.prototype,{isStopped:{get:function(){return this._isStopped}},type:{get:function(){return this._activityType}},startOverallPosition:{get:function(){return this._startMetricsData?this._startMetricsData.overallPosition:null}}}),_l(MediaActivity$1.prototype,rl),MediaActivity$1.prototype.started=function(e,t,r,n){var i=this._startEventHandler();i&&(this._startMetricsData=i.metricsData.apply(i,arguments),this.type!=MediaActivity$1.ACTIVITY_TYPE.SEEK&&cl.recordEvent(topic(),this._startMetricsData))},MediaActivity$1.prototype.stopped=function(e,t,r,n){var i=this._stopEventHandler();if(i){this._isStopped=!0;var a=[e,t,r,n,this._startMetricsData].concat(Array.prototype.slice.call(arguments,4)),o=i.metricsData.apply(i,a);cl.recordEvent(topic(),o)}},MediaActivity$1.prototype._startEventHandler=function(){var e;switch(this.type){case MediaActivity$1.ACTIVITY_TYPE.PLAY:e=fl;break;case MediaActivity$1.ACTIVITY_TYPE.SEEK:e=gl}return e},MediaActivity$1.prototype._stopEventHandler=function(){var e;switch(this.type){case MediaActivity$1.ACTIVITY_TYPE.PLAY:e=ml;break;case MediaActivity$1.ACTIVITY_TYPE.SEEK:e=vl}return e};var Sl=Is.isInteger,TimeTracker=function(e,t){this._date=new Date,this._position=t,this._validatePlaybackRate(e),this._playbackRate=e};Object.defineProperties(TimeTracker.prototype,{playbackRate:{get:function(){return this._playbackRate}}}),TimeTracker.prototype.update=function(e,t){this._date=new Date,this._position=t,this._validatePlaybackRate(e),this._playbackRate=e},TimeTracker.prototype.estimatedTime=function(e){var t;Sl(e)?t=e:(ll.logger.error("VPAFKit error: position should be an integer"),t=Math.round(e));var r=(t-this._position)/(0==this.playbackRate?1:this.playbackRate);return this._date.getTime()+Math.round(r)},TimeTracker.prototype._validatePlaybackRate=function(e){0==e&&ll.logger.error("VPAFKit error: playbackRate should not be zero.")};var Tl=Is.attachDelegate,Pl=Is.extend,El=Is.isFunction,kl=Is.isNumber,wl=Mc,Il=il.INCLUDES_START_POSITIONS,Ol=il.INCLUDES_END_POSITIONS,MediaActivityTracker=function(e){wl.apply(this,arguments),this._playlist=e,this._playActivity=null,this._playStartPlaylistItem=null,this._seekActivity=null,this._timeTracker=null,this._shouldGenerateTransitions=!0};(MediaActivityTracker.prototype=new wl).constructor=MediaActivityTracker,Pl(MediaActivityTracker.prototype,rl),Object.defineProperties(MediaActivityTracker.prototype,{shouldGenerateTransitions:{get:function(){return this._shouldGenerateTransitions},set:function(e){this._shouldGenerateTransitions=e}}}),MediaActivityTracker.prototype.setDelegate=function(e){return Tl(this,e)},MediaActivityTracker.prototype.playStarted=function(e,t,r){return this.playStartedWithPlaybackRate.apply(this,[1].concat(Array.prototype.slice.call(arguments)))},MediaActivityTracker.prototype.playStartedWithPlaybackRate=function(e,t,r,n){if(this._hasUnstoppedActivity(this._playActivity))this._error("inconsistent state: did you forget to call playStopped?");else{var i=this._playlistItem(t,Il);i&&(this._playStarted.apply(this,[i].concat(Array.prototype.slice.call(arguments,1))),this.shouldGenerateTransitions&&(this._timeTracker=new TimeTracker(e,t)))}},MediaActivityTracker.prototype.playStopped=function(e,t,r){this._generatePlaylistTransitionsIfNecessary(e),this._hasUnstoppedActivity(this._playActivity)?this._playStopped.apply(this,Array.prototype.slice.call(arguments)):this._error("inconsistent state: did you forget to call playStarted?"),this._playStartPlaylistItem=null,this._timeTracker=null},MediaActivityTracker.prototype.playTransitioned=function(e){this.playStopped.apply(this,[e,this.TYPE.AUTOMATIC,this.PLAY_STOP_REASON.TRANSITION].concat(Array.prototype.slice.call(arguments,1))),this.playStarted.apply(this,[e,this.TYPE.AUTOMATIC,this.PLAY_START_REASON.TRANSITION].concat(Array.prototype.slice.call(arguments,1)))},MediaActivityTracker.prototype.seekStarted=function(e,t,r){if(this._hasUnstoppedActivity(this._seekActivity))this._error("inconsistent state: did you forget to call seekStopped?");else{var n=this._playlistItem(e,Il);if(n){var i=this._activityArguments.apply(this,[n].concat(Array.prototype.slice.call(arguments)));this._seekActivity=new MediaActivity$1(MediaActivity$1.ACTIVITY_TYPE.SEEK),this._seekActivity.started.apply(this._seekActivity,i)}}},MediaActivityTracker.prototype.seekStopped=function(e,t,r){var n=this._playlistItem(e,Ol);if(n&&this._hasUnstoppedActivity(this._seekActivity)){var i=this._activityArguments.apply(this,[n].concat(Array.prototype.slice.call(arguments)));this._seekActivity.stopped.apply(this._seekActivity,i)}else this._error("inconsistent state: did you forget to call seekStarted?")},MediaActivityTracker.prototype.synchronize=function(e,t){if(this.shouldGenerateTransitions){var r=e>0,n=this._hasUnstoppedActivity(this._playActivity);n&&r?(this._generatePlaylistTransitionsIfNecessary(t),this._timeTracker.update(e,t)):n&&!r?this._error("inconsistent state: did you forget to call playStopped?"):!n&&r&&this._error("inconsistent state: did you forget to call playStarted?")}},MediaActivityTracker.prototype._playStarted=function(e,t,r,n){var i=this._activityArguments.apply(this,[e].concat(Array.prototype.slice.call(arguments,1)));this._playStartPlaylistItem=e,this._playActivity=new MediaActivity$1(MediaActivity$1.ACTIVITY_TYPE.PLAY),this._playActivity.started.apply(this._playActivity,i)},MediaActivityTracker.prototype._playStopped=function(e,t,r){var n=this._playStartPlaylistItem,i=this._activityArguments.apply(this,[n].concat(Array.prototype.slice.call(arguments)));this._playActivity.stopped.apply(this._playActivity,i)},MediaActivityTracker.prototype._playlistItem=function(e,t){var r;return this._playlist&&El(this._playlist.getItem)&&(r=this._playlist.getItem(e,t)),r||this._error("unable to get item from playlist"),r},MediaActivityTracker.prototype._playlistItems=function(e,t){var r=[];return this._playlist&&El(this._playlist.getItems)?r=this._playlist.getItems(e,t):this._error("unable to get items from playlist"),r},MediaActivityTracker.prototype._relativePosition=function(e,t){var r;return(t=t||this._playlistItem(e))&&kl(t.startOverallPosition)&&(r=e-t.startOverallPosition+(t.startPosition||0)),r},MediaActivityTracker.prototype._combineEventData=function(e,t){var r=this._playlist?this._playlist.eventData:null,n=e?e.eventData:null,i=[];return r&&i.push(r),n&&i.push(n),this._eventData&&i.push(this._eventData),t&&(i=i.concat(t)),i},MediaActivityTracker.prototype._activityArguments=function(e,t,r,n){var i=this._relativePosition(t,e),a=this._combineEventData(e,Array.prototype.slice.call(arguments,4)),o=[i,t,r,n].concat(a);return o},MediaActivityTracker.prototype._generatePlaylistTransitionsIfNecessary=function(e){if(this.shouldGenerateTransitions&&this._hasUnstoppedActivity(this._playActivity)){var t,r,n,i=this._playActivity.startOverallPosition||0,a=this._playlistItems(i,e);this._playlist._returnsOrderedItems||a.sort(this._playlistItemComparator);for(var o=0;o+1<a.length;o++)if(!((t=(r=a[o+1]).startOverallPosition)<=i)){if(t>=e)break;n={eventTime:this._timeTracker?this._timeTracker.estimatedTime(t):null},this._playStopped(t,this.TYPE.AUTOMATIC,this.PLAY_STOP_REASON.TRANSITION,n),this._playStarted(r,t,this.TYPE.AUTOMATIC,this.PLAY_START_REASON.TRANSITION,n)}}},MediaActivityTracker.prototype._hasUnstoppedActivity=function(e){return e&&!e.isStopped},MediaActivityTracker.prototype._error=function(e){ll.logger.error(this.constructor.name+" error: "+e)},MediaActivityTracker.prototype._playlistItemComparator=function(e,t){return e.startOverallPosition==t.startOverallPosition?0:e.startOverallPosition<t.startOverallPosition?-1:1};var Al=Mc,MediaPlaylistItem=function(e){Al.apply(this,arguments),this._startOverallPosition=e,this._startPosition=0};(MediaPlaylistItem.prototype=new Al).constructor=MediaPlaylistItem,Object.defineProperties(MediaPlaylistItem.prototype,{startOverallPosition:{get:function(){return this._startOverallPosition}},startPosition:{get:function(){return this._startPosition},set:function(e){this._startPosition=e}},eventData:{get:function(){return this._eventData}}});var HLSRollItem=function(e,t){MediaPlaylistItem.apply(this,arguments),this._duration=t};(HLSRollItem.prototype=new MediaPlaylistItem).constructor=HLSRollItem,Object.defineProperties(HLSRollItem.prototype,{duration:{get:function(){return this._duration}},endOverallPosition:{get:function(){return this.startOverallPosition+this.duration}}}),HLSRollItem.prototype.containsOverallPosition=function(e){return this.startOverallPosition<=e&&this.endOverallPosition>e};var MediaPlaylist=function(){};MediaPlaylist.prototype.RANGE_OPTIONS=il,Object.defineProperties(MediaPlaylist.prototype,{eventData:{get:function(){}}}),MediaPlaylist.prototype.getItem=function(e,t){},MediaPlaylist.prototype.getItems=function(e,t){};var Rl=Is.attachDelegate,Cl=Is.copyKeysAndValues,Dl=Is.extend,Ml=Is.isInteger,HLSVideoPlaylist=function(e){MediaPlaylist.apply(this,arguments),this._startPosition=e,this._mainFeatureMetricsData=Cl.apply(null,[!1,!1,!1,null].concat(Array.prototype.slice.call(arguments,1))),this._rollItems=[]};(HLSVideoPlaylist.prototype=new MediaPlaylist).constructor=HLSVideoPlaylist,HLSVideoPlaylist.prototype.setDelegate=function(e){return Rl(this,e)},HLSVideoPlaylist.prototype.addRollInfoItems=function(e){e&&e.length&&e.forEach((function(e){this.addRollInfoItem(e)}),this)},HLSVideoPlaylist.prototype.addRollInfoItem=function(e){e&&this.addRollItem(1e3*e.start,1e3*e.duration,e.metricsData)},HLSVideoPlaylist.prototype.addRollItem=function(e,t){var r=new HLSRollItem(e,t);r.updateData.apply(r,Array.prototype.slice.call(arguments,2)),this._addRollItem(r)},HLSVideoPlaylist.prototype.updateMainFeatureMetricsData=function(){Dl.apply(null,[this._mainFeatureMetricsData].concat(Array.prototype.slice.call(arguments)))},HLSVideoPlaylist.prototype.getItem=function(e,t){var r,n=this._indexOfLastRollItemWithStartBeforePosition(e);if(Ml(n)){for(;t!=this.RANGE_OPTIONS.INCLUDES_START_POSITIONS&&this._rollItems[n].startOverallPosition==e&&n>0;)n--;(r=this._rollItems[n]).containsOverallPosition(e)||t==this.RANGE_OPTIONS.INCLUDES_END_POSITIONS&&r.endOverallPosition==e||(r=this._mainFeatureItemWithStartOverallPosition(r.endOverallPosition))}else r=this._mainFeatureItemWithStartOverallPosition(this._startPosition);return r},HLSVideoPlaylist.prototype.getItems=function(e,t){var r=[];if(this._rollItems.length){var n=this._indexOfLastRollItemWithStartBeforePosition(e);for(Ml(n)||(r.push(this._mainFeatureItemWithStartOverallPosition(this._startPosition)),n=0);n<this._rollItems.length;){var i=this._rollItems[n];if(i.startOverallPosition>t)break;if(i.endOverallPosition>=e&&r.push(i),n++,i.endOverallPosition<t)if(n<this._rollItems.length){var a=this._rollItems[n];a.startOverallPosition&&a.startOverallPosition>i.endOverallPosition&&r.push(this._mainFeatureItemWithStartOverallPosition(i.endOverallPosition))}else r.push(this._mainFeatureItemWithStartOverallPosition(i.endOverallPosition))}}else r.push(this._mainFeatureItemWithStartOverallPosition(this._startPosition));return r},HLSVideoPlaylist.prototype._addRollItem=function(e){if(e){var t=this._insertionIndexForItemWithPosition(e.startOverallPosition);this._rollItems.splice(t,0,e)}},HLSVideoPlaylist.prototype._indexOfLastRollItemWithStartBeforePosition=function(e){var t,r=this._rollItems[0];return r&&Ml(e)&&r.startOverallPosition<=e&&(t=this._insertionIndexForItemWithPosition(e)-1),t},HLSVideoPlaylist.prototype._insertionIndexForItemWithPosition=function(e){for(var t=0,r=this._rollItems.length;t<r;){var n=Math.floor((t+r)/2);this._rollItems[n].startOverallPosition>e?r=n:t=n+1}return t},HLSVideoPlaylist.prototype._mainFeatureItemWithStartOverallPosition=function(e){var t=new MediaPlaylistItem(e);return t.startPosition=this._featurePlayheadProgress(e),t.updateData(this._mainFeatureMetricsData),t},HLSVideoPlaylist.prototype._featurePlayheadProgress=function(e){e=e||0;var t,r,n=this._indexOfLastRollItemWithStartBeforePosition(e),i=this._startPosition||0;Ml(n)||(n=-1);for(var a=n;a>=0;a--)t=this._rollItems[a],0===a?i+=t.startOverallPosition:(r=this._rollItems[a-1],i+=t.startOverallPosition-r.endOverallPosition);return i};var xl=Object.freeze({__proto__:null,createTracker:function(e){var t=new MediaActivityTracker(e);return t.updateData.apply(t,Array.prototype.slice.call(arguments,1)),t},createHLSVideoPlaylist:function(e){var t=new HLSVideoPlaylist(e);return t.updateMainFeatureMetricsData.apply(t,Array.prototype.slice.call(arguments,1)),t}});var Ll=Object.freeze({__proto__:null,applyFieldsMap:function(e,t){var r=Config.value("fieldsMap",topic());return Ls.applyFieldsMap(e,t,r)}}),Nl=Object.freeze({__proto__:null,eventFields:Ll}),$l=Is.setDelegates,jl=Is.attachMethods,Ul=Is.copyDelegatedFunctions,Gl=Rs.metricsDisabledOrBlacklistedEvent,Fl=Rs.removeBlacklistedFields;function PlayActivity(){this.config=Config.defaultConfig(),this._initCalled=!1}PlayActivity.prototype._utReset=function(){this.config=Config.defaultConfig(),this._initCalled=!1},PlayActivity.prototype.init=function(e,t,r,n,i){if(!this._initCalled){this._initCalled=!0,r&&($l(bl,r),$l(ll,r)),function(e){Dc=e}(e);var a=Config.getConfig(e),o={metricsDisabledOrBlacklistedEvent:Gl,removeBlacklistedFields:Fl};jl(a,o,a),jl(Config,o,Config),Ul(this.config,a),a.setDebugSource(this.config.debugSource()),a.init(t,n,i),this.config=a}},PlayActivity.prototype.system=ll,PlayActivity.prototype.eventHandlers=bl,PlayActivity.prototype.mediaActivityTracker=xl,PlayActivity.prototype.utils=Nl;var Bl=new PlayActivity;const Kl={"ac-3":"AC3","mp4a.a5":"AC3",alac:"Apple Lossless","ec-3":"EC3","mp4a.a6":"EC3",flac:"Free Lossless","mp4a.40.2":"AAC","mp4a.40.5":"AAC","mp4a.40.29":"AAC","mp4a.40.34":"MP3","mp4a.40.42":"AAC"},Vl=/^[0-9]+\/JOC$/,isAtmos=(e,t)=>"EC3"===Kl[e]&&(e=>Vl.test(e))(t),Hl=["dvh1.05.01","dvhe.05.06"],Wl={PQ:"HDR",HLG:"HDR",SDH:"SDH"};var ql;const convertToVideoColorRange=(e,t)=>(e=>-1!==Hl.indexOf(e))(e)?"DolbyVision":(e=>null!==(ql=Wl[e])&&void 0!==ql?ql:e)(t);function _defineProperty$3(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var zl,Yl,Ql;!function(e){e.MANUAL="MANUAL",e.AUTOMATIC="AUTOMATIC",e.UNKNOWN="UNKNOWN"}(zl||(zl={})),function(e){e.buffering="buffering",e.idle="idle",e.paused="paused",e.playing="playing"}(Yl||(Yl={})),function(e){e.bufferStart="BUFFER_START",e.bufferStop="BUFFER_STOP",e.exit="EXIT",e.play="PLAY",e.pause="PAUSE",e.stop="STOP",e.next="NEXT",e.newItem="NEW"}(Ql||(Ql={}));const Jl={initial:"idle",states:{idle:{on:{PLAY:{target:"playing",context:{reason:"PLAY",manual:"MANUAL",fromInitialPlay:!0}}}},playing:{on:{BUFFER_START:{target:"buffering",context:{reason:"BUFFERING",manual:"AUTOMATIC",fromInitialPlay:"~~previous~~"}},EXIT:{target:"idle",context:{reason:"EXIT"}},PAUSE:{target:"paused",context:{reason:"PAUSE"}},STOP:{target:"idle",context:{}},NEXT:{target:"idle",context:{reason:"NEXT"}},NEW:{target:"idle",context:{}}}},paused:{on:{PLAY:{target:"playing",context:{reason:"UNPAUSE"}},NEW:{target:"idle",context:{}},EXIT:{target:"idle",context:{reason:"EXIT"}}}},buffering:{on:{BUFFER_STOP:{target:"playing",context:{reason:"BUFFERING",manual:"AUTOMATIC"}},EXIT:{target:"idle",context:{reason:"EXIT"}}}}}},Xl={manual:"UNKNOWN",reason:"UNKNOWN",fromInitialPlay:!1};class VPAFStateMachine{isAllowedTransition(e){return void 0!==this.getNextState(e)}transition(e,t={}){const r=this.getNextState(e);if(!r)return;Li.debug(`[mk/activity/vpaf] Transitioning from ${this.currentState} to ${r.target} because ${e}`);const n={};return hasOwn(t,"manual")&&(void 0!==t.manual?n.manual=t.manual?"MANUAL":"AUTOMATIC":n.manual="UNKNOWN"),void 0!==t.reason&&(n.reason=t.reason),this.currentContext=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$3(e,t,r[t])}))}return e}({},Xl,r.context,n,this.preservePreviousContext(r.context)),this.currentState=r.target,this.currentContext}reset(){this.currentState=Jl.initial,this.currentContext=Xl}getNextState(e){return Jl.states[this.currentState].on[e]}preservePreviousContext(e){const t={};return["manual","reason","reasonType","fromInitialPlay"].forEach(r=>{"~~previous~~"===e[r]&&(t[r]=this.currentContext[r])}),t}constructor(){this.currentState=Jl.initial,this.currentContext=Xl}}function asyncGeneratorStep$1(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator$1(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep$1(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep$1(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty$2(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$2(e,t,r[t])}))}return e}function _objectSpreadProps(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}var Zl={}&&{}.__decorate||function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},eu={}&&{}.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};const tu=Li.createChild("vpaf");var ru;!function(e){e.SEEK_STARTED="seekStarted",e.SEEK_STOPPED="seekStopped",e.PLAY_STARTED="playStarted",e.PLAY_STOPPED="playStopped"}(ru||(ru={}));const nu={[zt.playbackPause]:Ql.pause,[zt.playbackPlay]:Ql.play,[zt.playbackStop]:Ql.stop,[zt.playerExit]:Ql.exit},iu={[Zt.EXITED_APPLICATION]:"EXIT",[Zt.FAILED_TO_LOAD]:"FAILURE",[Zt.MANUALLY_SELECTED_PLAYBACK_OF_A_DIFF_ITEM]:"PLAY_OTHER",[Zt.NATURAL_END_OF_TRACK]:"COMPLETE",[Zt.PLAYBACK_PAUSED_DUE_TO_INACTIVITY]:"INACTIVITY",[Zt.SCRUB_BEGIN]:"SEEK",[Zt.TRACK_SKIPPED_BACKWARDS]:"SEEK",[Zt.TRACK_SKIPPED_FORWARDS]:"SEEK",[da.NEXT_ITEM]:"NEXT"},au={[e.PresentationMode.pictureinpicture]:"pictureInPicture",[e.PresentationMode.inline]:"foreground",_default:"foreground"};function asMilliseconds(e){return Math.round(1e3*e)}function ensurePositionData(e,t){if(null==t?void 0:t.isLinearStream){if(void 0===e.playingDate)throw new Error('VPAFTracker: The property `playingDate` is required on data for "linear" content');return e}if(void 0===e.position)throw new Error('VPAFTracker: The property `position` is required on data "vod" content');return e}class VPAFTracker{get requestedEvents(){return Array.from(this.dispatchTable.keys())}get currentItem(){return this._currentItem}set currentItem(e){this._currentItem=e,this.currentSkipItems=e?parseSkipItems(e):void 0}configure(e,t){var r=this;return _asyncToGenerator$1((function*(){var n;if(r.instance=e,r.dispatcher=t.services.dispatcher,!Vi.storekit.cid)try{yield Vi.storekit.infoRefresh()}catch(a){}const i=null===(n=t.services.apiManager)||void 0===n?void 0:n.utsClient;return new Promise((e,t)=>{const n=function(){if(Array.isArray(navigator.languages))return navigator.languages;if("string"==typeof navigator.language)return[navigator.language];if("string"==typeof globalThis.navigator.userLanguage)return[globalThis.navigator.userLanguage];return[]}(),onSuccess=()=>(Bl.system.environment.setDelegate({app:()=>"com.apple.tv",appVersion:()=>"1.0",consumerId:()=>Vi.storekit.cid,consumerNs:()=>"TV",isOffline:()=>!1,delegateApp:()=>"web-tv-player",osLanguages:()=>n,resourceRevNum:()=>Bi.app.build,storeFrontCountryCode(){var e,t,r;return null!==(r=null==i||null===(e=i.configuration)||void 0===e||null===(t=e.userProps)||void 0===t?void 0:t.country)&&void 0!==r?r:""}}),r.setupListeners(),r.vpafKitInited=!0,e());if(r.vpafKitInited)return onSuccess();const a={environment:vc,eventRecorder:bc};Bl.init("xp_amp_tv_vpaf",null,a,onSuccess,e=>{t(e)})})}))()}cleanup(){var e=this;return _asyncToGenerator$1((function*(){e.tracker=void 0,e.isScrubbing=!1,e.scrubStopPosition=void 0,e.teardownListeners(),e.stopSynchronizing()}))()}shouldTrackPlayActivity(e,t){if(!t)return!1;const r=t.defaultPlayable;if(!r||!r.vpafMetrics)return!1;const n=nu[e];return void 0===n||this.state.isAllowedTransition(n)}handleEvent(e,t,r){if(!this.shouldTrackPlayActivity(e,r))return;const n=this.dispatchTable.get(e);void 0!==n&&"function"==typeof this[n]&&this[n](r,t)}bufferStart(e,t){var r=this;return _asyncToGenerator$1((function*(){var n;if(tu.debug("VPAFTracker: handling bufferStart()"),!(yield r.canTrackItem(e)))return void tu.debug("VPAFTracker: aborting bufferStart, no tracker");if(r.state.currentState!==Yl.playing)return void tu.debug("VPAFTracker: aborting bufferStart, not playing");if("seek"===(null===(n=r.lastTrackedEvent)||void 0===n?void 0:n.reason))return void tu.debug("VPAFTracker: aborting bufferStart, after a seek");const i=r.state.currentContext.fromInitialPlay,a=r.calculatePlaybackPosition(e,ensurePositionData(t,e));r.state.transition(Ql.bufferStart),i?tu.debug("VPAFTracker: bufferStart() not tracking PLAY_STOPPED, it is from initial play"):r.trackEvent("playStopped",a)}))()}bufferEnd(e,t){var r=this;return _asyncToGenerator$1((function*(){var n;if(tu.debug("VPAFTracker: handling bufferEnd()"),!(yield r.canTrackItem(e)))return;if(r.state.currentState!==Yl.buffering)return void tu.debug("VPAFTracker: aborting bufferEnd, not buffering");if("seek"===(null===(n=r.lastTrackedEvent)||void 0===n?void 0:n.reason))return void tu.debug("VPAFTracker: aborting bufferEnd, after a seek");const i=r.state.currentContext.fromInitialPlay,a=r.calculatePlaybackPosition(e,ensurePositionData(t,e));r.state.transition(Ql.bufferStop),i?tu.debug("VPAFTracker: bufferEnd() not tracking PLAY_STARTED, it is from initial play"):r.trackEvent("playStarted",a)}))()}exit(e,t={}){var r=this;return _asyncToGenerator$1((function*(){(yield r.canTrackItem(r.currentItem))&&(tu.debug("VPAFTracker.exit()"),r.state.transition(Ql.exit),r.trackEvent("playStopped",r.calculatePlaybackPosition(void 0,ensurePositionData(t,t.item))),r.stopSynchronizing(),r.currentItem=void 0)}))()}pause(e,t={}){var r=this;return _asyncToGenerator$1((function*(){if(!(yield r.canTrackItem(e)))return;tu.debug("VPAFTracker.pause()");const n=r.calculatePlaybackPosition(e,ensurePositionData(t,e)),i=t.endReasonType===da.NEXT_ITEM?Ql.next:Ql.pause;r.state.transition(i,r.getExplicitStateContext(t)),r.trackEvent("playStopped",n)}))()}play(e,t={}){var r=this;return _asyncToGenerator$1((function*(){if(!(yield r.canTrackItem(e)))return;tu.debug("VPAFTracker.play()");const n=r.calculatePlaybackPosition(e,_objectSpread$2({position:0},t));r.state.transition(Ql.play,r.getExplicitStateContext(t)),r.trackEvent("playStarted",n)}))()}scrub(e,t={}){var r=this;return _asyncToGenerator$1((function*(){if(void 0===e||void 0===t.position)return;const n=r.calculatePlaybackPosition(e,ensurePositionData(t,e));r.isScrubbing&&void 0===t.endReasonType?r.scrubStopPosition=n:r.isScrubbing&&r.scrubEnd(e,n)}))()}seek(e,t={}){var r=this;return _asyncToGenerator$1((function*(){void 0!==e&&(!e.isLinearStream||void 0!==t.playingDate&&void 0!==t.startPlayingDate)&&(e.isLinearStream||void 0!==t.position&&void 0!==t.startPosition)&&(r.isSkippingIntro(t)||r.isSeekingInterval(t)?yield r.trackSeek(e,t):yield r.trackScrub(e,t))}))()}skip(e,t={}){return _asyncToGenerator$1((function*(){}))()}stop(e,t={}){var r=this;return _asyncToGenerator$1((function*(){if(!(yield r.canTrackItem(e)))return;tu.debug("VPAFTracker.stop()");const n=r.calculatePlaybackPosition(e,ensurePositionData(t,e));r.state.transition(Ql.stop,r.getExplicitStateContext(t)),r.trackEvent("playStopped",n),r.stopSynchronizing(),r.currentItem=void 0}))()}lyricsPlay(e,t){return _asyncToGenerator$1((function*(){}))()}lyricsStop(){return _asyncToGenerator$1((function*(){}))()}trackSeek(e,t){var r=this;return _asyncToGenerator$1((function*(){const n={},i=r.getSkipActionName(t.position);r.isSkippingIntro(t)&&"string"==typeof i&&(n.actionName=i);const a=_objectSpreadProps(_objectSpread$2({},t),{position:t.startPosition,playingDate:t.startPlayingDate});yield r.trackSeekStart(e,a,n),yield r.trackSeekStop(e,t,n)}))()}trackSeekStart(t,r,n={}){var i=this;return _asyncToGenerator$1((function*(){const a=r.seekReasonType===e.SeekReasonType.SkipIntro?i.tracker.SEEK_START_REASON.SKIP_INTRO:i.tracker.SEEK_START_REASON.INTERVAL,o=i.calculatePlaybackPosition(t,ensurePositionData(r,t)),s=i.tracker.TYPE.MANUAL;if(i.state.currentState===Yl.playing){const e=i.isSkippingIntro(r)?_objectSpreadProps(_objectSpread$2({},n),{stopReasonType:i.tracker.PLAY_STOP_REASON_TYPE.SKIP_INTRO}):n;i.trackEvent("playStopped",o,s,i.tracker.PLAY_STOP_REASON.SEEK,e)}i.trackEvent("seekStarted",o,s,a,n)}))()}trackSeekStop(e,t,r={}){var n=this;return _asyncToGenerator$1((function*(){const i=n.isSeekingInterval(t)?n.tracker.SEEK_STOP_REASON.INTERVAL:n.tracker.SEEK_STOP_REASON.SKIP_INTRO,a=n.calculatePlaybackPosition(e,ensurePositionData(t,e)),o=n.tracker.TYPE.AUTOMATIC;if(n.trackEvent("seekStopped",a,o,i,r),n.state.currentState===Yl.playing){const e=n.isSkippingIntro(t)?_objectSpreadProps(_objectSpread$2({},r),{startReasonType:n.tracker.PLAY_START_REASON_TYPE.SKIP_INTRO}):r;n.trackEvent("playStarted",a,o,n.tracker.PLAY_START_REASON.SEEK,e)}}))()}trackScrub(e,t){var r=this;return _asyncToGenerator$1((function*(){const n=e.isLinearStream?t.playingDate.getTime():asMilliseconds(t.position),i=e.isLinearStream?t.startPlayingDate.getTime():asMilliseconds(t.startPosition);yield r.scrubStart(e,i),yield r.scrubEnd(e,n)}))()}scrubStart(e,t){var r=this;return _asyncToGenerator$1((function*(){(yield r.canTrackItem(e))&&(r.isScrubbing=!0,r.scrubStopPosition=t,r.state.currentState===Yl.playing&&r.trackEvent("playStopped",r.scrubStopPosition,r.tracker.TYPE.AUTOMATIC,r.tracker.PLAY_STOP_REASON.SEEK),r.trackEvent("seekStarted",t,r.tracker.TYPE.MANUAL,r.tracker.SEEK_START_REASON.SCRUB))}))()}scrubEnd(e,t){var r=this;return _asyncToGenerator$1((function*(){r.trackEvent("seekStopped",t,r.tracker.TYPE.MANUAL,r.tracker.SEEK_STOP_REASON.SCRUB),r.state.currentState===Yl.playing&&r.trackEvent("playStarted",t,r.tracker.TYPE.AUTOMATIC,r.tracker.PLAY_START_REASON.SEEK),r.isScrubbing=!1,r.scrubStopPosition=void 0}))()}trackEvent(e,t,r,n,i){void 0===r&&(r=this.tracker.TYPE[this.state.currentContext.manual]),void 0===n&&(n="playStarted"===e?this.tracker.PLAY_START_REASON[this.state.currentContext.reason]:this.tracker.PLAY_STOP_REASON[this.state.currentContext.reason]),tu.debug(`VPAFTracker.trackEvent(${e}, ${t}, ${r}, ${n})`,i),this.tracker[e].call(this.tracker,Math.round(t),r,n,i),this.lastTrackedEvent={eventType:e,position:t,type:r,reason:n,namedArgs:i}}calculatePlaybackPosition(e,t){if(null==e?void 0:e.isLinearStream){if(void 0===t.playingDate)throw new Error("VPAF: Can't report playback position for linear stream without playingDate value");return t.playingDate.getTime()}var r;return asMilliseconds(null!==(r=t.position)&&void 0!==r?r:0)}createTracker(e){var t=this;return _asyncToGenerator$1((function*(){const r=e.defaultPlayable,n=function(e){var t;const r={url:e.attributes.url,assetId:null==e||null===(t=e.hlsMetadata)||void 0===t?void 0:t["feature.adam-id"]};e.isLinearStream||(r.assetPlacement="feature");!0===e.attributes.isAdultContent&&(r.sensitiveContentType="adult");return r}(e),i=parseRollItems(e).map(e=>{const t={start:e.start,duration:e.duration,metricsData:{assetPlacement:e.type.replace("-",""),assetId:e["adam-id"],isSkippable:e.skippable}};return void 0!==e["dynamic-id"]&&(t.metricsData["data.dynamicSlot.dataSetId"]=e["dynamic-id"]),t});tu.debug("VPAF: Creating HLS Playlist",n);const a=Bl.mediaActivityTracker.createHLSVideoPlaylist(0,n);tu.debug("VPAF: adding roll items",i),a.addRollInfoItems(i);const o=_objectSpreadProps(_objectSpread$2({},r.vpafMetrics,function(e,t,r){var n;const i=null==e||null===(n=e.videoContainerElement)||void 0===n?void 0:n.querySelector("video"),a={programmingType:t.isLinearStream?"live":"videoOnDemand",downloadState:"streaming",playbackFocus:"foreground",videoViewportHeight:null==i?void 0:i.clientHeight,videoViewportWidth:null==i?void 0:i.clientWidth,delegatedPlayback:determineDelegatedPlayback(e)},o=currentAudioData(e,r),s=function(e,t){var r;const{language:n,kind:i}=null!==(r=e.currentTextTrack)&&void 0!==r?r:{};if("captions"===i)return{subtitleLocale:void 0,closedCaptionLocale:n};if("subtitles"===i)return{subtitleLocale:n,closedCaptionLocale:void 0};return{subtitleLocale:void 0,closedCaptionLocale:void 0}}(e);return _objectSpread$2({},a,o,s)}(t.instance,e,r)),{overallLength:calculateOverallLength(e,r,i),featureAssetId:n.assetId});return tu.debug("VPAFTracker.createTracker: creating new tracker for "+(null==e?void 0:e.id)),t.tracker=Bl.mediaActivityTracker.createTracker(a,Bl.utils.eventFields.applyFieldsMap(r,"utsVpafPlayable"),Bl.utils.eventFields.applyFieldsMap(e.attributes,"utsVpafContent"),o),t.startSynchronizing(),t.tracker}))()}getMappedStopReason(e){if(void 0!==e.endReasonType)return iu[e.endReasonType]}getExplicitStateContext(e){return{manual:e.userInitiated,reason:this.getMappedStopReason(e)}}onPlaybackStateChange(t,r){var n=this;return _asyncToGenerator$1((function*(){const{state:t}=r,i=n.currentItem;var a;const o={position:n.instance.currentPlaybackTime,playingDate:n.instance.currentPlayingDate,userInitiated:null!==(a=r.userInitiated)&&void 0!==a&&a},s="PlaybackStates."+e.PlaybackStates[r.oldState],c="PlaybackStates."+e.PlaybackStates[r.state];tu.debug(`onPlaybackStateChange: ${s} -> ${c}`,o),t===e.PlaybackStates.waiting?(n.isBuffering=!0,tu.debug("VPAFTracker.onPlaybackStateChange: triggering bufferStart()",o),yield n.bufferStart(i,o)):t===e.PlaybackStates.playing?n.isBuffering&&(n.isBuffering=!1,tu.debug("VPAFTracker.onPlaybackStateChange: triggering bufferEnd()",o),yield n.bufferEnd(i,o)):t!==e.PlaybackStates.stalled&&(tu.debug("VPAFTracker.onPlaybackStateChange: resetting isBuffering=false"),n.isBuffering=!1)}))()}handleLevelUpdated(e,t){var r;const{level:n,channels:i}=t;if(!n)return;const{audioCodec:a,videoRange:o,videoCodec:s}=n;if(!(a&&i||o&&s))return;const c={};a&&i&&(c.audioFormat=((e,t)=>{var r;const n=null!==(r=null==e?void 0:e.toLowerCase())&&void 0!==r?r:"";var i;return isAtmos(n,t)?"Atmos":null!==(i=Kl[n])&&void 0!==i?i:e})(a,i)),o&&s&&(c.videoColorRange=convertToVideoColorRange(s,o)),null===(r=this.tracker)||void 0===r||r.updateData(c)}handleAudioTrackChange(){if(void 0===this.tracker||void 0===this.instance)return;const e=currentAudioData(this.instance);e&&(tu.debug("Updating AudioData",e),this.tracker.updateData(e))}handleForcedTextTrackChange(e,t){var r;null===(r=this.tracker)||void 0===r||r.updateData({forcedSubtitleLocale:null==t?void 0:t.language})}handlePresentationModeChange(e,{mode:t}){var r,n;const i=null!==(n=au[t])&&void 0!==n?n:au._default;null===(r=this.tracker)||void 0===r||r.updateData({playbackFocus:i})}handleTargetWirelessChange(){var e;void 0!==this.instance&&(null===(e=this.tracker)||void 0===e||e.updateData({delegatedPlayback:determineDelegatedPlayback(this.instance)}))}handleTextTrackChange(){var e;const{tracker:t}=this;if(void 0===t)return;const r=null===(e=this.instance)||void 0===e?void 0:e.currentTextTrack;if(!r||"captions"!==r.kind&&"subtitles"!==(null==r?void 0:r.kind))return;const n=""===r.language?void 0:r.language,i={closedCaptionLocale:"captions"===r.kind?n:void 0,subtitleLocale:"subtitles"===r.kind?n:void 0};t.updateData(i)}handleNowPlayingItemDidChange(e,t){const{item:r}=t;r||(tu.debug("handleNowPlayingItemDidChange: calling exit and clearing currentItem"),this.state.transition(Ql.exit),this.stopSynchronizing(),this.currentItem=void 0)}isSkippingIntro(t){return t.seekReasonType===e.SeekReasonType.SkipIntro}isSeekingInterval(t){return t.seekReasonType===e.SeekReasonType.Interval}canTrackItem(e){var t=this;return _asyncToGenerator$1((function*(){var r;return void 0!==e&&void 0!==e.defaultPlayable&&((null===(r=t.currentItem)||void 0===r?void 0:r.id)!==e.id&&(t.state.transition(Ql.newItem),t.currentItem=e,yield t.createTracker(e)),void 0!==t.tracker)}))()}getSkipActionName(e){var t;const r=(null!==(t=this.currentSkipItems)&&void 0!==t?t:[]).find(t=>t.target===e);return null==r?void 0:r.label}onVideoComponentScrubStart(e){return this.scrubStart(this.currentItem,asMilliseconds(e.detail.currentSeconds))}setupListeners(){void 0!==this.dispatcher&&(this.dispatcher.subscribe(Ii.audioTrackChanged,this.handleAudioTrackChange),this.dispatcher.subscribe(Ii.textTrackChanged,this.handleTextTrackChange),this.dispatcher.subscribe(Ii.forcedTextTrackChanged,this.handleForcedTextTrackChange),this.dispatcher.subscribe(Ii.nowPlayingItemDidChange,this.handleNowPlayingItemDidChange),this.dispatcher.subscribe(Ii.playbackStateDidChange,this.onPlaybackStateChange),this.dispatcher.subscribe(zt.hlsLevelUpdated,this.handleLevelUpdated),this.dispatcher.subscribe(Ii.playbackTargetIsWirelessDidChange,this.handleTargetWirelessChange),this.dispatcher.subscribe(Ii.presentationModeDidChange,this.handlePresentationModeChange)),At||window.addEventListener("triggerSeekStart",this.onVideoComponentScrubStart)}teardownListeners(){void 0!==this.dispatcher&&(this.dispatcher.unsubscribe(Ii.audioTrackChanged,this.handleAudioTrackChange),this.dispatcher.unsubscribe(Ii.textTrackChanged,this.handleTextTrackChange),this.dispatcher.unsubscribe(Ii.forcedTextTrackChanged,this.handleForcedTextTrackChange),this.dispatcher.unsubscribe(Ii.nowPlayingItemDidChange,this.handleNowPlayingItemDidChange),this.dispatcher.unsubscribe(Ii.playbackStateDidChange,this.onPlaybackStateChange),this.dispatcher.unsubscribe(zt.hlsLevelUpdated,this.handleLevelUpdated),this.dispatcher.unsubscribe(Ii.playbackTargetIsWirelessDidChange,this.handleTargetWirelessChange),this.dispatcher.unsubscribe(Ii.presentationModeDidChange,this.handlePresentationModeChange)),At||window.removeEventListener("triggerSeekStart",this.onVideoComponentScrubStart)}startSynchronizing(){void 0===this.synchronizeTimeout&&(this.synchronizeTimeout=setInterval(this.synchronize,6e4))}stopSynchronizing(){void 0!==this.synchronizeTimeout&&(clearInterval(this.synchronizeTimeout),this.synchronizeTimeout=void 0)}synchronize(){if(void 0===this.tracker||void 0===this.instance||void 0===this.currentItem)return void this.stopSynchronizing();const e=this.state.currentState===Yl.paused,{playbackRate:t,currentPlaybackTime:r}=this.instance,n=e?0:t,i=Math.round(1e3*r);tu.debug(`VPAF: synchronize rate: ${n} and current time: ${i}`),this.tracker.synchronize(n,i)}constructor(){this.isScrubbing=!1,this.isBuffering=!1,this.vpafKitInited=!1,this.lastTrackedEvent=void 0,this.dispatchTable=new Map([[zt.playbackPlay,"play"],[zt.playbackPause,"pause"],[zt.playbackScrub,"scrub"],[zt.playbackSeek,"seek"],[zt.playbackSkip,"skip"],[zt.playbackStop,"stop"],[zt.playerExit,"exit"]]),this.state=new VPAFStateMachine,Bl.config.setDelegate({configHostname:()=>"daf.xp.apple.com"})}}function calculateOverallLength(e,t,r){if("EbsEvent"===t.type)return;var n;let i=parseFloat(null!==(n=e.hlsMetadata["feature.duration"])&&void 0!==n?n:t.duration);for(const a of r)i+=a.duration;return asMilliseconds(i)}function currentAudioData(e,t){const{currentAudioTrack:r,nowPlayingItem:n}=e;let i,a;var o,s;"description"===(null==r?void 0:r.kind)?(a=null==r?void 0:r.language,i=void 0):(i=null!==(s=null==r?void 0:r.language)&&void 0!==s?s:null==t||null===(o=t.primaryLocale)||void 0===o?void 0:o.locale,a=void 0);let c;return(null==n?void 0:n.isLinearStream)&&r&&(isHomeRadioTrack(r)?c=nn.Home:isAwayRadioTrack(r)&&(c=nn.Away)),{audioLocale:i,audioDescriptionLocale:a,audioVariantId:c}}function determineDelegatedPlayback(e){return e.playbackTargetIsWireless?"Airplay":"None"}function _defineProperty$1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",[String,Object])],VPAFTracker.prototype,"onPlaybackStateChange",null),Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",[Object,Object])],VPAFTracker.prototype,"handleLevelUpdated",null),Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",[])],VPAFTracker.prototype,"handleAudioTrackChange",null),Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",[Object,Object])],VPAFTracker.prototype,"handleForcedTextTrackChange",null),Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",[Object,void 0])],VPAFTracker.prototype,"handlePresentationModeChange",null),Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",[])],VPAFTracker.prototype,"handleTargetWirelessChange",null),Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",[])],VPAFTracker.prototype,"handleTextTrackChange",null),Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",[String,Object])],VPAFTracker.prototype,"handleNowPlayingItemDidChange",null),Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",["undefined"==typeof CustomEvent?Object:CustomEvent])],VPAFTracker.prototype,"onVideoComponentScrubStart",null),Zl([Bind(),eu("design:type",Function),eu("design:paramtypes",[])],VPAFTracker.prototype,"synchronize",null);const augmentUrlQueryParameters=e=>addQueryParamsToURL(e,{webbrowser:!0}),addPreviewFromPlayable=(e,t)=>{var r,n,i,a;const o=null!==(a=null!==(i=null===(r=t.assets)||void 0===r?void 0:r.hlsUrl)&&void 0!==i?i:t.hlsUrl)&&void 0!==a?a:null===(n=t.clipAssets)||void 0===n?void 0:n[0].url;e.previews=o?[{url:augmentUrlQueryParameters(o)}]:[]},addKeysFromPlayable=(e,t)=>{const{assets:r}=t;r&&(r.fpsKeyServerUrl&&(e.keyServerQueryParameters=r.fpsKeyServerQueryParameters,e.keyURLs={"hls-key-cert-url":r.fpsCertificateUrl,"hls-key-server-url":r.fpsKeyServerUrl,"widevine-cert-url":r.wideVineCertificateUrl}),e.assetURL=augmentUrlQueryParameters(r.hlsUrl))},addPlayableToItem=(e,t,r)=>{var n,i,a,o,s,c;e.type=null!==(i=null!==(n=e.type)&&void 0!==n?n:t.type)&&void 0!==i?i:r,e.contentType=null!==(a=e.contentType)&&void 0!==a?a:t.contentType,e.attributes=null!==(o=e.attributes)&&void 0!==o?o:{},e.attributes.title=null!==(c=null!==(s=e.attributes.title)&&void 0!==s?s:e.title)&&void 0!==c?c:t.title,delete e.title,addPreviewFromPlayable(e.attributes,t),addKeysFromPlayable(e,t),e.id||(e.id=generateUUID()),e.playables=[t]},createMediaItem=e=>{var t;const r=JSON.stringify(e),n=JSON.parse(r),i=null===(t=n.playables)||void 0===t?void 0:t[0];var a;n.attributes=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty$1(e,t,r[t])}))}return e}({},null!==(a=n.attributes)&&void 0!==a?a:{},n),addPlayableToItem(n,i);return new MediaItem(n)};function asyncGeneratorStep(e,t,r,n,i,a,o){try{var s=e[a](o),c=s.value}catch(Tt){return void r(Tt)}s.done?t(c):Promise.resolve(c).then(n,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function _next(e){asyncGeneratorStep(a,n,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(a,n,i,_next,_throw,"throw",e)}_next(void 0)}))}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){_defineProperty(e,t,r[t])}))}return e}const ou={mediaApi:{configureFn:ds,apiType:e.SupportedAPIs.MEDIA_API,allowDefault:!1},utsClient:{configureFn:function(e){return _configure$1.apply(this,arguments)},apiType:e.SupportedAPIs.UTS_CLIENT,allowDefault:!1}},createAPIConfiguration=(e,t)=>{var r,n;const{configureFn:i,apiType:a,allowDefault:o}=ou[e];var s;const c=((e,...t)=>{const r={};return Object.keys(e).forEach(n=>{t.includes(n)||(r[n]=e[n])}),r})(null!==(s=t.apiOptions)&&void 0!==s?s:{},"mediaApi","utsClient"),l={apiType:a,configureFn:i,options:{}};if(null===(r=t.apiOptions)||void 0===r||null===(n=r[e])||void 0===n?void 0:n.api)l.options.api=t.apiOptions[e].api;else{var u,d,p,h;const r=o?c:{};var y,f,m;l.options.apiOptions=null!==(m=null!==(f=null!==(y=null===(u=t.apiOptions)||void 0===u||null===(d=u[e])||void 0===d?void 0:d.configureOptions)&&void 0!==y?y:null===(p=t.apiOptions)||void 0===p||null===(h=p[e])||void 0===h?void 0:h.apiOptions)&&void 0!==f?f:r)&&void 0!==m?m:{}}return l};class MediaKitInstance extends MKInstance{playUtsItem(e,t,r){var n=this;return _asyncToGenerator((function*(){e=JSON.parse(JSON.stringify(e)),t?t=JSON.parse(JSON.stringify(t)):"EditorialVideoClip"===(t=JSON.parse(JSON.stringify(e))).type&&(t.type="Vod");const{id:i,type:a}=e,o={id:i,type:a,attributes:_objectSpread({},e),playables:[t]};"Show"===a?(o.attributes.showId=e.id,o.attributes.showTitle=o.attributes.title,o.attributes.title=t.title):"Season"===a&&(o.attributes.title=t.title),addPreviewFromPlayable(o.attributes,t),addKeysFromPlayable(o,t);const s=new MediaItem(o);return n.playMediaItem(s,r)}))()}}function _configure(){return(_configure=_asyncToGenerator((function*(t){Xi.linkChild(Li),Xi.linkChild(Ot),Xi.linkChild(W),t.playActivityAPI=[new VPAFTracker,new BookmarkTracker],t.realm=e.SKRealm.TV,t.rtcOptions&&t.playActivityAPI.push(new RTCStreamingTracker(t.rtcOptions));return yield configure$3(t,MediaKitInstance,function(){var e=_asyncToGenerator((function*(e){var r,n;const i=[];(null===(r=t.apiOptions)||void 0===r?void 0:r.utsClient)&&i.push(createAPIConfiguration("utsClient",t)),(null===(n=t.apiOptions)||void 0===n?void 0:n.mediaApi)&&i.push(createAPIConfiguration("mediaApi",t)),yield e.configure(i)}));return function(t){return e.apply(this,arguments)}}())}))).apply(this,arguments)}e.Events=Ii,e.MKError=MKError,e.MediaKitInstance=MediaKitInstance,e.PlayActivityEndReasonType=da,e.VideoTypes={movie:!0,musicVideo:!0,musicMovie:!0,trailer:!0,tvEpisode:!0,uploadedVideo:!0,"uploaded-videos":!0,"music-videos":!0,"music-movies":!0,"tv-episodes":!0,Bonus:!0,Extra:!0,Episode:!0,Movie:!0,Preview:!0,Promotional:!0,Season:!0,Show:!0,Vod:!0,EditorialVideoClip:!0,RealityVideo:!0,SportingEvent:!0,LiveService:!0},e.__dev=O,e.__log=Zi,e.configure=function(e){return _configure.apply(this,arguments)},e.createMediaItem=createMediaItem,e.createMediaItemFromPlayable=(e,t="Show")=>{if(Array.isArray(e.playables))return createMediaItem(e);const r=JSON.stringify(e),n=JSON.parse(r),i={id:n.id};addPlayableToItem(i,n,t);return new MediaItem(i)},e.enableMultipleInstances=function(){Ho=!0},e.formatArtworkURL=formatArtworkURL,e.formatMediaTime=function(e,t=":"){const{hours:r,minutes:n}=formattedSeconds(e);e=Math.floor(e%3600%60);const i=[];return r?(i.push(""+r),i.push(n<10?"0"+n:""+n)):i.push(""+n),i.push(e<10?"0"+e:""+e),i.join(t)},e.formattedMediaURL=formattedMediaURL,e.formattedMilliseconds=function(e){return formattedSeconds(e/1e3)},e.formattedSeconds=formattedSeconds,e.generateEmbedCode=function(e,t={height:"450",width:"660"}){if(!b.test(e))throw new Error("Invalid content url");var r;let n=null!==(r=t.height)&&void 0!==r?r:"450";var i;let a=null!==(i=t.width)&&void 0!==i?i:"660";const{kind:o,isUTS:s}=formattedMediaURL(e),c="post"===o||"musicVideo"===o||s;"song"===o||"episode"===o?n="175":c&&(n=""+Math.round(.5625*parseInt(a,10))),n=(""+n).replace(/(\d+)px/i,"$1"),a=(""+a).replace(/^(\d+)(?!px)%?$/i,"$1px");const l=(c?"width:"+a:"width:100%;"+(a?"max-width:"+a:""))+";overflow:hidden;border-radius:10px;";let u="https://embed.music.apple.com";return["podcast","episode"].includes(o)&&!s&&(u="https://embed.podcasts.apple.com"),["movie","episode","season","show"].includes(o)&&s&&(u="https://embed.tv.apple.com"),`<iframe ${[`allow="${S.join("; ")}"`,'frameborder="0"',n?`height="${n}"`:"",`style="${l}"`,`sandbox="${_.join(" ")}"`,`src="${e.replace(b,u)}"`].join(" ")}></iframe>`},e.getHlsJsCdnConfig=getHlsJsCdnConfig,e.getInstance=function(e){if(0!==Wo.length)return void 0===e?Wo[Wo.length-1]:Wo.find(t=>t.id===e)},e.getInstances=function(){return Wo},e.getPlayerType=getPlayerType,Object.defineProperty(e,"__esModule",{value:!0})}));
